!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("PhotoEditorCloud",[],e):"object"==typeof exports?exports.PhotoEditorCloud=e():t.PhotoEditorCloud=e()}(window,function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=52)}([function(t,e){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e){var i,n,r=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(i===setTimeout)return setTimeout(t,0);if((i===o||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:o}catch(t){i=o}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(t){n=s}}();var c,l=[],h=!1,u=-1;function f(){h&&c&&(h=!1,c.length?l=c.concat(l):u=-1,l.length&&d())}function d(){if(!h){var t=a(f);h=!0;for(var e=l.length;e;){for(c=l,l=[];++u<e;)c&&c[u].run();u=-1,e=l.length}c=null,h=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function g(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];l.push(new p(t,e)),1!==l.length||h||a(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=g,r.addListener=g,r.once=g,r.off=g,r.removeListener=g,r.removeAllListeners=g,r.emit=g,r.prependListener=g,r.prependOnceListener=g,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},function(t,e,i){"use strict";(function(t){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var n=i(49),r=i(48),o=i(25);function s(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(t,e){if(s()<e)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=c.prototype:(null===t&&(t=new c(e)),t.length=e),t}function c(t,e,i){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(t,e,i);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return u(this,t)}return l(this,t,e,i)}function l(t,e,i,n){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,i,n){if(e.byteLength,i<0||e.byteLength<i)throw new RangeError("'offset' is out of bounds");if(e.byteLength<i+(n||0))throw new RangeError("'length' is out of bounds");e=void 0===i&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,i):new Uint8Array(e,i,n);c.TYPED_ARRAY_SUPPORT?(t=e).__proto__=c.prototype:t=f(t,e);return t}(t,e,i,n):"string"==typeof e?function(t,e,i){"string"==typeof i&&""!==i||(i="utf8");if(!c.isEncoding(i))throw new TypeError('"encoding" must be a valid string encoding');var n=0|p(e,i),r=(t=a(t,n)).write(e,i);r!==n&&(t=t.slice(0,r));return t}(t,e,i):function(t,e){if(c.isBuffer(e)){var i=0|d(e.length);return 0===(t=a(t,i)).length?t:(e.copy(t,0,0,i),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||function(t){return t!=t}(e.length)?a(t,0):f(t,e);if("Buffer"===e.type&&o(e.data))return f(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function h(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function u(t,e){if(h(e),t=a(t,e<0?0:0|d(e)),!c.TYPED_ARRAY_SUPPORT)for(var i=0;i<e;++i)t[i]=0;return t}function f(t,e){var i=e.length<0?0:0|d(e.length);t=a(t,i);for(var n=0;n<i;n+=1)t[n]=255&e[n];return t}function d(t){if(t>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|t}function p(t,e){if(c.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var i=t.length;if(0===i)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return X(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return z(t).length;default:if(n)return X(t).length;e=(""+e).toLowerCase(),n=!0}}function g(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function v(t,e,i,n,r){if(0===t.length)return-1;if("string"==typeof i?(n=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,isNaN(i)&&(i=r?0:t.length-1),i<0&&(i=t.length+i),i>=t.length){if(r)return-1;i=t.length-1}else if(i<0){if(!r)return-1;i=0}if("string"==typeof e&&(e=c.from(e,n)),c.isBuffer(e))return 0===e.length?-1:m(t,e,i,n,r);if("number"==typeof e)return e&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(t,e,i):Uint8Array.prototype.lastIndexOf.call(t,e,i):m(t,[e],i,n,r);throw new TypeError("val must be string, number or Buffer")}function m(t,e,i,n,r){var o,s=1,a=t.length,c=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;s=2,a/=2,c/=2,i/=2}function l(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(r){var h=-1;for(o=i;o<a;o++)if(l(t,o)===l(e,-1===h?0:o-h)){if(-1===h&&(h=o),o-h+1===c)return h*s}else-1!==h&&(o-=o-h),h=-1}else for(i+c>a&&(i=a-c),o=i;o>=0;o--){for(var u=!0,f=0;f<c;f++)if(l(t,o+f)!==l(e,f)){u=!1;break}if(u)return o}return-1}function b(t,e,i,n){i=Number(i)||0;var r=t.length-i;n?(n=Number(n))>r&&(n=r):n=r;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var s=0;s<n;++s){var a=parseInt(e.substr(2*s,2),16);if(isNaN(a))return s;t[i+s]=a}return s}function y(t,e,i,n){return Y(X(e,t.length-i),t,i,n)}function _(t,e,i,n){return Y(function(t){for(var e=[],i=0;i<t.length;++i)e.push(255&t.charCodeAt(i));return e}(e),t,i,n)}function x(t,e,i,n){return _(t,e,i,n)}function w(t,e,i,n){return Y(z(e),t,i,n)}function S(t,e,i,n){return Y(function(t,e){for(var i,n,r,o=[],s=0;s<t.length&&!((e-=2)<0);++s)i=t.charCodeAt(s),n=i>>8,r=i%256,o.push(r),o.push(n);return o}(e,t.length-i),t,i,n)}function C(t,e,i){return 0===e&&i===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,i))}function O(t,e,i){i=Math.min(t.length,i);for(var n=[],r=e;r<i;){var o,s,a,c,l=t[r],h=null,u=l>239?4:l>223?3:l>191?2:1;if(r+u<=i)switch(u){case 1:l<128&&(h=l);break;case 2:128==(192&(o=t[r+1]))&&(c=(31&l)<<6|63&o)>127&&(h=c);break;case 3:o=t[r+1],s=t[r+2],128==(192&o)&&128==(192&s)&&(c=(15&l)<<12|(63&o)<<6|63&s)>2047&&(c<55296||c>57343)&&(h=c);break;case 4:o=t[r+1],s=t[r+2],a=t[r+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&c<1114112&&(h=c)}null===h?(h=65533,u=1):h>65535&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|1023&h),n.push(h),r+=u}return function(t){var e=t.length;if(e<=k)return String.fromCharCode.apply(String,t);var i="",n=0;for(;n<e;)i+=String.fromCharCode.apply(String,t.slice(n,n+=k));return i}(n)}e.Buffer=c,e.SlowBuffer=function(t){+t!=t&&(t=0);return c.alloc(+t)},e.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=s(),c.poolSize=8192,c._augment=function(t){return t.__proto__=c.prototype,t},c.from=function(t,e,i){return l(null,t,e,i)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(t,e,i){return function(t,e,i,n){return h(e),e<=0?a(t,e):void 0!==i?"string"==typeof n?a(t,e).fill(i,n):a(t,e).fill(i):a(t,e)}(null,t,e,i)},c.allocUnsafe=function(t){return u(null,t)},c.allocUnsafeSlow=function(t){return u(null,t)},c.isBuffer=function(t){return!(null==t||!t._isBuffer)},c.compare=function(t,e){if(!c.isBuffer(t)||!c.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var i=t.length,n=e.length,r=0,o=Math.min(i,n);r<o;++r)if(t[r]!==e[r]){i=t[r],n=e[r];break}return i<n?-1:n<i?1:0},c.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(t,e){if(!o(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return c.alloc(0);var i;if(void 0===e)for(e=0,i=0;i<t.length;++i)e+=t[i].length;var n=c.allocUnsafe(e),r=0;for(i=0;i<t.length;++i){var s=t[i];if(!c.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(n,r),r+=s.length}return n},c.byteLength=p,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)g(this,e,e+1);return this},c.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)g(this,e,e+3),g(this,e+1,e+2);return this},c.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)g(this,e,e+7),g(this,e+1,e+6),g(this,e+2,e+5),g(this,e+3,e+4);return this},c.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?O(this,0,t):function(t,e,i){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return j(this,e,i);case"utf8":case"utf-8":return O(this,e,i);case"ascii":return T(this,e,i);case"latin1":case"binary":return E(this,e,i);case"base64":return C(this,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,e,i);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}.apply(this,arguments)},c.prototype.equals=function(t){if(!c.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===c.compare(this,t)},c.prototype.inspect=function(){var t="",i=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,i).match(/.{2}/g).join(" "),this.length>i&&(t+=" ... ")),"<Buffer "+t+">"},c.prototype.compare=function(t,e,i,n,r){if(!c.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===i&&(i=t?t.length:0),void 0===n&&(n=0),void 0===r&&(r=this.length),e<0||i>t.length||n<0||r>this.length)throw new RangeError("out of range index");if(n>=r&&e>=i)return 0;if(n>=r)return-1;if(e>=i)return 1;if(e>>>=0,i>>>=0,n>>>=0,r>>>=0,this===t)return 0;for(var o=r-n,s=i-e,a=Math.min(o,s),l=this.slice(n,r),h=t.slice(e,i),u=0;u<a;++u)if(l[u]!==h[u]){o=l[u],s=h[u];break}return o<s?-1:s<o?1:0},c.prototype.includes=function(t,e,i){return-1!==this.indexOf(t,e,i)},c.prototype.indexOf=function(t,e,i){return v(this,t,e,i,!0)},c.prototype.lastIndexOf=function(t,e,i){return v(this,t,e,i,!1)},c.prototype.write=function(t,e,i,n){if(void 0===e)n="utf8",i=this.length,e=0;else if(void 0===i&&"string"==typeof e)n=e,i=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(i)?(i|=0,void 0===n&&(n="utf8")):(n=i,i=void 0)}var r=this.length-e;if((void 0===i||i>r)&&(i=r),t.length>0&&(i<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return b(this,t,e,i);case"utf8":case"utf-8":return y(this,t,e,i);case"ascii":return _(this,t,e,i);case"latin1":case"binary":return x(this,t,e,i);case"base64":return w(this,t,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,t,e,i);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var k=4096;function T(t,e,i){var n="";i=Math.min(t.length,i);for(var r=e;r<i;++r)n+=String.fromCharCode(127&t[r]);return n}function E(t,e,i){var n="";i=Math.min(t.length,i);for(var r=e;r<i;++r)n+=String.fromCharCode(t[r]);return n}function j(t,e,i){var n=t.length;(!e||e<0)&&(e=0),(!i||i<0||i>n)&&(i=n);for(var r="",o=e;o<i;++o)r+=N(t[o]);return r}function M(t,e,i){for(var n=t.slice(e,i),r="",o=0;o<n.length;o+=2)r+=String.fromCharCode(n[o]+256*n[o+1]);return r}function P(t,e,i){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>i)throw new RangeError("Trying to access beyond buffer length")}function A(t,e,i,n,r,o){if(!c.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>r||e<o)throw new RangeError('"value" argument is out of bounds');if(i+n>t.length)throw new RangeError("Index out of range")}function I(t,e,i,n){e<0&&(e=65535+e+1);for(var r=0,o=Math.min(t.length-i,2);r<o;++r)t[i+r]=(e&255<<8*(n?r:1-r))>>>8*(n?r:1-r)}function D(t,e,i,n){e<0&&(e=4294967295+e+1);for(var r=0,o=Math.min(t.length-i,4);r<o;++r)t[i+r]=e>>>8*(n?r:3-r)&255}function L(t,e,i,n,r,o){if(i+n>t.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function R(t,e,i,n,o){return o||L(t,0,i,4),r.write(t,e,i,n,23,4),i+4}function B(t,e,i,n,o){return o||L(t,0,i,8),r.write(t,e,i,n,52,8),i+8}c.prototype.slice=function(t,e){var i,n=this.length;if(t=~~t,e=void 0===e?n:~~e,t<0?(t+=n)<0&&(t=0):t>n&&(t=n),e<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t),c.TYPED_ARRAY_SUPPORT)(i=this.subarray(t,e)).__proto__=c.prototype;else{var r=e-t;i=new c(r,void 0);for(var o=0;o<r;++o)i[o]=this[o+t]}return i},c.prototype.readUIntLE=function(t,e,i){t|=0,e|=0,i||P(t,e,this.length);for(var n=this[t],r=1,o=0;++o<e&&(r*=256);)n+=this[t+o]*r;return n},c.prototype.readUIntBE=function(t,e,i){t|=0,e|=0,i||P(t,e,this.length);for(var n=this[t+--e],r=1;e>0&&(r*=256);)n+=this[t+--e]*r;return n},c.prototype.readUInt8=function(t,e){return e||P(t,1,this.length),this[t]},c.prototype.readUInt16LE=function(t,e){return e||P(t,2,this.length),this[t]|this[t+1]<<8},c.prototype.readUInt16BE=function(t,e){return e||P(t,2,this.length),this[t]<<8|this[t+1]},c.prototype.readUInt32LE=function(t,e){return e||P(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},c.prototype.readUInt32BE=function(t,e){return e||P(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},c.prototype.readIntLE=function(t,e,i){t|=0,e|=0,i||P(t,e,this.length);for(var n=this[t],r=1,o=0;++o<e&&(r*=256);)n+=this[t+o]*r;return n>=(r*=128)&&(n-=Math.pow(2,8*e)),n},c.prototype.readIntBE=function(t,e,i){t|=0,e|=0,i||P(t,e,this.length);for(var n=e,r=1,o=this[t+--n];n>0&&(r*=256);)o+=this[t+--n]*r;return o>=(r*=128)&&(o-=Math.pow(2,8*e)),o},c.prototype.readInt8=function(t,e){return e||P(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},c.prototype.readInt16LE=function(t,e){e||P(t,2,this.length);var i=this[t]|this[t+1]<<8;return 32768&i?4294901760|i:i},c.prototype.readInt16BE=function(t,e){e||P(t,2,this.length);var i=this[t+1]|this[t]<<8;return 32768&i?4294901760|i:i},c.prototype.readInt32LE=function(t,e){return e||P(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},c.prototype.readInt32BE=function(t,e){return e||P(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},c.prototype.readFloatLE=function(t,e){return e||P(t,4,this.length),r.read(this,t,!0,23,4)},c.prototype.readFloatBE=function(t,e){return e||P(t,4,this.length),r.read(this,t,!1,23,4)},c.prototype.readDoubleLE=function(t,e){return e||P(t,8,this.length),r.read(this,t,!0,52,8)},c.prototype.readDoubleBE=function(t,e){return e||P(t,8,this.length),r.read(this,t,!1,52,8)},c.prototype.writeUIntLE=function(t,e,i,n){(t=+t,e|=0,i|=0,n)||A(this,t,e,i,Math.pow(2,8*i)-1,0);var r=1,o=0;for(this[e]=255&t;++o<i&&(r*=256);)this[e+o]=t/r&255;return e+i},c.prototype.writeUIntBE=function(t,e,i,n){(t=+t,e|=0,i|=0,n)||A(this,t,e,i,Math.pow(2,8*i)-1,0);var r=i-1,o=1;for(this[e+r]=255&t;--r>=0&&(o*=256);)this[e+r]=t/o&255;return e+i},c.prototype.writeUInt8=function(t,e,i){return t=+t,e|=0,i||A(this,t,e,1,255,0),c.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},c.prototype.writeUInt16LE=function(t,e,i){return t=+t,e|=0,i||A(this,t,e,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):I(this,t,e,!0),e+2},c.prototype.writeUInt16BE=function(t,e,i){return t=+t,e|=0,i||A(this,t,e,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):I(this,t,e,!1),e+2},c.prototype.writeUInt32LE=function(t,e,i){return t=+t,e|=0,i||A(this,t,e,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):D(this,t,e,!0),e+4},c.prototype.writeUInt32BE=function(t,e,i){return t=+t,e|=0,i||A(this,t,e,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):D(this,t,e,!1),e+4},c.prototype.writeIntLE=function(t,e,i,n){if(t=+t,e|=0,!n){var r=Math.pow(2,8*i-1);A(this,t,e,i,r-1,-r)}var o=0,s=1,a=0;for(this[e]=255&t;++o<i&&(s*=256);)t<0&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+i},c.prototype.writeIntBE=function(t,e,i,n){if(t=+t,e|=0,!n){var r=Math.pow(2,8*i-1);A(this,t,e,i,r-1,-r)}var o=i-1,s=1,a=0;for(this[e+o]=255&t;--o>=0&&(s*=256);)t<0&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+i},c.prototype.writeInt8=function(t,e,i){return t=+t,e|=0,i||A(this,t,e,1,127,-128),c.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},c.prototype.writeInt16LE=function(t,e,i){return t=+t,e|=0,i||A(this,t,e,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):I(this,t,e,!0),e+2},c.prototype.writeInt16BE=function(t,e,i){return t=+t,e|=0,i||A(this,t,e,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):I(this,t,e,!1),e+2},c.prototype.writeInt32LE=function(t,e,i){return t=+t,e|=0,i||A(this,t,e,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):D(this,t,e,!0),e+4},c.prototype.writeInt32BE=function(t,e,i){return t=+t,e|=0,i||A(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):D(this,t,e,!1),e+4},c.prototype.writeFloatLE=function(t,e,i){return R(this,t,e,!0,i)},c.prototype.writeFloatBE=function(t,e,i){return R(this,t,e,!1,i)},c.prototype.writeDoubleLE=function(t,e,i){return B(this,t,e,!0,i)},c.prototype.writeDoubleBE=function(t,e,i){return B(this,t,e,!1,i)},c.prototype.copy=function(t,e,i,n){if(i||(i=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<i&&(n=i),n===i)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-i&&(n=t.length-e+i);var r,o=n-i;if(this===t&&i<e&&e<n)for(r=o-1;r>=0;--r)t[r+e]=this[r+i];else if(o<1e3||!c.TYPED_ARRAY_SUPPORT)for(r=0;r<o;++r)t[r+e]=this[r+i];else Uint8Array.prototype.set.call(t,this.subarray(i,i+o),e);return o},c.prototype.fill=function(t,e,i,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,i=this.length):"string"==typeof i&&(n=i,i=this.length),1===t.length){var r=t.charCodeAt(0);r<256&&(t=r)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!c.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<i)throw new RangeError("Out of range index");if(i<=e)return this;var o;if(e>>>=0,i=void 0===i?this.length:i>>>0,t||(t=0),"number"==typeof t)for(o=e;o<i;++o)this[o]=t;else{var s=c.isBuffer(t)?t:X(new c(t,n).toString()),a=s.length;for(o=0;o<i-e;++o)this[o+e]=s[o%a]}return this};var F=/[^+\/0-9A-Za-z-_]/g;function N(t){return t<16?"0"+t.toString(16):t.toString(16)}function X(t,e){var i;e=e||1/0;for(var n=t.length,r=null,o=[],s=0;s<n;++s){if((i=t.charCodeAt(s))>55295&&i<57344){if(!r){if(i>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(e-=3)>-1&&o.push(239,191,189);continue}r=i;continue}if(i<56320){(e-=3)>-1&&o.push(239,191,189),r=i;continue}i=65536+(r-55296<<10|i-56320)}else r&&(e-=3)>-1&&o.push(239,191,189);if(r=null,i<128){if((e-=1)<0)break;o.push(i)}else if(i<2048){if((e-=2)<0)break;o.push(i>>6|192,63&i|128)}else if(i<65536){if((e-=3)<0)break;o.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return o}function z(t){return n.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(F,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function Y(t,e,i,n){for(var r=0;r<n&&!(r+i>=e.length||r>=t.length);++r)e[r+i]=t[r];return r}}).call(this,i(0))},function(t,e,i){"use strict";var n=i(8),r=Object.keys||function(t){var e=[];for(var i in t)e.push(i);return e};t.exports=u;var o=i(6);o.inherits=i(2);var s=i(19),a=i(15);o.inherits(u,s);for(var c=r(a.prototype),l=0;l<c.length;l++){var h=c[l];u.prototype[h]||(u.prototype[h]=a.prototype[h])}function u(t){if(!(this instanceof u))return new u(t);s.call(this,t),a.call(this,t),t&&!1===t.readable&&(this.readable=!1),t&&!1===t.writable&&(this.writable=!1),this.allowHalfOpen=!0,t&&!1===t.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",f)}function f(){this.allowHalfOpen||this._writableState.ended||n.nextTick(d,this)}function d(t){t.end()}Object.defineProperty(u.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(t){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}}),u.prototype._destroy=function(t,e){this.push(null),this.end(),n.nextTick(e,t)}},function(t,e){},function(t,e,i){(function(t){function i(t){return Object.prototype.toString.call(t)}e.isArray=function(t){return Array.isArray?Array.isArray(t):"[object Array]"===i(t)},e.isBoolean=function(t){return"boolean"==typeof t},e.isNull=function(t){return null===t},e.isNullOrUndefined=function(t){return null==t},e.isNumber=function(t){return"number"==typeof t},e.isString=function(t){return"string"==typeof t},e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=function(t){return void 0===t},e.isRegExp=function(t){return"[object RegExp]"===i(t)},e.isObject=function(t){return"object"==typeof t&&null!==t},e.isDate=function(t){return"[object Date]"===i(t)},e.isError=function(t){return"[object Error]"===i(t)||t instanceof Error},e.isFunction=function(t){return"function"==typeof t},e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=t.isBuffer}).call(this,i(3).Buffer)},function(t,e,i){var n=i(3),r=n.Buffer;function o(t,e){for(var i in t)e[i]=t[i]}function s(t,e,i){return r(t,e,i)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?t.exports=n:(o(n,e),e.Buffer=s),o(r,s),s.from=function(t,e,i){if("number"==typeof t)throw new TypeError("Argument must not be a number");return r(t,e,i)},s.alloc=function(t,e,i){if("number"!=typeof t)throw new TypeError("Argument must be a number");var n=r(t);return void 0!==e?"string"==typeof i?n.fill(e,i):n.fill(e):n.fill(0),n},s.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return r(t)},s.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return n.SlowBuffer(t)}},function(t,e,i){"use strict";(function(e){!e.version||0===e.version.indexOf("v0.")||0===e.version.indexOf("v1.")&&0!==e.version.indexOf("v1.8.")?t.exports={nextTick:function(t,i,n,r){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var o,s,a=arguments.length;switch(a){case 0:case 1:return e.nextTick(t);case 2:return e.nextTick(function(){t.call(null,i)});case 3:return e.nextTick(function(){t.call(null,i,n)});case 4:return e.nextTick(function(){t.call(null,i,n,r)});default:for(o=new Array(a-1),s=0;s<o.length;)o[s++]=arguments[s];return e.nextTick(function(){t.apply(null,o)})}}}:t.exports=e}).call(this,i(1))},function(t,e,i){"use strict";var n=i(47),r=i(45);function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}e.parse=y,e.resolve=function(t,e){return y(t,!1,!0).resolve(e)},e.resolveObject=function(t,e){return t?y(t,!1,!0).resolveObject(e):e},e.format=function(t){r.isString(t)&&(t=y(t));return t instanceof o?t.format():o.prototype.format.call(t)},e.Url=o;var s=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,c=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,l=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),h=["'"].concat(l),u=["%","/","?",";","#"].concat(h),f=["/","?","#"],d=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,g={javascript:!0,"javascript:":!0},v={javascript:!0,"javascript:":!0},m={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},b=i(44);function y(t,e,i){if(t&&r.isObject(t)&&t instanceof o)return t;var n=new o;return n.parse(t,e,i),n}o.prototype.parse=function(t,e,i){if(!r.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var o=t.indexOf("?"),a=-1!==o&&o<t.indexOf("#")?"?":"#",l=t.split(a);l[0]=l[0].replace(/\\/g,"/");var y=t=l.join(a);if(y=y.trim(),!i&&1===t.split("#").length){var _=c.exec(y);if(_)return this.path=y,this.href=y,this.pathname=_[1],_[2]?(this.search=_[2],this.query=e?b.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var x=s.exec(y);if(x){var w=(x=x[0]).toLowerCase();this.protocol=w,y=y.substr(x.length)}if(i||x||y.match(/^\/\/[^@\/]+@[^@\/]+/)){var S="//"===y.substr(0,2);!S||x&&v[x]||(y=y.substr(2),this.slashes=!0)}if(!v[x]&&(S||x&&!m[x])){for(var C,O,k=-1,T=0;T<f.length;T++){-1!==(E=y.indexOf(f[T]))&&(-1===k||E<k)&&(k=E)}-1!==(O=-1===k?y.lastIndexOf("@"):y.lastIndexOf("@",k))&&(C=y.slice(0,O),y=y.slice(O+1),this.auth=decodeURIComponent(C)),k=-1;for(T=0;T<u.length;T++){var E;-1!==(E=y.indexOf(u[T]))&&(-1===k||E<k)&&(k=E)}-1===k&&(k=y.length),this.host=y.slice(0,k),y=y.slice(k),this.parseHost(),this.hostname=this.hostname||"";var j="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!j)for(var M=this.hostname.split(/\./),P=(T=0,M.length);T<P;T++){var A=M[T];if(A&&!A.match(d)){for(var I="",D=0,L=A.length;D<L;D++)A.charCodeAt(D)>127?I+="x":I+=A[D];if(!I.match(d)){var R=M.slice(0,T),B=M.slice(T+1),F=A.match(p);F&&(R.push(F[1]),B.unshift(F[2])),B.length&&(y="/"+B.join(".")+y),this.hostname=R.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),j||(this.hostname=n.toASCII(this.hostname));var N=this.port?":"+this.port:"",X=this.hostname||"";this.host=X+N,this.href+=this.host,j&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==y[0]&&(y="/"+y))}if(!g[w])for(T=0,P=h.length;T<P;T++){var z=h[T];if(-1!==y.indexOf(z)){var Y=encodeURIComponent(z);Y===z&&(Y=escape(z)),y=y.split(z).join(Y)}}var W=y.indexOf("#");-1!==W&&(this.hash=y.substr(W),y=y.slice(0,W));var G=y.indexOf("?");if(-1!==G?(this.search=y.substr(G),this.query=y.substr(G+1),e&&(this.query=b.parse(this.query)),y=y.slice(0,G)):e&&(this.search="",this.query={}),y&&(this.pathname=y),m[w]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){N=this.pathname||"";var H=this.search||"";this.path=N+H}return this.href=this.format(),this},o.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",i=this.pathname||"",n=this.hash||"",o=!1,s="";this.host?o=t+this.host:this.hostname&&(o=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&r.isObject(this.query)&&Object.keys(this.query).length&&(s=b.stringify(this.query));var a=this.search||s&&"?"+s||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||m[e])&&!1!==o?(o="//"+(o||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):o||(o=""),n&&"#"!==n.charAt(0)&&(n="#"+n),a&&"?"!==a.charAt(0)&&(a="?"+a),e+o+(i=i.replace(/[?#]/g,function(t){return encodeURIComponent(t)}))+(a=a.replace("#","%23"))+n},o.prototype.resolve=function(t){return this.resolveObject(y(t,!1,!0)).format()},o.prototype.resolveObject=function(t){if(r.isString(t)){var e=new o;e.parse(t,!1,!0),t=e}for(var i=new o,n=Object.keys(this),s=0;s<n.length;s++){var a=n[s];i[a]=this[a]}if(i.hash=t.hash,""===t.href)return i.href=i.format(),i;if(t.slashes&&!t.protocol){for(var c=Object.keys(t),l=0;l<c.length;l++){var h=c[l];"protocol"!==h&&(i[h]=t[h])}return m[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i}if(t.protocol&&t.protocol!==i.protocol){if(!m[t.protocol]){for(var u=Object.keys(t),f=0;f<u.length;f++){var d=u[f];i[d]=t[d]}return i.href=i.format(),i}if(i.protocol=t.protocol,t.host||v[t.protocol])i.pathname=t.pathname;else{for(var p=(t.pathname||"").split("/");p.length&&!(t.host=p.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),i.pathname=p.join("/")}if(i.search=t.search,i.query=t.query,i.host=t.host||"",i.auth=t.auth,i.hostname=t.hostname||t.host,i.port=t.port,i.pathname||i.search){var g=i.pathname||"",b=i.search||"";i.path=g+b}return i.slashes=i.slashes||t.slashes,i.href=i.format(),i}var y=i.pathname&&"/"===i.pathname.charAt(0),_=t.host||t.pathname&&"/"===t.pathname.charAt(0),x=_||y||i.host&&t.pathname,w=x,S=i.pathname&&i.pathname.split("/")||[],C=(p=t.pathname&&t.pathname.split("/")||[],i.protocol&&!m[i.protocol]);if(C&&(i.hostname="",i.port=null,i.host&&(""===S[0]?S[0]=i.host:S.unshift(i.host)),i.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===p[0]?p[0]=t.host:p.unshift(t.host)),t.host=null),x=x&&(""===p[0]||""===S[0])),_)i.host=t.host||""===t.host?t.host:i.host,i.hostname=t.hostname||""===t.hostname?t.hostname:i.hostname,i.search=t.search,i.query=t.query,S=p;else if(p.length)S||(S=[]),S.pop(),S=S.concat(p),i.search=t.search,i.query=t.query;else if(!r.isNullOrUndefined(t.search)){if(C)i.hostname=i.host=S.shift(),(j=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=j.shift(),i.host=i.hostname=j.shift());return i.search=t.search,i.query=t.query,r.isNull(i.pathname)&&r.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i}if(!S.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var O=S.slice(-1)[0],k=(i.host||t.host||S.length>1)&&("."===O||".."===O)||""===O,T=0,E=S.length;E>=0;E--)"."===(O=S[E])?S.splice(E,1):".."===O?(S.splice(E,1),T++):T&&(S.splice(E,1),T--);if(!x&&!w)for(;T--;T)S.unshift("..");!x||""===S[0]||S[0]&&"/"===S[0].charAt(0)||S.unshift(""),k&&"/"!==S.join("/").substr(-1)&&S.push("");var j,M=""===S[0]||S[0]&&"/"===S[0].charAt(0);C&&(i.hostname=i.host=M?"":S.length?S.shift():"",(j=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=j.shift(),i.host=i.hostname=j.shift()));return(x=x||i.host&&S.length)&&!M&&S.unshift(""),S.length?i.pathname=S.join("/"):(i.pathname=null,i.path=null),r.isNull(i.pathname)&&r.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=t.auth||i.auth,i.slashes=i.slashes||t.slashes,i.href=i.format(),i},o.prototype.parseHost=function(){var t=this.host,e=a.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},function(t,e,i){(function(t){var n=i(41),r=i(21),o=i(32),s=i(31),a=i(9),c=e;c.request=function(e,i){e="string"==typeof e?a.parse(e):o(e);var r=-1===t.location.protocol.search(/^https?:$/)?"http:":"",s=e.protocol||r,c=e.hostname||e.host,l=e.port,h=e.path||"/";c&&-1!==c.indexOf(":")&&(c="["+c+"]"),e.url=(c?s+"//"+c:"")+(l?":"+l:"")+h,e.method=(e.method||"GET").toUpperCase(),e.headers=e.headers||{};var u=new n(e);return i&&u.on("response",i),u},c.get=function(t,e){var i=c.request(t,e);return i.end(),i},c.ClientRequest=n,c.IncomingMessage=r.IncomingMessage,c.Agent=function(){},c.Agent.defaultMaxSockets=4,c.globalAgent=new c.Agent,c.STATUS_CODES=s,c.METHODS=["CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REPORT","SEARCH","SUBSCRIBE","TRACE","UNLOCK","UNSUBSCRIBE"]}).call(this,i(0))},function(t,e){},function(t,e,i){var n=i(10),r=i(9),o=t.exports;for(var s in n)n.hasOwnProperty(s)&&(o[s]=n[s]);function a(t){if("string"==typeof t&&(t=r.parse(t)),t.protocol||(t.protocol="https:"),"https:"!==t.protocol)throw new Error('Protocol "'+t.protocol+'" not supported. Expected "https:"');return t}o.request=function(t,e){return t=a(t),n.request.call(this,t,e)},o.get=function(t,e){return t=a(t),n.get.call(this,t,e)}},function(t,e,i){"use strict";t.exports=o;var n=i(4),r=i(6);function o(t){if(!(this instanceof o))return new o(t);n.call(this,t),this._transformState={afterTransform:function(t,e){var i=this._transformState;i.transforming=!1;var n=i.writecb;if(!n)return this.emit("error",new Error("write callback called multiple times"));i.writechunk=null,i.writecb=null,null!=e&&this.push(e),n(t);var r=this._readableState;r.reading=!1,(r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.on("prefinish",s)}function s(){var t=this;"function"==typeof this._flush?this._flush(function(e,i){a(t,e,i)}):a(this,null,null)}function a(t,e,i){if(e)return t.emit("error",e);if(null!=i&&t.push(i),t._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(t._transformState.transforming)throw new Error("Calling transform done when still transforming");return t.push(null)}r.inherits=i(2),r.inherits(o,n),o.prototype.push=function(t,e){return this._transformState.needTransform=!1,n.prototype.push.call(this,t,e)},o.prototype._transform=function(t,e,i){throw new Error("_transform() is not implemented")},o.prototype._write=function(t,e,i){var n=this._transformState;if(n.writecb=i,n.writechunk=t,n.writeencoding=e,!n.transforming){var r=this._readableState;(n.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},o.prototype._read=function(t){var e=this._transformState;null!==e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0},o.prototype._destroy=function(t,e){var i=this;n.prototype._destroy.call(this,t,function(t){e(t),i.emit("close")})}},function(t,e,i){"use strict";var n=i(7).Buffer,r=n.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(t){var e;switch(this.encoding=function(t){var e=function(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}(t);if("string"!=typeof e&&(n.isEncoding===r||!r(t)))throw new Error("Unknown encoding: "+t);return e||t}(t),this.encoding){case"utf16le":this.text=c,this.end=l,e=4;break;case"utf8":this.fillLast=a,e=4;break;case"base64":this.text=h,this.end=u,e=3;break;default:return this.write=f,void(this.end=d)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(e)}function s(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:-1}function a(t){var e=this.lastTotal-this.lastNeed,i=function(t,e,i){if(128!=(192&e[0]))return t.lastNeed=0,"�".repeat(i);if(t.lastNeed>1&&e.length>1){if(128!=(192&e[1]))return t.lastNeed=1,"�".repeat(i+1);if(t.lastNeed>2&&e.length>2&&128!=(192&e[2]))return t.lastNeed=2,"�".repeat(i+2)}}(this,t,e);return void 0!==i?i:this.lastNeed<=t.length?(t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,e,0,t.length),void(this.lastNeed-=t.length))}function c(t,e){if((t.length-e)%2==0){var i=t.toString("utf16le",e);if(i){var n=i.charCodeAt(i.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],i.slice(0,-1)}return i}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function l(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var i=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,i)}return e}function h(t,e){var i=(t.length-e)%3;return 0===i?t.toString("base64",e):(this.lastNeed=3-i,this.lastTotal=3,1===i?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-i))}function u(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function f(t){return t.toString(this.encoding)}function d(t){return t&&t.length?this.write(t):""}e.StringDecoder=o,o.prototype.write=function(t){if(0===t.length)return"";var e,i;if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return"";i=this.lastNeed,this.lastNeed=0}else i=0;return i<t.length?e?e+this.text(t,i):this.text(t,i):e||""},o.prototype.end=function(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"�".repeat(this.lastTotal-this.lastNeed):e},o.prototype.text=function(t,e){var i=function(t,e,i){var n=e.length-1;if(n<i)return 0;var r=s(e[n]);if(r>=0)return r>0&&(t.lastNeed=r-1),r;if(--n<i)return 0;if((r=s(e[n]))>=0)return r>0&&(t.lastNeed=r-2),r;if(--n<i)return 0;if((r=s(e[n]))>=0)return r>0&&(2===r?r=0:t.lastNeed=r-3),r;return 0}(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=i;var n=t.length-(i-this.lastNeed);return t.copy(this.lastChar,0,n),t.toString("utf8",e,n)},o.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length}},function(t,e,i){"use strict";(function(e,n,r){var o=i(8);function s(t){var e=this;this.next=null,this.entry=null,this.finish=function(){!function(t,e,i){var n=t.entry;t.entry=null;for(;n;){var r=n.callback;e.pendingcb--,r(i),n=n.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}(e,t)}}t.exports=b;var a,c=!e.browser&&["v0.10","v0.9."].indexOf(e.version.slice(0,5))>-1?n:o.nextTick;b.WritableState=m;var l=i(6);l.inherits=i(2);var h={deprecate:i(35)},u=i(17),f=i(7).Buffer,d=r.Uint8Array||function(){};var p,g=i(16);function v(){}function m(t,e){a=a||i(4),t=t||{};var n=e instanceof a;this.objectMode=!!t.objectMode,n&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var r=t.highWaterMark,l=t.writableHighWaterMark,h=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:n&&(l||0===l)?l:h,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var u=!1===t.decodeStrings;this.decodeStrings=!u,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){!function(t,e){var i=t._writableState,n=i.sync,r=i.writecb;if(function(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}(i),e)!function(t,e,i,n,r){--e.pendingcb,i?(o.nextTick(r,n),o.nextTick(C,t,e),t._writableState.errorEmitted=!0,t.emit("error",n)):(r(n),t._writableState.errorEmitted=!0,t.emit("error",n),C(t,e))}(t,i,n,e,r);else{var s=w(i);s||i.corked||i.bufferProcessing||!i.bufferedRequest||x(t,i),n?c(_,t,i,s,r):_(t,i,s,r)}}(e,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function b(t){if(a=a||i(4),!(p.call(b,this)||this instanceof a))return new b(t);this._writableState=new m(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),u.call(this)}function y(t,e,i,n,r,o,s){e.writelen=n,e.writecb=s,e.writing=!0,e.sync=!0,i?t._writev(r,e.onwrite):t._write(r,o,e.onwrite),e.sync=!1}function _(t,e,i,n){i||function(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}(t,e),e.pendingcb--,n(),C(t,e)}function x(t,e){e.bufferProcessing=!0;var i=e.bufferedRequest;if(t._writev&&i&&i.next){var n=e.bufferedRequestCount,r=new Array(n),o=e.corkedRequestsFree;o.entry=i;for(var a=0,c=!0;i;)r[a]=i,i.isBuf||(c=!1),i=i.next,a+=1;r.allBuffers=c,y(t,e,!0,e.length,r,"",o.finish),e.pendingcb++,e.lastBufferedRequest=null,o.next?(e.corkedRequestsFree=o.next,o.next=null):e.corkedRequestsFree=new s(e),e.bufferedRequestCount=0}else{for(;i;){var l=i.chunk,h=i.encoding,u=i.callback;if(y(t,e,!1,e.objectMode?1:l.length,l,h,u),i=i.next,e.bufferedRequestCount--,e.writing)break}null===i&&(e.lastBufferedRequest=null)}e.bufferedRequest=i,e.bufferProcessing=!1}function w(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function S(t,e){t._final(function(i){e.pendingcb--,i&&t.emit("error",i),e.prefinished=!0,t.emit("prefinish"),C(t,e)})}function C(t,e){var i=w(e);return i&&(!function(t,e){e.prefinished||e.finalCalled||("function"==typeof t._final?(e.pendingcb++,e.finalCalled=!0,o.nextTick(S,t,e)):(e.prefinished=!0,t.emit("prefinish")))}(t,e),0===e.pendingcb&&(e.finished=!0,t.emit("finish"))),i}l.inherits(b,u),m.prototype.getBuffer=function(){for(var t=this.bufferedRequest,e=[];t;)e.push(t),t=t.next;return e},function(){try{Object.defineProperty(m.prototype,"buffer",{get:h.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(p=Function.prototype[Symbol.hasInstance],Object.defineProperty(b,Symbol.hasInstance,{value:function(t){return!!p.call(this,t)||this===b&&(t&&t._writableState instanceof m)}})):p=function(t){return t instanceof this},b.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},b.prototype.write=function(t,e,i){var n=this._writableState,r=!1,s=!n.objectMode&&function(t){return f.isBuffer(t)||t instanceof d}(t);return s&&!f.isBuffer(t)&&(t=function(t){return f.from(t)}(t)),"function"==typeof e&&(i=e,e=null),s?e="buffer":e||(e=n.defaultEncoding),"function"!=typeof i&&(i=v),n.ended?function(t,e){var i=new Error("write after end");t.emit("error",i),o.nextTick(e,i)}(this,i):(s||function(t,e,i,n){var r=!0,s=!1;return null===i?s=new TypeError("May not write null values to stream"):"string"==typeof i||void 0===i||e.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s&&(t.emit("error",s),o.nextTick(n,s),r=!1),r}(this,n,t,i))&&(n.pendingcb++,r=function(t,e,i,n,r,o){if(!i){var s=function(t,e,i){t.objectMode||!1===t.decodeStrings||"string"!=typeof e||(e=f.from(e,i));return e}(e,n,r);n!==s&&(i=!0,r="buffer",n=s)}var a=e.objectMode?1:n.length;e.length+=a;var c=e.length<e.highWaterMark;c||(e.needDrain=!0);if(e.writing||e.corked){var l=e.lastBufferedRequest;e.lastBufferedRequest={chunk:n,encoding:r,isBuf:i,callback:o,next:null},l?l.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else y(t,e,!1,a,n,r,o);return c}(this,n,s,t,e,i)),r},b.prototype.cork=function(){this._writableState.corked++},b.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.finished||t.bufferProcessing||!t.bufferedRequest||x(this,t))},b.prototype.setDefaultEncoding=function(t){if("string"==typeof t&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+t);return this._writableState.defaultEncoding=t,this},b.prototype._write=function(t,e,i){i(new Error("_write() is not implemented"))},b.prototype._writev=null,b.prototype.end=function(t,e,i){var n=this._writableState;"function"==typeof t?(i=t,t=null,e=null):"function"==typeof e&&(i=e,e=null),null!==t&&void 0!==t&&this.write(t,e),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||function(t,e,i){e.ending=!0,C(t,e),i&&(e.finished?o.nextTick(i):t.once("finish",i));e.ended=!0,t.writable=!1}(this,n,i)},Object.defineProperty(b.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(t){this._writableState&&(this._writableState.destroyed=t)}}),b.prototype.destroy=g.destroy,b.prototype._undestroy=g.undestroy,b.prototype._destroy=function(t,e){this.end(),e(t)}}).call(this,i(1),i(37).setImmediate,i(0))},function(t,e,i){"use strict";var n=i(8);function r(t,e){t.emit("error",e)}t.exports={destroy:function(t,e){var i=this,o=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;return o||s?(e?e(t):!t||this._writableState&&this._writableState.errorEmitted||n.nextTick(r,this,t),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(t){!e&&t?(n.nextTick(r,i,t),i._writableState&&(i._writableState.errorEmitted=!0)):e&&e(t)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(t,e,i){t.exports=i(18).EventEmitter},function(t,e){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(t){return"function"==typeof t}function r(t){return"object"==typeof t&&null!==t}function o(t){return void 0===t}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(t){if(!function(t){return"number"==typeof t}(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},i.prototype.emit=function(t){var e,i,s,a,c,l;if(this._events||(this._events={}),"error"===t&&(!this._events.error||r(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var h=new Error('Uncaught, unspecified "error" event. ('+e+")");throw h.context=e,h}if(o(i=this._events[t]))return!1;if(n(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),i.apply(this,a)}else if(r(i))for(a=Array.prototype.slice.call(arguments,1),s=(l=i.slice()).length,c=0;c<s;c++)l[c].apply(this,a);return!0},i.prototype.addListener=function(t,e){var s;if(!n(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,n(e.listener)?e.listener:e),this._events[t]?r(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,r(this._events[t])&&!this._events[t].warned&&(s=o(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&s>0&&this._events[t].length>s&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(t,e){if(!n(e))throw TypeError("listener must be a function");var i=!1;function r(){this.removeListener(t,r),i||(i=!0,e.apply(this,arguments))}return r.listener=e,this.on(t,r),this},i.prototype.removeListener=function(t,e){var i,o,s,a;if(!n(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(s=(i=this._events[t]).length,o=-1,i===e||n(i.listener)&&i.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(r(i)){for(a=s;a-- >0;)if(i[a]===e||i[a].listener&&i[a].listener===e){o=a;break}if(o<0)return this;1===i.length?(i.length=0,delete this._events[t]):i.splice(o,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},i.prototype.removeAllListeners=function(t){var e,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n(i=this._events[t]))this.removeListener(t,i);else if(i)for(;i.length;)this.removeListener(t,i[i.length-1]);return delete this._events[t],this},i.prototype.listeners=function(t){return this._events&&this._events[t]?n(this._events[t])?[this._events[t]]:this._events[t].slice():[]},i.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(n(e))return 1;if(e)return e.length}return 0},i.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e,i){"use strict";(function(e,n){var r=i(8);t.exports=y;var o,s=i(25);y.ReadableState=b;i(18).EventEmitter;var a=function(t,e){return t.listeners(e).length},c=i(17),l=i(7).Buffer,h=e.Uint8Array||function(){};var u=i(6);u.inherits=i(2);var f=i(40),d=void 0;d=f&&f.debuglog?f.debuglog("stream"):function(){};var p,g=i(39),v=i(16);u.inherits(y,c);var m=["error","close","destroy","pause","resume"];function b(t,e){o=o||i(4),t=t||{};var n=e instanceof o;this.objectMode=!!t.objectMode,n&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var r=t.highWaterMark,s=t.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:n&&(s||0===s)?s:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new g,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(p||(p=i(14).StringDecoder),this.decoder=new p(t.encoding),this.encoding=t.encoding)}function y(t){if(o=o||i(4),!(this instanceof y))return new y(t);this._readableState=new b(t,this),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),c.call(this)}function _(t,e,i,n,r){var o,s=t._readableState;null===e?(s.reading=!1,function(t,e){if(e.ended)return;if(e.decoder){var i=e.decoder.end();i&&i.length&&(e.buffer.push(i),e.length+=e.objectMode?1:i.length)}e.ended=!0,C(t)}(t,s)):(r||(o=function(t,e){var i;(function(t){return l.isBuffer(t)||t instanceof h})(e)||"string"==typeof e||void 0===e||t.objectMode||(i=new TypeError("Invalid non-string/buffer chunk"));return i}(s,e)),o?t.emit("error",o):s.objectMode||e&&e.length>0?("string"==typeof e||s.objectMode||Object.getPrototypeOf(e)===l.prototype||(e=function(t){return l.from(t)}(e)),n?s.endEmitted?t.emit("error",new Error("stream.unshift() after end event")):x(t,s,e,!0):s.ended?t.emit("error",new Error("stream.push() after EOF")):(s.reading=!1,s.decoder&&!i?(e=s.decoder.write(e),s.objectMode||0!==e.length?x(t,s,e,!1):k(t,s)):x(t,s,e,!1))):n||(s.reading=!1));return function(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}(s)}function x(t,e,i,n){e.flowing&&0===e.length&&!e.sync?(t.emit("data",i),t.read(0)):(e.length+=e.objectMode?1:i.length,n?e.buffer.unshift(i):e.buffer.push(i),e.needReadable&&C(t)),k(t,e)}Object.defineProperty(y.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(t){this._readableState&&(this._readableState.destroyed=t)}}),y.prototype.destroy=v.destroy,y.prototype._undestroy=v.undestroy,y.prototype._destroy=function(t,e){this.push(null),e(t)},y.prototype.push=function(t,e){var i,n=this._readableState;return n.objectMode?i=!0:"string"==typeof t&&((e=e||n.defaultEncoding)!==n.encoding&&(t=l.from(t,e),e=""),i=!0),_(this,t,e,!1,i)},y.prototype.unshift=function(t){return _(this,t,null,!0,!1)},y.prototype.isPaused=function(){return!1===this._readableState.flowing},y.prototype.setEncoding=function(t){return p||(p=i(14).StringDecoder),this._readableState.decoder=new p(t),this._readableState.encoding=t,this};var w=8388608;function S(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!=t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=function(t){return t>=w?t=w:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}function C(t){var e=t._readableState;e.needReadable=!1,e.emittedReadable||(d("emitReadable",e.flowing),e.emittedReadable=!0,e.sync?r.nextTick(O,t):O(t))}function O(t){d("emit readable"),t.emit("readable"),M(t)}function k(t,e){e.readingMore||(e.readingMore=!0,r.nextTick(T,t,e))}function T(t,e){for(var i=e.length;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(d("maybeReadMore read 0"),t.read(0),i!==e.length);)i=e.length;e.readingMore=!1}function E(t){d("readable nexttick read 0"),t.read(0)}function j(t,e){e.reading||(d("resume read 0"),t.read(0)),e.resumeScheduled=!1,e.awaitDrain=0,t.emit("resume"),M(t),e.flowing&&!e.reading&&t.read(0)}function M(t){var e=t._readableState;for(d("flow",e.flowing);e.flowing&&null!==t.read(););}function P(t,e){return 0===e.length?null:(e.objectMode?i=e.buffer.shift():!t||t>=e.length?(i=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.head.data:e.buffer.concat(e.length),e.buffer.clear()):i=function(t,e,i){var n;t<e.head.data.length?(n=e.head.data.slice(0,t),e.head.data=e.head.data.slice(t)):n=t===e.head.data.length?e.shift():i?function(t,e){var i=e.head,n=1,r=i.data;t-=r.length;for(;i=i.next;){var o=i.data,s=t>o.length?o.length:t;if(s===o.length?r+=o:r+=o.slice(0,t),0===(t-=s)){s===o.length?(++n,i.next?e.head=i.next:e.head=e.tail=null):(e.head=i,i.data=o.slice(s));break}++n}return e.length-=n,r}(t,e):function(t,e){var i=l.allocUnsafe(t),n=e.head,r=1;n.data.copy(i),t-=n.data.length;for(;n=n.next;){var o=n.data,s=t>o.length?o.length:t;if(o.copy(i,i.length-t,0,s),0===(t-=s)){s===o.length?(++r,n.next?e.head=n.next:e.head=e.tail=null):(e.head=n,n.data=o.slice(s));break}++r}return e.length-=r,i}(t,e);return n}(t,e.buffer,e.decoder),i);var i}function A(t){var e=t._readableState;if(e.length>0)throw new Error('"endReadable()" called on non-empty stream');e.endEmitted||(e.ended=!0,r.nextTick(I,e,t))}function I(t,e){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}function D(t,e){for(var i=0,n=t.length;i<n;i++)if(t[i]===e)return i;return-1}y.prototype.read=function(t){d("read",t),t=parseInt(t,10);var e=this._readableState,i=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return d("read: emitReadable",e.length,e.ended),0===e.length&&e.ended?A(this):C(this),null;if(0===(t=S(t,e))&&e.ended)return 0===e.length&&A(this),null;var n,r=e.needReadable;return d("need readable",r),(0===e.length||e.length-t<e.highWaterMark)&&d("length less than watermark",r=!0),e.ended||e.reading?d("reading or ended",r=!1):r&&(d("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=S(i,e))),null===(n=t>0?P(t,e):null)?(e.needReadable=!0,t=0):e.length-=t,0===e.length&&(e.ended||(e.needReadable=!0),i!==t&&e.ended&&A(this)),null!==n&&this.emit("data",n),n},y.prototype._read=function(t){this.emit("error",new Error("_read() is not implemented"))},y.prototype.pipe=function(t,e){var i=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=t;break;case 1:o.pipes=[o.pipes,t];break;default:o.pipes.push(t)}o.pipesCount+=1,d("pipe count=%d opts=%j",o.pipesCount,e);var c=(!e||!1!==e.end)&&t!==n.stdout&&t!==n.stderr?h:y;function l(e,n){d("onunpipe"),e===i&&n&&!1===n.hasUnpiped&&(n.hasUnpiped=!0,d("cleanup"),t.removeListener("close",m),t.removeListener("finish",b),t.removeListener("drain",u),t.removeListener("error",v),t.removeListener("unpipe",l),i.removeListener("end",h),i.removeListener("end",y),i.removeListener("data",g),f=!0,!o.awaitDrain||t._writableState&&!t._writableState.needDrain||u())}function h(){d("onend"),t.end()}o.endEmitted?r.nextTick(c):i.once("end",c),t.on("unpipe",l);var u=function(t){return function(){var e=t._readableState;d("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&a(t,"data")&&(e.flowing=!0,M(t))}}(i);t.on("drain",u);var f=!1;var p=!1;function g(e){d("ondata"),p=!1,!1!==t.write(e)||p||((1===o.pipesCount&&o.pipes===t||o.pipesCount>1&&-1!==D(o.pipes,t))&&!f&&(d("false write response, pause",i._readableState.awaitDrain),i._readableState.awaitDrain++,p=!0),i.pause())}function v(e){d("onerror",e),y(),t.removeListener("error",v),0===a(t,"error")&&t.emit("error",e)}function m(){t.removeListener("finish",b),y()}function b(){d("onfinish"),t.removeListener("close",m),y()}function y(){d("unpipe"),i.unpipe(t)}return i.on("data",g),function(t,e,i){if("function"==typeof t.prependListener)return t.prependListener(e,i);t._events&&t._events[e]?s(t._events[e])?t._events[e].unshift(i):t._events[e]=[i,t._events[e]]:t.on(e,i)}(t,"error",v),t.once("close",m),t.once("finish",b),t.emit("pipe",i),o.flowing||(d("pipe resume"),i.resume()),t},y.prototype.unpipe=function(t){var e=this._readableState,i={hasUnpiped:!1};if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes?this:(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,i),this);if(!t){var n=e.pipes,r=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var o=0;o<r;o++)n[o].emit("unpipe",this,i);return this}var s=D(e.pipes,t);return-1===s?this:(e.pipes.splice(s,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,i),this)},y.prototype.on=function(t,e){var i=c.prototype.on.call(this,t,e);if("data"===t)!1!==this._readableState.flowing&&this.resume();else if("readable"===t){var n=this._readableState;n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&C(this):r.nextTick(E,this))}return i},y.prototype.addListener=y.prototype.on,y.prototype.resume=function(){var t=this._readableState;return t.flowing||(d("resume"),t.flowing=!0,function(t,e){e.resumeScheduled||(e.resumeScheduled=!0,r.nextTick(j,t,e))}(this,t)),this},y.prototype.pause=function(){return d("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(d("pause"),this._readableState.flowing=!1,this.emit("pause")),this},y.prototype.wrap=function(t){var e=this,i=this._readableState,n=!1;for(var r in t.on("end",function(){if(d("wrapped end"),i.decoder&&!i.ended){var t=i.decoder.end();t&&t.length&&e.push(t)}e.push(null)}),t.on("data",function(r){(d("wrapped data"),i.decoder&&(r=i.decoder.write(r)),!i.objectMode||null!==r&&void 0!==r)&&((i.objectMode||r&&r.length)&&(e.push(r)||(n=!0,t.pause())))}),t)void 0===this[r]&&"function"==typeof t[r]&&(this[r]=function(e){return function(){return t[e].apply(t,arguments)}}(r));for(var o=0;o<m.length;o++)t.on(m[o],this.emit.bind(this,m[o]));return this._read=function(e){d("wrapped _read",e),n&&(n=!1,t.resume())},this},y._fromList=P}).call(this,i(0),i(1))},function(t,e,i){(e=t.exports=i(19)).Stream=e,e.Readable=e,e.Writable=i(15),e.Duplex=i(4),e.Transform=i(13),e.PassThrough=i(34)},function(t,e,i){(function(t,n,r){var o=i(22),s=i(2),a=i(20),c=e.readyStates={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},l=e.IncomingMessage=function(e,i,s,c){var l=this;if(a.Readable.call(l),l._mode=s,l.headers={},l.rawHeaders=[],l.trailers={},l.rawTrailers=[],l.on("end",function(){t.nextTick(function(){l.emit("close")})}),"fetch"===s){if(l._fetchResponse=i,l.url=i.url,l.statusCode=i.status,l.statusMessage=i.statusText,i.headers.forEach(function(t,e){l.headers[e.toLowerCase()]=t,l.rawHeaders.push(e,t)}),o.writableStream){var h=new WritableStream({write:function(t){return new Promise(function(e,i){l._destroyed?i():l.push(new n(t))?e():l._resumeFetch=e})},close:function(){r.clearTimeout(c),l._destroyed||l.push(null)},abort:function(t){l._destroyed||l.emit("error",t)}});try{return void i.body.pipeTo(h).catch(function(t){r.clearTimeout(c),l._destroyed||l.emit("error",t)})}catch(t){}}var u=i.body.getReader();!function t(){u.read().then(function(e){if(!l._destroyed){if(e.done)return r.clearTimeout(c),void l.push(null);l.push(new n(e.value)),t()}}).catch(function(t){r.clearTimeout(c),l._destroyed||l.emit("error",t)})}()}else{if(l._xhr=e,l._pos=0,l.url=e.responseURL,l.statusCode=e.status,l.statusMessage=e.statusText,e.getAllResponseHeaders().split(/\r?\n/).forEach(function(t){var e=t.match(/^([^:]+):\s*(.*)/);if(e){var i=e[1].toLowerCase();"set-cookie"===i?(void 0===l.headers[i]&&(l.headers[i]=[]),l.headers[i].push(e[2])):void 0!==l.headers[i]?l.headers[i]+=", "+e[2]:l.headers[i]=e[2],l.rawHeaders.push(e[1],e[2])}}),l._charset="x-user-defined",!o.overrideMimeType){var f=l.rawHeaders["mime-type"];if(f){var d=f.match(/;\s*charset=([^;])(;|$)/);d&&(l._charset=d[1].toLowerCase())}l._charset||(l._charset="utf-8")}}};s(l,a.Readable),l.prototype._read=function(){var t=this._resumeFetch;t&&(this._resumeFetch=null,t())},l.prototype._onXHRProgress=function(){var t=this,e=t._xhr,i=null;switch(t._mode){case"text:vbarray":if(e.readyState!==c.DONE)break;try{i=new r.VBArray(e.responseBody).toArray()}catch(t){}if(null!==i){t.push(new n(i));break}case"text":try{i=e.responseText}catch(e){t._mode="text:vbarray";break}if(i.length>t._pos){var o=i.substr(t._pos);if("x-user-defined"===t._charset){for(var s=new n(o.length),a=0;a<o.length;a++)s[a]=255&o.charCodeAt(a);t.push(s)}else t.push(o,t._charset);t._pos=i.length}break;case"arraybuffer":if(e.readyState!==c.DONE||!e.response)break;i=e.response,t.push(new n(new Uint8Array(i)));break;case"moz-chunked-arraybuffer":if(i=e.response,e.readyState!==c.LOADING||!i)break;t.push(new n(new Uint8Array(i)));break;case"ms-stream":if(i=e.response,e.readyState!==c.LOADING)break;var l=new r.MSStreamReader;l.onprogress=function(){l.result.byteLength>t._pos&&(t.push(new n(new Uint8Array(l.result.slice(t._pos)))),t._pos=l.result.byteLength)},l.onload=function(){t.push(null)},l.readAsArrayBuffer(i)}t._xhr.readyState===c.DONE&&"ms-stream"!==t._mode&&t.push(null)}}).call(this,i(1),i(3).Buffer,i(0))},function(t,e,i){(function(t){e.fetch=a(t.fetch)&&a(t.ReadableStream),e.writableStream=a(t.WritableStream),e.abortController=a(t.AbortController),e.blobConstructor=!1;try{new Blob([new ArrayBuffer(1)]),e.blobConstructor=!0}catch(t){}var i;function n(){if(void 0!==i)return i;if(t.XMLHttpRequest){i=new t.XMLHttpRequest;try{i.open("GET",t.XDomainRequest?"/":"https://example.com")}catch(t){i=null}}else i=null;return i}function r(t){var e=n();if(!e)return!1;try{return e.responseType=t,e.responseType===t}catch(t){}return!1}var o=void 0!==t.ArrayBuffer,s=o&&a(t.ArrayBuffer.prototype.slice);function a(t){return"function"==typeof t}e.arraybuffer=e.fetch||o&&r("arraybuffer"),e.msstream=!e.fetch&&s&&r("ms-stream"),e.mozchunkedarraybuffer=!e.fetch&&o&&r("moz-chunked-arraybuffer"),e.overrideMimeType=e.fetch||!!n()&&a(n().overrideMimeType),e.vbArray=a(t.VBArray),i=null}).call(this,i(0))},function(t,e){},function(t,e){},function(t,e){var i={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==i.call(t)}},function(t,e,i){
/*!
 * tui-code-snippet.js
 * @version 1.4.0
 * @author NHNEnt FE Development Lab <dl_javascript@nhnent.com>
 * @license MIT
 */
!function(e,i){t.exports=i()}(0,function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={exports:{},id:n,loaded:!1};return t[n].call(r.exports,r,r.exports,i),r.loaded=!0,r.exports}return i.m=t,i.c=e,i.p="dist",i(0)}([function(t,e,i){"use strict";var n={},r=i(1),o=r.extend;o(n,r),o(n,i(3)),o(n,i(2)),o(n,i(4)),o(n,i(5)),o(n,i(6)),o(n,i(7)),o(n,i(8)),o(n,i(9)),n.browser=i(10),n.popup=i(11),n.formatDate=i(12),n.defineClass=i(13),n.defineModule=i(14),n.defineNamespace=i(15),n.CustomEvents=i(16),n.Enum=i(17),n.ExMap=i(18),n.HashMap=i(20),n.Map=i(19),t.exports=n},function(t,e,i){"use strict";var n=i(2),r=i(3),o=0;function s(t,e){var i,o=[],a=[];if(isNaN(t)&&isNaN(e)&&n.isNumber(t)&&n.isNumber(e))return!0;if(t===e)return!0;if(n.isFunction(t)&&n.isFunction(e)||t instanceof Date&&e instanceof Date||t instanceof RegExp&&e instanceof RegExp||t instanceof String&&e instanceof String||t instanceof Number&&e instanceof Number)return t.toString()===e.toString();if(!(t instanceof Object&&e instanceof Object))return!1;if(t.isPrototypeOf(e)||e.isPrototypeOf(t)||t.constructor!==e.constructor||t.prototype!==e.prototype)return!1;if(r.inArray(t,o)>-1||r.inArray(e,a)>-1)return!1;for(i in e){if(e.hasOwnProperty(i)!==t.hasOwnProperty(i))return!1;if(typeof e[i]!=typeof t[i])return!1}for(i in t){if(e.hasOwnProperty(i)!==t.hasOwnProperty(i))return!1;if(typeof e[i]!=typeof t[i])return!1;if("object"==typeof t[i]||"function"==typeof t[i]){if(o.push(t),a.push(e),!s(t[i],e[i]))return!1;o.pop(),a.pop()}else if(t[i]!==e[i])return!1}return!0}function a(t,e){for(var i=arguments,r=i[0],o=1,s=i.length;o<s;o+=1){if(n.isUndefined(r)||n.isNull(r))return;r=r[i[o]]}return r}t.exports={extend:function(t,e){var i,n,r,o,s=Object.prototype.hasOwnProperty;for(r=1,o=arguments.length;r<o;r+=1)for(n in i=arguments[r])s.call(i,n)&&(t[n]=i[n]);return t},stamp:function(t){return t.__fe_id||(o+=1,t.__fe_id=o),t.__fe_id},hasStamp:function(t){return n.isExisty(a(t,"__fe_id"))},resetLastId:function(){o=0},keys:Object.prototype.keys||function(t){var e,i=[];for(e in t)t.hasOwnProperty(e)&&i.push(e);return i},compareJSON:function(t){var e=arguments.length,i=1;if(e<1)return!0;for(;i<e;i+=1)if(!s(t,arguments[i]))return!1;return!0},pick:a}},function(t,e){"use strict";var i=Object.prototype.toString;function n(t){return!r(t)&&!o(t)}function r(t){return void 0===t}function o(t){return null===t}function s(t){return n(t)&&!1!==t}function a(t){return n(t)&&("[object Arguments]"===i.call(t)||!!t.callee)}function c(t){return t instanceof Array}function l(t){return t===Object(t)}function h(t){return t instanceof Function}function u(t){return"string"==typeof t||t instanceof String}function f(t){return!(n(t)&&!function(t){return u(t)&&""===t}(t))||(c(t)||a(t)?0===t.length:!(l(t)&&!h(t))||!function(t){var e;for(e in t)if(t.hasOwnProperty(e))return!0;return!1}(t))}t.exports={isExisty:n,isUndefined:r,isNull:o,isTruthy:s,isFalsy:function(t){return!s(t)},isArguments:a,isArray:c,isArraySafe:function(t){return"[object Array]"===i.call(t)},isObject:l,isFunction:h,isFunctionSafe:function(t){return"[object Function]"===i.call(t)},isNumber:function(t){return"number"==typeof t||t instanceof Number},isNumberSafe:function(t){return"[object Number]"===i.call(t)},isDate:function(t){return t instanceof Date},isDateSafe:function(t){return"[object Date]"===i.call(t)},isString:u,isStringSafe:function(t){return"[object String]"===i.call(t)},isBoolean:function(t){return"boolean"==typeof t||t instanceof Boolean},isBooleanSafe:function(t){return"[object Boolean]"===i.call(t)},isHTMLNode:function(t){return"object"==typeof HTMLElement?t&&(t instanceof HTMLElement||!!t.nodeType):!(!t||!t.nodeType)},isHTMLTag:function(t){return"object"==typeof HTMLElement?t&&t instanceof HTMLElement:!(!t||!t.nodeType||1!==t.nodeType)},isEmpty:f,isNotEmpty:function(t){return!f(t)}}},function(t,e,i){"use strict";var n,r=i(4),o=i(2),s=Array.prototype.slice;n={inArray:function(t,e,i){var n,r;if(i=i||0,!o.isArray(e))return-1;if(Array.prototype.indexOf)return Array.prototype.indexOf.call(e,t,i);for(r=e.length,n=i;i>=0&&n<r;n+=1)if(e[n]===t)return n;return-1},range:function(t,e,i){var n,r=[];for(o.isUndefined(e)&&(e=t||0,t=0),e*=n=(i=i||1)<0?-1:1;t*n<e;t+=i)r.push(t);return r},zip:function(){var t=s.call(arguments),e=[];return r.forEach(t,function(t){r.forEach(t,function(t,i){e[i]||(e[i]=[]),e[i].push(t)})}),e}},t.exports=n},function(t,e,i){"use strict";var n=i(2),r=i(1);function o(t,e,i){var n=0,r=t.length;for(i=i||null;n<r&&!1!==e.call(i,t[n],n,t);n+=1);}function s(t,e,i){var n;for(n in i=i||null,t)if(t.hasOwnProperty(n)&&!1===e.call(i,t[n],n,t))break}function a(t,e,i){n.isArray(t)?o(t,e,i):s(t,e,i)}function c(t,e,i){var n=[];return i=i||null,a(t,function(){n.push(e.apply(i,arguments))}),n}t.exports={forEachOwnProperties:s,forEachArray:o,forEach:a,toArray:function(t){var e;try{e=Array.prototype.slice.call(t)}catch(i){e=[],o(t,function(t){e.push(t)})}return e},map:c,reduce:function(t,e,i){var o,s,a,c=0;for(i=i||null,n.isArray(t)?(s=t.length,a=t[c]):(s=(o=r.keys(t)).length,a=t[o[c+=1]]),c+=1;c<s;c+=1)a=e.call(i,a,t[o?o[c]:c]);return a},filter:function(t,e,i){var r,o;if(i=i||null,!n.isObject(t)||!n.isFunction(e))throw new Error("wrong parameter");return n.isArray(t)?(r=[],o=function(t,e){t.push(e[0])}):(r={},o=function(t,e){t[e[1]]=e[0]}),a(t,function(){e.apply(i,arguments)&&o(r,arguments)},i),r},pluck:function(t,e){return c(t,function(t){return t[e]})}}},function(t,e){"use strict";t.exports={bind:function(t,e){var i,n=Array.prototype.slice;return t.bind?t.bind.apply(t,n.call(arguments,1)):(i=n.call(arguments,2),function(){return t.apply(e,i.length?i.concat(n.call(arguments)):arguments)})}}},function(t,e){"use strict";function i(t){function e(){}return e.prototype=t,new e}t.exports={createObject:i,inherit:function(t,e){var n=i(e.prototype);n.constructor=t,t.prototype=n}}},function(t,e,i){"use strict";var n=i(4),r=i(1);t.exports={decodeHTMLEntity:function(t){var e={"&quot;":'"',"&amp;":"&","&lt;":"<","&gt;":">","&#39;":"'","&nbsp;":" "};return t.replace(/&amp;|&lt;|&gt;|&quot;|&#39;|&nbsp;/g,function(t){return e[t]?e[t]:t})},encodeHTMLEntity:function(t){var e={'"':"quot","&":"amp","<":"lt",">":"gt","'":"#39"};return t.replace(/[<>&"']/g,function(t){return e[t]?"&"+e[t]+";":t})},hasEncodableString:function(t){return/[<>&"']/.test(t)},getDuplicatedChar:function(t,e){for(var i,o=0,s=t.length,a={};o<s;o+=1)a[i=t.charAt(o)]=1;for(o=0,s=e.length;o<s;o+=1)a[i=e.charAt(o)]&&(a[i]+=1);return a=n.filter(a,function(t){return t>1}),(a=r.keys(a).sort()).join("")}}},function(t,e){"use strict";var i={},n=Array.prototype.slice;i.timestamp=function(){return Number(new Date)},i.debounce=function(t,e){var i,r;return e=e||0,function(){r=n.call(arguments),window.clearTimeout(i),i=window.setTimeout(function(){t.apply(null,r)},e)}},i.throttle=function(t,e){var r,o,s,a,c=!0,l=function(e){t.apply(null,e),r=null};function h(){if(a=n.call(arguments),c)return l(a),void(c=!1);s=i.timestamp(),r=r||s,o(a),s-r>=e&&l(a)}return e=e||0,o=i.debounce(l,e),h.reset=function(){c=!0,r=null},h},t.exports=i},function(t,e,i){"use strict";var n=i(1),r=i(4),o=i(2);function s(t,e){var i=r.map(n.keys(e),function(t,i){return(0===i?"":"&")+t+"="+e[t]}).join(""),o=document.createElement("img");return o.src=t+"?"+i,o.style.display="none",document.body.appendChild(o),document.body.removeChild(o),o}t.exports={imagePing:s,sendHostname:function(t){var e=location.hostname;(o.isUndefined(window.tui)||!1!==window.tui.usageStatistics)&&setTimeout(function(){"interactive"!==document.readyState&&"complete"!==document.readyState||s("https://www.google-analytics.com/collect",{v:1,t:"event",tid:"UA-115377265-9",cid:e,dp:e,dh:t})},1e3)}}},function(t,e){"use strict";var i,n,r={chrome:!1,firefox:!1,safari:!1,msie:!1,edge:!1,others:!1,version:0},o=window.navigator,s=o.appName.replace(/\s/g,"_"),a=o.userAgent,c=/MSIE\s([0-9]+[.0-9]*)/,l=/Trident.*rv:11\./,h=/Edge\/(\d+)\./,u={firefox:/Firefox\/(\d+)\./,chrome:/Chrome\/(\d+)\./,safari:/Version\/([\d.]+).*Safari\/(\d+)/},f={Microsoft_Internet_Explorer:function(){var t=a.match(c);t?(r.msie=!0,r.version=parseFloat(t[1])):r.others=!0},Netscape:function(){var t=!1;if(l.exec(a))r.msie=!0,r.version=11,t=!0;else if(h.exec(a))r.edge=!0,r.version=a.match(h)[1],t=!0;else for(i in u)if(u.hasOwnProperty(i)&&(n=a.match(u[i]))&&n.length>1){r[i]=t=!0,r.version=parseFloat(n[1]||0);break}t||(r.others=!0)}};f[s]&&f[s](),t.exports=r},function(t,e,i){"use strict";var n=i(4),r=i(2),o=i(5),s=i(10),a=i(1),c=0;function l(){this.openedPopup={},this.closeWithParentPopup={},this.postBridgeUrl=""}l.prototype.getPopupList=function(t){return r.isExisty(t)?this.openedPopup[t]:this.openedPopup},l.prototype.openPopup=function(t,e){var i,n,l;if((e=a.extend({popupName:"popup_"+c+"_"+Number(new Date),popupOptionStr:"",useReload:!0,closeWithParent:!0,method:"get",param:{}},e||{})).method=e.method.toUpperCase(),this.postBridgeUrl=e.postBridgeUrl||this.postBridgeUrl,l="POST"===e.method&&e.param&&s.msie&&11===s.version,!r.isExisty(t))throw new Error("Popup#open() need popup url.");c+=1,e.param&&("GET"===e.method?t=t+(/\?/.test(t)?"&":"?")+this._parameterize(e.param):"POST"===e.method&&(l||(n=this.createForm(t,e.param,e.method,e.popupName),t="about:blank"))),i=this.openedPopup[e.popupName],r.isExisty(i)?i.closed?this.openedPopup[e.popupName]=i=this._open(l,e.param,t,e.popupName,e.popupOptionStr):(e.useReload&&i.location.replace(t),i.focus()):this.openedPopup[e.popupName]=i=this._open(l,e.param,t,e.popupName,e.popupOptionStr),this.closeWithParentPopup[e.popupName]=e.closeWithParent,(!i||i.closed||r.isUndefined(i.closed))&&alert("please enable popup windows for this website"),e.param&&"POST"===e.method&&!l&&(i&&n.submit(),n.parentNode&&n.parentNode.removeChild(n)),window.onunload=o.bind(this.closeAllPopup,this)},l.prototype.close=function(t,e){var i=e||window;(t=!!r.isExisty(t)&&t)&&(window.onunload=null),i.closed||(i.opener=window.location.href,i.close())},l.prototype.closeAllPopup=function(t){var e=r.isExisty(t);n.forEachOwnProperties(this.openedPopup,function(t,i){(e&&this.closeWithParentPopup[i]||!e)&&this.close(!1,t)},this)},l.prototype.focus=function(t){this.getPopupList(t).focus()},l.prototype.parseQuery=function(){var t,e,i={};return t=window.location.search.substr(1),n.forEachArray(t.split("&"),function(t){e=t.split("="),i[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}),i},l.prototype.createForm=function(t,e,i,r,o){var s,a=document.createElement("form");return o=o||document.body,a.method=i||"POST",a.action=t||"",a.target=r||"",a.style.display="none",n.forEachOwnProperties(e,function(t,e){(s=document.createElement("input")).name=e,s.type="hidden",s.value=t,a.appendChild(s)}),o.appendChild(a),a},l.prototype._parameterize=function(t){var e=[];return n.forEachOwnProperties(t,function(t,i){e.push(encodeURIComponent(i)+"="+encodeURIComponent(t))}),e.join("&")},l.prototype._open=function(t,e,i,n,r){var o;return t?(o=window.open(this.postBridgeUrl,n,r),setTimeout(function(){o.redirect(i,e)},100)):o=window.open(i,n,r),o},t.exports=new l},function(t,e,i){"use strict";var n=i(2),r=i(1),o=/[\\]*YYYY|[\\]*YY|[\\]*MMMM|[\\]*MMM|[\\]*MM|[\\]*M|[\\]*DD|[\\]*D|[\\]*HH|[\\]*H|[\\]*A/gi,s=["Invalid month","January","February","March","April","May","June","July","August","September","October","November","December"],a=[0,31,28,31,30,31,30,31,31,30,31,30,31],c={M:function(t){return Number(t.month)},MM:function(t){var e=t.month;return Number(e)<10?"0"+e:e},MMM:function(t){return s[Number(t.month)].substr(0,3)},MMMM:function(t){return s[Number(t.month)]},D:function(t){return Number(t.date)},d:function(t){return c.D(t)},DD:function(t){var e=t.date;return Number(e)<10?"0"+e:e},dd:function(t){return c.DD(t)},YY:function(t){return Number(t.year)%100},yy:function(t){return c.YY(t)},YYYY:function(t){var e="20",i=t.year;return i>69&&i<100&&(e="19"),Number(i)<100?e+String(i):i},yyyy:function(t){return c.YYYY(t)},A:function(t){return t.meridiem},a:function(t){return t.meridiem},hh:function(t){var e=t.hour;return Number(e)<10?"0"+e:e},HH:function(t){return c.hh(t)},h:function(t){return String(Number(t.hour))},H:function(t){return c.h(t)},m:function(t){return String(Number(t.minute))},mm:function(t){var e=t.minute;return Number(e)<10?"0"+e:e}};t.exports=function(t,e,i){var s,l,h=r.pick(i,"meridiemSet","AM")||"AM",u=r.pick(i,"meridiemSet","PM")||"PM";return!!function(t,e,i){var n;return t=Number(t),e=Number(e),i=Number(i),(t>-1&&t<100||t>1969&&t<2070)&&e>0&&e<13&&(n=a[e],2===e&&t%4==0&&(t%100==0&&t%400!=0||(n=29)),i>0&&i<=n)}((l=n.isDate(e)?{year:e.getFullYear(),month:e.getMonth()+1,date:e.getDate(),hour:e.getHours(),minute:e.getMinutes()}:{year:e.year,month:e.month,date:e.date,hour:e.hour,minute:e.minute}).year,l.month,l.date)&&(l.meridiem="",/([^\\]|^)[aA]\b/.test(t)&&(s=l.hour>11?u:h,l.hour>12&&(l.hour%=12),0===l.hour&&(l.hour=12),l.meridiem=s),t.replace(o,function(t){return t.indexOf("\\")>-1?t.replace(/\\/,""):c[t](l)||""}))}},function(t,e,i){"use strict";var n=i(6).inherit,r=i(1).extend;t.exports=function(t,e){var i;return e||(e=t,t=null),i=e.init||function(){},t&&n(i,t),e.hasOwnProperty("static")&&(r(i,e.static),delete e.static),r(i.prototype,e),i}},function(t,e,i){"use strict";var n=i(15),r=i(2),o="initialize";t.exports=function(t,e){var i=e||{};return r.isFunction(i[o])&&i[o](),n(t,i)}},function(t,e,i){"use strict";var n=i(4),r=i(1);t.exports=function(t,e,i){var o,s,a;return(o=t.split(".")).unshift(window),s=n.reduce(o,function(t,e){return t[e]=t[e]||{},t[e]}),i?(a=o.pop(),s=r.pick.apply(null,o)[a]=e):r.extend(s,e),s}},function(t,e,i){"use strict";var n=i(4),r=i(2),o=i(1),s=/\s+/g;function a(){this.events=null,this.contexts=null}a.mixin=function(t){o.extend(t.prototype,a.prototype)},a.prototype._getHandlerItem=function(t,e){var i={handler:t};return e&&(i.context=e),i},a.prototype._safeEvent=function(t){var e,i=this.events;return i||(i=this.events={}),t&&((e=i[t])||(e=[],i[t]=e),i=e),i},a.prototype._safeContext=function(){var t=this.contexts;return t||(t=this.contexts=[]),t},a.prototype._indexOfContext=function(t){for(var e=this._safeContext(),i=0;e[i];){if(t===e[i][0])return i;i+=1}return-1},a.prototype._memorizeContext=function(t){var e,i;r.isExisty(t)&&(e=this._safeContext(),(i=this._indexOfContext(t))>-1?e[i][1]+=1:e.push([t,1]))},a.prototype._forgetContext=function(t){var e,i;r.isExisty(t)&&(e=this._safeContext(),(i=this._indexOfContext(t))>-1&&(e[i][1]-=1,e[i][1]<=0&&e.splice(i,1)))},a.prototype._bindEvent=function(t,e,i){var n=this._safeEvent(t);this._memorizeContext(i),n.push(this._getHandlerItem(e,i))},a.prototype.on=function(t,e,i){var o=this;r.isString(t)?(t=t.split(s),n.forEach(t,function(t){o._bindEvent(t,e,i)})):r.isObject(t)&&(i=e,n.forEach(t,function(t,e){o.on(e,t,i)}))},a.prototype.once=function(t,e,i){var o=this;if(r.isObject(t))return i=e,void n.forEach(t,function(t,e){o.once(e,t,i)});this.on(t,function n(){e.apply(i,arguments),o.off(t,n,i)},i)},a.prototype._spliceMatches=function(t,e){var i,n=0;if(r.isArray(t))for(i=t.length;n<i;n+=1)!0===e(t[n])&&(t.splice(n,1),i-=1,n-=1)},a.prototype._matchHandler=function(t){var e=this;return function(i){var n=t===i.handler;return n&&e._forgetContext(i.context),n}},a.prototype._matchContext=function(t){var e=this;return function(i){var n=t===i.context;return n&&e._forgetContext(i.context),n}},a.prototype._matchHandlerAndContext=function(t,e){var i=this;return function(n){var r=t===n.handler,o=e===n.context,s=r&&o;return s&&i._forgetContext(n.context),s}},a.prototype._offByEventName=function(t,e){var i=this,o=n.forEachArray,a=r.isFunction(e),c=i._matchHandler(e);t=t.split(s),o(t,function(t){var e=i._safeEvent(t);a?i._spliceMatches(e,c):(o(e,function(t){i._forgetContext(t.context)}),i.events[t]=[])})},a.prototype._offByHandler=function(t){var e=this,i=this._matchHandler(t);n.forEach(this._safeEvent(),function(t){e._spliceMatches(t,i)})},a.prototype._offByObject=function(t,e){var i,o=this;this._indexOfContext(t)<0?n.forEach(t,function(t,e){o.off(e,t)}):r.isString(e)?(i=this._matchContext(t),o._spliceMatches(this._safeEvent(e),i)):r.isFunction(e)?(i=this._matchHandlerAndContext(e,t),n.forEach(this._safeEvent(),function(t){o._spliceMatches(t,i)})):(i=this._matchContext(t),n.forEach(this._safeEvent(),function(t){o._spliceMatches(t,i)}))},a.prototype.off=function(t,e){r.isString(t)?this._offByEventName(t,e):arguments.length?r.isFunction(t)?this._offByHandler(t):r.isObject(t)&&this._offByObject(t,e):(this.events={},this.contexts=[])},a.prototype.fire=function(t){this.invoke.apply(this,arguments)},a.prototype.invoke=function(t){var e,i,n,r;if(!this.hasListener(t))return!0;for(e=this._safeEvent(t),i=Array.prototype.slice.call(arguments,1),n=0;e[n];){if(!1===(r=e[n]).handler.apply(r.context,i))return!1;n+=1}return!0},a.prototype.hasListener=function(t){return this.getListenerLength(t)>0},a.prototype.getListenerLength=function(t){return this._safeEvent(t).length},t.exports=a},function(t,e,i){"use strict";var n=i(4),r=i(2),o=function(){try{return Object.defineProperty({},"x",{}),!0}catch(t){return!1}}(),s=0;function a(t){t&&this.set.apply(this,arguments)}a.prototype.set=function(t){var e=this;r.isArray(t)||(t=n.toArray(arguments)),n.forEach(t,function(t){e._addItem(t)})},a.prototype.getName=function(t){var e,i=this;return n.forEach(this,function(n,r){if(i._isEnumItem(r)&&t===n)return e=r,!1}),e},a.prototype._addItem=function(t){var e;this.hasOwnProperty(t)||(e=this._makeEnumValue(),o?Object.defineProperty(this,t,{enumerable:!0,configurable:!1,writable:!1,value:e}):this[t]=e)},a.prototype._makeEnumValue=function(){var t;return t=s,s+=1,t},a.prototype._isEnumItem=function(t){return r.isNumber(this[t])},t.exports=a},function(t,e,i){"use strict";var n=i(4),r=i(19);function o(t){this._map=new r(t),this.size=this._map.size}n.forEachArray(["get","has","forEach","keys","values","entries"],function(t){o.prototype[t]=function(){return this._map[t].apply(this._map,arguments)}}),n.forEachArray(["delete","clear"],function(t){o.prototype[t]=function(){var e=this._map[t].apply(this._map,arguments);return this.size=this._map.size,e}}),o.prototype.set=function(){return this._map.set.apply(this._map,arguments),this.size=this._map.size,this},o.prototype.setObject=function(t){n.forEachOwnProperties(t,function(t,e){this.set(e,t)},this)},o.prototype.deleteByKeys=function(t){n.forEachArray(t,function(t){this.delete(t)},this)},o.prototype.merge=function(t){t.forEach(function(t,e){this.set(e,t)},this)},o.prototype.filter=function(t){var e=new o;return this.forEach(function(i,n){t(i,n)&&e.set(n,i)}),e},t.exports=o},function(t,e,i){"use strict";var n=i(4),r=i(2),o=i(3),s=i(10),a=i(5),c={},l={};function h(t,e){this._keys=t,this._valueGetter=e,this._length=this._keys.length,this._index=-1,this._done=!1}function u(t){this._valuesForString={},this._valuesForIndex={},this._keys=[],t&&this._setInitData(t),this.size=0}h.prototype.next=function(){var t={};do{this._index+=1}while(r.isUndefined(this._keys[this._index])&&this._index<this._length);return this._index>=this._length?t.done=!0:(t.done=!1,t.value=this._valueGetter(this._keys[this._index],this._index)),t},u.prototype._setInitData=function(t){if(!r.isArray(t))throw new Error("Only Array is supported.");n.forEachArray(t,function(t){this.set(t[0],t[1])},this)},u.prototype._isNaN=function(t){return"number"==typeof t&&t!=t},u.prototype._getKeyIndex=function(t){var e,i=-1;return r.isString(t)?(e=this._valuesForString[t])&&(i=e.keyIndex):i=o.inArray(t,this._keys),i},u.prototype._getOriginKey=function(t){var e=t;return t===c?e=void 0:t===l&&(e=NaN),e},u.prototype._getUniqueKey=function(t){var e=t;return r.isUndefined(t)?e=c:this._isNaN(t)&&(e=l),e},u.prototype._getValueObject=function(t,e){return r.isString(t)?this._valuesForString[t]:(r.isUndefined(e)&&(e=this._getKeyIndex(t)),e>=0?this._valuesForIndex[e]:void 0)},u.prototype._getOriginValue=function(t,e){return this._getValueObject(t,e).origin},u.prototype._getKeyValuePair=function(t,e){return[this._getOriginKey(t),this._getOriginValue(t,e)]},u.prototype._createValueObject=function(t,e){return{keyIndex:e,origin:t}},u.prototype.set=function(t,e){var i,n=this._getUniqueKey(t),o=this._getKeyIndex(n);return o<0&&(o=this._keys.push(n)-1,this.size+=1),i=this._createValueObject(e,o),r.isString(t)?this._valuesForString[t]=i:this._valuesForIndex[o]=i,this},u.prototype.get=function(t){var e=this._getUniqueKey(t),i=this._getValueObject(e);return i&&i.origin},u.prototype.keys=function(){return new h(this._keys,a.bind(this._getOriginKey,this))},u.prototype.values=function(){return new h(this._keys,a.bind(this._getOriginValue,this))},u.prototype.entries=function(){return new h(this._keys,a.bind(this._getKeyValuePair,this))},u.prototype.has=function(t){return!!this._getValueObject(t)},u.prototype.delete=function(t){var e;r.isString(t)?this._valuesForString[t]&&(e=this._valuesForString[t].keyIndex,delete this._valuesForString[t]):(e=this._getKeyIndex(t))>=0&&delete this._valuesForIndex[e],e>=0&&(delete this._keys[e],this.size-=1)},u.prototype.forEach=function(t,e){e=e||this,n.forEachArray(this._keys,function(i){r.isUndefined(i)||t.call(e,this._getValueObject(i).origin,i,this)},this)},u.prototype.clear=function(){u.call(this)},window.Map&&(s.firefox&&s.version>=37||s.chrome&&s.version>=42)&&(u=window.Map),t.exports=u},function(t,e,i){"use strict";var n=i(4),r=i(2);function o(t){this.length=0,t&&this.setObject(t)}o.prototype.set=function(t,e){2===arguments.length?this.setKeyValue(t,e):this.setObject(t)},o.prototype.setKeyValue=function(t,e){this.has(t)||(this.length+=1),this[this.encodeKey(t)]=e},o.prototype.setObject=function(t){var e=this;n.forEachOwnProperties(t,function(t,i){e.setKeyValue(i,t)})},o.prototype.merge=function(t){var e=this;t.each(function(t,i){e.setKeyValue(i,t)})},o.prototype.encodeKey=function(t){return"å"+t},o.prototype.decodeKey=function(t){var e=t.split("å");return e[e.length-1]},o.prototype.get=function(t){return this[this.encodeKey(t)]},o.prototype.has=function(t){return this.hasOwnProperty(this.encodeKey(t))},o.prototype.remove=function(t){return arguments.length>1&&(t=n.toArray(arguments)),r.isArray(t)?this.removeByKeyArray(t):this.removeByKey(t)},o.prototype.removeByKey=function(t){var e=this.has(t)?this.get(t):null;return null!==e&&(delete this[this.encodeKey(t)],this.length-=1),e},o.prototype.removeByKeyArray=function(t){var e=[],i=this;return n.forEach(t,function(t){e.push(i.removeByKey(t))}),e},o.prototype.removeAll=function(){var t=this;this.each(function(e,i){t.remove(i)})},o.prototype.each=function(t){var e,i=this;n.forEachOwnProperties(this,function(n,r){if("å"===r.charAt(0)&&(e=t(n,i.decodeKey(r))),!1===e)return e})},o.prototype.keys=function(){var t=[],e=this;return this.each(function(i,n){t.push(e.decodeKey(n))}),t},o.prototype.find=function(t){var e=[];return this.each(function(i,n){t(i,n)&&e.push(i)}),e},o.prototype.toArray=function(){var t=[];return this.each(function(e){t.push(e)}),t},t.exports=o}])})},function(module,exports,__webpack_require__){(function(Buffer,process){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,fabric=fabric||{version:"1.6.7"};exports.fabric=fabric,"undefined"!=typeof document&&"undefined"!=typeof window?(fabric.document=document,fabric.window=window,window.fabric=fabric):(fabric.document=__webpack_require__(24).jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),fabric.document.createWindow?fabric.window=fabric.document.createWindow():fabric.window=fabric.document.parentWindow),fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement,fabric.isLikelyNode=void 0!==Buffer&&"undefined"==typeof window,fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id"],fabric.DPI=96,fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",fabric.fontPaths={},fabric.charWidthsCache={},fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1,function(){function t(t,e){if(this.__eventListeners[t]){var i=this.__eventListeners[t];e?i[i.indexOf(e)]=!1:fabric.util.array.fill(i,!1)}}function e(t,e){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var i in t)this.on(i,t[i]);else this.__eventListeners[t]||(this.__eventListeners[t]=[]),this.__eventListeners[t].push(e);return this}function i(e,i){if(this.__eventListeners){if(0===arguments.length)for(e in this.__eventListeners)t.call(this,e);else if(1===arguments.length&&"object"==typeof arguments[0])for(var n in e)t.call(this,n,e[n]);else t.call(this,e,i);return this}}function n(t,e){if(this.__eventListeners){var i=this.__eventListeners[t];if(i){for(var n=0,r=i.length;n<r;n++)i[n]&&i[n].call(this,e||{});return this.__eventListeners[t]=i.filter(function(t){return!1!==t}),this}}}fabric.Observable={observe:e,stopObserving:i,fire:n,on:e,off:i,trigger:n}}(),fabric.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var t=0,e=arguments.length;t<e;t++)this._onObjectAdded(arguments[t]);return this.renderOnAddRemove&&this.renderAll(),this},insertAt:function(t,e,i){var n=this.getObjects();return i?n[e]=t:n.splice(e,0,t),this._onObjectAdded&&this._onObjectAdded(t),this.renderOnAddRemove&&this.renderAll(),this},remove:function(){for(var t,e=this.getObjects(),i=!1,n=0,r=arguments.length;n<r;n++)-1!==(t=e.indexOf(arguments[n]))&&(i=!0,e.splice(t,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[n]));return this.renderOnAddRemove&&i&&this.renderAll(),this},forEachObject:function(t,e){for(var i=this.getObjects(),n=0,r=i.length;n<r;n++)t.call(e,i[n],n,i);return this},getObjects:function(t){return void 0===t?this._objects:this._objects.filter(function(e){return e.type===t})},item:function(t){return this.getObjects()[t]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(t){return this.getObjects().indexOf(t)>-1},complexity:function(){return this.getObjects().reduce(function(t,e){return t+=e.complexity?e.complexity():0},0)}},function(t){var e=Math.sqrt,i=Math.atan2,n=Math.pow,r=Math.abs,o=Math.PI/180;fabric.util={removeFromArray:function(t,e){var i=t.indexOf(e);return-1!==i&&t.splice(i,1),t},getRandomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},degreesToRadians:function(t){return t*o},radiansToDegrees:function(t){return t/o},rotatePoint:function(t,e,i){t.subtractEquals(e);var n=fabric.util.rotateVector(t,i);return new fabric.Point(n.x,n.y).addEquals(e)},rotateVector:function(t,e){var i=Math.sin(e),n=Math.cos(e);return{x:t.x*n-t.y*i,y:t.x*i+t.y*n}},transformPoint:function(t,e,i){return i?new fabric.Point(e[0]*t.x+e[2]*t.y,e[1]*t.x+e[3]*t.y):new fabric.Point(e[0]*t.x+e[2]*t.y+e[4],e[1]*t.x+e[3]*t.y+e[5])},makeBoundingBoxFromPoints:function(t){var e=[t[0].x,t[1].x,t[2].x,t[3].x],i=fabric.util.array.min(e),n=fabric.util.array.max(e),r=Math.abs(i-n),o=[t[0].y,t[1].y,t[2].y,t[3].y],s=fabric.util.array.min(o),a=fabric.util.array.max(o);return{left:i,top:s,width:r,height:Math.abs(s-a)}},invertTransform:function(t){var e=1/(t[0]*t[3]-t[1]*t[2]),i=[e*t[3],-e*t[1],-e*t[2],e*t[0]],n=fabric.util.transformPoint({x:t[4],y:t[5]},i,!0);return i[4]=-n.x,i[5]=-n.y,i},toFixed:function(t,e){return parseFloat(Number(t).toFixed(e))},parseUnit:function(t,e){var i=/\D{0,2}$/.exec(t),n=parseFloat(t);switch(e||(e=fabric.Text.DEFAULT_SVG_FONT_SIZE),i[0]){case"mm":return n*fabric.DPI/25.4;case"cm":return n*fabric.DPI/2.54;case"in":return n*fabric.DPI;case"pt":return n*fabric.DPI/72;case"pc":return n*fabric.DPI/72*12;case"em":return n*e;default:return n}},falseFunction:function(){return!1},getKlass:function(t,e){return t=fabric.util.string.camelize(t.charAt(0).toUpperCase()+t.slice(1)),fabric.util.resolveNamespace(e)[t]},resolveNamespace:function(e){if(!e)return fabric;var i,n=e.split("."),r=n.length,o=t||fabric.window;for(i=0;i<r;++i)o=o[n[i]];return o},loadImage:function(t,e,i,n){if(t){var r=fabric.util.createImage();r.onload=function(){e&&e.call(i,r),r=r.onload=r.onerror=null},r.onerror=function(){fabric.log("Error loading "+r.src),e&&e.call(i,null,!0),r=r.onload=r.onerror=null},0!==t.indexOf("data")&&n&&(r.crossOrigin=n),r.src=t}else e&&e.call(i,t)},enlivenObjects:function(t,e,i,n){function r(){++s===a&&e&&e(o)}var o=[],s=0,a=(t=t||[]).length;a?t.forEach(function(t,e){if(t&&t.type){var s=fabric.util.getKlass(t.type,i);s.async?s.fromObject(t,function(i,s){s||(o[e]=i,n&&n(t,o[e])),r()}):(o[e]=s.fromObject(t),n&&n(t,o[e]),r())}else r()}):e&&e(o)},groupSVGElements:function(t,e,i){var n;return n=new fabric.PathGroup(t,e),void 0!==i&&n.setSourcePath(i),n},populateWithProperties:function(t,e,i){if(i&&"[object Array]"===Object.prototype.toString.call(i))for(var n=0,r=i.length;n<r;n++)i[n]in t&&(e[i[n]]=t[i[n]])},drawDashedLine:function(t,n,r,o,s,a){var c=o-n,l=s-r,h=e(c*c+l*l),u=i(l,c),f=a.length,d=0,p=!0;for(t.save(),t.translate(n,r),t.moveTo(0,0),t.rotate(u),n=0;h>n;)(n+=a[d++%f])>h&&(n=h),t[p?"lineTo":"moveTo"](n,0),p=!p;t.restore()},createCanvasElement:function(t){return t||(t=fabric.document.createElement("canvas")),t.getContext||"undefined"==typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(t),t},createImage:function(){return fabric.isLikelyNode?new(__webpack_require__(5).Image):fabric.document.createElement("img")},createAccessors:function(t){var e,i,n,r,o,s=t.prototype;for(e=s.stateProperties.length;e--;)r="set"+(n=(i=s.stateProperties[e]).charAt(0).toUpperCase()+i.slice(1)),s[o="get"+n]||(s[o]=new Function('return this.get("'+i+'")')),s[r]||(s[r]=new Function("value",'return this.set("'+i+'", value)'))},clipContext:function(t,e){e.save(),e.beginPath(),t.clipTo(e),e.clip()},multiplyTransformMatrices:function(t,e,i){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],i?0:t[0]*e[4]+t[2]*e[5]+t[4],i?0:t[1]*e[4]+t[3]*e[5]+t[5]]},qrDecompose:function(t){var r=i(t[1],t[0]),s=n(t[0],2)+n(t[1],2),a=e(s),c=(t[0]*t[3]-t[2]*t[1])/a,l=i(t[0]*t[2]+t[1]*t[3],s);return{angle:r/o,scaleX:a,scaleY:c,skewX:l/o,skewY:0,translateX:t[4],translateY:t[5]}},customTransformMatrix:function(t,e,i){var n=[1,0,r(Math.tan(i*o)),1],s=[r(t),0,0,r(e)];return fabric.util.multiplyTransformMatrices(s,n,!0)},resetObjectTransform:function(t){t.scaleX=1,t.scaleY=1,t.skewX=0,t.skewY=0,t.flipX=!1,t.flipY=!1,t.setAngle(0)},getFunctionBody:function(t){return(String(t).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(t,e,i,n){n>0&&(e>n?e-=n:e=0,i>n?i-=n:i=0);var r,o=!0,s=t.getImageData(e,i,2*n||1,2*n||1),a=s.data.length;for(r=3;r<a&&!1!==(o=s.data[r]<=0);r+=4);return s=null,o},parsePreserveAspectRatioAttribute:function(t){var e,i="meet",n=t.split(" ");return n&&n.length&&("meet"!==(i=n.pop())&&"slice"!==i?(e=i,i="meet"):n.length&&(e=n.pop())),{meetOrSlice:i,alignX:"none"!==e?e.slice(1,4):"none",alignY:"none"!==e?e.slice(5,8):"none"}},clearFabricFontCache:function(t){t?fabric.charWidthsCache[t]&&delete fabric.charWidthsCache[t]:fabric.charWidthsCache={}}}}(exports),function(){var t={},e={},i={},n=Array.prototype.join;function r(e,i,r,a,c,l,h){var u=n.call(arguments);if(t[u])return t[u];var f=Math.PI,d=h*f/180,p=Math.sin(d),g=Math.cos(d),v=0,m=0,b=-g*e*.5-p*i*.5,y=-g*i*.5+p*e*.5,_=(r=Math.abs(r))*r,x=(a=Math.abs(a))*a,w=y*y,S=b*b,C=_*x-_*w-x*S,O=0;if(C<0){var k=Math.sqrt(1-C/(_*x));r*=k,a*=k}else O=(c===l?-1:1)*Math.sqrt(C/(_*w+x*S));var T=O*r*y/a,E=-O*a*b/r,j=g*T-p*E+.5*e,M=p*T+g*E+.5*i,P=s(1,0,(b-T)/r,(y-E)/a),A=s((b-T)/r,(y-E)/a,(-b-T)/r,(-y-E)/a);0===l&&A>0?A-=2*f:1===l&&A<0&&(A+=2*f);for(var I=Math.ceil(Math.abs(A/f*2)),D=[],L=A/I,R=8/3*Math.sin(L/4)*Math.sin(L/4)/Math.sin(L/2),B=P+L,F=0;F<I;F++)D[F]=o(P,B,g,p,r,a,j,M,R,v,m),v=D[F][4],m=D[F][5],P=B,B+=L;return t[u]=D,D}function o(t,i,r,o,s,a,c,l,h,u,f){var d=n.call(arguments);if(e[d])return e[d];var p=Math.cos(t),g=Math.sin(t),v=Math.cos(i),m=Math.sin(i),b=r*s*v-o*a*m+c,y=o*s*v+r*a*m+l,_=u+h*(-r*s*g-o*a*p),x=f+h*(-o*s*g+r*a*p),w=b+h*(r*s*m+o*a*v),S=y+h*(o*s*m-r*a*v);return e[d]=[_,x,w,S,b,y],e[d]}function s(t,e,i,n){var r=Math.atan2(e,t),o=Math.atan2(n,i);return o>=r?o-r:2*Math.PI-(r-o)}function a(t,e,r,o,s,a,c,l){var h=n.call(arguments);if(i[h])return i[h];var u,f,d,p,g,v,m,b,y=Math.sqrt,_=Math.min,x=Math.max,w=Math.abs,S=[],C=[[],[]];f=6*t-12*r+6*s,u=-3*t+9*r-9*s+3*c,d=3*r-3*t;for(var O=0;O<2;++O)if(O>0&&(f=6*e-12*o+6*a,u=-3*e+9*o-9*a+3*l,d=3*o-3*e),w(u)<1e-12){if(w(f)<1e-12)continue;0<(p=-d/f)&&p<1&&S.push(p)}else(m=f*f-4*d*u)<0||(0<(g=(-f+(b=y(m)))/(2*u))&&g<1&&S.push(g),0<(v=(-f-b)/(2*u))&&v<1&&S.push(v));for(var k,T,E,j=S.length,M=j;j--;)k=(E=1-(p=S[j]))*E*E*t+3*E*E*p*r+3*E*p*p*s+p*p*p*c,C[0][j]=k,T=E*E*E*e+3*E*E*p*o+3*E*p*p*a+p*p*p*l,C[1][j]=T;C[0][M]=t,C[1][M]=e,C[0][M+1]=c,C[1][M+1]=l;var P=[{x:_.apply(null,C[0]),y:_.apply(null,C[1])},{x:x.apply(null,C[0]),y:x.apply(null,C[1])}];return i[h]=P,P}fabric.util.drawArc=function(t,e,i,n){for(var o=n[0],s=n[1],a=n[2],c=n[3],l=n[4],h=[[],[],[],[]],u=r(n[5]-e,n[6]-i,o,s,c,l,a),f=0,d=u.length;f<d;f++)h[f][0]=u[f][0]+e,h[f][1]=u[f][1]+i,h[f][2]=u[f][2]+e,h[f][3]=u[f][3]+i,h[f][4]=u[f][4]+e,h[f][5]=u[f][5]+i,t.bezierCurveTo.apply(t,h[f])},fabric.util.getBoundsOfArc=function(t,e,i,n,o,s,c,l,h){for(var u,f=0,d=0,p=[],g=r(l-t,h-e,i,n,s,c,o),v=0,m=g.length;v<m;v++)u=a(f,d,g[v][0],g[v][1],g[v][2],g[v][3],g[v][4],g[v][5]),p.push({x:u[0].x+t,y:u[0].y+e}),p.push({x:u[1].x+t,y:u[1].y+e}),f=g[v][4],d=g[v][5];return p},fabric.util.getBoundsOfCurve=a}(),function(){var t=Array.prototype.slice;function e(t,e,i){if(t&&0!==t.length){var n=t.length-1,r=e?t[n][e]:t[n];if(e)for(;n--;)i(t[n][e],r)&&(r=t[n][e]);else for(;n--;)i(t[n],r)&&(r=t[n]);return r}}Array.prototype.indexOf||(Array.prototype.indexOf=function(t){if(void 0===this||null===this)throw new TypeError;var e=Object(this),i=e.length>>>0;if(0===i)return-1;var n=0;if(arguments.length>0&&((n=Number(arguments[1]))!=n?n=0:0!==n&&n!==Number.POSITIVE_INFINITY&&n!==Number.NEGATIVE_INFINITY&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=i)return-1;for(var r=n>=0?n:Math.max(i-Math.abs(n),0);r<i;r++)if(r in e&&e[r]===t)return r;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){for(var i=0,n=this.length>>>0;i<n;i++)i in this&&t.call(e,this[i],i,this)}),Array.prototype.map||(Array.prototype.map=function(t,e){for(var i=[],n=0,r=this.length>>>0;n<r;n++)n in this&&(i[n]=t.call(e,this[n],n,this));return i}),Array.prototype.every||(Array.prototype.every=function(t,e){for(var i=0,n=this.length>>>0;i<n;i++)if(i in this&&!t.call(e,this[i],i,this))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(t,e){for(var i=0,n=this.length>>>0;i<n;i++)if(i in this&&t.call(e,this[i],i,this))return!0;return!1}),Array.prototype.filter||(Array.prototype.filter=function(t,e){for(var i,n=[],r=0,o=this.length>>>0;r<o;r++)r in this&&(i=this[r],t.call(e,i,r,this)&&n.push(i));return n}),Array.prototype.reduce||(Array.prototype.reduce=function(t){var e,i=this.length>>>0,n=0;if(arguments.length>1)e=arguments[1];else for(;;){if(n in this){e=this[n++];break}if(++n>=i)throw new TypeError}for(;n<i;n++)n in this&&(e=t.call(null,e,this[n],n,this));return e}),fabric.util.array={fill:function(t,e){for(var i=t.length;i--;)t[i]=e;return t},invoke:function(e,i){for(var n=t.call(arguments,2),r=[],o=0,s=e.length;o<s;o++)r[o]=n.length?e[o][i].apply(e[o],n):e[o][i].call(e[o]);return r},min:function(t,i){return e(t,i,function(t,e){return t<e})},max:function(t,i){return e(t,i,function(t,e){return t>=e})}}}(),function(){function t(t,i,n){if(n)if(!fabric.isLikelyNode&&i instanceof Element)t=i;else if(i instanceof Array)t=i.map(function(t){return e(t,n)});else if(i instanceof Object)for(var r in i)t[r]=e(i[r],n);else t=i;else for(var r in i)t[r]=i[r];return t}function e(e,i){return t({},e,i)}fabric.util.object={extend:t,clone:e}}(),function(){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}),fabric.util.string={camelize:function(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})},capitalize:function(t,e){return t.charAt(0).toUpperCase()+(e?t.slice(1):t.slice(1).toLowerCase())},escapeXml:function(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}}(),function(){var t=Array.prototype.slice,e=Function.prototype.apply,i=function(){};Function.prototype.bind||(Function.prototype.bind=function(n){var r,o=this,s=t.call(arguments,1);return r=s.length?function(){return e.call(o,this instanceof i?this:n,s.concat(t.call(arguments)))}:function(){return e.call(o,this instanceof i?this:n,arguments)},i.prototype=this.prototype,r.prototype=new i,r})}(),function(){var t=Array.prototype.slice,e=function(){},i=function(){for(var t in{toString:1})if("toString"===t)return!1;return!0}(),n=function(t,e,n){for(var r in e)r in t.prototype&&"function"==typeof t.prototype[r]&&(e[r]+"").indexOf("callSuper")>-1?t.prototype[r]=function(t){return function(){var i=this.constructor.superclass;this.constructor.superclass=n;var r=e[t].apply(this,arguments);if(this.constructor.superclass=i,"initialize"!==t)return r}}(r):t.prototype[r]=e[r],i&&(e.toString!==Object.prototype.toString&&(t.prototype.toString=e.toString),e.valueOf!==Object.prototype.valueOf&&(t.prototype.valueOf=e.valueOf))};function r(){}function o(e){var i=this.constructor.superclass.prototype[e];return arguments.length>1?i.apply(this,t.call(arguments,1)):i.call(this)}fabric.util.createClass=function(){var i=null,s=t.call(arguments,0);function a(){this.initialize.apply(this,arguments)}"function"==typeof s[0]&&(i=s.shift()),a.superclass=i,a.subclasses=[],i&&(r.prototype=i.prototype,a.prototype=new r,i.subclasses.push(a));for(var c=0,l=s.length;c<l;c++)n(a,s[c],i);return a.prototype.initialize||(a.prototype.initialize=e),a.prototype.constructor=a,a.prototype.callSuper=o,a}}(),function(){var t="unknown";function e(t){var e,i,n=Array.prototype.slice.call(arguments,1),r=n.length;for(i=0;i<r;i++)if(e=typeof t[n[i]],!/^(?:function|object|unknown)$/.test(e))return!1;return!0}var i,n,r=function(){var t=0;return function(e){return e.__uniqueID||(e.__uniqueID="uniqueID__"+t++)}}();function o(t,e){return{handler:e,wrappedHandler:function(t,e){return function(n){e.call(i(t),n||fabric.window.event)}}(t,e)}}!function(){var t={};i=function(e){return t[e]},n=function(e,i){t[e]=i}}();var s,a,c=e(fabric.document.documentElement,"addEventListener","removeEventListener")&&e(fabric.window,"addEventListener","removeEventListener"),l=e(fabric.document.documentElement,"attachEvent","detachEvent")&&e(fabric.window,"attachEvent","detachEvent"),h={},u={};c?(s=function(t,e,i){t.addEventListener(e,i,!1)},a=function(t,e,i){t.removeEventListener(e,i,!1)}):l?(s=function(t,e,i){var s=r(t);n(s,t),h[s]||(h[s]={}),h[s][e]||(h[s][e]=[]);var a=o(s,i);h[s][e].push(a),t.attachEvent("on"+e,a.wrappedHandler)},a=function(t,e,i){var n,o=r(t);if(h[o]&&h[o][e])for(var s=0,a=h[o][e].length;s<a;s++)(n=h[o][e][s])&&n.handler===i&&(t.detachEvent("on"+e,n.wrappedHandler),h[o][e][s]=null)}):(s=function(t,e,i){var n=r(t);if(u[n]||(u[n]={}),!u[n][e]){u[n][e]=[];var o=t["on"+e];o&&u[n][e].push(o),t["on"+e]=function(t,e){return function(i){if(u[t]&&u[t][e])for(var n=u[t][e],r=0,o=n.length;r<o;r++)n[r].call(this,i||fabric.window.event)}}(n,e)}u[n][e].push(i)},a=function(t,e,i){var n=r(t);if(u[n]&&u[n][e])for(var o=u[n][e],s=0,a=o.length;s<a;s++)o[s]===i&&o.splice(s,1)}),fabric.util.addListener=s,fabric.util.removeListener=a;var f=function(e){return typeof e.clientX!==t?e.clientX:0},d=function(e){return typeof e.clientY!==t?e.clientY:0};function p(t,e,i){var n="touchend"===t.type?"changedTouches":"touches";return t[n]&&t[n][0]&&t[n][0][e]-(t[n][0][e]-t[n][0][i])||t[i]}fabric.isTouchSupported&&(f=function(t){return p(t,"pageX","clientX")},d=function(t){return p(t,"pageY","clientY")}),fabric.util.getPointer=function(e){e||(e=fabric.window.event);var i=e.target||(typeof e.srcElement!==t?e.srcElement:null),n=fabric.util.getScrollLeftTop(i);return{x:f(e)+n.left,y:d(e)+n.top}},fabric.util.object.extend(fabric.util,fabric.Observable)}(),function(){var t=fabric.document.createElement("div"),e="string"==typeof t.style.opacity,i="string"==typeof t.style.filter,n=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,r=function(t){return t};e?r=function(t,e){return t.style.opacity=e,t}:i&&(r=function(t,e){var i=t.style;return t.currentStyle&&!t.currentStyle.hasLayout&&(i.zoom=1),n.test(i.filter)?(e=e>=.9999?"":"alpha(opacity="+100*e+")",i.filter=i.filter.replace(n,e)):i.filter+=" alpha(opacity="+100*e+")",t}),fabric.util.setStyle=function(t,e){var i=t.style;if(!i)return t;if("string"==typeof e)return t.style.cssText+=";"+e,e.indexOf("opacity")>-1?r(t,e.match(/opacity:\s*(\d?\.?\d*)/)[1]):t;for(var n in e)"opacity"===n?r(t,e[n]):i["float"===n||"cssFloat"===n?void 0===i.styleFloat?"cssFloat":"styleFloat":n]=e[n];return t}}(),function(){var t=Array.prototype.slice;var e,i,n=function(e){return t.call(e,0)};try{e=n(fabric.document.childNodes)instanceof Array}catch(t){}function r(t,e){var i=fabric.document.createElement(t);for(var n in e)"class"===n?i.className=e[n]:"for"===n?i.htmlFor=e[n]:i.setAttribute(n,e[n]);return i}function o(t){for(var e=0,i=0,n=fabric.document.documentElement,r=fabric.document.body||{scrollLeft:0,scrollTop:0};t&&(t.parentNode||t.host)&&((t=t.parentNode||t.host)===fabric.document?(e=r.scrollLeft||n.scrollLeft||0,i=r.scrollTop||n.scrollTop||0):(e+=t.scrollLeft||0,i+=t.scrollTop||0),1!==t.nodeType||"fixed"!==fabric.util.getElementStyle(t,"position")););return{left:e,top:i}}e||(n=function(t){for(var e=new Array(t.length),i=t.length;i--;)e[i]=t[i];return e}),i=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(t,e){var i=fabric.document.defaultView.getComputedStyle(t,null);return i?i[e]:void 0}:function(t,e){var i=t.style[e];return!i&&t.currentStyle&&(i=t.currentStyle[e]),i},function(){var t=fabric.document.documentElement.style,e="userSelect"in t?"userSelect":"MozUserSelect"in t?"MozUserSelect":"WebkitUserSelect"in t?"WebkitUserSelect":"KhtmlUserSelect"in t?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=function(t){return void 0!==t.onselectstart&&(t.onselectstart=fabric.util.falseFunction),e?t.style[e]="none":"string"==typeof t.unselectable&&(t.unselectable="on"),t},fabric.util.makeElementSelectable=function(t){return void 0!==t.onselectstart&&(t.onselectstart=null),e?t.style[e]="":"string"==typeof t.unselectable&&(t.unselectable=""),t}}(),function(){fabric.util.getScript=function(t,e){var i=fabric.document.getElementsByTagName("head")[0],n=fabric.document.createElement("script"),r=!0;n.onload=n.onreadystatechange=function(t){if(r){if("string"==typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)return;r=!1,e(t||fabric.window.event),n=n.onload=n.onreadystatechange=null}},n.src=t,i.appendChild(n)}}(),fabric.util.getById=function(t){return"string"==typeof t?fabric.document.getElementById(t):t},fabric.util.toArray=n,fabric.util.makeElement=r,fabric.util.addClass=function(t,e){t&&-1===(" "+t.className+" ").indexOf(" "+e+" ")&&(t.className+=(t.className?" ":"")+e)},fabric.util.wrapElement=function(t,e,i){return"string"==typeof e&&(e=r(e,i)),t.parentNode&&t.parentNode.replaceChild(e,t),e.appendChild(t),e},fabric.util.getScrollLeftTop=o,fabric.util.getElementOffset=function(t){var e,n,r=t&&t.ownerDocument,s={left:0,top:0},a={left:0,top:0},c={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!r)return a;for(var l in c)a[c[l]]+=parseInt(i(t,l),10)||0;return e=r.documentElement,void 0!==t.getBoundingClientRect&&(s=t.getBoundingClientRect()),n=o(t),{left:s.left+n.left-(e.clientLeft||0)+a.left,top:s.top+n.top-(e.clientTop||0)+a.top}},fabric.util.getElementStyle=i}(),function(){var t=function(){for(var t=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],e=t.length;e--;)try{if(t[e]())return t[e]}catch(t){}}();function e(){}fabric.util.request=function(i,n){n||(n={});var r=n.method?n.method.toUpperCase():"GET",o=n.onComplete||function(){},s=t(),a=n.body||n.parameters;return s.onreadystatechange=function(){4===s.readyState&&(o(s),s.onreadystatechange=e)},"GET"===r&&(a=null,"string"==typeof n.parameters&&(i=function(t,e){return t+(/\?/.test(t)?"&":"?")+e}(i,n.parameters))),s.open(r,i,!0),"POST"!==r&&"PUT"!==r||s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send(a),s}}(),fabric.log=function(){},fabric.warn=function(){},"undefined"!=typeof console&&["log","warn"].forEach(function(t){void 0!==console[t]&&"function"==typeof console[t].apply&&(fabric[t]=function(){return console[t].apply(console,arguments)})}),function(){var t=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(t){fabric.window.setTimeout(t,1e3/60)};function e(){return t.apply(fabric.window,arguments)}fabric.util.animate=function(t){e(function(i){t||(t={});var n,r=i||+new Date,o=t.duration||500,s=r+o,a=t.onChange||function(){},c=t.abort||function(){return!1},l=t.easing||function(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e},h="startValue"in t?t.startValue:0,u="endValue"in t?t.endValue:100,f=t.byValue||u-h;t.onStart&&t.onStart(),function i(u){var d=(n=u||+new Date)>s?o:n-r;c()?t.onComplete&&t.onComplete():(a(l(d,h,f,o)),n>s?t.onComplete&&t.onComplete():e(i))}(r)})},fabric.util.requestAnimFrame=e}(),function(){function t(t,e,i,n){return t<Math.abs(e)?(t=e,n=i/4):n=0===e&&0===t?i/(2*Math.PI)*Math.asin(1):i/(2*Math.PI)*Math.asin(e/t),{a:t,c:e,p:i,s:n}}function e(t,e,i){return t.a*Math.pow(2,10*(e-=1))*Math.sin((e*i-t.s)*(2*Math.PI)/t.p)}function i(t,e,i,r){return i-n(r-t,0,i,r)+e}function n(t,e,i,n){return(t/=n)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e}fabric.util.ease={easeInQuad:function(t,e,i,n){return i*(t/=n)*t+e},easeOutQuad:function(t,e,i,n){return-i*(t/=n)*(t-2)+e},easeInOutQuad:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},easeInCubic:function(t,e,i,n){return i*(t/=n)*t*t+e},easeOutCubic:function(t,e,i,n){return i*((t=t/n-1)*t*t+1)+e},easeInOutCubic:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},easeInQuart:function(t,e,i,n){return i*(t/=n)*t*t*t+e},easeOutQuart:function(t,e,i,n){return-i*((t=t/n-1)*t*t*t-1)+e},easeInOutQuart:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},easeInQuint:function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},easeOutQuint:function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},easeInOutQuint:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},easeInSine:function(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e},easeOutSine:function(t,e,i,n){return i*Math.sin(t/n*(Math.PI/2))+e},easeInOutSine:function(t,e,i,n){return-i/2*(Math.cos(Math.PI*t/n)-1)+e},easeInExpo:function(t,e,i,n){return 0===t?e:i*Math.pow(2,10*(t/n-1))+e},easeOutExpo:function(t,e,i,n){return t===n?e+i:i*(1-Math.pow(2,-10*t/n))+e},easeInOutExpo:function(t,e,i,n){return 0===t?e:t===n?e+i:(t/=n/2)<1?i/2*Math.pow(2,10*(t-1))+e:i/2*(2-Math.pow(2,-10*--t))+e},easeInCirc:function(t,e,i,n){return-i*(Math.sqrt(1-(t/=n)*t)-1)+e},easeOutCirc:function(t,e,i,n){return i*Math.sqrt(1-(t=t/n-1)*t)+e},easeInOutCirc:function(t,e,i,n){return(t/=n/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e},easeInElastic:function(i,n,r,o){var s=0;return 0===i?n:1==(i/=o)?n+r:(s||(s=.3*o),-e(t(r,r,s,1.70158),i,o)+n)},easeOutElastic:function(e,i,n,r){var o=0,s=n;if(0===e)return i;if(1==(e/=r))return i+n;o||(o=.3*r);var a=t(s,n,o,1.70158);return a.a*Math.pow(2,-10*e)*Math.sin((e*r-a.s)*(2*Math.PI)/a.p)+a.c+i},easeInOutElastic:function(i,n,r,o){var s=0,a=r;if(0===i)return n;if(2==(i/=o/2))return n+r;s||(s=o*(.3*1.5));var c=t(a,r,s,1.70158);return i<1?-.5*e(c,i,o)+n:c.a*Math.pow(2,-10*(i-=1))*Math.sin((i*o-c.s)*(2*Math.PI)/c.p)*.5+c.c+n},easeInBack:function(t,e,i,n,r){return void 0===r&&(r=1.70158),i*(t/=n)*t*((r+1)*t-r)+e},easeOutBack:function(t,e,i,n,r){return void 0===r&&(r=1.70158),i*((t=t/n-1)*t*((r+1)*t+r)+1)+e},easeInOutBack:function(t,e,i,n,r){return void 0===r&&(r=1.70158),(t/=n/2)<1?i/2*(t*t*((1+(r*=1.525))*t-r))+e:i/2*((t-=2)*t*((1+(r*=1.525))*t+r)+2)+e},easeInBounce:i,easeOutBounce:n,easeInOutBounce:function(t,e,r,o){return t<o/2?.5*i(2*t,0,r,o)+e:.5*n(2*t-o,0,r,o)+.5*r+e}}}(),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.string.capitalize,r=e.util.object.clone,o=e.util.toFixed,s=e.util.parseUnit,a=e.util.multiplyTransformMatrices,c=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/i,l=/^(symbol|image|marker|pattern|view|svg)$/i,h=/^(?:pattern|defs|symbol|metadata)$/i,u=/^(symbol|g|a|svg)$/i,f={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"originX"},d={stroke:"strokeOpacity",fill:"fillOpacity"};function p(t){return t in f?f[t]:t}function g(t,i,n,r){var o,c="[object Array]"===Object.prototype.toString.call(i);return"fill"!==t&&"stroke"!==t||"none"!==i?"strokeDashArray"===t?i=i.replace(/,/g," ").split(/\s+/).map(function(t){return parseFloat(t)}):"transformMatrix"===t?i=n&&n.transformMatrix?a(n.transformMatrix,e.parseTransformAttribute(i)):e.parseTransformAttribute(i):"visible"===t?(i="none"!==i&&"hidden"!==i,n&&!1===n.visible&&(i=!1)):"originX"===t?i="start"===i?"left":"end"===i?"right":"center":o=c?i.map(s):s(i,r):i="",!c&&isNaN(o)?i:o}function v(t,e){for(var i,n,r=[],o=0;o<e.length;o++)i=e[o],n=t.getElementsByTagName(i),r=r.concat(Array.prototype.slice.call(n));return r}function m(t,e){var i,n=!0;return(i=b(t,e.pop()))&&e.length&&(n=function(t,e){var i,n=!0;for(;t.parentNode&&1===t.parentNode.nodeType&&e.length;)n&&(i=e.pop()),t=t.parentNode,n=b(t,i);return 0===e.length}(t,e)),i&&n&&0===e.length}function b(t,e){var i,n=t.nodeName,r=t.getAttribute("class"),o=t.getAttribute("id");if(i=new RegExp("^"+n,"i"),e=e.replace(i,""),o&&e.length&&(i=new RegExp("#"+o+"(?![a-zA-Z\\-]+)","i"),e=e.replace(i,"")),r&&e.length)for(var s=(r=r.split(" ")).length;s--;)i=new RegExp("\\."+r[s]+"(?![a-zA-Z\\-]+)","i"),e=e.replace(i,"");return 0===e.length}function y(t,e){var i;if(t.getElementById&&(i=t.getElementById(e)),i)return i;var n,r,o=t.getElementsByTagName("*");for(r=0;r<o.length;r++)if(e===(n=o[r]).getAttribute("id"))return n}e.cssRules={},e.gradientDefs={},e.parseTransformAttribute=function(){var t=[1,0,0,1,0,0],i=e.reNum,n="(?:\\s+,?\\s*|,\\s*)",r="(?:"+("(?:(matrix)\\s*\\(\\s*("+i+")"+n+"("+i+")"+n+"("+i+")"+n+"("+i+")"+n+"("+i+")"+n+"("+i+")\\s*\\))")+"|"+("(?:(translate)\\s*\\(\\s*("+i+")(?:"+n+"("+i+"))?\\s*\\))")+"|"+("(?:(scale)\\s*\\(\\s*("+i+")(?:"+n+"("+i+"))?\\s*\\))")+"|"+("(?:(rotate)\\s*\\(\\s*("+i+")(?:"+n+"("+i+")"+n+"("+i+"))?\\s*\\))")+"|"+("(?:(skewX)\\s*\\(\\s*("+i+")\\s*\\))")+"|"+("(?:(skewY)\\s*\\(\\s*("+i+")\\s*\\))")+")",o=new RegExp("^\\s*(?:"+("(?:"+r+"(?:"+n+"*"+r+")*)")+"?)\\s*$"),s=new RegExp(r,"g");return function(i){var n=t.concat(),a=[];if(!i||i&&!o.test(i))return n;i.replace(s,function(i){var o=new RegExp(r).exec(i).filter(function(t){return!!t}),s=o[1],c=o.slice(2).map(parseFloat);switch(s){case"translate":!function(t,e){t[4]=e[0],2===e.length&&(t[5]=e[1])}(n,c);break;case"rotate":c[0]=e.util.degreesToRadians(c[0]),function(t,e){var i=e[0],n=3===e.length?e[1]:0,r=3===e.length?e[2]:0;t[0]=Math.cos(i),t[1]=Math.sin(i),t[2]=-Math.sin(i),t[3]=Math.cos(i),t[4]=n-(t[0]*n+t[2]*r),t[5]=r-(t[1]*n+t[3]*r)}(n,c);break;case"scale":!function(t,e){var i=e[0],n=2===e.length?e[1]:e[0];t[0]=i,t[3]=n}(n,c);break;case"skewX":!function(t,i){t[2]=Math.tan(e.util.degreesToRadians(i[0]))}(n,c);break;case"skewY":!function(t,i){t[1]=Math.tan(e.util.degreesToRadians(i[0]))}(n,c);break;case"matrix":n=c}a.push(n.concat()),n=t.concat()});for(var c=a[0];a.length>1;)a.shift(),c=e.util.multiplyTransformMatrices(c,a[0]);return c}}();var _=new RegExp("^\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*$");function x(t){var i,n,r,o,a,c,h=t.getAttribute("viewBox"),u=1,f=1,d=t.getAttribute("width"),p=t.getAttribute("height"),g=t.getAttribute("x")||0,v=t.getAttribute("y")||0,m=t.getAttribute("preserveAspectRatio")||"",b=!h||!l.test(t.nodeName)||!(h=h.match(_)),y=!d||!p||"100%"===d||"100%"===p,x=b&&y,w={},S="";if(w.width=0,w.height=0,w.toBeParsed=x,x)return w;if(b)return w.width=s(d),w.height=s(p),w;if(i=-parseFloat(h[1]),n=-parseFloat(h[2]),r=parseFloat(h[3]),o=parseFloat(h[4]),y?(w.width=r,w.height=o):(w.width=s(d),w.height=s(p),u=w.width/r,f=w.height/o),"none"!==(m=e.util.parsePreserveAspectRatioAttribute(m)).alignX&&(f=u=u>f?f:u),1===u&&1===f&&0===i&&0===n&&0===g&&0===v)return w;if((g||v)&&(S=" translate("+s(g)+" "+s(v)+") "),a=S+" matrix("+u+" 0 0 "+f+" "+i*u+" "+n*f+") ","svg"===t.nodeName){for(c=t.ownerDocument.createElement("g");t.firstChild;)c.appendChild(t.firstChild);t.appendChild(c)}else a=(c=t).getAttribute("transform")+a;return c.setAttribute("transform",a),w}e.parseSVGDocument=function(){return function(t,i,n){if(t){!function(t){for(var e=v(t,["use","svg:use"]),i=0;e.length&&i<e.length;){var n,r,o,s,a=e[i],c=a.getAttribute("xlink:href").substr(1),l=a.getAttribute("x")||0,h=a.getAttribute("y")||0,u=y(t,c).cloneNode(!0),f=(u.getAttribute("transform")||"")+" translate("+l+", "+h+")",d=e.length;if(x(u),/^svg$/i.test(u.nodeName)){var p=u.ownerDocument.createElement("g");for(r=0,s=(o=u.attributes).length;r<s;r++)n=o.item(r),p.setAttribute(n.nodeName,n.nodeValue);for(;u.firstChild;)p.appendChild(u.firstChild);u=p}for(r=0,s=(o=a.attributes).length;r<s;r++)"x"!==(n=o.item(r)).nodeName&&"y"!==n.nodeName&&"xlink:href"!==n.nodeName&&("transform"===n.nodeName?f=n.nodeValue+" "+f:u.setAttribute(n.nodeName,n.nodeValue));u.setAttribute("transform",f),u.setAttribute("instantiated_by_use","1"),u.removeAttribute("id"),a.parentNode.replaceChild(u,a),e.length===d&&i++}}(t);var o=new Date,s=e.Object.__uid++,a=x(t),l=e.util.toArray(t.getElementsByTagName("*"));if(a.svgUid=s,0===l.length&&e.isLikelyNode){for(var u=[],f=0,d=(l=t.selectNodes('//*[name(.)!="svg"]')).length;f<d;f++)u[f]=l[f];l=u}var p=l.filter(function(t){return x(t),c.test(t.nodeName.replace("svg:",""))&&!function(t,e){for(;t&&(t=t.parentNode);)if(t.nodeName&&e.test(t.nodeName.replace("svg:",""))&&!t.getAttribute("instantiated_by_use"))return!0;return!1}(t,h)});!p||p&&!p.length?i&&i([],{}):(e.gradientDefs[s]=e.getGradientDefs(t),e.cssRules[s]=e.getCSSRules(t),e.parseElements(p,function(t){e.documentParsingTime=new Date-o,i&&i(t,a)},r(a),n))}}}();var w={has:function(t,e){e(!1)},get:function(){},set:function(){}};function S(t,e,i){e[i]&&e[i].toSVG&&t.push('\t<pattern x="0" y="0" id="',i,'Pattern" ','width="',e[i].source.width,'" height="',e[i].source.height,'" patternUnits="userSpaceOnUse">\n','\t\t<image x="0" y="0" ','width="',e[i].source.width,'" height="',e[i].source.height,'" xlink:href="',e[i].source.src,'"></image>\n\t</pattern>\n')}var C=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+e.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+e.reNum+"))?\\s+(.*)");i(e,{parseFontDeclaration:function(t,e){var i=t.match(C);if(i){var n=i[1],r=i[3],o=i[4],a=i[5],c=i[6];n&&(e.fontStyle=n),r&&(e.fontWeight=isNaN(parseFloat(r))?r:parseFloat(r)),o&&(e.fontSize=s(o)),c&&(e.fontFamily=c),a&&(e.lineHeight="normal"===a?1:a)}},getGradientDefs:function(t){var e,i,n,r=v(t,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),o=0,s={},a={};for(o=r.length;o--;)n=(e=r[o]).getAttribute("xlink:href"),i=e.getAttribute("id"),n&&(a[i]=n.substr(1)),s[i]=e;for(i in a){var c=s[a[i]].cloneNode(!0);for(e=s[i];c.firstChild;)e.appendChild(c.firstChild)}return s},parseAttributes:function(t,n,r){if(t){var s,a,c={};void 0===r&&(r=t.getAttribute("svgUid")),t.parentNode&&u.test(t.parentNode.nodeName)&&(c=e.parseAttributes(t.parentNode,n,r)),a=c&&c.fontSize||t.getAttribute("font-size")||e.Text.DEFAULT_SVG_FONT_SIZE;var l=n.reduce(function(e,i){return(s=t.getAttribute(i))&&(i=p(i),s=g(i,s,c,a),e[i]=s),e},{});return(l=i(l,i(function(t,i){var n={};for(var r in e.cssRules[i])if(m(t,r.split(" ")))for(var o in e.cssRules[i][r])n[o]=e.cssRules[i][r][o];return n}(t,r),e.parseStyleAttribute(t)))).font&&e.parseFontDeclaration(l.font,l),function(t){for(var i in d)if(void 0!==t[d[i]]&&""!==t[i]){if(void 0===t[i]){if(!e.Object.prototype[i])continue;t[i]=e.Object.prototype[i]}if(0!==t[i].indexOf("url(")){var n=new e.Color(t[i]);t[i]=n.setAlpha(o(n.getAlpha()*t[d[i]],2)).toRgba()}}return t}(i(c,l))}},parseElements:function(t,i,n,r){new e.ElementsParser(t,i,n,r).parse()},parseStyleAttribute:function(t){var e={},i=t.getAttribute("style");return i?("string"==typeof i?function(t,e){var i,n;t.replace(/;\s*$/,"").split(";").forEach(function(t){var r=t.split(":");i=p(r[0].trim().toLowerCase()),n=g(i,r[1].trim()),e[i]=n})}(i,e):function(t,e){var i,n;for(var r in t)void 0!==t[r]&&(n=g(i=p(r.toLowerCase()),t[r]),e[i]=n)}(i,e),e):e},parsePointsAttribute:function(t){if(!t)return null;var e,i,n=[];for(e=0,i=(t=(t=t.replace(/,/g," ").trim()).split(/\s+/)).length;e<i;e+=2)n.push({x:parseFloat(t[e]),y:parseFloat(t[e+1])});return n},getCSSRules:function(t){for(var i=t.getElementsByTagName("style"),n={},r=0,o=i.length;r<o;r++){var s=i[r].textContent||i[r].text;""!==(s=s.replace(/\/\*[\s\S]*?\*\//g,"")).trim()&&s.match(/[^{]*\{[\s\S]*?\}/g).map(function(t){return t.trim()}).forEach(function(t){for(var i=t.match(/([\s\S]*?)\s*\{([^}]*)\}/),r={},o=i[2].trim().replace(/;$/,"").split(/\s*;\s*/),s=0,a=o.length;s<a;s++){var c=o[s].split(/\s*:\s*/),l=p(c[0]),h=g(l,c[1],c[0]);r[l]=h}(t=i[1]).split(",").forEach(function(t){""!==(t=t.replace(/^svg/i,"").trim())&&(n[t]?e.util.object.extend(n[t],r):n[t]=e.util.object.clone(r))})})}return n},loadSVGFromURL:function(t,i,r){function o(n){var o=n.responseXML;o&&!o.documentElement&&e.window.ActiveXObject&&n.responseText&&((o=new ActiveXObject("Microsoft.XMLDOM")).async="false",o.loadXML(n.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),o&&o.documentElement||i&&i(null),e.parseSVGDocument(o.documentElement,function(n,r){w.set(t,{objects:e.util.array.invoke(n,"toObject"),options:r}),i&&i(n,r)},r)}t=t.replace(/^\n\s*/,"").trim(),w.has(t,function(r){r?w.get(t,function(t){var r=function(t){var i=t.objects,r=t.options;return{objects:i=i.map(function(t){return e[n(t.type)].fromObject(t)}),options:r}}(t);i(r.objects,r.options)}):new e.util.request(t,{method:"get",onComplete:o})})},loadSVGFromString:function(t,i,n){var r;if(t=t.trim(),"undefined"!=typeof DOMParser){var o=new DOMParser;o&&o.parseFromString&&(r=o.parseFromString(t,"text/xml"))}else e.window.ActiveXObject&&((r=new ActiveXObject("Microsoft.XMLDOM")).async="false",r.loadXML(t.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));e.parseSVGDocument(r.documentElement,function(t,e){i(t,e)},n)},createSVGFontFacesMarkup:function(t){for(var i,n,r,o,s,a,c="",l={},h=e.fontPaths,u=0,f=t.length;u<f;u++)if(n=(i=t[u]).fontFamily,-1!==i.type.indexOf("text")&&!l[n]&&h[n]&&(l[n]=!0,i.styles))for(s in r=i.styles)for(a in o=r[s])!l[n=o[a].fontFamily]&&h[n]&&(l[n]=!0);for(var d in l)c+=["\t\t@font-face {\n","\t\t\tfont-family: '",d,"';\n","\t\t\tsrc: url('",h[d],"');\n","\t\t}\n"].join("");return c&&(c=['\t<style type="text/css">',"<![CDATA[\n",c,"]]>","</style>\n"].join("")),c},createSVGRefElementsMarkup:function(t){var e=[];return S(e,t,"backgroundColor"),S(e,t,"overlayColor"),e.join("")}})}(exports),fabric.ElementsParser=function(t,e,i,n){this.elements=t,this.callback=e,this.options=i,this.reviver=n,this.svgUid=i&&i.svgUid||0},fabric.ElementsParser.prototype.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},fabric.ElementsParser.prototype.createObjects=function(){for(var t=0,e=this.elements.length;t<e;t++)this.elements[t].setAttribute("svgUid",this.svgUid),function(t,e){setTimeout(function(){t.createObject(t.elements[e],e)},0)}(this,t)},fabric.ElementsParser.prototype.createObject=function(t,e){var i=fabric[fabric.util.string.capitalize(t.tagName.replace("svg:",""))];if(i&&i.fromElement)try{this._createObject(i,t,e)}catch(t){fabric.log(t)}else this.checkIfDone()},fabric.ElementsParser.prototype._createObject=function(t,e,i){if(t.async)t.fromElement(e,this.createCallback(i,e),this.options);else{var n=t.fromElement(e,this.options);this.resolveGradient(n,"fill"),this.resolveGradient(n,"stroke"),this.reviver&&this.reviver(e,n),this.instances[i]=n,this.checkIfDone()}},fabric.ElementsParser.prototype.createCallback=function(t,e){var i=this;return function(n){i.resolveGradient(n,"fill"),i.resolveGradient(n,"stroke"),i.reviver&&i.reviver(e,n),i.instances[t]=n,i.checkIfDone()}},fabric.ElementsParser.prototype.resolveGradient=function(t,e){var i=t.get(e);if(/^url\(/.test(i)){var n=i.slice(5,i.length-1);fabric.gradientDefs[this.svgUid][n]&&t.set(e,fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][n],t))}},fabric.ElementsParser.prototype.checkIfDone=function(){0==--this.numElements&&(this.instances=this.instances.filter(function(t){return null!=t}),this.callback(this.instances))},function(t){"use strict";var e=t.fabric||(t.fabric={});function i(t,e){this.x=t,this.y=e}e.Point?e.warn("fabric.Point is already defined"):(e.Point=i,i.prototype={type:"point",constructor:i,add:function(t){return new i(this.x+t.x,this.y+t.y)},addEquals:function(t){return this.x+=t.x,this.y+=t.y,this},scalarAdd:function(t){return new i(this.x+t,this.y+t)},scalarAddEquals:function(t){return this.x+=t,this.y+=t,this},subtract:function(t){return new i(this.x-t.x,this.y-t.y)},subtractEquals:function(t){return this.x-=t.x,this.y-=t.y,this},scalarSubtract:function(t){return new i(this.x-t,this.y-t)},scalarSubtractEquals:function(t){return this.x-=t,this.y-=t,this},multiply:function(t){return new i(this.x*t,this.y*t)},multiplyEquals:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return new i(this.x/t,this.y/t)},divideEquals:function(t){return this.x/=t,this.y/=t,this},eq:function(t){return this.x===t.x&&this.y===t.y},lt:function(t){return this.x<t.x&&this.y<t.y},lte:function(t){return this.x<=t.x&&this.y<=t.y},gt:function(t){return this.x>t.x&&this.y>t.y},gte:function(t){return this.x>=t.x&&this.y>=t.y},lerp:function(t,e){return void 0===e&&(e=.5),e=Math.max(Math.min(1,e),0),new i(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)},distanceFrom:function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},midPointFrom:function(t){return this.lerp(t)},min:function(t){return new i(Math.min(this.x,t.x),Math.min(this.y,t.y))},max:function(t){return new i(Math.max(this.x,t.x),Math.max(this.y,t.y))},toString:function(){return this.x+","+this.y},setXY:function(t,e){return this.x=t,this.y=e,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setFromPoint:function(t){return this.x=t.x,this.y=t.y,this},swap:function(t){var e=this.x,i=this.y;this.x=t.x,this.y=t.y,t.x=e,t.y=i},clone:function(){return new i(this.x,this.y)}})}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={});function i(t){this.status=t,this.points=[]}e.Intersection?e.warn("fabric.Intersection is already defined"):(e.Intersection=i,e.Intersection.prototype={constructor:i,appendPoint:function(t){return this.points.push(t),this},appendPoints:function(t){return this.points=this.points.concat(t),this}},e.Intersection.intersectLineLine=function(t,n,r,o){var s,a=(o.x-r.x)*(t.y-r.y)-(o.y-r.y)*(t.x-r.x),c=(n.x-t.x)*(t.y-r.y)-(n.y-t.y)*(t.x-r.x),l=(o.y-r.y)*(n.x-t.x)-(o.x-r.x)*(n.y-t.y);if(0!==l){var h=a/l,u=c/l;0<=h&&h<=1&&0<=u&&u<=1?(s=new i("Intersection")).appendPoint(new e.Point(t.x+h*(n.x-t.x),t.y+h*(n.y-t.y))):s=new i}else s=new i(0===a||0===c?"Coincident":"Parallel");return s},e.Intersection.intersectLinePolygon=function(t,e,n){for(var r,o,s,a=new i,c=n.length,l=0;l<c;l++)r=n[l],o=n[(l+1)%c],s=i.intersectLineLine(t,e,r,o),a.appendPoints(s.points);return a.points.length>0&&(a.status="Intersection"),a},e.Intersection.intersectPolygonPolygon=function(t,e){for(var n=new i,r=t.length,o=0;o<r;o++){var s=t[o],a=t[(o+1)%r],c=i.intersectLinePolygon(s,a,e);n.appendPoints(c.points)}return n.points.length>0&&(n.status="Intersection"),n},e.Intersection.intersectPolygonRectangle=function(t,n,r){var o=n.min(r),s=n.max(r),a=new e.Point(s.x,o.y),c=new e.Point(o.x,s.y),l=i.intersectLinePolygon(o,a,t),h=i.intersectLinePolygon(a,s,t),u=i.intersectLinePolygon(s,c,t),f=i.intersectLinePolygon(c,o,t),d=new i;return d.appendPoints(l.points),d.appendPoints(h.points),d.appendPoints(u.points),d.appendPoints(f.points),d.points.length>0&&(d.status="Intersection"),d})}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={});function i(t){t?this._tryParsingColor(t):this.setSource([0,0,0,1])}function n(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}e.Color?e.warn("fabric.Color is already defined."):(e.Color=i,e.Color.prototype={_tryParsingColor:function(t){var e;t in i.colorNameMap&&(t=i.colorNameMap[t]),"transparent"===t&&(e=[255,255,255,0]),e||(e=i.sourceFromHex(t)),e||(e=i.sourceFromRgb(t)),e||(e=i.sourceFromHsl(t)),e||(e=[0,0,0,1]),e&&this.setSource(e)},_rgbToHsl:function(t,i,n){t/=255,i/=255,n/=255;var r,o,s,a=e.util.array.max([t,i,n]),c=e.util.array.min([t,i,n]);if(s=(a+c)/2,a===c)r=o=0;else{var l=a-c;switch(o=s>.5?l/(2-a-c):l/(a+c),a){case t:r=(i-n)/l+(i<n?6:0);break;case i:r=(n-t)/l+2;break;case n:r=(t-i)/l+4}r/=6}return[Math.round(360*r),Math.round(100*o),Math.round(100*s)]},getSource:function(){return this._source},setSource:function(t){this._source=t},toRgb:function(){var t=this.getSource();return"rgb("+t[0]+","+t[1]+","+t[2]+")"},toRgba:function(){var t=this.getSource();return"rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")"},toHsl:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsl("+e[0]+","+e[1]+"%,"+e[2]+"%)"},toHsla:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsla("+e[0]+","+e[1]+"%,"+e[2]+"%,"+t[3]+")"},toHex:function(){var t,e,i,n=this.getSource();return t=1===(t=n[0].toString(16)).length?"0"+t:t,e=1===(e=n[1].toString(16)).length?"0"+e:e,i=1===(i=n[2].toString(16)).length?"0"+i:i,t.toUpperCase()+e.toUpperCase()+i.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(t){var e=this.getSource();return e[3]=t,this.setSource(e),this},toGrayscale:function(){var t=this.getSource(),e=parseInt((.3*t[0]+.59*t[1]+.11*t[2]).toFixed(0),10),i=t[3];return this.setSource([e,e,e,i]),this},toBlackWhite:function(t){var e=this.getSource(),i=(.3*e[0]+.59*e[1]+.11*e[2]).toFixed(0),n=e[3];return t=t||127,i=Number(i)<Number(t)?0:255,this.setSource([i,i,i,n]),this},overlayWith:function(t){t instanceof i||(t=new i(t));for(var e=[],n=this.getAlpha(),r=this.getSource(),o=t.getSource(),s=0;s<3;s++)e.push(Math.round(.5*r[s]+.5*o[s]));return e[3]=n,this.setSource(e),this}},e.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,e.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,e.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,e.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",grey:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},e.Color.fromRgb=function(t){return i.fromSource(i.sourceFromRgb(t))},e.Color.sourceFromRgb=function(t){var e=t.match(i.reRGBa);if(e){var n=parseInt(e[1],10)/(/%$/.test(e[1])?100:1)*(/%$/.test(e[1])?255:1),r=parseInt(e[2],10)/(/%$/.test(e[2])?100:1)*(/%$/.test(e[2])?255:1),o=parseInt(e[3],10)/(/%$/.test(e[3])?100:1)*(/%$/.test(e[3])?255:1);return[parseInt(n,10),parseInt(r,10),parseInt(o,10),e[4]?parseFloat(e[4]):1]}},e.Color.fromRgba=i.fromRgb,e.Color.fromHsl=function(t){return i.fromSource(i.sourceFromHsl(t))},e.Color.sourceFromHsl=function(t){var e=t.match(i.reHSLa);if(e){var r,o,s,a=(parseFloat(e[1])%360+360)%360/360,c=parseFloat(e[2])/(/%$/.test(e[2])?100:1),l=parseFloat(e[3])/(/%$/.test(e[3])?100:1);if(0===c)r=o=s=l;else{var h=l<=.5?l*(c+1):l+c-l*c,u=2*l-h;r=n(u,h,a+1/3),o=n(u,h,a),s=n(u,h,a-1/3)}return[Math.round(255*r),Math.round(255*o),Math.round(255*s),e[4]?parseFloat(e[4]):1]}},e.Color.fromHsla=i.fromHsl,e.Color.fromHex=function(t){return i.fromSource(i.sourceFromHex(t))},e.Color.sourceFromHex=function(t){if(t.match(i.reHex)){var e=t.slice(t.indexOf("#")+1),n=3===e.length||4===e.length,r=8===e.length||4===e.length,o=n?e.charAt(0)+e.charAt(0):e.substring(0,2),s=n?e.charAt(1)+e.charAt(1):e.substring(2,4),a=n?e.charAt(2)+e.charAt(2):e.substring(4,6),c=r?n?e.charAt(3)+e.charAt(3):e.substring(6,8):"FF";return[parseInt(o,16),parseInt(s,16),parseInt(a,16),parseFloat((parseInt(c,16)/255).toFixed(2))]}},e.Color.fromSource=function(t){var e=new i;return e.setSource(t),e})}(exports),function(){function t(t){var e,i,n,r=t.getAttribute("style"),o=t.getAttribute("offset")||0;if(o=(o=parseFloat(o)/(/%$/.test(o)?100:1))<0?0:o>1?1:o,r){var s=r.split(/\s*;\s*/);""===s[s.length-1]&&s.pop();for(var a=s.length;a--;){var c=s[a].split(/\s*:\s*/),l=c[0].trim(),h=c[1].trim();"stop-color"===l?e=h:"stop-opacity"===l&&(n=h)}}return e||(e=t.getAttribute("stop-color")||"rgb(0,0,0)"),n||(n=t.getAttribute("stop-opacity")),i=(e=new fabric.Color(e)).getAlpha(),n=isNaN(parseFloat(n))?1:parseFloat(n),n*=i,{offset:o,color:e.toRgb(),opacity:n}}function e(t,e,i){var n,r=0,o=1,s="";for(var a in e)"Infinity"===e[a]?e[a]=1:"-Infinity"===e[a]&&(e[a]=0),n=parseFloat(e[a],10),o="string"==typeof e[a]&&/^\d+%$/.test(e[a])?.01:1,"x1"===a||"x2"===a||"r2"===a?(o*="objectBoundingBox"===i?t.width:1,r="objectBoundingBox"===i&&t.left||0):"y1"!==a&&"y2"!==a||(o*="objectBoundingBox"===i?t.height:1,r="objectBoundingBox"===i&&t.top||0),e[a]=n*o+r;if("ellipse"===t.type&&null!==e.r2&&"objectBoundingBox"===i&&t.rx!==t.ry){var c=t.ry/t.rx;s=" scale(1, "+c+")",e.y1&&(e.y1/=c),e.y2&&(e.y2/=c)}return s}fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,initialize:function(t){t||(t={});var e={};this.id=fabric.Object.__uid++,this.type=t.type||"linear",e={x1:t.coords.x1||0,y1:t.coords.y1||0,x2:t.coords.x2||0,y2:t.coords.y2||0},"radial"===this.type&&(e.r1=t.coords.r1||0,e.r2=t.coords.r2||0),this.coords=e,this.colorStops=t.colorStops.slice(),t.gradientTransform&&(this.gradientTransform=t.gradientTransform),this.offsetX=t.offsetX||this.offsetX,this.offsetY=t.offsetY||this.offsetY},addColorStop:function(t){for(var e in t){var i=new fabric.Color(t[e]);this.colorStops.push({offset:e,color:i.toRgb(),opacity:i.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform}},toSVG:function(t){var e,i,n=fabric.util.object.clone(this.coords);if(this.colorStops.sort(function(t,e){return t.offset-e.offset}),!t.group||"path-group"!==t.group.type)for(var r in n)"x1"===r||"x2"===r||"r2"===r?n[r]+=this.offsetX-t.width/2:"y1"!==r&&"y2"!==r||(n[r]+=this.offsetY-t.height/2);i='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"',this.gradientTransform&&(i+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" '),"linear"===this.type?e=["<linearGradient ",i,' x1="',n.x1,'" y1="',n.y1,'" x2="',n.x2,'" y2="',n.y2,'">\n']:"radial"===this.type&&(e=["<radialGradient ",i,' cx="',n.x2,'" cy="',n.y2,'" r="',n.r2,'" fx="',n.x1,'" fy="',n.y1,'">\n']);for(var o=0;o<this.colorStops.length;o++)e.push("<stop ",'offset="',100*this.colorStops[o].offset+"%",'" style="stop-color:',this.colorStops[o].color,null!==this.colorStops[o].opacity?";stop-opacity: "+this.colorStops[o].opacity:";",'"/>\n');return e.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),e.join("")},toLive:function(t,e){var i,n,r=fabric.util.object.clone(this.coords);if(this.type){if(e.group&&"path-group"===e.group.type)for(n in r)"x1"===n||"x2"===n?r[n]+=-this.offsetX+e.width/2:"y1"!==n&&"y2"!==n||(r[n]+=-this.offsetY+e.height/2);"linear"===this.type?i=t.createLinearGradient(r.x1,r.y1,r.x2,r.y2):"radial"===this.type&&(i=t.createRadialGradient(r.x1,r.y1,r.r1,r.x2,r.y2,r.r2));for(var o=0,s=this.colorStops.length;o<s;o++){var a=this.colorStops[o].color,c=this.colorStops[o].opacity,l=this.colorStops[o].offset;void 0!==c&&(a=new fabric.Color(a).setAlpha(c).toRgba()),i.addColorStop(parseFloat(l),a)}return i}}}),fabric.util.object.extend(fabric.Gradient,{fromElement:function(i,n){var r,o,s,a=i.getElementsByTagName("stop"),c=i.getAttribute("gradientUnits")||"objectBoundingBox",l=i.getAttribute("gradientTransform"),h=[];"linear"===(r="linearGradient"===i.nodeName||"LINEARGRADIENT"===i.nodeName?"linear":"radial")?o=function(t){return{x1:t.getAttribute("x1")||0,y1:t.getAttribute("y1")||0,x2:t.getAttribute("x2")||"100%",y2:t.getAttribute("y2")||0}}(i):"radial"===r&&(o=function(t){return{x1:t.getAttribute("fx")||t.getAttribute("cx")||"50%",y1:t.getAttribute("fy")||t.getAttribute("cy")||"50%",r1:0,x2:t.getAttribute("cx")||"50%",y2:t.getAttribute("cy")||"50%",r2:t.getAttribute("r")||"50%"}}(i));for(var u=a.length;u--;)h.push(t(a[u]));s=e(n,o,c);var f=new fabric.Gradient({type:r,coords:o,colorStops:h,offsetX:-n.left,offsetY:-n.top});return(l||""!==s)&&(f.gradientTransform=fabric.parseTransformAttribute((l||"")+s)),f},forObject:function(t,i){return i||(i={}),e(t,i.coords,"userSpaceOnUse"),new fabric.Gradient(i)}})}(),fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(t){if(t||(t={}),this.id=fabric.Object.__uid++,t.source)if("string"==typeof t.source)if(void 0!==fabric.util.getFunctionBody(t.source))this.source=new Function(fabric.util.getFunctionBody(t.source));else{var e=this;this.source=fabric.util.createImage(),fabric.util.loadImage(t.source,function(t){e.source=t})}else this.source=t.source;t.repeat&&(this.repeat=t.repeat),t.offsetX&&(this.offsetX=t.offsetX),t.offsetY&&(this.offsetY=t.offsetY)},toObject:function(){var t;return"function"==typeof this.source?t=String(this.source):"string"==typeof this.source.src?t=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(t=this.source.toDataURL()),{source:t,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(t){var e="function"==typeof this.source?this.source():this.source,i=e.width/t.getWidth(),n=e.height/t.getHeight(),r=this.offsetX/t.getWidth(),o=this.offsetY/t.getHeight(),s="";return"repeat-x"!==this.repeat&&"no-repeat"!==this.repeat||(n=1),"repeat-y"!==this.repeat&&"no-repeat"!==this.repeat||(i=1),e.src?s=e.src:e.toDataURL&&(s=e.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+r+'" y="'+o+'" width="'+i+'" height="'+n+'">\n<image x="0" y="0" width="'+e.width+'" height="'+e.height+'" xlink:href="'+s+'"></image>\n</pattern>\n'},toLive:function(t){var e="function"==typeof this.source?this.source():this.source;if(!e)return"";if(void 0!==e.src){if(!e.complete)return"";if(0===e.naturalWidth||0===e.naturalHeight)return""}return t.createPattern(e,this.repeat)}}),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.toFixed;e.Shadow?e.warn("fabric.Shadow is already defined."):(e.Shadow=e.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(t){for(var i in"string"==typeof t&&(t=this._parseShadow(t)),t)this[i]=t[i];this.id=e.Object.__uid++},_parseShadow:function(t){var i=t.trim(),n=e.Shadow.reOffsetsAndBlur.exec(i)||[];return{color:(i.replace(e.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseInt(n[1],10)||0,offsetY:parseInt(n[2],10)||0,blur:parseInt(n[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(t){var n=40,r=40,o=e.Object.NUM_FRACTION_DIGITS,s=e.util.rotateVector({x:this.offsetX,y:this.offsetY},e.util.degreesToRadians(-t.angle));return t.width&&t.height&&(n=100*i((Math.abs(s.x)+this.blur)/t.width,o)+20,r=100*i((Math.abs(s.y)+this.blur)/t.height,o)+20),t.flipX&&(s.x*=-1),t.flipY&&(s.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+r+'%" height="'+(100+2*r)+'%" x="-'+n+'%" width="'+(100+2*n)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+i(this.blur?this.blur/2:0,o)+'"></feGaussianBlur>\n\t<feOffset dx="'+i(s.x,o)+'" dy="'+i(s.y,o)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+this.color+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke};var t={},i=e.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke"].forEach(function(e){this[e]!==i[e]&&(t[e]=this[e])},this),t}}),e.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/)}(exports),function(){"use strict";if(fabric.StaticCanvas)fabric.warn("fabric.StaticCanvas is already defined.");else{var t=fabric.util.object.extend,e=fabric.util.getElementOffset,i=fabric.util.removeFromArray,n=fabric.util.toFixed,r=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(t,e){e||(e={}),this._initStatic(t,e)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:[1,0,0,1,0,0],backgroundVpt:!0,overlayVpt:!0,onBeforeScaleRotate:function(){},enableRetinaScaling:!0,_initStatic:function(t,e){var i=fabric.StaticCanvas.prototype.renderAll.bind(this);this._objects=[],this._createLowerCanvas(t),this._initOptions(e),this._setImageSmoothing(),this.interactive||this._initRetinaScaling(),e.overlayImage&&this.setOverlayImage(e.overlayImage,i),e.backgroundImage&&this.setBackgroundImage(e.backgroundImage,i),e.backgroundColor&&this.setBackgroundColor(e.backgroundColor,i),e.overlayColor&&this.setOverlayColor(e.overlayColor,i),this.calcOffset()},_isRetinaScaling:function(){return 1!==fabric.devicePixelRatio&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?fabric.devicePixelRatio:1},_initRetinaScaling:function(){this._isRetinaScaling()&&(this.lowerCanvasEl.setAttribute("width",this.width*fabric.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio),this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio))},calcOffset:function(){return this._offset=e(this.lowerCanvasEl),this},setOverlayImage:function(t,e,i){return this.__setBgOverlayImage("overlayImage",t,e,i)},setBackgroundImage:function(t,e,i){return this.__setBgOverlayImage("backgroundImage",t,e,i)},setOverlayColor:function(t,e){return this.__setBgOverlayColor("overlayColor",t,e)},setBackgroundColor:function(t,e){return this.__setBgOverlayColor("backgroundColor",t,e)},_setImageSmoothing:function(){var t=this.getContext();t.imageSmoothingEnabled=t.imageSmoothingEnabled||t.webkitImageSmoothingEnabled||t.mozImageSmoothingEnabled||t.msImageSmoothingEnabled||t.oImageSmoothingEnabled,t.imageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(t,e,i,n){return"string"==typeof e?fabric.util.loadImage(e,function(e){e&&(this[t]=new fabric.Image(e,n)),i&&i(e)},this,n&&n.crossOrigin):(n&&e.setOptions(n),this[t]=e,i&&i(e)),this},__setBgOverlayColor:function(t,e,i){if(e&&e.source){var n=this;fabric.util.loadImage(e.source,function(r){n[t]=new fabric.Pattern({source:r,repeat:e.repeat,offsetX:e.offsetX,offsetY:e.offsetY}),i&&i()})}else this[t]=e,i&&i();return this},_createCanvasElement:function(t){var e=fabric.util.createCanvasElement(t);if(e.style||(e.style={}),!e)throw r;if(void 0===e.getContext)throw r;return e},_initOptions:function(t){for(var e in t)this[e]=t[e];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0,this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0,this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(t){this.lowerCanvasEl=fabric.util.getById(t)||this._createCanvasElement(t),fabric.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(t,e){return this.setDimensions({width:t},e)},setHeight:function(t,e){return this.setDimensions({height:t},e)},setDimensions:function(t,e){var i;for(var n in e=e||{},t)i=t[n],e.cssOnly||(this._setBackstoreDimension(n,t[n]),i+="px"),e.backstoreOnly||this._setCssDimension(n,i);return this._initRetinaScaling(),this._setImageSmoothing(),this.calcOffset(),e.cssOnly||this.renderAll(),this},_setBackstoreDimension:function(t,e){return this.lowerCanvasEl[t]=e,this.upperCanvasEl&&(this.upperCanvasEl[t]=e),this.cacheCanvasEl&&(this.cacheCanvasEl[t]=e),this[t]=e,this},_setCssDimension:function(t,e){return this.lowerCanvasEl.style[t]=e,this.upperCanvasEl&&(this.upperCanvasEl.style[t]=e),this.wrapperEl&&(this.wrapperEl.style[t]=e),this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(t){var e,i=this._activeGroup;this.viewportTransform=t;for(var n=0,r=this._objects.length;n<r;n++)(e=this._objects[n]).group||e.setCoords();return i&&i.setCoords(),this.renderAll(),this},zoomToPoint:function(t,e){var i=t,n=this.viewportTransform.slice(0);t=fabric.util.transformPoint(t,fabric.util.invertTransform(this.viewportTransform)),n[0]=e,n[3]=e;var r=fabric.util.transformPoint(t,n);return n[4]+=i.x-r.x,n[5]+=i.y-r.y,this.setViewportTransform(n)},setZoom:function(t){return this.zoomToPoint(new fabric.Point(0,0),t),this},absolutePan:function(t){var e=this.viewportTransform.slice(0);return e[4]=-t.x,e[5]=-t.y,this.setViewportTransform(e)},relativePan:function(t){return this.absolutePan(new fabric.Point(-t.x-this.viewportTransform[4],-t.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(t){this.stateful&&t.setupState(),t._set("canvas",this),t.setCoords(),this.fire("object:added",{target:t}),t.fire("added")},_onObjectRemoved:function(t){this.fire("object:removed",{target:t}),t.fire("removed"),delete t.canvas},clearContext:function(t){return t.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("selection:cleared",this._canvasITextSelectionClearedHanlder),this.off("object:selected",this._canvasITextSelectionClearedHanlder),this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderAll(),this},renderAll:function(){var t=this.contextContainer;return this.renderCanvas(t,this._objects),this},renderCanvas:function(t,e){this.clearContext(t),this.fire("before:render"),this.clipTo&&fabric.util.clipContext(this,t),this._renderBackground(t),t.save(),t.transform.apply(t,this.viewportTransform),this._renderObjects(t,e),t.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),this.clipTo&&t.restore(),this._renderOverlay(t),this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),this.fire("after:render")},_renderObjects:function(t,e){for(var i=0,n=e.length;i<n;++i)e[i]&&e[i].render(t)},_renderBackgroundOrOverlay:function(t,e){var i=this[e+"Color"];i&&(t.fillStyle=i.toLive?i.toLive(t):i,t.fillRect(i.offsetX||0,i.offsetY||0,this.width,this.height)),(i=this[e+"Image"])&&(this[e+"Vpt"]&&(t.save(),t.transform.apply(t,this.viewportTransform)),i.render(t),this[e+"Vpt"]&&t.restore())},_renderBackground:function(t){this._renderBackgroundOrOverlay(t,"background")},_renderOverlay:function(t){this._renderBackgroundOrOverlay(t,"overlay")},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(t){return this._centerObject(t,new fabric.Point(this.getCenter().left,t.getCenterPoint().y))},centerObjectV:function(t){return this._centerObject(t,new fabric.Point(t.getCenterPoint().x,this.getCenter().top))},centerObject:function(t){var e=this.getCenter();return this._centerObject(t,new fabric.Point(e.left,e.top))},viewportCenterObject:function(t){var e=this.getVpCenter();return this._centerObject(t,e)},viewportCenterObjectH:function(t){var e=this.getVpCenter();return this._centerObject(t,new fabric.Point(e.x,t.getCenterPoint().y)),this},viewportCenterObjectV:function(t){var e=this.getVpCenter();return this._centerObject(t,new fabric.Point(t.getCenterPoint().x,e.y))},getVpCenter:function(){var t=this.getCenter(),e=fabric.util.invertTransform(this.viewportTransform);return fabric.util.transformPoint({x:t.left,y:t.top},e)},_centerObject:function(t,e){return t.setPositionByOrigin(e,"center","center"),this.renderAll(),this},toDatalessJSON:function(t){return this.toDatalessObject(t)},toObject:function(t){return this._toObjectMethod("toObject",t)},toDatalessObject:function(t){return this._toObjectMethod("toDatalessObject",t)},_toObjectMethod:function(e,i){var n={objects:this._toObjects(e,i)};return t(n,this.__serializeBgOverlay(e,i)),fabric.util.populateWithProperties(this,n,i),n},_toObjects:function(t,e){return this.getObjects().filter(function(t){return!t.excludeFromExport}).map(function(i){return this._toObject(i,t,e)},this)},_toObject:function(t,e,i){var n;this.includeDefaultValues||(n=t.includeDefaultValues,t.includeDefaultValues=!1);var r=t[e](i);return this.includeDefaultValues||(t.includeDefaultValues=n),r},__serializeBgOverlay:function(t,e){var i={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject(e):this.backgroundColor};return this.overlayColor&&(i.overlay=this.overlayColor.toObject?this.overlayColor.toObject(e):this.overlayColor),this.backgroundImage&&(i.backgroundImage=this._toObject(this.backgroundImage,t,e)),this.overlayImage&&(i.overlayImage=this._toObject(this.overlayImage,t,e)),i},svgViewportTransformation:!0,toSVG:function(t,e){t||(t={});var i=[];return this._setSVGPreamble(i,t),this._setSVGHeader(i,t),this._setSVGBgOverlayColor(i,"backgroundColor"),this._setSVGBgOverlayImage(i,"backgroundImage",e),this._setSVGObjects(i,e),this._setSVGBgOverlayColor(i,"overlayColor"),this._setSVGBgOverlayImage(i,"overlayImage",e),i.push("</svg>"),i.join("")},_setSVGPreamble:function(t,e){e.suppressPreamble||t.push('<?xml version="1.0" encoding="',e.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(t,e){var i,r=e.width||this.width,o=e.height||this.height,s='viewBox="0 0 '+this.width+" "+this.height+'" ',a=fabric.Object.NUM_FRACTION_DIGITS;e.viewBox?s='viewBox="'+e.viewBox.x+" "+e.viewBox.y+" "+e.viewBox.width+" "+e.viewBox.height+'" ':this.svgViewportTransformation&&(i=this.viewportTransform,s='viewBox="'+n(-i[4]/i[0],a)+" "+n(-i[5]/i[3],a)+" "+n(this.width/i[0],a)+" "+n(this.height/i[3],a)+'" '),t.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',r,'" ','height="',o,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,s,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",fabric.version,"</desc>\n","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>\n")},_setSVGObjects:function(t,e){for(var i,n=0,r=this.getObjects(),o=r.length;n<o;n++)(i=r[n]).excludeFromExport||this._setSVGObject(t,i,e)},_setSVGObject:function(t,e,i){t.push(e.toSVG(i))},_setSVGBgOverlayImage:function(t,e,i){this[e]&&this[e].toSVG&&t.push(this[e].toSVG(i))},_setSVGBgOverlayColor:function(t,e){this[e]&&this[e].source?t.push('<rect x="',this[e].offsetX,'" y="',this[e].offsetY,'" ','width="',"repeat-y"===this[e].repeat||"no-repeat"===this[e].repeat?this[e].source.width:this.width,'" height="',"repeat-x"===this[e].repeat||"no-repeat"===this[e].repeat?this[e].source.height:this.height,'" fill="url(#'+e+'Pattern)"',"></rect>\n"):this[e]&&"overlayColor"===e&&t.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[e],'"',"></rect>\n")},sendToBack:function(t){if(!t)return this;var e,n,r,o=this._activeGroup;if(t===o)for(e=(r=o._objects).length;e--;)n=r[e],i(this._objects,n),this._objects.unshift(n);else i(this._objects,t),this._objects.unshift(t);return this.renderAll&&this.renderAll()},bringToFront:function(t){if(!t)return this;var e,n,r,o=this._activeGroup;if(t===o)for(r=o._objects,e=0;e<r.length;e++)n=r[e],i(this._objects,n),this._objects.push(n);else i(this._objects,t),this._objects.push(t);return this.renderAll&&this.renderAll()},sendBackwards:function(t,e){if(!t)return this;var n,r,o,s,a,c=this._activeGroup;if(t===c)for(a=c._objects,n=0;n<a.length;n++)r=a[n],0!==(o=this._objects.indexOf(r))&&(s=o-1,i(this._objects,r),this._objects.splice(s,0,r));else 0!==(o=this._objects.indexOf(t))&&(s=this._findNewLowerIndex(t,o,e),i(this._objects,t),this._objects.splice(s,0,t));return this.renderAll&&this.renderAll(),this},_findNewLowerIndex:function(t,e,i){var n;if(i){n=e;for(var r=e-1;r>=0;--r){if(t.intersectsWithObject(this._objects[r])||t.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(t)){n=r;break}}}else n=e-1;return n},bringForward:function(t,e){if(!t)return this;var n,r,o,s,a,c=this._activeGroup;if(t===c)for(n=(a=c._objects).length;n--;)r=a[n],(o=this._objects.indexOf(r))!==this._objects.length-1&&(s=o+1,i(this._objects,r),this._objects.splice(s,0,r));else(o=this._objects.indexOf(t))!==this._objects.length-1&&(s=this._findNewUpperIndex(t,o,e),i(this._objects,t),this._objects.splice(s,0,t));return this.renderAll&&this.renderAll(),this},_findNewUpperIndex:function(t,e,i){var n;if(i){n=e;for(var r=e+1;r<this._objects.length;++r){if(t.intersectsWithObject(this._objects[r])||t.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(t)){n=r;break}}}else n=e+1;return n},moveTo:function(t,e){return i(this._objects,t),this._objects.splice(e,0,t),this.renderAll&&this.renderAll()},dispose:function(){return this.clear(),this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}}),t(fabric.StaticCanvas.prototype,fabric.Observable),t(fabric.StaticCanvas.prototype,fabric.Collection),t(fabric.StaticCanvas.prototype,fabric.DataURLExporter),t(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(t){var e=fabric.util.createCanvasElement();if(!e||!e.getContext)return null;var i=e.getContext("2d");if(!i)return null;switch(t){case"getImageData":return void 0!==i.getImageData;case"setLineDash":return void 0!==i.setLineDash;case"toDataURL":return void 0!==e.toDataURL;case"toDataURLWithQuality":try{return e.toDataURL("image/jpeg",0),!0}catch(t){}return!1;default:return null}}}),fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}}(),fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeDashArray:null,setShadow:function(t){return this.shadow=new fabric.Shadow(t),this},_setBrushStyles:function(){var t=this.canvas.contextTop;t.strokeStyle=this.color,t.lineWidth=this.width,t.lineCap=this.strokeLineCap,t.lineJoin=this.strokeLineJoin,this.strokeDashArray&&fabric.StaticCanvas.supports("setLineDash")&&t.setLineDash(this.strokeDashArray)},_setShadow:function(){if(this.shadow){var t=this.canvas.contextTop;t.shadowColor=this.shadow.color,t.shadowBlur=this.shadow.blur,t.shadowOffsetX=this.shadow.offsetX,t.shadowOffsetY=this.shadow.offsetY}},_resetShadow:function(){var t=this.canvas.contextTop;t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0}}),fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(t){this.canvas=t,this._points=[]},onMouseDown:function(t){this._prepareForDrawing(t),this._captureDrawingPath(t),this._render()},onMouseMove:function(t){this._captureDrawingPath(t),this.canvas.clearContext(this.canvas.contextTop),this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(t){var e=new fabric.Point(t.x,t.y);this._reset(),this._addPoint(e),this.canvas.contextTop.moveTo(e.x,e.y)},_addPoint:function(t){this._points.push(t)},_reset:function(){this._points.length=0,this._setBrushStyles(),this._setShadow()},_captureDrawingPath:function(t){var e=new fabric.Point(t.x,t.y);this._addPoint(e)},_render:function(){var t=this.canvas.contextTop,e=this.canvas.viewportTransform,i=this._points[0],n=this._points[1];t.save(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5]),t.beginPath(),2===this._points.length&&i.x===n.x&&i.y===n.y&&(i.x-=.5,n.x+=.5),t.moveTo(i.x,i.y);for(var r=1,o=this._points.length;r<o;r++){var s=i.midPointFrom(n);t.quadraticCurveTo(i.x,i.y,s.x,s.y),i=this._points[r],n=this._points[r+1]}t.lineTo(i.x,i.y),t.stroke(),t.restore()},convertPointsToSVGPath:function(t){var e=[],i=new fabric.Point(t[0].x,t[0].y),n=new fabric.Point(t[1].x,t[1].y);e.push("M ",t[0].x," ",t[0].y," ");for(var r=1,o=t.length;r<o;r++){var s=i.midPointFrom(n);e.push("Q ",i.x," ",i.y," ",s.x," ",s.y," "),i=new fabric.Point(t[r].x,t[r].y),r+1<t.length&&(n=new fabric.Point(t[r+1].x,t[r+1].y))}return e.push("L ",i.x," ",i.y," "),e},createPath:function(t){var e=new fabric.Path(t,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,originX:"center",originY:"center"});return this.shadow&&(this.shadow.affectStroke=!0,e.setShadow(this.shadow)),e},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath();var t=this.convertPointsToSVGPath(this._points).join("");if("M 0 0 Q 0 0 0 0 L 0 0"!==t){var e=this.createPath(t);this.canvas.add(e),e.setCoords(),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderAll(),this.canvas.fire("path:created",{path:e})}else this.canvas.renderAll()}}),fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(t){this.canvas=t,this.points=[]},drawDot:function(t){var e=this.addPoint(t),i=this.canvas.contextTop,n=this.canvas.viewportTransform;i.save(),i.transform(n[0],n[1],n[2],n[3],n[4],n[5]),i.fillStyle=e.fill,i.beginPath(),i.arc(e.x,e.y,e.radius,0,2*Math.PI,!1),i.closePath(),i.fill(),i.restore()},onMouseDown:function(t){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(t)},onMouseMove:function(t){this.drawDot(t)},onMouseUp:function(){var t=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var e=[],i=0,n=this.points.length;i<n;i++){var r=this.points[i],o=new fabric.Circle({radius:r.radius,left:r.x,top:r.y,originX:"center",originY:"center",fill:r.fill});this.shadow&&o.setShadow(this.shadow),e.push(o)}var s=new fabric.Group(e,{originX:"center",originY:"center"});s.canvas=this.canvas,this.canvas.add(s),this.canvas.fire("path:created",{path:s}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=t,this.canvas.renderAll()},addPoint:function(t){var e=new fabric.Point(t.x,t.y),i=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,n=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return e.radius=i,e.fill=n,this.points.push(e),e}}),fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(t){this.canvas=t,this.sprayChunks=[]},onMouseDown:function(t){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(t),this.render()},onMouseMove:function(t){this.addSprayChunk(t),this.render()},onMouseUp:function(){var t=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var e=[],i=0,n=this.sprayChunks.length;i<n;i++)for(var r=this.sprayChunks[i],o=0,s=r.length;o<s;o++){var a=new fabric.Rect({width:r[o].width,height:r[o].width,left:r[o].x+1,top:r[o].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&a.setShadow(this.shadow),e.push(a)}this.optimizeOverlapping&&(e=this._getOptimizedRects(e));var c=new fabric.Group(e,{originX:"center",originY:"center"});c.canvas=this.canvas,this.canvas.add(c),this.canvas.fire("path:created",{path:c}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=t,this.canvas.renderAll()},_getOptimizedRects:function(t){for(var e,i={},n=0,r=t.length;n<r;n++)i[e=t[n].left+""+t[n].top]||(i[e]=t[n]);var o=[];for(e in i)o.push(i[e]);return o},render:function(){var t=this.canvas.contextTop;t.fillStyle=this.color;var e=this.canvas.viewportTransform;t.save(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5]);for(var i=0,n=this.sprayChunkPoints.length;i<n;i++){var r=this.sprayChunkPoints[i];void 0!==r.opacity&&(t.globalAlpha=r.opacity),t.fillRect(r.x,r.y,r.width,r.width)}t.restore()},addSprayChunk:function(t){this.sprayChunkPoints=[];for(var e,i,n,r=this.width/2,o=0;o<this.density;o++){e=fabric.util.getRandomInt(t.x-r,t.x+r),i=fabric.util.getRandomInt(t.y-r,t.y+r),n=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var s=new fabric.Point(e,i);s.width=n,this.randomOpacity&&(s.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(s)}this.sprayChunks.push(this.sprayChunkPoints)}}),fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var t=fabric.document.createElement("canvas"),e=t.getContext("2d");return t.width=t.height=25,e.fillStyle=this.color,e.beginPath(),e.arc(10,10,10,0,2*Math.PI,!1),e.closePath(),e.fill(),t},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(t){var e=this.callSuper("createPath",t),i=e._getLeftTopCoords().scalarAdd(e.strokeWidth/2);return e.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-i.x,offsetY:-i.y}),e}}),function(){var t=fabric.util.getPointer,e=fabric.util.degreesToRadians,i=fabric.util.radiansToDegrees,n=Math.atan2,r=Math.abs,o=fabric.StaticCanvas.supports("setLineDash");for(var s in fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(t,e){e||(e={}),this._initStatic(t,e),this._initInteractive(),this._createCacheCanvas()},uniScaleTransform:!1,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var t,e=this.getActiveGroup(),i=this.getActiveObject(),n=[],r=[];if(!e&&!i||this.preserveObjectStacking)n=this._objects;else{for(var o=0,s=this._objects.length;o<s;o++)t=this._objects[o],e&&e.contains(t)||t===i?r.push(t):n.push(t);e&&(e._set("_objects",r),n.push(e)),i&&n.push(i)}return n},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1);var t=this.contextContainer;return this.renderCanvas(t,this._chooseObjectsToRender()),this},renderTop:function(){var t=this.contextTop;return this.clearContext(t),this.selection&&this._groupSelector&&this._drawSelection(t),this.fire("after:render"),this.contextTopDirty=!0,this},_resetCurrentTransform:function(){var t=this._currentTransform;t.target.set({scaleX:t.original.scaleX,scaleY:t.original.scaleY,skewX:t.original.skewX,skewY:t.original.skewY,left:t.original.left,top:t.original.top}),this._shouldCenterTransform(t.target)?"rotate"===t.action?this._setOriginToCenter(t.target):("center"!==t.originX&&("right"===t.originX?t.mouseXSign=-1:t.mouseXSign=1),"center"!==t.originY&&("bottom"===t.originY?t.mouseYSign=-1:t.mouseYSign=1),t.originX="center",t.originY="center"):(t.originX=t.original.originX,t.originY=t.original.originY)},containsPoint:function(t,e,i){var n,r=i||this.getPointer(t,!0);return n=e.group&&e.group===this.getActiveGroup()?this._normalizePointer(e.group,r):{x:r.x,y:r.y},e.containsPoint(n)||e._findTargetCorner(r)},_normalizePointer:function(t,e){var i=t.calcTransformMatrix(),n=fabric.util.invertTransform(i),r=this.viewportTransform,o=this.restorePointerVpt(e),s=fabric.util.transformPoint(o,n);return fabric.util.transformPoint(s,r)},isTargetTransparent:function(t,e,i){var n=t.hasBorders,r=t.transparentCorners,o=this.contextCache,s=t.selectionBackgroundColor;t.hasBorders=t.transparentCorners=!1,t.selectionBackgroundColor="",o.save(),o.transform.apply(o,this.viewportTransform),t.render(o),o.restore(),t.active&&t._renderControls(o),t.hasBorders=n,t.transparentCorners=r,t.selectionBackgroundColor=s;var a=fabric.util.isTransparent(o,e,i,this.targetFindTolerance);return this.clearContext(o),a},_shouldClearSelection:function(t,e){var i=this.getActiveGroup(),n=this.getActiveObject();return!e||e&&i&&!i.contains(e)&&i!==e&&!t[this.selectionKey]||e&&!e.evented||e&&!e.selectable&&n&&n!==e},_shouldCenterTransform:function(t){if(t){var e,i=this._currentTransform;return"scale"===i.action||"scaleX"===i.action||"scaleY"===i.action?e=this.centeredScaling||t.centeredScaling:"rotate"===i.action&&(e=this.centeredRotation||t.centeredRotation),e?!i.altKey:i.altKey}},_getOriginFromCorner:function(t,e){var i={x:t.originX,y:t.originY};return"ml"===e||"tl"===e||"bl"===e?i.x="right":"mr"!==e&&"tr"!==e&&"br"!==e||(i.x="left"),"tl"===e||"mt"===e||"tr"===e?i.y="bottom":"bl"!==e&&"mb"!==e&&"br"!==e||(i.y="top"),i},_getActionFromCorner:function(t,e,i){if(!e)return"drag";switch(e){case"mtr":return"rotate";case"ml":case"mr":return i[this.altActionKey]?"skewY":"scaleX";case"mt":case"mb":return i[this.altActionKey]?"skewX":"scaleY";default:return"scale"}},_setupCurrentTransform:function(t,i){if(i){var n=this.getPointer(t),r=i._findTargetCorner(this.getPointer(t,!0)),o=this._getActionFromCorner(i,r,t),s=this._getOriginFromCorner(i,r);this._currentTransform={target:i,action:o,corner:r,scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY,offsetX:n.x-i.left,offsetY:n.y-i.top,originX:s.x,originY:s.y,ex:n.x,ey:n.y,lastX:n.x,lastY:n.y,left:i.left,top:i.top,theta:e(i.angle),width:i.width*i.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:t.shiftKey,altKey:t[this.centeredKey]},this._currentTransform.original={left:i.left,top:i.top,scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY,originX:s.x,originY:s.y},this._resetCurrentTransform()}},_translateObject:function(t,e){var i=this._currentTransform,n=i.target,r=t-i.offsetX,o=e-i.offsetY,s=!n.get("lockMovementX")&&n.left!==r,a=!n.get("lockMovementY")&&n.top!==o;return s&&n.set("left",r),a&&n.set("top",o),s||a},_changeSkewTransformOrigin:function(t,e,i){var n="originX",r={0:"center"},o=e.target.skewX,s="left",a="right",c="mt"===e.corner||"ml"===e.corner?1:-1,l=1;t=t>0?1:-1,"y"===i&&(o=e.target.skewY,s="top",a="bottom",n="originY"),r[-1]=s,r[1]=a,e.target.flipX&&(l*=-1),e.target.flipY&&(l*=-1),0===o?(e.skewSign=-c*t*l,e[n]=r[-t]):(o=o>0?1:-1,e.skewSign=o,e[n]=r[o*c*l])},_skewObject:function(t,e,i){var n,r=this._currentTransform,o=r.target,s=o.get("lockSkewingX"),a=o.get("lockSkewingY");if(s&&"x"===i||a&&"y"===i)return!1;var c,l,h=o.getCenterPoint(),u=o.toLocalPoint(new fabric.Point(t,e),"center","center")[i],f=o.toLocalPoint(new fabric.Point(r.lastX,r.lastY),"center","center")[i],d=o._getTransformedDimensions();return this._changeSkewTransformOrigin(u-f,r,i),c=o.toLocalPoint(new fabric.Point(t,e),r.originX,r.originY)[i],l=o.translateToOriginPoint(h,r.originX,r.originY),n=this._setObjectSkew(c,r,i,d),r.lastX=t,r.lastY=e,o.setPositionByOrigin(l,r.originX,r.originY),n},_setObjectSkew:function(t,e,i,n){var r,o,s,a,c,l,h,u,f,d,p=e.target,g=e.skewSign;return"x"===i?(c="y",l="Y",h="X",f=0,d=p.skewY):(c="x",l="X",h="Y",f=p.skewX,d=0),a=p._getTransformedDimensions(f,d),(u=2*Math.abs(t)-a[i])<=2?r=0:(r=g*Math.atan(u/p["scale"+h]/(a[c]/p["scale"+l])),r=fabric.util.radiansToDegrees(r)),o=p["skew"+h]!==r,p.set("skew"+h,r),0!==p["skew"+l]&&(s=p._getTransformedDimensions(),r=n[c]/s[c]*p["scale"+l],p.set("scale"+l,r)),o},_scaleObject:function(t,e,i){var n=this._currentTransform,r=n.target,o=r.get("lockScalingX"),s=r.get("lockScalingY"),a=r.get("lockScalingFlip");if(o&&s)return!1;var c,l=r.translateToOriginPoint(r.getCenterPoint(),n.originX,n.originY),h=r.toLocalPoint(new fabric.Point(t,e),n.originX,n.originY),u=r._getTransformedDimensions();return this._setLocalMouse(h,n),c=this._setObjectScale(h,n,o,s,i,a,u),r.setPositionByOrigin(l,n.originX,n.originY),c},_setObjectScale:function(t,e,i,n,r,o,s){var a,c,l,h,u=e.target,f=!1,d=!1,p=!1;return l=t.x*u.scaleX/s.x,h=t.y*u.scaleY/s.y,a=u.scaleX!==l,c=u.scaleY!==h,o&&l<=0&&l<u.scaleX&&(f=!0),o&&h<=0&&h<u.scaleY&&(d=!0),"equally"!==r||i||n?r?"x"!==r||u.get("lockUniScaling")?"y"!==r||u.get("lockUniScaling")||d||n||u.set("scaleY",h)&&(p=p||c):f||i||u.set("scaleX",l)&&(p=p||a):(f||i||u.set("scaleX",l)&&(p=p||a),d||n||u.set("scaleY",h)&&(p=p||c)):f||d||(p=this._scaleObjectEqually(t,u,e,s)),e.newScaleX=l,e.newScaleY=h,f||d||this._flipObject(e,r),p},_scaleObjectEqually:function(t,e,i,n){var r,o=t.y+t.x,s=n.y*i.original.scaleY/e.scaleY+n.x*i.original.scaleX/e.scaleX;return i.newScaleX=i.original.scaleX*o/s,i.newScaleY=i.original.scaleY*o/s,r=i.newScaleX!==e.scaleX||i.newScaleY!==e.scaleY,e.set("scaleX",i.newScaleX),e.set("scaleY",i.newScaleY),r},_flipObject:function(t,e){t.newScaleX<0&&"y"!==e&&("left"===t.originX?t.originX="right":"right"===t.originX&&(t.originX="left")),t.newScaleY<0&&"x"!==e&&("top"===t.originY?t.originY="bottom":"bottom"===t.originY&&(t.originY="top"))},_setLocalMouse:function(t,e){var i=e.target;"right"===e.originX?t.x*=-1:"center"===e.originX&&(t.x*=2*e.mouseXSign,t.x<0&&(e.mouseXSign=-e.mouseXSign)),"bottom"===e.originY?t.y*=-1:"center"===e.originY&&(t.y*=2*e.mouseYSign,t.y<0&&(e.mouseYSign=-e.mouseYSign)),r(t.x)>i.padding?t.x<0?t.x+=i.padding:t.x-=i.padding:t.x=0,r(t.y)>i.padding?t.y<0?t.y+=i.padding:t.y-=i.padding:t.y=0},_rotateObject:function(t,e){var r=this._currentTransform;if(r.target.get("lockRotation"))return!1;var o=n(r.ey-r.top,r.ex-r.left),s=n(e-r.top,t-r.left),a=i(s-o+r.theta),c=!0;if(a<0&&(a=360+a),a%=360,r.target.snapAngle>0){var l=r.target.snapAngle,h=r.target.snapThreshold||l,u=Math.ceil(a/l)*l,f=Math.floor(a/l)*l;Math.abs(a-f)<h?a=f:Math.abs(a-u)<h&&(a=u),r.target.angle===a&&(c=!1)}return r.target.angle=a,c},setCursor:function(t){this.upperCanvasEl.style.cursor=t},_resetObjectTransform:function(t){t.scaleX=1,t.scaleY=1,t.skewX=0,t.skewY=0,t.setAngle(0)},_drawSelection:function(t){var e=this._groupSelector,i=e.left,n=e.top,s=r(i),a=r(n);if(this.selectionColor&&(t.fillStyle=this.selectionColor,t.fillRect(e.ex-(i>0?0:-i),e.ey-(n>0?0:-n),s,a)),this.selectionLineWidth&&this.selectionBorderColor)if(t.lineWidth=this.selectionLineWidth,t.strokeStyle=this.selectionBorderColor,this.selectionDashArray.length>1&&!o){var c=e.ex+.5-(i>0?0:s),l=e.ey+.5-(n>0?0:a);t.beginPath(),fabric.util.drawDashedLine(t,c,l,c+s,l,this.selectionDashArray),fabric.util.drawDashedLine(t,c,l+a-1,c+s,l+a-1,this.selectionDashArray),fabric.util.drawDashedLine(t,c,l,c,l+a,this.selectionDashArray),fabric.util.drawDashedLine(t,c+s-1,l,c+s-1,l+a,this.selectionDashArray),t.closePath(),t.stroke()}else fabric.Object.prototype._setLineDash.call(this,t,this.selectionDashArray),t.strokeRect(e.ex+.5-(i>0?0:s),e.ey+.5-(n>0?0:a),s,a)},findTarget:function(t,e){if(!this.skipTargetFind){var i,n=this.getPointer(t,!0),r=this.getActiveGroup(),o=this.getActiveObject();if(r&&!e&&this._checkTarget(n,r))return this._fireOverOutEvents(r,t),r;if(o&&o._findTargetCorner(n))return this._fireOverOutEvents(o,t),o;if(o&&this._checkTarget(n,o)){if(!this.preserveObjectStacking)return this._fireOverOutEvents(o,t),o;i=o}this.targets=[];var s=this._searchPossibleTargets(this._objects,n);return t[this.altSelectionKey]&&s&&i&&s!==i&&(s=i),this._fireOverOutEvents(s,t),s}},_fireOverOutEvents:function(t,e){t?this._hoveredTarget!==t&&(this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget,e:e}),this._hoveredTarget.fire("mouseout")),this.fire("mouse:over",{target:t,e:e}),t.fire("mouseover"),this._hoveredTarget=t):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget,e:e}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},_checkTarget:function(t,e){if(e&&e.visible&&e.evented&&this.containsPoint(null,e,t)){if(!this.perPixelTargetFind&&!e.perPixelTargetFind||e.isEditing)return!0;if(!this.isTargetTransparent(e,t.x,t.y))return!0}},_searchPossibleTargets:function(t,e){for(var i,n,r,o=t.length;o--;)if(this._checkTarget(e,t[o])){"group"===(i=t[o]).type&&i.subTargetCheck&&(n=this._normalizePointer(i,e),(r=this._searchPossibleTargets(i._objects,n))&&this.targets.push(r));break}return i},restorePointerVpt:function(t){return fabric.util.transformPoint(t,fabric.util.invertTransform(this.viewportTransform))},getPointer:function(e,i,n){n||(n=this.upperCanvasEl);var r,o=t(e),s=n.getBoundingClientRect(),a=s.width||0,c=s.height||0;return a&&c||("top"in s&&"bottom"in s&&(c=Math.abs(s.top-s.bottom)),"right"in s&&"left"in s&&(a=Math.abs(s.right-s.left))),this.calcOffset(),o.x=o.x-this._offset.left,o.y=o.y-this._offset.top,i||(o=this.restorePointerVpt(o)),r=0===a||0===c?{width:1,height:1}:{width:n.width/a,height:n.height/c},{x:o.x*r.width,y:o.y*r.height}},_createUpperCanvas:function(){var t=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement(),fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+t),this.wrapperEl.appendChild(this.upperCanvasEl),this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl),this._applyCanvasStyle(this.upperCanvasEl),this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"}),fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(t){var e=this.getWidth()||t.width,i=this.getHeight()||t.height;fabric.util.setStyle(t,{position:"absolute",width:e+"px",height:i+"px",left:0,top:0}),t.width=e,t.height=i,fabric.util.makeElementUnselectable(t)},_copyCanvasStyle:function(t,e){e.style.cssText=t.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(t){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=t,t.set("active",!0)},setActiveObject:function(t,e){return this._setActiveObject(t),this.renderAll(),this.fire("object:selected",{target:t,e:e}),t.fire("selected",{e:e}),this},getActiveObject:function(){return this._activeObject},_onObjectRemoved:function(t){this.getActiveObject()===t&&(this.fire("before:selection:cleared",{target:t}),this._discardActiveObject(),this.fire("selection:cleared",{target:t}),t.fire("deselected")),this.callSuper("_onObjectRemoved",t)},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=null},discardActiveObject:function(t){var e=this._activeObject;return this.fire("before:selection:cleared",{target:e,e:t}),this._discardActiveObject(),this.fire("selection:cleared",{e:t}),e&&e.fire("deselected",{e:t}),this},_setActiveGroup:function(t){this._activeGroup=t,t&&t.set("active",!0)},setActiveGroup:function(t,e){return this._setActiveGroup(t),t&&(this.fire("object:selected",{target:t,e:e}),t.fire("selected",{e:e})),this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var t=this.getActiveGroup();t&&t.destroy(),this.setActiveGroup(null)},discardActiveGroup:function(t){var e=this.getActiveGroup();return this.fire("before:selection:cleared",{e:t,target:e}),this._discardActiveGroup(),this.fire("selection:cleared",{e:t}),this},deactivateAll:function(){for(var t=this.getObjects(),e=0,i=t.length;e<i;e++)t[e].set("active",!1);return this._discardActiveGroup(),this._discardActiveObject(),this},deactivateAllWithDispatch:function(t){var e=this.getActiveGroup(),i=this.getActiveObject();return(i||e)&&this.fire("before:selection:cleared",{target:i||e,e:t}),this.deactivateAll(),(i||e)&&(this.fire("selection:cleared",{e:t,target:i}),i&&i.fire("deselected")),this},dispose:function(){this.callSuper("dispose");var t=this.wrapperEl;return this.removeListeners(),t.removeChild(this.upperCanvasEl),t.removeChild(this.lowerCanvasEl),delete this.upperCanvasEl,t.parentNode&&t.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,this},clear:function(){return this.discardActiveGroup(),this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(t){var e=this.getActiveGroup();e?e._renderControls(t):this._drawObjectsControls(t)},_drawObjectsControls:function(t){for(var e=0,i=this._objects.length;e<i;++e)this._objects[e]&&this._objects[e].active&&this._objects[e]._renderControls(t)},_toObject:function(t,e,i){var n=this._realizeGroupTransformOnObject(t),r=this.callSuper("_toObject",t,e,i);return this._unwindGroupTransformOnObject(t,n),r},_realizeGroupTransformOnObject:function(t){if(t.group&&t.group===this.getActiveGroup()){var e={};return["angle","flipX","flipY","height","left","scaleX","scaleY","top","width"].forEach(function(i){e[i]=t[i]}),this.getActiveGroup().realizeTransform(t),e}return null},_unwindGroupTransformOnObject:function(t,e){e&&t.set(e)},_setSVGObject:function(t,e,i){var n;n=this._realizeGroupTransformOnObject(e),this.callSuper("_setSVGObject",t,e,i),this._unwindGroupTransformOnObject(e,n)}}),fabric.StaticCanvas)"prototype"!==s&&(fabric.Canvas[s]=fabric.StaticCanvas[s]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){}),fabric.Element=fabric.Canvas}(),function(){var t={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},e=fabric.util.addListener,i=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this._bindEvents(),e(fabric.window,"resize",this._onResize),e(this.upperCanvasEl,"mousedown",this._onMouseDown),e(this.upperCanvasEl,"mousemove",this._onMouseMove),e(this.upperCanvasEl,"mouseout",this._onMouseOut),e(this.upperCanvasEl,"mouseenter",this._onMouseEnter),e(this.upperCanvasEl,"wheel",this._onMouseWheel),e(this.upperCanvasEl,"contextmenu",this._onContextMenu),e(this.upperCanvasEl,"touchstart",this._onMouseDown),e(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof eventjs&&"add"in eventjs&&(eventjs.add(this.upperCanvasEl,"gesture",this._onGesture),eventjs.add(this.upperCanvasEl,"drag",this._onDrag),eventjs.add(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.add(this.upperCanvasEl,"shake",this._onShake),eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this)},removeListeners:function(){i(fabric.window,"resize",this._onResize),i(this.upperCanvasEl,"mousedown",this._onMouseDown),i(this.upperCanvasEl,"mousemove",this._onMouseMove),i(this.upperCanvasEl,"mouseout",this._onMouseOut),i(this.upperCanvasEl,"mouseenter",this._onMouseEnter),i(this.upperCanvasEl,"wheel",this._onMouseWheel),i(this.upperCanvasEl,"contextmenu",this._onContextMenu),i(this.upperCanvasEl,"touchstart",this._onMouseDown),i(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof eventjs&&"remove"in eventjs&&(eventjs.remove(this.upperCanvasEl,"gesture",this._onGesture),eventjs.remove(this.upperCanvasEl,"drag",this._onDrag),eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.remove(this.upperCanvasEl,"shake",this._onShake),eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(t,e){this.__onTransformGesture&&this.__onTransformGesture(t,e)},_onDrag:function(t,e){this.__onDrag&&this.__onDrag(t,e)},_onMouseWheel:function(t){this.__onMouseWheel(t)},_onMouseOut:function(t){var e=this._hoveredTarget;this.fire("mouse:out",{target:e,e:t}),this._hoveredTarget=null,e&&e.fire("mouseout",{e:t})},_onMouseEnter:function(t){this.findTarget(t)||(this.fire("mouse:over",{target:null,e:t}),this._hoveredTarget=null)},_onOrientationChange:function(t,e){this.__onOrientationChange&&this.__onOrientationChange(t,e)},_onShake:function(t,e){this.__onShake&&this.__onShake(t,e)},_onLongPress:function(t,e){this.__onLongPress&&this.__onLongPress(t,e)},_onContextMenu:function(t){return this.stopContextMenu&&(t.stopPropagation(),t.preventDefault()),!1},_onMouseDown:function(t){this.__onMouseDown(t),e(fabric.document,"touchend",this._onMouseUp),e(fabric.document,"touchmove",this._onMouseMove),i(this.upperCanvasEl,"mousemove",this._onMouseMove),i(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchstart"===t.type?i(this.upperCanvasEl,"mousedown",this._onMouseDown):(e(fabric.document,"mouseup",this._onMouseUp),e(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(t){if(this.__onMouseUp(t),i(fabric.document,"mouseup",this._onMouseUp),i(fabric.document,"touchend",this._onMouseUp),i(fabric.document,"mousemove",this._onMouseMove),i(fabric.document,"touchmove",this._onMouseMove),e(this.upperCanvasEl,"mousemove",this._onMouseMove),e(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchend"===t.type){var n=this;setTimeout(function(){e(n.upperCanvasEl,"mousedown",n._onMouseDown)},400)}},_onMouseMove:function(t){!this.allowTouchScrolling&&t.preventDefault&&t.preventDefault(),this.__onMouseMove(t)},_onResize:function(){this.calcOffset()},_shouldRender:function(t,e){var i=this.getActiveGroup()||this.getActiveObject();return!!(t&&(t.isMoving||t!==i)||!t&&i||!t&&!i&&!this._groupSelector||e&&this._previousPointer&&this.selection&&(e.x!==this._previousPointer.x||e.y!==this._previousPointer.y))},__onMouseUp:function(t){var e,i=!0,n=this._currentTransform,r=this._groupSelector,o=!r||0===r.left&&0===r.top;if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(t);else{n&&(this._finalizeCurrentTransform(),i=!n.actionPerformed),e=i?this.findTarget(t,!0):n.target;var s=this._shouldRender(e,this.getPointer(t));e||!o?this._maybeGroupObjects(t):(this._groupSelector=null,this._currentTransform=null),e&&(e.isMoving=!1),this._handleCursorAndEvent(t,e,"up"),e&&(e.__corner=0),s&&this.renderAll()}},_handleCursorAndEvent:function(t,e,i){this._setCursorFromEvent(t,e),this._handleEvent(t,i,e||null)},_handleEvent:function(t,e,i){var n=void 0===typeof i?this.findTarget(t):i,r=this.targets||[],o={e:t,target:n,subTargets:r};this.fire("mouse:"+e,o),n&&n.fire("mouse"+e,o);for(var s=0;s<r.length;s++)r[s].fire("mouse"+e,o)},_finalizeCurrentTransform:function(){var t=this._currentTransform,e=t.target;e._scaling&&(e._scaling=!1),e.setCoords(),this._restoreOriginXY(e),(t.actionPerformed||this.stateful&&e.hasStateChanged())&&(this.fire("object:modified",{target:e}),e.fire("modified"))},_restoreOriginXY:function(t){if(this._previousOriginX&&this._previousOriginY){var e=t.translateToOriginPoint(t.getCenterPoint(),this._previousOriginX,this._previousOriginY);t.originX=this._previousOriginX,t.originY=this._previousOriginY,t.left=e.x,t.top=e.y,this._previousOriginX=null,this._previousOriginY=null}},_onMouseDownInDrawingMode:function(t){this._isCurrentlyDrawing=!0,this.discardActiveObject(t).renderAll(),this.clipTo&&fabric.util.clipContext(this,this.contextTop);var e=this.getPointer(t);this.freeDrawingBrush.onMouseDown(e),this._handleEvent(t,"down")},_onMouseMoveInDrawingMode:function(t){if(this._isCurrentlyDrawing){var e=this.getPointer(t);this.freeDrawingBrush.onMouseMove(e)}this.setCursor(this.freeDrawingCursor),this._handleEvent(t,"move")},_onMouseUpInDrawingMode:function(t){this._isCurrentlyDrawing=!1,this.clipTo&&this.contextTop.restore(),this.freeDrawingBrush.onMouseUp(),this._handleEvent(t,"up")},__onMouseDown:function(t){var e=this.findTarget(t),i=this.getPointer(t,!0);if("which"in t?3===t.which:2===t.button)this.fireRightClick&&this._handleEvent(t,"down",e||null);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(t);else if(!this._currentTransform){this._previousPointer=i;var n=this._shouldRender(e,i),r=this._shouldGroup(t,e);this._shouldClearSelection(t,e)?this._clearSelection(t,e,i):r&&(this._handleGrouping(t,e),e=this.getActiveGroup()),e&&(!e.selectable||!e.__corner&&r||(this._beforeTransform(t,e),this._setupCurrentTransform(t,e)),e!==this.getActiveGroup()&&e!==this.getActiveObject()&&(this.deactivateAll(),e.selectable&&this.setActiveObject(e,t))),this._handleEvent(t,"down",e||null),n&&this.renderAll()}},_beforeTransform:function(t,e){this.stateful&&e.saveState(),e._findTargetCorner(this.getPointer(t))&&this.onBeforeScaleRotate(e)},_clearSelection:function(t,e,i){this.deactivateAllWithDispatch(t),e&&e.selectable?this.setActiveObject(e,t):this.selection&&(this._groupSelector={ex:i.x,ey:i.y,top:0,left:0})},_setOriginToCenter:function(t){this._previousOriginX=this._currentTransform.target.originX,this._previousOriginY=this._currentTransform.target.originY;var e=t.getCenterPoint();t.originX="center",t.originY="center",t.left=e.x,t.top=e.y,this._currentTransform.left=t.left,this._currentTransform.top=t.top},_setCenterToOrigin:function(t){var e=t.translateToOriginPoint(t.getCenterPoint(),this._previousOriginX,this._previousOriginY);t.originX=this._previousOriginX,t.originY=this._previousOriginY,t.left=e.x,t.top=e.y,this._previousOriginX=null,this._previousOriginY=null},__onMouseMove:function(t){var e,i;if(this.isDrawingMode)this._onMouseMoveInDrawingMode(t);else if(!(void 0!==t.touches&&t.touches.length>1)){var n=this._groupSelector;n?(i=this.getPointer(t,!0),n.left=i.x-n.ex,n.top=i.y-n.ey,this.renderTop()):this._currentTransform?this._transformObject(t):(e=this.findTarget(t),this._setCursorFromEvent(t,e)),this._handleEvent(t,"move",e||null)}},__onMouseWheel:function(t){this.fire("mouse:wheel",{e:t})},_transformObject:function(t){var e=this.getPointer(t),i=this._currentTransform;i.reset=!1,i.target.isMoving=!0,this._beforeScaleTransform(t,i),this._performTransformAction(t,i,e),i.actionPerformed&&this.renderAll()},_performTransformAction:function(t,e,i){var n=i.x,r=i.y,o=e.target,s=e.action,a=!1;"rotate"===s?(a=this._rotateObject(n,r))&&this._fire("rotating",o,t):"scale"===s?(a=this._onScale(t,e,n,r))&&this._fire("scaling",o,t):"scaleX"===s?(a=this._scaleObject(n,r,"x"))&&this._fire("scaling",o,t):"scaleY"===s?(a=this._scaleObject(n,r,"y"))&&this._fire("scaling",o,t):"skewX"===s?(a=this._skewObject(n,r,"x"))&&this._fire("skewing",o,t):"skewY"===s?(a=this._skewObject(n,r,"y"))&&this._fire("skewing",o,t):(a=this._translateObject(n,r))&&(this._fire("moving",o,t),this.setCursor(o.moveCursor||this.moveCursor)),e.actionPerformed=a},_fire:function(t,e,i){this.fire("object:"+t,{target:e,e:i}),e.fire(t,{e:i})},_beforeScaleTransform:function(t,e){if("scale"===e.action||"scaleX"===e.action||"scaleY"===e.action){var i=this._shouldCenterTransform(e.target);(i&&("center"!==e.originX||"center"!==e.originY)||!i&&"center"===e.originX&&"center"===e.originY)&&(this._resetCurrentTransform(),e.reset=!0)}},_onScale:function(t,e,i,n){return!t[this.uniScaleKey]&&!this.uniScaleTransform||e.target.get("lockUniScaling")?(e.reset||"scale"!==e.currentAction||this._resetCurrentTransform(),e.currentAction="scaleEqually",this._scaleObject(i,n,"equally")):(e.currentAction="scale",this._scaleObject(i,n))},_setCursorFromEvent:function(t,e){if(!e)return this.setCursor(this.defaultCursor),!1;var i=e.hoverCursor||this.hoverCursor;if(e.selectable){var n=this.getActiveGroup(),r=e._findTargetCorner&&(!n||!n.contains(e))&&e._findTargetCorner(this.getPointer(t,!0));r?this._setCornerCursor(r,e,t):this.setCursor(i)}else this.setCursor(i);return!0},_setCornerCursor:function(e,i,n){if(e in t)this.setCursor(this._getRotatedCornerCursor(e,i,n));else{if("mtr"!==e||!i.hasRotatingPoint)return this.setCursor(this.defaultCursor),!1;this.setCursor(this.rotationCursor)}},_getRotatedCornerCursor:function(e,i,n){var r=Math.round(i.getAngle()%360/45);return r<0&&(r+=8),r+=t[e],n[this.altActionKey]&&t[e]%2==0&&(r+=2),r%=8,this.cursorMap[r]}})}(),function(){var t=Math.min,e=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(t,e){var i=this.getActiveObject();return t[this.selectionKey]&&e&&e.selectable&&(this.getActiveGroup()||i&&i!==e)&&this.selection},_handleGrouping:function(t,e){var i=this.getActiveGroup();(e!==i||(e=this.findTarget(t,!0)))&&(i?this._updateActiveGroup(e,t):this._createActiveGroup(e,t),this._activeGroup&&this._activeGroup.saveCoords())},_updateActiveGroup:function(t,e){var i=this.getActiveGroup();if(i.contains(t)){if(i.removeWithUpdate(t),t.set("active",!1),1===i.size())return this.discardActiveGroup(e),void this.setActiveObject(i.item(0))}else i.addWithUpdate(t);this.fire("selection:created",{target:i,e:e}),i.set("active",!0)},_createActiveGroup:function(t,e){if(this._activeObject&&t!==this._activeObject){var i=this._createGroup(t);i.addWithUpdate(),this.setActiveGroup(i),this._activeObject=null,this.fire("selection:created",{target:i,e:e})}t.set("active",!0)},_createGroup:function(t){var e=this.getObjects(),i=e.indexOf(this._activeObject)<e.indexOf(t)?[this._activeObject,t]:[t,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new fabric.Group(i,{canvas:this})},_groupSelectedObjects:function(t){var e=this._collectObjects();1===e.length?this.setActiveObject(e[0],t):e.length>1&&((e=new fabric.Group(e.reverse(),{canvas:this})).addWithUpdate(),this.setActiveGroup(e,t),e.saveCoords(),this.fire("selection:created",{target:e}),this.renderAll())},_collectObjects:function(){for(var i,n=[],r=this._groupSelector.ex,o=this._groupSelector.ey,s=r+this._groupSelector.left,a=o+this._groupSelector.top,c=new fabric.Point(t(r,s),t(o,a)),l=new fabric.Point(e(r,s),e(o,a)),h=r===s&&o===a,u=this._objects.length;u--&&!((i=this._objects[u])&&i.selectable&&i.visible&&(i.intersectsWithRect(c,l)||i.isContainedWithinRect(c,l)||i.containsPoint(c)||i.containsPoint(l))&&(i.set("active",!0),n.push(i),h)););return n},_maybeGroupObjects:function(t){this.selection&&this._groupSelector&&this._groupSelectedObjects(t);var e=this.getActiveGroup();e&&(e.setObjectsCoords().setCoords(),e.isMoving=!1,this.setCursor(this.defaultCursor)),this._groupSelector=null,this._currentTransform=null}})}(),function(){var t=fabric.StaticCanvas.supports("toDataURLWithQuality");fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(t){t||(t={});var e=t.format||"png",i=t.quality||1,n=t.multiplier||1,r={left:t.left||0,top:t.top||0,width:t.width||0,height:t.height||0};return this.__toDataURLWithMultiplier(e,i,r,n)},__toDataURLWithMultiplier:function(t,e,i,n){var r=this.getWidth(),o=this.getHeight(),s=(i.width||this.getWidth())*n,a=(i.height||this.getHeight())*n,c=this.getZoom()*n,l=this.viewportTransform,h=[c,0,0,c,(l[4]-i.left)*n,(l[5]-i.top)*n],u=this.interactive;this.viewportTransform=h,this.interactive&&(this.interactive=!1),r!==s||o!==a?this.setDimensions({width:s,height:a}):this.renderAll();var f=this.__toDataURL(t,e,i);return u&&(this.interactive=u),this.viewportTransform=l,this.setDimensions({width:r,height:o}),f},__toDataURL:function(e,i){var n=this.contextContainer.canvas;return"jpg"===e&&(e="jpeg"),t?n.toDataURL("image/"+e,i):n.toDataURL("image/"+e)},toDataURLWithMultiplier:function(t,e,i){return this.toDataURL({format:t,multiplier:e,quality:i})}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(t,e,i){return this.loadFromJSON(t,e,i)},loadFromJSON:function(t,e,i){if(t){var n="string"==typeof t?JSON.parse(t):fabric.util.object.clone(t);this.clear();var r=this;return this._enlivenObjects(n.objects,function(){r._setBgOverlay(n,function(){for(var t in delete n.objects,delete n.backgroundImage,delete n.overlayImage,delete n.background,delete n.overlay,n)r[t]=n[t];e&&e()})},i),this}},_setBgOverlay:function(t,e){var i=this,n={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(t.backgroundImage||t.overlayImage||t.background||t.overlay){var r=function(){n.backgroundImage&&n.overlayImage&&n.backgroundColor&&n.overlayColor&&(i.renderAll(),e&&e())};this.__setBgOverlay("backgroundImage",t.backgroundImage,n,r),this.__setBgOverlay("overlayImage",t.overlayImage,n,r),this.__setBgOverlay("backgroundColor",t.background,n,r),this.__setBgOverlay("overlayColor",t.overlay,n,r),r()}else e&&e()},__setBgOverlay:function(t,e,i,n){var r=this;e?"backgroundImage"===t||"overlayImage"===t?fabric.Image.fromObject(e,function(e){r[t]=e,i[t]=!0,n&&n()}):this["set"+fabric.util.string.capitalize(t,!0)](e,function(){i[t]=!0,n&&n()}):i[t]=!0},_enlivenObjects:function(t,e,i){var n=this;if(t&&0!==t.length){var r=this.renderOnAddRemove;this.renderOnAddRemove=!1,fabric.util.enlivenObjects(t,function(t){t.forEach(function(t,e){n.insertAt(t,e)}),n.renderOnAddRemove=r,e&&e()},null,i)}else e&&e()},_toDataURL:function(t,e){this.clone(function(i){e(i.toDataURL(t))})},_toDataURLWithMultiplier:function(t,e,i){this.clone(function(n){i(n.toDataURLWithMultiplier(t,e))})},clone:function(t,e){var i=JSON.stringify(this.toJSON(e));this.cloneWithoutData(function(e){e.loadFromJSON(i,function(){t&&t(e)})})},cloneWithoutData:function(t){var e=fabric.document.createElement("canvas");e.width=this.getWidth(),e.height=this.getHeight();var i=new fabric.Canvas(e);i.clipTo=this.clipTo,this.backgroundImage?(i.setBackgroundImage(this.backgroundImage.src,function(){i.renderAll(),t&&t(i)}),i.backgroundImageOpacity=this.backgroundImageOpacity,i.backgroundImageStretch=this.backgroundImageStretch):t&&t(i)}}),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.toFixed,r=e.util.string.capitalize,o=e.util.degreesToRadians,s=e.StaticCanvas.supports("setLineDash");e.Object||(e.Object=e.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",borderDashArray:null,cornerColor:"rgba(102,153,255,0.5)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor skewX skewY".split(" "),initialize:function(t){t&&this.setOptions(t)},_initGradient:function(t){!t.fill||!t.fill.colorStops||t.fill instanceof e.Gradient||this.set("fill",new e.Gradient(t.fill)),!t.stroke||!t.stroke.colorStops||t.stroke instanceof e.Gradient||this.set("stroke",new e.Gradient(t.stroke))},_initPattern:function(t){!t.fill||!t.fill.source||t.fill instanceof e.Pattern||this.set("fill",new e.Pattern(t.fill)),!t.stroke||!t.stroke.source||t.stroke instanceof e.Pattern||this.set("stroke",new e.Pattern(t.stroke))},_initClipping:function(t){if(t.clipTo&&"string"==typeof t.clipTo){var i=e.util.getFunctionBody(t.clipTo);void 0!==i&&(this.clipTo=new Function("ctx",i))}},setOptions:function(t){for(var e in t)this.set(e,t[e]);this._initGradient(t),this._initPattern(t),this._initClipping(t)},transform:function(t,e){this.group&&!this.group._transformDone&&this.group===this.canvas._activeGroup&&this.group.transform(t);var i=e?this._getLeftTopCoords():this.getCenterPoint();t.translate(i.x,i.y),t.rotate(o(this.angle)),t.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1)),t.transform(1,0,Math.tan(o(this.skewX)),1,0,0),t.transform(1,Math.tan(o(this.skewY)),0,1,0,0)},toObject:function(t){var i=e.Object.NUM_FRACTION_DIGITS,r={type:this.type,originX:this.originX,originY:this.originY,left:n(this.left,i),top:n(this.top,i),width:n(this.width,i),height:n(this.height,i),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:n(this.strokeWidth,i),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:n(this.strokeMiterLimit,i),scaleX:n(this.scaleX,i),scaleY:n(this.scaleY,i),angle:n(this.getAngle(),i),flipX:this.flipX,flipY:this.flipY,opacity:n(this.opacity,i),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():this.transformMatrix,skewX:n(this.skewX,i),skewY:n(this.skewY,i)};return e.util.populateWithProperties(this,r,t),this.includeDefaultValues||(r=this._removeDefaultValues(r)),r},toDatalessObject:function(t){return this.toObject(t)},_removeDefaultValues:function(t){var i=e.util.getKlass(t.type).prototype;return i.stateProperties.forEach(function(e){t[e]===i[e]&&delete t[e],"[object Array]"===Object.prototype.toString.call(t[e])&&"[object Array]"===Object.prototype.toString.call(i[e])&&0===t[e].length&&0===i[e].length&&delete t[e]}),t},toString:function(){return"#<fabric."+r(this.type)+">"},get:function(t){return this[t]},getObjectScaling:function(){var t=this.scaleX,e=this.scaleY;if(this.group){var i=this.group.getObjectScaling();t*=i.scaleX,e*=i.scaleY}return{scaleX:t,scaleY:e}},_setObject:function(t){for(var e in t)this._set(e,t[e])},set:function(t,e){return"object"==typeof t?this._setObject(t):"function"==typeof e&&"clipTo"!==t?this._set(t,e(this.get(t))):this._set(t,e),this},_set:function(t,i){return("scaleX"===t||"scaleY"===t)&&(i=this._constrainScale(i)),"scaleX"===t&&i<0?(this.flipX=!this.flipX,i*=-1):"scaleY"===t&&i<0?(this.flipY=!this.flipY,i*=-1):"shadow"!==t||!i||i instanceof e.Shadow||(i=new e.Shadow(i)),this[t]=i,"width"!==t&&"height"!==t||(this.minScaleLimit=Math.min(.1,1/Math.max(this.width,this.height))),this},setOnGroup:function(){},toggle:function(t){var e=this.get(t);return"boolean"==typeof e&&this.set(t,!e),this},setSourcePath:function(t){return this.sourcePath=t,this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(t,i){0===this.width&&0===this.height||!this.visible||(t.save(),this._setupCompositeOperation(t),this.drawSelectionBackground(t),i||this.transform(t),this._setOpacity(t),this._setShadow(t),this._renderBackground(t),this._setStrokeStyles(t),this._setFillStyles(t),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this.clipTo&&e.util.clipContext(this,t),this._render(t,i),this.clipTo&&t.restore(),t.restore())},_renderBackground:function(t){this.backgroundColor&&(t.fillStyle=this.backgroundColor,t.fillRect(-this.width/2,-this.height/2,this.width,this.height),this._removeShadow(t))},_setOpacity:function(t){this.group&&this.group._setOpacity(t),t.globalAlpha*=this.opacity},_setStrokeStyles:function(t){this.stroke&&(t.lineWidth=this.strokeWidth,t.lineCap=this.strokeLineCap,t.lineJoin=this.strokeLineJoin,t.miterLimit=this.strokeMiterLimit,t.strokeStyle=this.stroke.toLive?this.stroke.toLive(t,this):this.stroke)},_setFillStyles:function(t){this.fill&&(t.fillStyle=this.fill.toLive?this.fill.toLive(t,this):this.fill)},_setLineDash:function(t,e,i){e&&(1&e.length&&e.push.apply(e,e),s?t.setLineDash(e):i&&i(t))},_renderControls:function(t,i){if(!(!this.active||i||this.group&&this.group!==this.canvas.getActiveGroup())){var n,r=this.getViewportTransform(),s=this.calcTransformMatrix();s=e.util.multiplyTransformMatrices(r,s),n=e.util.qrDecompose(s),t.save(),t.translate(n.translateX,n.translateY),t.lineWidth=1*this.borderScaleFactor,t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.group&&this.group===this.canvas.getActiveGroup()?(t.rotate(o(n.angle)),this.drawBordersInGroup(t,n)):(t.rotate(o(this.angle)),this.drawBorders(t)),this.drawControls(t),t.restore()}},_setShadow:function(t){if(this.shadow){var i=this.canvas&&this.canvas.viewportTransform[0]||1,n=this.canvas&&this.canvas.viewportTransform[3]||1,r=this.getObjectScaling();this.canvas&&this.canvas._isRetinaScaling()&&(i*=e.devicePixelRatio,n*=e.devicePixelRatio),t.shadowColor=this.shadow.color,t.shadowBlur=this.shadow.blur*(i+n)*(r.scaleX+r.scaleY)/4,t.shadowOffsetX=this.shadow.offsetX*i*r.scaleX,t.shadowOffsetY=this.shadow.offsetY*n*r.scaleY}},_removeShadow:function(t){this.shadow&&(t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0)},_renderFill:function(t){if(this.fill){if(t.save(),this.fill.gradientTransform){var e=this.fill.gradientTransform;t.transform.apply(t,e)}this.fill.toLive&&t.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0),"evenodd"===this.fillRule?t.fill("evenodd"):t.fill(),t.restore()}},_renderStroke:function(t){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokeDashArray,this._renderDashedStroke),this.stroke.gradientTransform){var e=this.stroke.gradientTransform;t.transform.apply(t,e)}this.stroke.toLive&&t.translate(-this.width/2+this.stroke.offsetX||0,-this.height/2+this.stroke.offsetY||0),t.stroke(),t.restore()}},clone:function(t,i){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(i),t):new e.Object(this.toObject(i))},cloneAsImage:function(t,i){var n=this.toDataURL(i);return e.util.loadImage(n,function(i){t&&t(new e.Image(i))}),this},toDataURL:function(t){t||(t={});var i=e.util.createCanvasElement(),n=this.getBoundingRect();i.width=n.width,i.height=n.height,e.util.wrapElement(i,"div");var r=new e.StaticCanvas(i,{enableRetinaScaling:t.enableRetinaScaling});"jpg"===t.format&&(t.format="jpeg"),"jpeg"===t.format&&(r.backgroundColor="#fff");var o={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",!1),this.setPositionByOrigin(new e.Point(r.getWidth()/2,r.getHeight()/2),"center","center");var s=this.canvas;r.add(this);var a=r.toDataURL(t);return this.set(o).setCoords(),this.canvas=s,r.dispose(),r=null,a},isType:function(t){return this.type===t},complexity:function(){return 0},toJSON:function(t){return this.toObject(t)},setGradient:function(t,i){i||(i={});var n={colorStops:[]};for(var r in n.type=i.type||(i.r1||i.r2?"radial":"linear"),n.coords={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2},(i.r1||i.r2)&&(n.coords.r1=i.r1,n.coords.r2=i.r2),i.gradientTransform&&(n.gradientTransform=i.gradientTransform),i.colorStops){var o=new e.Color(i.colorStops[r]);n.colorStops.push({offset:r,color:o.toRgb(),opacity:o.getAlpha()})}return this.set(t,e.Gradient.forObject(this,n))},setPatternFill:function(t){return this.set("fill",new e.Pattern(t))},setShadow:function(t){return this.set("shadow",t?new e.Shadow(t):null)},setColor:function(t){return this.set("fill",t),this},setAngle:function(t){var e=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return e&&this._setOriginToCenter(),this.set("angle",t),e&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},remove:function(){return this.canvas&&this.canvas.remove(this),this},getLocalPointer:function(t,i){i=i||this.canvas.getPointer(t);var n=new e.Point(i.x,i.y),r=this._getLeftTopCoords();return this.angle&&(n=e.util.rotatePoint(n,r,e.util.degreesToRadians(-this.angle))),{x:n.x-r.x,y:n.y-r.y}},_setupCompositeOperation:function(t){this.globalCompositeOperation&&(t.globalCompositeOperation=this.globalCompositeOperation)}}),e.util.createAccessors(e.Object),e.Object.prototype.rotate=e.Object.prototype.setAngle,i(e.Object.prototype,e.Observable),e.Object.NUM_FRACTION_DIGITS=2,e.Object.__uid=0)}(exports),function(){var t=fabric.util.degreesToRadians,e={left:-.5,center:0,right:.5},i={top:-.5,center:0,bottom:.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(t,n,r,o,s){var a,c,l,h=t.x,u=t.y;return"string"==typeof n?n=e[n]:n-=.5,"string"==typeof o?o=e[o]:o-=.5,a=o-n,"string"==typeof r?r=i[r]:r-=.5,"string"==typeof s?s=i[s]:s-=.5,c=s-r,(a||c)&&(l=this._getTransformedDimensions(),h=t.x+a*l.x,u=t.y+c*l.y),new fabric.Point(h,u)},translateToCenterPoint:function(e,i,n){var r=this.translateToGivenOrigin(e,i,n,"center","center");return this.angle?fabric.util.rotatePoint(r,e,t(this.angle)):r},translateToOriginPoint:function(e,i,n){var r=this.translateToGivenOrigin(e,"center","center",i,n);return this.angle?fabric.util.rotatePoint(r,e,t(this.angle)):r},getCenterPoint:function(){var t=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(t,this.originX,this.originY)},getPointByOrigin:function(t,e){var i=this.getCenterPoint();return this.translateToOriginPoint(i,t,e)},toLocalPoint:function(e,i,n){var r,o,s=this.getCenterPoint();return r=void 0!==i&&void 0!==n?this.translateToGivenOrigin(s,"center","center",i,n):new fabric.Point(this.left,this.top),o=new fabric.Point(e.x,e.y),this.angle&&(o=fabric.util.rotatePoint(o,s,-t(this.angle))),o.subtractEquals(r)},setPositionByOrigin:function(t,e,i){var n=this.translateToCenterPoint(t,e,i),r=this.translateToOriginPoint(n,this.originX,this.originY);this.set("left",r.x),this.set("top",r.y)},adjustPosition:function(i){var n,r,o=t(this.angle),s=this.getWidth(),a=Math.cos(o)*s,c=Math.sin(o)*s;n="string"==typeof this.originX?e[this.originX]:this.originX-.5,r="string"==typeof i?e[i]:i-.5,this.left+=a*(r-n),this.top+=c*(r-n),this.setCoords(),this.originX=i},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var t=this.getCenterPoint();this.originX="center",this.originY="center",this.left=t.x,this.top=t.y},_resetOrigin:function(){var t=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=t.x,this.top=t.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function t(t){return[new fabric.Point(t.tl.x,t.tl.y),new fabric.Point(t.tr.x,t.tr.y),new fabric.Point(t.br.x,t.br.y),new fabric.Point(t.bl.x,t.bl.y)]}var e=fabric.util.degreesToRadians,i=fabric.util.multiplyTransformMatrices;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(e,i){var n=t(this.oCoords);return"Intersection"===fabric.Intersection.intersectPolygonRectangle(n,e,i).status},intersectsWithObject:function(e){return"Intersection"===fabric.Intersection.intersectPolygonPolygon(t(this.oCoords),t(e.oCoords)).status||e.isContainedWithinObject(this)||this.isContainedWithinObject(e)},isContainedWithinObject:function(e){for(var i=t(this.oCoords),n=0;n<4;n++)if(!e.containsPoint(i[n]))return!1;return!0},isContainedWithinRect:function(t,e){var i=this.getBoundingRect();return i.left>=t.x&&i.left+i.width<=e.x&&i.top>=t.y&&i.top+i.height<=e.y},containsPoint:function(t){this.oCoords||this.setCoords();var e=this._getImageLines(this.oCoords),i=this._findCrossPoints(t,e);return 0!==i&&i%2==1},_getImageLines:function(t){return{topline:{o:t.tl,d:t.tr},rightline:{o:t.tr,d:t.br},bottomline:{o:t.br,d:t.bl},leftline:{o:t.bl,d:t.tl}}},_findCrossPoints:function(t,e){var i,n,r,o,s=0;for(var a in e)if(!((o=e[a]).o.y<t.y&&o.d.y<t.y||o.o.y>=t.y&&o.d.y>=t.y||(o.o.x===o.d.x&&o.o.x>=t.x?r=o.o.x:(i=0,n=(o.d.y-o.o.y)/(o.d.x-o.o.x),r=-(t.y-i*t.x-(o.o.y-n*o.o.x))/(i-n)),r>=t.x&&(s+=1),2!==s)))break;return s},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){return this.oCoords||this.setCoords(),fabric.util.makeBoundingBoxFromPoints([this.oCoords.tl,this.oCoords.tr,this.oCoords.br,this.oCoords.bl])},getWidth:function(){return this._getTransformedDimensions().x},getHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(t){return Math.abs(t)<this.minScaleLimit?t<0?-this.minScaleLimit:this.minScaleLimit:t},scale:function(t){return(t=this._constrainScale(t))<0&&(this.flipX=!this.flipX,this.flipY=!this.flipY,t*=-1),this.scaleX=t,this.scaleY=t,this.setCoords(),this},scaleToWidth:function(t){var e=this.getBoundingRect().width/this.getWidth();return this.scale(t/this.width/e)},scaleToHeight:function(t){var e=this.getBoundingRect().height/this.getHeight();return this.scale(t/this.height/e)},setCoords:function(){var t=e(this.angle),i=this.getViewportTransform(),n=this._calculateCurrentDimensions(),r=n.x,o=n.y;r<0&&(r=Math.abs(r));var s=Math.sin(t),a=Math.cos(t),c=r>0?Math.atan(o/r):0,l=r/Math.cos(c)/2,h=Math.cos(c+t)*l,u=Math.sin(c+t)*l,f=fabric.util.transformPoint(this.getCenterPoint(),i),d=new fabric.Point(f.x-h,f.y-u),p=new fabric.Point(d.x+r*a,d.y+r*s),g=new fabric.Point(d.x-o*s,d.y+o*a),v=new fabric.Point(f.x+h,f.y+u),m=new fabric.Point((d.x+g.x)/2,(d.y+g.y)/2),b=new fabric.Point((p.x+d.x)/2,(p.y+d.y)/2),y=new fabric.Point((v.x+p.x)/2,(v.y+p.y)/2),_=new fabric.Point((v.x+g.x)/2,(v.y+g.y)/2),x=new fabric.Point(b.x+s*this.rotatingPointOffset,b.y-a*this.rotatingPointOffset);return this.oCoords={tl:d,tr:p,br:v,bl:g,ml:m,mt:b,mr:y,mb:_,mtr:x},this._setCornerCoords&&this._setCornerCoords(),this},_calcRotateMatrix:function(){if(this.angle){var t=e(this.angle),i=Math.cos(t),n=Math.sin(t);return[i,n,-n,i,0,0]}return[1,0,0,1,0,0]},calcTransformMatrix:function(){var t=this.getCenterPoint(),e=[1,0,0,1,t.x,t.y],n=this._calcRotateMatrix(),r=this._calcDimensionsTransformMatrix(this.skewX,this.skewY,!0),o=this.group?this.group.calcTransformMatrix():[1,0,0,1,0,0];return o=i(o,e),o=i(o,n),o=i(o,r)},_calcDimensionsTransformMatrix:function(t,n,r){var o=[1,0,Math.tan(e(t)),1],s=[1,Math.tan(e(n)),0,1],a=this.scaleX*(r&&this.flipX?-1:1),c=this.scaleY*(r&&this.flipY?-1:1),l=i([a,0,0,c],o,!0);return i(l,s,!0)}})}(),fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(t){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,t):this.canvas.sendBackwards(this,t),this},bringForward:function(t){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,t):this.canvas.bringForward(this,t),this},moveTo:function(t){return this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,t):this.canvas.moveTo(this,t),this}}),function(){function t(t,e){if(e){if(e.toLive)return t+": url(#SVGID_"+e.id+"); ";var i=new fabric.Color(e),n=t+": "+i.toRgb()+"; ",r=i.getAlpha();return 1!==r&&(n+=t+"-opacity: "+r.toString()+"; "),n}return t+": none; "}fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(e){var i=this.fillRule,n=this.strokeWidth?this.strokeWidth:"0",r=this.strokeDashArray?this.strokeDashArray.join(" "):"none",o=this.strokeLineCap?this.strokeLineCap:"butt",s=this.strokeLineJoin?this.strokeLineJoin:"miter",a=this.strokeMiterLimit?this.strokeMiterLimit:"4",c=void 0!==this.opacity?this.opacity:"1",l=this.visible?"":" visibility: hidden;",h=e?"":this.getSvgFilter(),u=t("fill",this.fill);return[t("stroke",this.stroke),"stroke-width: ",n,"; ","stroke-dasharray: ",r,"; ","stroke-linecap: ",o,"; ","stroke-linejoin: ",s,"; ","stroke-miterlimit: ",a,"; ",u,"fill-rule: ",i,"; ","opacity: ",c,";",h,l].join("")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgId:function(){return this.id?'id="'+this.id+'" ':""},getSvgTransform:function(){if(this.group&&"path-group"===this.group.type)return"";var t=fabric.util.toFixed,e=this.getAngle(),i=this.getSkewX()%360,n=this.getSkewY()%360,r=this.getCenterPoint(),o=fabric.Object.NUM_FRACTION_DIGITS,s="path-group"===this.type?"":"translate("+t(r.x,o)+" "+t(r.y,o)+")",a=0!==e?" rotate("+t(e,o)+")":"",c=1===this.scaleX&&1===this.scaleY?"":" scale("+t(this.scaleX,o)+" "+t(this.scaleY,o)+")",l=0!==i?" skewX("+t(i,o)+")":"",h=0!==n?" skewY("+t(n,o)+")":"",u="path-group"===this.type?this.width:0,f=this.flipX?" matrix(-1 0 0 1 "+u+" 0) ":"",d="path-group"===this.type?this.height:0;return[s,a,c,f,this.flipY?" matrix(1 0 0 -1 0 "+d+")":"",l,h].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+") ":""},_createBaseSVGMarkup:function(){var t=[];return this.fill&&this.fill.toLive&&t.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&t.push(this.stroke.toSVG(this,!1)),this.shadow&&t.push(this.shadow.toSVG(this)),t}})}(),function(){var t=fabric.util.object.extend;function e(e,i,n){var r={};n.forEach(function(t){r[t]=e[t]}),t(e[i],r,!0)}fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return!function t(e,i){if(!fabric.isLikelyNode&&e instanceof Element)return e===i;if(e instanceof Array){if(e.length!==i.length)return!1;var n=i.concat().sort();return!e.concat().sort().some(function(e,i){return!t(n[i],e)})}if(e instanceof Object){for(var r in e)if(!t(e[r],i[r]))return!1;return!0}return e===i}(this.originalState,this)},saveState:function(t){return e(this,"originalState",this.stateProperties),t&&t.stateProperties&&e(this,"originalState",t.stateProperties),this},setupState:function(t){return this.originalState={},this.saveState(t),this}})}(),function(){var t=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(t){if(!this.hasControls||!this.active)return!1;var e,i,n=t.x,r=t.y;for(var o in this.__corner=0,this.oCoords)if(this.isControlVisible(o)&&("mtr"!==o||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==o&&"mr"!==o&&"mb"!==o&&"ml"!==o)&&(i=this._getImageLines(this.oCoords[o].corner),0!==(e=this._findCrossPoints({x:n,y:r},i))&&e%2==1))return this.__corner=o,o;return!1},_setCornerCoords:function(){var e,i,n=this.oCoords,r=t(45-this.angle),o=.707106*this.cornerSize,s=o*Math.cos(r),a=o*Math.sin(r);for(var c in n)e=n[c].x,i=n[c].y,n[c].corner={tl:{x:e-a,y:i-s},tr:{x:e+s,y:i-a},bl:{x:e-s,y:i+a},br:{x:e+a,y:i+s}}},_getNonTransformedDimensions:function(){var t=this.strokeWidth,e=this.width,i=this.height,n=!0,r=!0;return"line"===this.type&&"butt"===this.strokeLineCap&&(r=e,n=i),r&&(i+=i<0?-t:t),n&&(e+=e<0?-t:t),{x:e,y:i}},_getTransformedDimensions:function(t,e){void 0===t&&(t=this.skewX),void 0===e&&(e=this.skewY);var i,n,r=this._getNonTransformedDimensions(),o=r.x/2,s=r.y/2,a=[{x:-o,y:-s},{x:o,y:-s},{x:-o,y:s},{x:o,y:s}],c=this._calcDimensionsTransformMatrix(t,e,!1);for(i=0;i<a.length;i++)a[i]=fabric.util.transformPoint(a[i],c);return{x:(n=fabric.util.makeBoundingBoxFromPoints(a)).width,y:n.height}},_calculateCurrentDimensions:function(){var t=this.getViewportTransform(),e=this._getTransformedDimensions(),i=e.x,n=e.y;return fabric.util.transformPoint(new fabric.Point(i,n),t,!0).scalarAdd(2*this.padding)},drawSelectionBackground:function(e){if(!this.selectionBackgroundColor||this.group||!this.active)return this;e.save();var i=this.getCenterPoint(),n=this._calculateCurrentDimensions(),r=this.canvas.viewportTransform;return e.translate(i.x,i.y),e.scale(1/r[0],1/r[3]),e.rotate(t(this.angle)),e.fillStyle=this.selectionBackgroundColor,e.fillRect(-n.x/2,-n.y/2,n.x,n.y),e.restore(),this},drawBorders:function(t){if(!this.hasBorders)return this;var e=this._calculateCurrentDimensions(),i=1/this.borderScaleFactor,n=e.x+i,r=e.y+i;if(t.save(),t.strokeStyle=this.borderColor,this._setLineDash(t,this.borderDashArray,null),t.strokeRect(-n/2,-r/2,n,r),this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls){var o=-r/2;t.beginPath(),t.moveTo(0,o),t.lineTo(0,o-this.rotatingPointOffset),t.closePath(),t.stroke()}return t.restore(),this},drawBordersInGroup:function(t,e){if(!this.hasBorders)return this;var i=this._getNonTransformedDimensions(),n=fabric.util.customTransformMatrix(e.scaleX,e.scaleY,e.skewX),r=fabric.util.transformPoint(i,n),o=1/this.borderScaleFactor,s=r.x+o+2*this.padding,a=r.y+o+2*this.padding;return t.save(),this._setLineDash(t,this.borderDashArray,null),t.strokeStyle=this.borderColor,t.strokeRect(-s/2,-a/2,s,a),t.restore(),this},drawControls:function(t){if(!this.hasControls)return this;var e=this._calculateCurrentDimensions(),i=e.x,n=e.y,r=this.cornerSize,o=-(i+r)/2,s=-(n+r)/2,a=this.transparentCorners?"stroke":"fill";return t.save(),t.strokeStyle=t.fillStyle=this.cornerColor,this.transparentCorners||(t.strokeStyle=this.cornerStrokeColor),this._setLineDash(t,this.cornerDashArray,null),this._drawControl("tl",t,a,o,s),this._drawControl("tr",t,a,o+i,s),this._drawControl("bl",t,a,o,s+n),this._drawControl("br",t,a,o+i,s+n),this.get("lockUniScaling")||(this._drawControl("mt",t,a,o+i/2,s),this._drawControl("mb",t,a,o+i/2,s+n),this._drawControl("mr",t,a,o+i,s+n/2),this._drawControl("ml",t,a,o,s+n/2)),this.hasRotatingPoint&&this._drawControl("mtr",t,a,o+i/2,s-this.rotatingPointOffset),t.restore(),this},_drawControl:function(t,e,i,n,r){if(this.isControlVisible(t)){var o=this.cornerSize,s=!this.transparentCorners&&this.cornerStrokeColor;switch(this.cornerStyle){case"circle":e.beginPath(),e.arc(n+o/2,r+o/2,o/2,0,2*Math.PI,!1),e[i](),s&&e.stroke();break;default:"undefined"!=typeof G_vmlCanvasManager||this.transparentCorners||e.clearRect(n,r,o,o),e[i+"Rect"](n,r,o,o),s&&e.strokeRect(n,r,o,o)}}},isControlVisible:function(t){return this._getControlsVisibility()[t]},setControlVisible:function(t,e){return this._getControlsVisibility()[t]=e,this},setControlsVisibility:function(t){for(var e in t||(t={}),t)this.setControlVisible(e,t[e]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(t,e){var i=function(){},n=(e=e||{}).onComplete||i,r=e.onChange||i,o=this;return fabric.util.animate({startValue:t.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(e){t.set("left",e),o.renderAll(),r()},onComplete:function(){t.setCoords(),n()}}),this},fxCenterObjectV:function(t,e){var i=function(){},n=(e=e||{}).onComplete||i,r=e.onChange||i,o=this;return fabric.util.animate({startValue:t.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(e){t.set("top",e),o.renderAll(),r()},onComplete:function(){t.setCoords(),n()}}),this},fxRemove:function(t,e){var i=function(){},n=(e=e||{}).onComplete||i,r=e.onChange||i,o=this;return fabric.util.animate({startValue:t.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){t.set("active",!1)},onChange:function(e){t.set("opacity",e),o.renderAll(),r()},onComplete:function(){o.remove(t),n()}}),this}}),fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var t,e,i=[];for(t in arguments[0])i.push(t);for(var n=0,r=i.length;n<r;n++)t=i[n],e=n!==r-1,this._animate(t,arguments[0][t],arguments[1],e)}else this._animate.apply(this,arguments);return this},_animate:function(t,e,i,n){var r,o=this;e=e.toString(),i=i?fabric.util.object.clone(i):{},~t.indexOf(".")&&(r=t.split("."));var s=r?this.get(r[0])[r[1]]:this.get(t);"from"in i||(i.from=s),e=~e.indexOf("=")?s+parseFloat(e.replace("=","")):parseFloat(e),fabric.util.animate({startValue:i.from,endValue:e,byValue:i.by,easing:i.easing,duration:i.duration,abort:i.abort&&function(){return i.abort.call(o)},onChange:function(e){r?o[r[0]][r[1]]=e:o.set(t,e),n||i.onChange&&i.onChange()},onComplete:function(){n||(o.setCoords(),i.onComplete&&i.onComplete())}})}}),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n={x1:1,x2:1,y1:1,y2:1},r=e.StaticCanvas.supports("setLineDash");function o(t,e){var i=t.origin,n=t.axis1,r=t.axis2,o=t.dimension,s=e.nearest,a=e.center,c=e.farthest;return function(){switch(this.get(i)){case s:return Math.min(this.get(n),this.get(r));case a:return Math.min(this.get(n),this.get(r))+.5*this.get(o);case c:return Math.max(this.get(n),this.get(r))}}}e.Line?e.warn("fabric.Line is already defined"):(e.Line=e.util.createClass(e.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(t,e){e=e||{},t||(t=[0,0,0,0]),this.callSuper("initialize",e),this.set("x1",t[0]),this.set("y1",t[1]),this.set("x2",t[2]),this.set("y2",t[3]),this._setWidthHeight(e)},_setWidthHeight:function(t){t||(t={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in t?t.left:this._getLeftToOriginX(),this.top="top"in t?t.top:this._getTopToOriginY()},_set:function(t,e){return this.callSuper("_set",t,e),void 0!==n[t]&&this._setWidthHeight(),this},_getLeftToOriginX:o({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:o({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(t,e){if(t.beginPath(),e){var i=this.getCenterPoint();t.translate(i.x-this.strokeWidth/2,i.y-this.strokeWidth/2)}if(!this.strokeDashArray||this.strokeDashArray&&r){var n=this.calcLinePoints();t.moveTo(n.x1,n.y1),t.lineTo(n.x2,n.y2)}t.lineWidth=this.strokeWidth;var o=t.strokeStyle;t.strokeStyle=this.stroke||t.fillStyle,this.stroke&&this._renderStroke(t),t.strokeStyle=o},_renderDashedStroke:function(t){var i=this.calcLinePoints();t.beginPath(),e.util.drawDashedLine(t,i.x1,i.y1,i.x2,i.y2,this.strokeDashArray),t.closePath()},toObject:function(t){return i(this.callSuper("toObject",t),this.calcLinePoints())},calcLinePoints:function(){var t=this.x1<=this.x2?-1:1,e=this.y1<=this.y2?-1:1,i=t*this.width*.5,n=e*this.height*.5;return{x1:i,x2:t*this.width*-.5,y1:n,y2:e*this.height*-.5}},toSVG:function(t){var e=this._createBaseSVGMarkup(),i={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};return this.group&&"path-group"===this.group.type||(i=this.calcLinePoints()),e.push("<line ",this.getSvgId(),'x1="',i.x1,'" y1="',i.y1,'" x2="',i.x2,'" y2="',i.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),t?t(e.join("")):e.join("")},complexity:function(){return 1}}),e.Line.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),e.Line.fromElement=function(t,n){var r=e.parseAttributes(t,e.Line.ATTRIBUTE_NAMES),o=[r.x1||0,r.y1||0,r.x2||0,r.y2||0];return new e.Line(o,i(r,n))},e.Line.fromObject=function(t,i){var n=[t.x1,t.y1,t.x2,t.y2],r=new e.Line(n,t);return i&&i(r),r})}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=Math.PI,n=e.util.object.extend;e.Circle?e.warn("fabric.Circle is already defined."):(e.Circle=e.util.createClass(e.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*i,initialize:function(t){t=t||{},this.callSuper("initialize",t),this.set("radius",t.radius||0),this.startAngle=t.startAngle||this.startAngle,this.endAngle=t.endAngle||this.endAngle},_set:function(t,e){return this.callSuper("_set",t,e),"radius"===t&&this.setRadius(e),this},toObject:function(t){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(t))},toSVG:function(t){var e=this._createBaseSVGMarkup(),n=0,r=0,o=(this.endAngle-this.startAngle)%(2*i);if(0===o)this.group&&"path-group"===this.group.type&&(n=this.left+this.radius,r=this.top+this.radius),e.push("<circle ",this.getSvgId(),'cx="'+n+'" cy="'+r+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');else{var s=Math.cos(this.startAngle)*this.radius,a=Math.sin(this.startAngle)*this.radius,c=Math.cos(this.endAngle)*this.radius,l=Math.sin(this.endAngle)*this.radius,h=o>i?"1":"0";e.push('<path d="M '+s+" "+a," A "+this.radius+" "+this.radius," 0 ",+h+" 1"," "+c+" "+l,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')}return t?t(e.join("")):e.join("")},_render:function(t,e){t.beginPath(),t.arc(e?this.left+this.radius:0,e?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,!1),this._renderFill(t),this._renderStroke(t)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(t){return this.radius=t,this.set("width",2*t).set("height",2*t)},complexity:function(){return 1}}),e.Circle.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),e.Circle.fromElement=function(t,i){i||(i={});var r=e.parseAttributes(t,e.Circle.ATTRIBUTE_NAMES);if(!function(t){return"radius"in t&&t.radius>=0}(r))throw new Error("value of `r` attribute is required and can not be negative");r.left=r.left||0,r.top=r.top||0;var o=new e.Circle(n(r,i));return o.left-=o.radius,o.top-=o.radius,o},e.Circle.fromObject=function(t,i){var n=new e.Circle(t);return i&&i(n),n})}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={});e.Triangle?e.warn("fabric.Triangle is already defined"):(e.Triangle=e.util.createClass(e.Object,{type:"triangle",initialize:function(t){t=t||{},this.callSuper("initialize",t),this.set("width",t.width||100).set("height",t.height||100)},_render:function(t){var e=this.width/2,i=this.height/2;t.beginPath(),t.moveTo(-e,i),t.lineTo(0,-i),t.lineTo(e,i),t.closePath(),this._renderFill(t),this._renderStroke(t)},_renderDashedStroke:function(t){var i=this.width/2,n=this.height/2;t.beginPath(),e.util.drawDashedLine(t,-i,n,0,-n,this.strokeDashArray),e.util.drawDashedLine(t,0,-n,i,n,this.strokeDashArray),e.util.drawDashedLine(t,i,n,-i,n,this.strokeDashArray),t.closePath()},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=this.width/2,n=this.height/2,r=[-i+" "+n,"0 "+-n,i+" "+n].join(",");return e.push("<polygon ",this.getSvgId(),'points="',r,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),t?t(e.join("")):e.join("")},complexity:function(){return 1}}),e.Triangle.fromObject=function(t,i){var n=new e.Triangle(t);return i&&i(n),n})}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=2*Math.PI,n=e.util.object.extend;e.Ellipse?e.warn("fabric.Ellipse is already defined."):(e.Ellipse=e.util.createClass(e.Object,{type:"ellipse",rx:0,ry:0,initialize:function(t){t=t||{},this.callSuper("initialize",t),this.set("rx",t.rx||0),this.set("ry",t.ry||0)},_set:function(t,e){switch(this.callSuper("_set",t,e),t){case"rx":this.rx=e,this.set("width",2*e);break;case"ry":this.ry=e,this.set("height",2*e)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(t){return this.callSuper("toObject",["rx","ry"].concat(t))},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=0,n=0;return this.group&&"path-group"===this.group.type&&(i=this.left+this.rx,n=this.top+this.ry),e.push("<ellipse ",this.getSvgId(),'cx="',i,'" cy="',n,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),t?t(e.join("")):e.join("")},_render:function(t,e){t.beginPath(),t.save(),t.transform(1,0,0,this.ry/this.rx,0,0),t.arc(e?this.left+this.rx:0,e?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,i,!1),t.restore(),this._renderFill(t),this._renderStroke(t)},complexity:function(){return 1}}),e.Ellipse.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),e.Ellipse.fromElement=function(t,i){i||(i={});var r=e.parseAttributes(t,e.Ellipse.ATTRIBUTE_NAMES);r.left=r.left||0,r.top=r.top||0;var o=new e.Ellipse(n(r,i));return o.top-=o.ry,o.left-=o.rx,o},e.Ellipse.fromObject=function(t,i){var n=new e.Ellipse(t);return i&&i(n),n})}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend;if(e.Rect)e.warn("fabric.Rect is already defined");else{var n=e.Object.prototype.stateProperties.concat();n.push("rx","ry","x","y"),e.Rect=e.util.createClass(e.Object,{stateProperties:n,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(t){t=t||{},this.callSuper("initialize",t),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(t,e){if(1!==this.width||1!==this.height){var i=this.rx?Math.min(this.rx,this.width/2):0,n=this.ry?Math.min(this.ry,this.height/2):0,r=this.width,o=this.height,s=e?this.left:-this.width/2,a=e?this.top:-this.height/2,c=0!==i||0!==n,l=.4477152502;t.beginPath(),t.moveTo(s+i,a),t.lineTo(s+r-i,a),c&&t.bezierCurveTo(s+r-l*i,a,s+r,a+l*n,s+r,a+n),t.lineTo(s+r,a+o-n),c&&t.bezierCurveTo(s+r,a+o-l*n,s+r-l*i,a+o,s+r-i,a+o),t.lineTo(s+i,a+o),c&&t.bezierCurveTo(s+l*i,a+o,s,a+o-l*n,s,a+o-n),t.lineTo(s,a+n),c&&t.bezierCurveTo(s,a+l*n,s+l*i,a,s+i,a),t.closePath(),this._renderFill(t),this._renderStroke(t)}else t.fillRect(-.5,-.5,1,1)},_renderDashedStroke:function(t){var i=-this.width/2,n=-this.height/2,r=this.width,o=this.height;t.beginPath(),e.util.drawDashedLine(t,i,n,i+r,n,this.strokeDashArray),e.util.drawDashedLine(t,i+r,n,i+r,n+o,this.strokeDashArray),e.util.drawDashedLine(t,i+r,n+o,i,n+o,this.strokeDashArray),e.util.drawDashedLine(t,i,n+o,i,n,this.strokeDashArray),t.closePath()},toObject:function(t){return this.callSuper("toObject",["rx","ry"].concat(t))},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=this.left,n=this.top;return this.group&&"path-group"===this.group.type||(i=-this.width/2,n=-this.height/2),e.push("<rect ",this.getSvgId(),'x="',i,'" y="',n,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),t?t(e.join("")):e.join("")},complexity:function(){return 1}}),e.Rect.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),e.Rect.fromElement=function(t,n){if(!t)return null;n=n||{};var r=e.parseAttributes(t,e.Rect.ATTRIBUTE_NAMES);r.left=r.left||0,r.top=r.top||0;var o=new e.Rect(i(n?e.util.object.clone(n):{},r));return o.visible=o.visible&&o.width>0&&o.height>0,o},e.Rect.fromObject=function(t,i){var n=new e.Rect(t);return i&&i(n),n}}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={});e.Polyline?e.warn("fabric.Polyline is already defined"):(e.Polyline=e.util.createClass(e.Object,{type:"polyline",points:null,minX:0,minY:0,initialize:function(t,i){return e.Polygon.prototype.initialize.call(this,t,i)},_calcDimensions:function(){return e.Polygon.prototype._calcDimensions.call(this)},toObject:function(t){return e.Polygon.prototype.toObject.call(this,t)},toSVG:function(t){return e.Polygon.prototype.toSVG.call(this,t)},_render:function(t,i){e.Polygon.prototype.commonRender.call(this,t,i)&&(this._renderFill(t),this._renderStroke(t))},_renderDashedStroke:function(t){var i,n;t.beginPath();for(var r=0,o=this.points.length;r<o;r++)i=this.points[r],n=this.points[r+1]||i,e.util.drawDashedLine(t,i.x,i.y,n.x,n.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),e.Polyline.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polyline.fromElement=function(t,i){if(!t)return null;i||(i={});var n=e.parsePointsAttribute(t.getAttribute("points")),r=e.parseAttributes(t,e.Polyline.ATTRIBUTE_NAMES);return new e.Polyline(n,e.util.object.extend(r,i))},e.Polyline.fromObject=function(t,i){var n=new e.Polyline(t.points,t);return i&&i(n),n})}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.array.min,r=e.util.array.max,o=e.util.toFixed;e.Polygon?e.warn("fabric.Polygon is already defined"):(e.Polygon=e.util.createClass(e.Object,{type:"polygon",points:null,minX:0,minY:0,initialize:function(t,e){e=e||{},this.points=t||[],this.callSuper("initialize",e),this._calcDimensions(),"top"in e||(this.top=this.minY),"left"in e||(this.left=this.minX),this.pathOffset={x:this.minX+this.width/2,y:this.minY+this.height/2}},_calcDimensions:function(){var t=this.points,e=n(t,"x"),i=n(t,"y"),o=r(t,"x"),s=r(t,"y");this.width=o-e||0,this.height=s-i||0,this.minX=e||0,this.minY=i||0},toObject:function(t){return i(this.callSuper("toObject",t),{points:this.points.concat()})},toSVG:function(t){for(var e,i=[],n=this._createBaseSVGMarkup(),r=0,s=this.points.length;r<s;r++)i.push(o(this.points[r].x,2),",",o(this.points[r].y,2)," ");return this.group&&"path-group"===this.group.type||(e=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") "),n.push("<",this.type," ",this.getSvgId(),'points="',i.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),e," ",this.getSvgTransformMatrix(),'"/>\n'),t?t(n.join("")):n.join("")},_render:function(t,e){this.commonRender(t,e)&&(this._renderFill(t),(this.stroke||this.strokeDashArray)&&(t.closePath(),this._renderStroke(t)))},commonRender:function(t,e){var i,n=this.points.length;if(!n||isNaN(this.points[n-1].y))return!1;e||t.translate(-this.pathOffset.x,-this.pathOffset.y),t.beginPath(),t.moveTo(this.points[0].x,this.points[0].y);for(var r=0;r<n;r++)i=this.points[r],t.lineTo(i.x,i.y);return!0},_renderDashedStroke:function(t){e.Polyline.prototype._renderDashedStroke.call(this,t),t.closePath()},complexity:function(){return this.points.length}}),e.Polygon.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polygon.fromElement=function(t,n){if(!t)return null;n||(n={});var r=e.parsePointsAttribute(t.getAttribute("points")),o=e.parseAttributes(t,e.Polygon.ATTRIBUTE_NAMES);return new e.Polygon(r,i(o,n))},e.Polygon.fromObject=function(t,i){var n=new e.Polygon(t.points,t);return i&&i(n),n})}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.array.min,n=e.util.array.max,r=e.util.object.extend,o=Object.prototype.toString,s=e.util.drawArc,a={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},c={m:"l",M:"L"};e.Path?e.warn("fabric.Path is already defined"):(e.Path=e.util.createClass(e.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(t,e){e=e||{},this.setOptions(e),t||(t=[]);var i="[object Array]"===o.call(t);this.path=i?t:t.match&&t.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path&&(i||(this.path=this._parsePath()),this._setPositionDimensions(e),e.sourcePath&&this.setSourcePath(e.sourcePath))},_setPositionDimensions:function(t){var e=this._parseDimensions();this.minX=e.left,this.minY=e.top,this.width=e.width,this.height=e.height,void 0===t.left&&(this.left=e.left+("center"===this.originX?this.width/2:"right"===this.originX?this.width:0)),void 0===t.top&&(this.top=e.top+("center"===this.originY?this.height/2:"bottom"===this.originY?this.height:0)),this.pathOffset=this.pathOffset||{x:this.minX+this.width/2,y:this.minY+this.height/2}},_renderPathCommands:function(t){var e,i,n,r=null,o=0,a=0,c=0,l=0,h=0,u=0,f=-this.pathOffset.x,d=-this.pathOffset.y;this.group&&"path-group"===this.group.type&&(f=0,d=0),t.beginPath();for(var p=0,g=this.path.length;p<g;++p){switch((e=this.path[p])[0]){case"l":c+=e[1],l+=e[2],t.lineTo(c+f,l+d);break;case"L":c=e[1],l=e[2],t.lineTo(c+f,l+d);break;case"h":c+=e[1],t.lineTo(c+f,l+d);break;case"H":c=e[1],t.lineTo(c+f,l+d);break;case"v":l+=e[1],t.lineTo(c+f,l+d);break;case"V":l=e[1],t.lineTo(c+f,l+d);break;case"m":o=c+=e[1],a=l+=e[2],t.moveTo(c+f,l+d);break;case"M":o=c=e[1],a=l=e[2],t.moveTo(c+f,l+d);break;case"c":i=c+e[5],n=l+e[6],h=c+e[3],u=l+e[4],t.bezierCurveTo(c+e[1]+f,l+e[2]+d,h+f,u+d,i+f,n+d),c=i,l=n;break;case"C":c=e[5],l=e[6],h=e[3],u=e[4],t.bezierCurveTo(e[1]+f,e[2]+d,h+f,u+d,c+f,l+d);break;case"s":i=c+e[3],n=l+e[4],null===r[0].match(/[CcSs]/)?(h=c,u=l):(h=2*c-h,u=2*l-u),t.bezierCurveTo(h+f,u+d,c+e[1]+f,l+e[2]+d,i+f,n+d),h=c+e[1],u=l+e[2],c=i,l=n;break;case"S":i=e[3],n=e[4],null===r[0].match(/[CcSs]/)?(h=c,u=l):(h=2*c-h,u=2*l-u),t.bezierCurveTo(h+f,u+d,e[1]+f,e[2]+d,i+f,n+d),c=i,l=n,h=e[1],u=e[2];break;case"q":i=c+e[3],n=l+e[4],h=c+e[1],u=l+e[2],t.quadraticCurveTo(h+f,u+d,i+f,n+d),c=i,l=n;break;case"Q":i=e[3],n=e[4],t.quadraticCurveTo(e[1]+f,e[2]+d,i+f,n+d),c=i,l=n,h=e[1],u=e[2];break;case"t":i=c+e[1],n=l+e[2],null===r[0].match(/[QqTt]/)?(h=c,u=l):(h=2*c-h,u=2*l-u),t.quadraticCurveTo(h+f,u+d,i+f,n+d),c=i,l=n;break;case"T":i=e[1],n=e[2],null===r[0].match(/[QqTt]/)?(h=c,u=l):(h=2*c-h,u=2*l-u),t.quadraticCurveTo(h+f,u+d,i+f,n+d),c=i,l=n;break;case"a":s(t,c+f,l+d,[e[1],e[2],e[3],e[4],e[5],e[6]+c+f,e[7]+l+d]),c+=e[6],l+=e[7];break;case"A":s(t,c+f,l+d,[e[1],e[2],e[3],e[4],e[5],e[6]+f,e[7]+d]),c=e[6],l=e[7];break;case"z":case"Z":c=o,l=a,t.closePath()}r=e}},_render:function(t){this._renderPathCommands(t),this._renderFill(t),this._renderStroke(t)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(t){return r(this.callSuper("toObject",["sourcePath","pathOffset"].concat(t)),{path:this.path.map(function(t){return t.slice()})})},toDatalessObject:function(t){var e=this.toObject(t);return this.sourcePath&&(e.path=this.sourcePath),delete e.sourcePath,e},toSVG:function(t){for(var e=[],i=this._createBaseSVGMarkup(),n="",r=0,o=this.path.length;r<o;r++)e.push(this.path[r].join(" "));var s=e.join(" ");return this.group&&"path-group"===this.group.type||(n=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") "),i.push("<path ",this.getSvgId(),'d="',s,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),n,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n"),t?t(i.join("")):i.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var t,e,i,n,r,o=[],s=[],l=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,h=0,u=this.path.length;h<u;h++){for(n=(t=this.path[h]).slice(1).trim(),s.length=0;i=l.exec(n);)s.push(i[0]);r=[t.charAt(0)];for(var f=0,d=s.length;f<d;f++)e=parseFloat(s[f]),isNaN(e)||r.push(e);var p=r[0],g=a[p.toLowerCase()],v=c[p]||p;if(r.length-1>g)for(var m=1,b=r.length;m<b;m+=g)o.push([p].concat(r.slice(m,m+g))),p=v;else o.push(r)}return o},_parseDimensions:function(){for(var t,r,o,s,a=[],c=[],l=null,h=0,u=0,f=0,d=0,p=0,g=0,v=0,m=this.path.length;v<m;++v){switch((t=this.path[v])[0]){case"l":f+=t[1],d+=t[2],s=[];break;case"L":f=t[1],d=t[2],s=[];break;case"h":f+=t[1],s=[];break;case"H":f=t[1],s=[];break;case"v":d+=t[1],s=[];break;case"V":d=t[1],s=[];break;case"m":h=f+=t[1],u=d+=t[2],s=[];break;case"M":h=f=t[1],u=d=t[2],s=[];break;case"c":r=f+t[5],o=d+t[6],p=f+t[3],g=d+t[4],s=e.util.getBoundsOfCurve(f,d,f+t[1],d+t[2],p,g,r,o),f=r,d=o;break;case"C":f=t[5],d=t[6],p=t[3],g=t[4],s=e.util.getBoundsOfCurve(f,d,t[1],t[2],p,g,f,d);break;case"s":r=f+t[3],o=d+t[4],null===l[0].match(/[CcSs]/)?(p=f,g=d):(p=2*f-p,g=2*d-g),s=e.util.getBoundsOfCurve(f,d,p,g,f+t[1],d+t[2],r,o),p=f+t[1],g=d+t[2],f=r,d=o;break;case"S":r=t[3],o=t[4],null===l[0].match(/[CcSs]/)?(p=f,g=d):(p=2*f-p,g=2*d-g),s=e.util.getBoundsOfCurve(f,d,p,g,t[1],t[2],r,o),f=r,d=o,p=t[1],g=t[2];break;case"q":r=f+t[3],o=d+t[4],p=f+t[1],g=d+t[2],s=e.util.getBoundsOfCurve(f,d,p,g,p,g,r,o),f=r,d=o;break;case"Q":p=t[1],g=t[2],s=e.util.getBoundsOfCurve(f,d,p,g,p,g,t[3],t[4]),f=t[3],d=t[4];break;case"t":r=f+t[1],o=d+t[2],null===l[0].match(/[QqTt]/)?(p=f,g=d):(p=2*f-p,g=2*d-g),s=e.util.getBoundsOfCurve(f,d,p,g,p,g,r,o),f=r,d=o;break;case"T":r=t[1],o=t[2],null===l[0].match(/[QqTt]/)?(p=f,g=d):(p=2*f-p,g=2*d-g),s=e.util.getBoundsOfCurve(f,d,p,g,p,g,r,o),f=r,d=o;break;case"a":s=e.util.getBoundsOfArc(f,d,t[1],t[2],t[3],t[4],t[5],t[6]+f,t[7]+d),f+=t[6],d+=t[7];break;case"A":s=e.util.getBoundsOfArc(f,d,t[1],t[2],t[3],t[4],t[5],t[6],t[7]),f=t[6],d=t[7];break;case"z":case"Z":f=h,d=u}l=t,s.forEach(function(t){a.push(t.x),c.push(t.y)}),a.push(f),c.push(d)}var b=i(a)||0,y=i(c)||0;return{left:b,top:y,width:(n(a)||0)-b,height:(n(c)||0)-y}}}),e.Path.fromObject=function(t,i){var n;if("string"!=typeof t.path)return n=new e.Path(t.path,t),i&&i(n),n;e.loadSVGFromURL(t.path,function(r){var o=t.path;n=r[0],delete t.path,e.util.object.extend(n,t),n.setSourcePath(o),i&&i(n)})},e.Path.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(["d"]),e.Path.fromElement=function(t,i,n){var o=e.parseAttributes(t,e.Path.ATTRIBUTE_NAMES);i&&i(new e.Path(o.d,r(o,n)))},e.Path.async=!0)}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.array.invoke,r=e.Object.prototype.toObject;e.PathGroup?e.warn("fabric.PathGroup is already defined"):(e.PathGroup=e.util.createClass(e.Path,{type:"path-group",fill:"",initialize:function(t,e){e=e||{},this.paths=t||[];for(var i=this.paths.length;i--;)this.paths[i].group=this;e.toBeParsed&&(this.parseDimensionsFromPaths(e),delete e.toBeParsed),this.setOptions(e),this.setCoords(),e.sourcePath&&this.setSourcePath(e.sourcePath)},parseDimensionsFromPaths:function(t){for(var i,n,r,o,s,a,c=[],l=[],h=this.paths.length;h--;){o=(r=this.paths[h]).height+r.strokeWidth,s=r.width+r.strokeWidth,i=[{x:r.left,y:r.top},{x:r.left+s,y:r.top},{x:r.left,y:r.top+o},{x:r.left+s,y:r.top+o}],a=this.paths[h].transformMatrix;for(var u=0;u<i.length;u++)n=i[u],a&&(n=e.util.transformPoint(n,a,!1)),c.push(n.x),l.push(n.y)}t.width=Math.max.apply(null,c),t.height=Math.max.apply(null,l)},render:function(t){if(this.visible){t.save(),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this.transform(t),this._setShadow(t),this.clipTo&&e.util.clipContext(this,t),t.translate(-this.width/2,-this.height/2);for(var i=0,n=this.paths.length;i<n;++i)this.paths[i].render(t,!0);this.clipTo&&t.restore(),t.restore()}},_set:function(t,e){if("fill"===t&&e&&this.isSameColor())for(var i=this.paths.length;i--;)this.paths[i]._set(t,e);return this.callSuper("_set",t,e)},toObject:function(t){return i(r.call(this,["sourcePath"].concat(t)),{paths:n(this.getObjects(),"toObject",t)})},toDatalessObject:function(t){var e=this.toObject(t);return this.sourcePath&&(e.paths=this.sourcePath),e},toSVG:function(t){var e=this.getObjects(),i=this.getPointByOrigin("left","top"),n="translate("+i.x+" "+i.y+")",r=this._createBaseSVGMarkup();r.push("<g ",this.getSvgId(),'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransformMatrix(),n,this.getSvgTransform(),'" ',">\n");for(var o=0,s=e.length;o<s;o++)r.push("\t",e[o].toSVG(t));return r.push("</g>\n"),t?t(r.join("")):r.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var t=this.getObjects()[0].get("fill")||"";return"string"==typeof t&&(t=t.toLowerCase(),this.getObjects().every(function(e){var i=e.get("fill")||"";return"string"==typeof i&&i.toLowerCase()===t}))},complexity:function(){return this.paths.reduce(function(t,e){return t+(e&&e.complexity?e.complexity():0)},0)},getObjects:function(){return this.paths}}),e.PathGroup.fromObject=function(t,i){"string"==typeof t.paths?e.loadSVGFromURL(t.paths,function(n){var r=t.paths;delete t.paths;var o=e.util.groupSVGElements(n,t,r);i(o)}):e.util.enlivenObjects(t.paths,function(n){delete t.paths,i(new e.PathGroup(n,t))})},e.PathGroup.async=!0)}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.array.min,r=e.util.array.max,o=e.util.array.invoke;if(!e.Group){var s={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};e.Group=e.util.createClass(e.Object,e.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,initialize:function(t,e,i){e=e||{},this._objects=[],i&&this.callSuper("initialize",e),this._objects=t||[];for(var n=this._objects.length;n--;)this._objects[n].group=this;this.originalState={},e.originX&&(this.originX=e.originX),e.originY&&(this.originY=e.originY),i?this._updateObjectsCoords(!0):(this._calcBounds(),this._updateObjectsCoords(),this.callSuper("initialize",e)),this.setCoords(),this.saveCoords()},_updateObjectsCoords:function(t){for(var e=this._objects.length;e--;)this._updateObjectCoords(this._objects[e],t)},_updateObjectCoords:function(t,e){if(t.__origHasControls=t.hasControls,t.hasControls=!1,!e){var i=t.getLeft(),n=t.getTop(),r=this.getCenterPoint();t.set({originalLeft:i,originalTop:n,left:i-r.x,top:n-r.y}),t.setCoords()}},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(t){return this._restoreObjectsState(),e.util.resetObjectTransform(this),t&&(this._objects.push(t),t.group=this,t._set("canvas",this.canvas)),this.forEachObject(this._setObjectActive,this),this._calcBounds(),this._updateObjectsCoords(),this},_setObjectActive:function(t){t.set("active",!0),t.group=this},removeWithUpdate:function(t){return this._restoreObjectsState(),e.util.resetObjectTransform(this),this.forEachObject(this._setObjectActive,this),this.remove(t),this._calcBounds(),this._updateObjectsCoords(),this},_onObjectAdded:function(t){t.group=this,t._set("canvas",this.canvas)},_onObjectRemoved:function(t){delete t.group,t.set("active",!1)},delegatedProperties:{fill:!0,stroke:!0,strokeWidth:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(t,e){var i=this._objects.length;if(this.delegatedProperties[t]||"canvas"===t)for(;i--;)this._objects[i].set(t,e);else for(;i--;)this._objects[i].setOnGroup(t,e);this.callSuper("_set",t,e)},toObject:function(t){return i(this.callSuper("toObject",t),{objects:o(this._objects,"toObject",t)})},render:function(t){if(this.visible){t.save(),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this.transform(t),this._setShadow(t),this.clipTo&&e.util.clipContext(this,t),this._transformDone=!0;for(var i=0,n=this._objects.length;i<n;i++)this._renderObject(this._objects[i],t);this.clipTo&&t.restore(),t.restore(),this._transformDone=!1}},_renderControls:function(t,e){this.callSuper("_renderControls",t,e);for(var i=0,n=this._objects.length;i<n;i++)this._objects[i]._renderControls(t)},_renderObject:function(t,e){if(t.visible){var i=t.hasRotatingPoint;t.hasRotatingPoint=!1,t.render(e),t.hasRotatingPoint=i}},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(t){var i=t.calcTransformMatrix(),n=e.util.qrDecompose(i),r=new e.Point(n.translateX,n.translateY);return t.scaleX=n.scaleX,t.scaleY=n.scaleY,t.skewX=n.skewX,t.skewY=n.skewY,t.angle=n.angle,t.flipX=!1,t.flipY=!1,t.setPositionByOrigin(r,"center","center"),t},_restoreObjectState:function(t){return this.realizeTransform(t),t.setCoords(),t.hasControls=t.__origHasControls,delete t.__origHasControls,t.set("active",!1),delete t.group,this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){return this._originalLeft=this.get("left"),this._originalTop=this.get("top"),this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){return this.forEachObject(function(t){t.setCoords()}),this},_calcBounds:function(t){for(var e,i,n,r=[],o=[],s=["tr","br","bl","tl"],a=0,c=this._objects.length,l=s.length;a<c;++a)for((e=this._objects[a]).setCoords(),n=0;n<l;n++)i=s[n],r.push(e.oCoords[i].x),o.push(e.oCoords[i].y);this.set(this._getBounds(r,o,t))},_getBounds:function(t,i,o){var s=e.util.invertTransform(this.getViewportTransform()),a=e.util.transformPoint(new e.Point(n(t),n(i)),s),c=e.util.transformPoint(new e.Point(r(t),r(i)),s),l={width:c.x-a.x||0,height:c.y-a.y||0};return o||(l.left=a.x||0,l.top=a.y||0,"center"===this.originX&&(l.left+=l.width/2),"right"===this.originX&&(l.left+=l.width),"center"===this.originY&&(l.top+=l.height/2),"bottom"===this.originY&&(l.top+=l.height)),l},toSVG:function(t){var e=this._createBaseSVGMarkup();e.push("<g ",this.getSvgId(),'transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'" style="',this.getSvgFilter(),'">\n');for(var i=0,n=this._objects.length;i<n;i++)e.push("\t",this._objects[i].toSVG(t));return e.push("</g>\n"),t?t(e.join("")):e.join("")},get:function(t){if(t in s){if(this[t])return this[t];for(var e=0,i=this._objects.length;e<i;e++)if(this._objects[e][t])return!0;return!1}return t in this.delegatedProperties?this._objects[0]&&this._objects[0].get(t):this[t]}}),e.Group.fromObject=function(t,i){e.util.enlivenObjects(t.objects,function(n){delete t.objects,i&&i(new e.Group(n,t,!0))})},e.Group.async=!0}}(exports),function(t){"use strict";var e=fabric.util.object.extend;if(t.fabric||(t.fabric={}),t.fabric.Image)fabric.warn("fabric.Image is already defined.");else{var i=fabric.Object.prototype.stateProperties.concat();i.push("alignX","alignY","meetOrSlice"),fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",strokeWidth:0,_lastScaleX:1,_lastScaleY:1,minimumScaleTrigger:.5,stateProperties:i,initialize:function(t,e,i){e||(e={}),this.filters=[],this.resizeFilters=[],this.callSuper("initialize",e),this._initElement(t,e,i)},getElement:function(){return this._element},setElement:function(t,e,i){var n,r;return this._element=t,this._originalElement=t,this._initConfig(i),0===this.resizeFilters.length?n=e:(r=this,n=function(){r.applyFilters(e,r.resizeFilters,r._filteredEl||r._originalElement,!0)}),0!==this.filters.length?this.applyFilters(n):n&&n(this),this},setCrossOrigin:function(t){return this.crossOrigin=t,this._element.crossOrigin=t,this},getOriginalSize:function(){var t=this.getElement();return{width:t.width,height:t.height}},_stroke:function(t){if(this.stroke&&0!==this.strokeWidth){var e=this.width/2,i=this.height/2;t.beginPath(),t.moveTo(-e,-i),t.lineTo(e,-i),t.lineTo(e,i),t.lineTo(-e,i),t.lineTo(-e,-i),t.closePath()}},_renderDashedStroke:function(t){var e=-this.width/2,i=-this.height/2,n=this.width,r=this.height;t.save(),this._setStrokeStyles(t),t.beginPath(),fabric.util.drawDashedLine(t,e,i,e+n,i,this.strokeDashArray),fabric.util.drawDashedLine(t,e+n,i,e+n,i+r,this.strokeDashArray),fabric.util.drawDashedLine(t,e+n,i+r,e,i+r,this.strokeDashArray),fabric.util.drawDashedLine(t,e,i+r,e,i,this.strokeDashArray),t.closePath(),t.restore()},toObject:function(t){var i=[],n=[],r=1,o=1;this.filters.forEach(function(t){t&&("Resize"===t.type&&(r*=t.scaleX,o*=t.scaleY),i.push(t.toObject()))}),this.resizeFilters.forEach(function(t){t&&n.push(t.toObject())});var s=e(this.callSuper("toObject",["crossOrigin","alignX","alignY","meetOrSlice"].concat(t)),{src:this.getSrc(),filters:i,resizeFilters:n});return s.width/=r,s.height/=o,s},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=-this.width/2,n=-this.height/2,r="none";if(this.group&&"path-group"===this.group.type&&(i=this.left,n=this.top),"none"!==this.alignX&&"none"!==this.alignY&&(r="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice),e.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n',"<image ",this.getSvgId(),'xlink:href="',this.getSvgSrc(!0),'" x="',i,'" y="',n,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',r,'"',"></image>\n"),this.stroke||this.strokeDashArray){var o=this.fill;this.fill=null,e.push("<rect ",'x="',i,'" y="',n,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=o}return e.push("</g>\n"),t?t(e.join("")):e.join("")},getSrc:function(t){var e=t?this._element:this._originalElement;return e?fabric.isLikelyNode?e._src:e.src:this.src||""},setSrc:function(t,e,i){fabric.util.loadImage(t,function(t){return this.setElement(t,e,i)},this,i&&i.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyFilters:function(t,e,i,n){if(e=e||this.filters,i=i||this._originalElement){var r,o,s=fabric.util.createImage(),a=this.canvas?this.canvas.getRetinaScaling():fabric.devicePixelRatio,c=this.minimumScaleTrigger/a,l=this;if(0===e.length)return this._element=i,t&&t(this),i;var h=fabric.util.createCanvasElement();return h.width=i.width,h.height=i.height,h.getContext("2d").drawImage(i,0,0,i.width,i.height),e.forEach(function(t){t&&(n?(r=l.scaleX<c?l.scaleX:1,o=l.scaleY<c?l.scaleY:1,r*a<1&&(r*=a),o*a<1&&(o*=a)):(r=t.scaleX,o=t.scaleY),t.applyTo(h,r,o),n||"Resize"!==t.type||(l.width*=t.scaleX,l.height*=t.scaleY))}),s.width=h.width,s.height=h.height,fabric.isLikelyNode?(s.src=h.toBuffer(void 0,fabric.Image.pngCompression),l._element=s,!n&&(l._filteredEl=s),t&&t(l)):(s.onload=function(){l._element=s,!n&&(l._filteredEl=s),t&&t(l),s.onload=h=null},s.src=h.toDataURL("image/png")),h}},_render:function(t,e){var i,n,r,o=this._findMargins();i=e?this.left:-this.width/2,n=e?this.top:-this.height/2,"slice"===this.meetOrSlice&&(t.beginPath(),t.rect(i,n,this.width,this.height),t.clip()),!1===this.isMoving&&this.resizeFilters.length&&this._needsResize()?(this._lastScaleX=this.scaleX,this._lastScaleY=this.scaleY,r=this.applyFilters(null,this.resizeFilters,this._filteredEl||this._originalElement,!0)):r=this._element,r&&t.drawImage(r,i+o.marginX,n+o.marginY,o.width,o.height),this._stroke(t),this._renderStroke(t)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var t,e,i=this.width,n=this.height,r=0,o=0;return"none"===this.alignX&&"none"===this.alignY||(t=[this.width/this._element.width,this.height/this._element.height],e="meet"===this.meetOrSlice?Math.min.apply(null,t):Math.max.apply(null,t),i=this._element.width*e,n=this._element.height*e,"Mid"===this.alignX&&(r=(this.width-i)/2),"Max"===this.alignX&&(r=this.width-i),"Mid"===this.alignY&&(o=(this.height-n)/2),"Max"===this.alignY&&(o=this.height-n)),{width:i,height:n,marginX:r,marginY:o}},_resetWidthHeight:function(){var t=this.getElement();this.set("width",t.width),this.set("height",t.height)},_initElement:function(t,e,i){this.setElement(fabric.util.getById(t),i,e),fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(t){t||(t={}),this.setOptions(t),this._setWidthHeight(t),this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(t,e){t&&t.length?fabric.util.enlivenObjects(t,function(t){e&&e(t)},"fabric.Image.filters"):e&&e()},_setWidthHeight:function(t){this.width="width"in t?t.width:this.getElement()&&this.getElement().width||0,this.height="height"in t?t.height:this.getElement()&&this.getElement().height||0},complexity:function(){return 1}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(t,e){fabric.util.loadImage(t.src,function(i){fabric.Image.prototype._initFilters.call(t,t.filters,function(n){t.filters=n||[],fabric.Image.prototype._initFilters.call(t,t.resizeFilters,function(n){return t.resizeFilters=n||[],new fabric.Image(i,t,e)})})},null,t.crossOrigin)},fabric.Image.fromURL=function(t,e,i){fabric.util.loadImage(t,function(t){e&&e(new fabric.Image(t,i))},null,i&&i.crossOrigin)},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href".split(" ")),fabric.Image.fromElement=function(t,i,n){var r,o=fabric.parseAttributes(t,fabric.Image.ATTRIBUTE_NAMES);o.preserveAspectRatio&&(r=fabric.util.parsePreserveAspectRatioAttribute(o.preserveAspectRatio),e(o,r)),fabric.Image.fromURL(o["xlink:href"],i,e(n?fabric.util.object.clone(n):{},o))},fabric.Image.async=!0,fabric.Image.pngCompression=1}}(exports),fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var t=this.getAngle()%360;return t>0?90*Math.round((t-1)/90):90*Math.round(t/90)},straighten:function(){return this.setAngle(this._getAngleValueForStraighten()),this},fxStraighten:function(t){var e=function(){},i=(t=t||{}).onComplete||e,n=t.onChange||e,r=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(t){r.setAngle(t),n()},onComplete:function(){r.setCoords(),i()},onStart:function(){r.set("active",!1)}}),this}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(t){return t.straighten(),this.renderAll(),this},fxStraightenObject:function(t){return t.fxStraighten({onChange:this.renderAll.bind(this)}),this}}),fabric.Image.filters=fabric.Image.filters||{},fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",initialize:function(t){t&&this.setOptions(t)},setOptions:function(t){for(var e in t)this[e]=t[e]},toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}}),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.Brightness=r(n.BaseFilter,{type:"Brightness",initialize:function(t){t=t||{},this.brightness=t.brightness||0},applyTo:function(t){for(var e=t.getContext("2d"),i=e.getImageData(0,0,t.width,t.height),n=i.data,r=this.brightness,o=0,s=n.length;o<s;o+=4)n[o]+=r,n[o+1]+=r,n[o+2]+=r;e.putImageData(i,0,0)},toObject:function(){return i(this.callSuper("toObject"),{brightness:this.brightness})}}),e.Image.filters.Brightness.fromObject=function(t){return new e.Image.filters.Brightness(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.Convolute=r(n.BaseFilter,{type:"Convolute",initialize:function(t){t=t||{},this.opaque=t.opaque,this.matrix=t.matrix||[0,0,0,0,1,0,0,0,0]},applyTo:function(t){for(var e,i,n,r,o,s,a,c,l,h=this.matrix,u=t.getContext("2d"),f=u.getImageData(0,0,t.width,t.height),d=Math.round(Math.sqrt(h.length)),p=Math.floor(d/2),g=f.data,v=f.width,m=f.height,b=u.createImageData(v,m),y=b.data,_=this.opaque?1:0,x=0;x<m;x++)for(var w=0;w<v;w++){o=4*(x*v+w),e=0,i=0,n=0,r=0;for(var S=0;S<d;S++)for(var C=0;C<d;C++)s=w+C-p,(a=x+S-p)<0||a>m||s<0||s>v||(c=4*(a*v+s),l=h[S*d+C],e+=g[c]*l,i+=g[c+1]*l,n+=g[c+2]*l,r+=g[c+3]*l);y[o]=e,y[o+1]=i,y[o+2]=n,y[o+3]=r+_*(255-r)}u.putImageData(b,0,0)},toObject:function(){return i(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),e.Image.filters.Convolute.fromObject=function(t){return new e.Image.filters.Convolute(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.GradientTransparency=r(n.BaseFilter,{type:"GradientTransparency",initialize:function(t){t=t||{},this.threshold=t.threshold||100},applyTo:function(t){for(var e=t.getContext("2d"),i=e.getImageData(0,0,t.width,t.height),n=i.data,r=this.threshold,o=n.length,s=0,a=n.length;s<a;s+=4)n[s+3]=r+255*(o-s)/o;e.putImageData(i,0,0)},toObject:function(){return i(this.callSuper("toObject"),{threshold:this.threshold})}}),e.Image.filters.GradientTransparency.fromObject=function(t){return new e.Image.filters.GradientTransparency(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Grayscale=n(i.BaseFilter,{type:"Grayscale",applyTo:function(t){for(var e,i=t.getContext("2d"),n=i.getImageData(0,0,t.width,t.height),r=n.data,o=n.width*n.height*4,s=0;s<o;)e=(r[s]+r[s+1]+r[s+2])/3,r[s]=e,r[s+1]=e,r[s+2]=e,s+=4;i.putImageData(n,0,0)}}),e.Image.filters.Grayscale.fromObject=function(){return new e.Image.filters.Grayscale}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Invert=n(i.BaseFilter,{type:"Invert",applyTo:function(t){var e,i=t.getContext("2d"),n=i.getImageData(0,0,t.width,t.height),r=n.data,o=r.length;for(e=0;e<o;e+=4)r[e]=255-r[e],r[e+1]=255-r[e+1],r[e+2]=255-r[e+2];i.putImageData(n,0,0)}}),e.Image.filters.Invert.fromObject=function(){return new e.Image.filters.Invert}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.Mask=r(n.BaseFilter,{type:"Mask",initialize:function(t){t=t||{},this.mask=t.mask,this.channel=[0,1,2,3].indexOf(t.channel)>-1?t.channel:0},applyTo:function(t){if(this.mask){var i,n=t.getContext("2d"),r=n.getImageData(0,0,t.width,t.height),o=r.data,s=this.mask.getElement(),a=e.util.createCanvasElement(),c=this.channel,l=r.width*r.height*4;a.width=t.width,a.height=t.height,a.getContext("2d").drawImage(s,0,0,t.width,t.height);var h=a.getContext("2d").getImageData(0,0,t.width,t.height).data;for(i=0;i<l;i+=4)o[i+3]=h[i+c];n.putImageData(r,0,0)}},toObject:function(){return i(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}}),e.Image.filters.Mask.fromObject=function(t,i){e.util.loadImage(t.mask.src,function(n){t.mask=new e.Image(n,t.mask),i&&i(new e.Image.filters.Mask(t))})},e.Image.filters.Mask.async=!0}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.Noise=r(n.BaseFilter,{type:"Noise",initialize:function(t){t=t||{},this.noise=t.noise||0},applyTo:function(t){for(var e,i=t.getContext("2d"),n=i.getImageData(0,0,t.width,t.height),r=n.data,o=this.noise,s=0,a=r.length;s<a;s+=4)e=(.5-Math.random())*o,r[s]+=e,r[s+1]+=e,r[s+2]+=e;i.putImageData(n,0,0)},toObject:function(){return i(this.callSuper("toObject"),{noise:this.noise})}}),e.Image.filters.Noise.fromObject=function(t){return new e.Image.filters.Noise(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.Pixelate=r(n.BaseFilter,{type:"Pixelate",initialize:function(t){t=t||{},this.blocksize=t.blocksize||4},applyTo:function(t){var e,i,n,r,o,s,a,c=t.getContext("2d"),l=c.getImageData(0,0,t.width,t.height),h=l.data,u=l.height,f=l.width;for(i=0;i<u;i+=this.blocksize)for(n=0;n<f;n+=this.blocksize){r=h[e=4*i*f+4*n],o=h[e+1],s=h[e+2],a=h[e+3];for(var d=i,p=i+this.blocksize;d<p;d++)for(var g=n,v=n+this.blocksize;g<v;g++)h[e=4*d*f+4*g]=r,h[e+1]=o,h[e+2]=s,h[e+3]=a}c.putImageData(l,0,0)},toObject:function(){return i(this.callSuper("toObject"),{blocksize:this.blocksize})}}),e.Image.filters.Pixelate.fromObject=function(t){return new e.Image.filters.Pixelate(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.RemoveWhite=r(n.BaseFilter,{type:"RemoveWhite",initialize:function(t){t=t||{},this.threshold=t.threshold||30,this.distance=t.distance||20},applyTo:function(t){for(var e,i,n,r=t.getContext("2d"),o=r.getImageData(0,0,t.width,t.height),s=o.data,a=this.threshold,c=this.distance,l=255-a,h=Math.abs,u=0,f=s.length;u<f;u+=4)e=s[u],i=s[u+1],n=s[u+2],e>l&&i>l&&n>l&&h(e-i)<c&&h(e-n)<c&&h(i-n)<c&&(s[u+3]=0);r.putImageData(o,0,0)},toObject:function(){return i(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}}),e.Image.filters.RemoveWhite.fromObject=function(t){return new e.Image.filters.RemoveWhite(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Sepia=n(i.BaseFilter,{type:"Sepia",applyTo:function(t){var e,i,n=t.getContext("2d"),r=n.getImageData(0,0,t.width,t.height),o=r.data,s=o.length;for(e=0;e<s;e+=4)i=.3*o[e]+.59*o[e+1]+.11*o[e+2],o[e]=i+100,o[e+1]=i+50,o[e+2]=i+255;n.putImageData(r,0,0)}}),e.Image.filters.Sepia.fromObject=function(){return new e.Image.filters.Sepia}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Sepia2=n(i.BaseFilter,{type:"Sepia2",applyTo:function(t){var e,i,n,r,o=t.getContext("2d"),s=o.getImageData(0,0,t.width,t.height),a=s.data,c=a.length;for(e=0;e<c;e+=4)i=a[e],n=a[e+1],r=a[e+2],a[e]=(.393*i+.769*n+.189*r)/1.351,a[e+1]=(.349*i+.686*n+.168*r)/1.203,a[e+2]=(.272*i+.534*n+.131*r)/2.14;o.putImageData(s,0,0)}}),e.Image.filters.Sepia2.fromObject=function(){return new e.Image.filters.Sepia2}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.Tint=r(n.BaseFilter,{type:"Tint",initialize:function(t){t=t||{},this.color=t.color||"#000000",this.opacity=void 0!==t.opacity?t.opacity:new e.Color(this.color).getAlpha()},applyTo:function(t){var i,n,r,o,s,a,c,l,h,u=t.getContext("2d"),f=u.getImageData(0,0,t.width,t.height),d=f.data,p=d.length;for(n=(h=new e.Color(this.color).getSource())[0]*this.opacity,r=h[1]*this.opacity,o=h[2]*this.opacity,l=1-this.opacity,i=0;i<p;i+=4)s=d[i],a=d[i+1],c=d[i+2],d[i]=n+s*l,d[i+1]=r+a*l,d[i+2]=o+c*l;u.putImageData(f,0,0)},toObject:function(){return i(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}}),e.Image.filters.Tint.fromObject=function(t){return new e.Image.filters.Tint(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.Multiply=r(n.BaseFilter,{type:"Multiply",initialize:function(t){t=t||{},this.color=t.color||"#000000"},applyTo:function(t){var i,n,r=t.getContext("2d"),o=r.getImageData(0,0,t.width,t.height),s=o.data,a=s.length;for(n=new e.Color(this.color).getSource(),i=0;i<a;i+=4)s[i]*=n[0]/255,s[i+1]*=n[1]/255,s[i+2]*=n[2]/255;r.putImageData(o,0,0)},toObject:function(){return i(this.callSuper("toObject"),{color:this.color})}}),e.Image.filters.Multiply.fromObject=function(t){return new e.Image.filters.Multiply(t)}}(exports),function(t){"use strict";var e=t.fabric,i=e.Image.filters,n=e.util.createClass;i.Blend=n(i.BaseFilter,{type:"Blend",initialize:function(t){t=t||{},this.color=t.color||"#000",this.image=t.image||!1,this.mode=t.mode||"multiply",this.alpha=t.alpha||1},applyTo:function(t){var i,n,r,o,s,a,c,l,h,u,f=t.getContext("2d"),d=f.getImageData(0,0,t.width,t.height),p=d.data,g=!1;if(this.image){g=!0;var v=e.util.createCanvasElement();v.width=this.image.width,v.height=this.image.height;var m=new e.StaticCanvas(v);m.add(this.image),u=m.getContext("2d").getImageData(0,0,m.width,m.height).data}else i=(u=new e.Color(this.color).getSource())[0]*this.alpha,n=u[1]*this.alpha,r=u[2]*this.alpha;for(var b=0,y=p.length;b<y;b+=4)switch(o=p[b],s=p[b+1],a=p[b+2],g&&(i=u[b]*this.alpha,n=u[b+1]*this.alpha,r=u[b+2]*this.alpha),this.mode){case"multiply":p[b]=o*i/255,p[b+1]=s*n/255,p[b+2]=a*r/255;break;case"screen":p[b]=1-(1-o)*(1-i),p[b+1]=1-(1-s)*(1-n),p[b+2]=1-(1-a)*(1-r);break;case"add":p[b]=Math.min(255,o+i),p[b+1]=Math.min(255,s+n),p[b+2]=Math.min(255,a+r);break;case"diff":case"difference":p[b]=Math.abs(o-i),p[b+1]=Math.abs(s-n),p[b+2]=Math.abs(a-r);break;case"subtract":c=o-i,l=s-n,h=a-r,p[b]=c<0?0:c,p[b+1]=l<0?0:l,p[b+2]=h<0?0:h;break;case"darken":p[b]=Math.min(o,i),p[b+1]=Math.min(s,n),p[b+2]=Math.min(a,r);break;case"lighten":p[b]=Math.max(o,i),p[b+1]=Math.max(s,n),p[b+2]=Math.max(a,r)}f.putImageData(d,0,0)},toObject:function(){return{color:this.color,image:this.image,mode:this.mode,alpha:this.alpha}}}),e.Image.filters.Blend.fromObject=function(t){return new e.Image.filters.Blend(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=Math.pow,n=Math.floor,r=Math.sqrt,o=Math.abs,s=Math.max,a=Math.round,c=Math.sin,l=Math.ceil,h=e.Image.filters,u=e.util.createClass;h.Resize=u(h.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,applyTo:function(t,e,i){if(1!==e||1!==i){this.rcpScaleX=1/e,this.rcpScaleY=1/i;var n,r=t.width,o=t.height,s=a(r*e),c=a(o*i);"sliceHack"===this.resizeType&&(n=this.sliceByTwo(t,r,o,s,c)),"hermite"===this.resizeType&&(n=this.hermiteFastResize(t,r,o,s,c)),"bilinear"===this.resizeType&&(n=this.bilinearFiltering(t,r,o,s,c)),"lanczos"===this.resizeType&&(n=this.lanczosResize(t,r,o,s,c)),t.width=s,t.height=c,t.getContext("2d").putImageData(n,0,0)}},sliceByTwo:function(t,i,r,o,a){var c,l=t.getContext("2d"),h=.5,u=.5,f=1,d=1,p=!1,g=!1,v=i,m=r,b=e.util.createCanvasElement(),y=b.getContext("2d");for(o=n(o),a=n(a),b.width=s(o,i),b.height=s(a,r),o>i&&(h=2,f=-1),a>r&&(u=2,d=-1),c=l.getImageData(0,0,i,r),t.width=s(o,i),t.height=s(a,r),l.putImageData(c,0,0);!p||!g;)i=v,r=m,o*f<n(v*h*f)?v=n(v*h):(v=o,p=!0),a*d<n(m*u*d)?m=n(m*u):(m=a,g=!0),c=l.getImageData(0,0,i,r),y.putImageData(c,0,0),l.clearRect(0,0,v,m),l.drawImage(b,0,0,i,r,0,0,v,m);return l.getImageData(0,0,o,a)},lanczosResize:function(t,e,s,a,h){var u=t.getContext("2d"),f=u.getImageData(0,0,e,s),d=u.getImageData(0,0,a,h),p=f.data,g=d.data,v=function(t){return function(e){if(e>t)return 0;if(e*=Math.PI,o(e)<1e-16)return 1;var i=e/t;return c(e)*c(i)/e/i}}(this.lanczosLobes),m=this.rcpScaleX,b=this.rcpScaleY,y=2/this.rcpScaleX,_=2/this.rcpScaleY,x=l(m*this.lanczosLobes/2),w=l(b*this.lanczosLobes/2),S={},C={},O={};return function t(c){var l,u,f,k,T,E,j,M,P,A,I;for(C.x=(c+.5)*m,O.x=n(C.x),l=0;l<h;l++){for(C.y=(l+.5)*b,O.y=n(C.y),T=0,E=0,j=0,M=0,P=0,u=O.x-x;u<=O.x+x;u++)if(!(u<0||u>=e)){A=n(1e3*o(u-C.x)),S[A]||(S[A]={});for(var D=O.y-w;D<=O.y+w;D++)D<0||D>=s||(I=n(1e3*o(D-C.y)),S[A][I]||(S[A][I]=v(r(i(A*y,2)+i(I*_,2))/1e3)),(f=S[A][I])>0&&(T+=f,E+=f*p[k=4*(D*e+u)],j+=f*p[k+1],M+=f*p[k+2],P+=f*p[k+3]))}g[k=4*(l*a+c)]=E/T,g[k+1]=j/T,g[k+2]=M/T,g[k+3]=P/T}return++c<a?t(c):d}(0)},bilinearFiltering:function(t,e,i,r,o){var s,a,c,l,h,u,f,d,p,g=0,v=this.rcpScaleX,m=this.rcpScaleY,b=t.getContext("2d"),y=4*(e-1),_=b.getImageData(0,0,e,i).data,x=b.getImageData(0,0,r,o),w=x.data;for(c=0;c<o;c++)for(l=0;l<r;l++)for(h=v*l-(s=n(v*l)),u=m*c-(a=n(m*c)),p=4*(a*e+s),f=0;f<4;f++)d=_[p+f]*(1-h)*(1-u)+_[p+4+f]*h*(1-u)+_[p+y+f]*u*(1-h)+_[p+y+4+f]*h*u,w[g++]=d;return x},hermiteFastResize:function(t,e,i,s,a){for(var c=this.rcpScaleX,h=this.rcpScaleY,u=l(c/2),f=l(h/2),d=t.getContext("2d"),p=d.getImageData(0,0,e,i).data,g=d.getImageData(0,0,s,a),v=g.data,m=0;m<a;m++)for(var b=0;b<s;b++){for(var y=4*(b+m*s),_=0,x=0,w=0,S=0,C=0,O=0,k=0,T=(m+.5)*h,E=n(m*h);E<(m+1)*h;E++)for(var j=o(T-(E+.5))/f,M=(b+.5)*c,P=j*j,A=n(b*c);A<(b+1)*c;A++){var I=o(M-(A+.5))/u,D=r(P+I*I);D>1&&D<-1||(_=2*D*D*D-3*D*D+1)>0&&(k+=_*p[(I=4*(A+E*e))+3],w+=_,p[I+3]<255&&(_=_*p[I+3]/250),S+=_*p[I],C+=_*p[I+1],O+=_*p[I+2],x+=_)}v[y]=S/x,v[y+1]=C/x,v[y+2]=O/x,v[y+3]=k/w}return g},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),e.Image.filters.Resize.fromObject=function(t){return new e.Image.filters.Resize(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.ColorMatrix=r(n.BaseFilter,{type:"ColorMatrix",initialize:function(t){t||(t={}),this.matrix=t.matrix||[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]},applyTo:function(t){var e,i,n,r,o,s=t.getContext("2d"),a=s.getImageData(0,0,t.width,t.height),c=a.data,l=c.length,h=this.matrix;for(e=0;e<l;e+=4)i=c[e],n=c[e+1],r=c[e+2],o=c[e+3],c[e]=i*h[0]+n*h[1]+r*h[2]+o*h[3]+h[4],c[e+1]=i*h[5]+n*h[6]+r*h[7]+o*h[8]+h[9],c[e+2]=i*h[10]+n*h[11]+r*h[12]+o*h[13]+h[14],c[e+3]=i*h[15]+n*h[16]+r*h[17]+o*h[18]+h[19];s.putImageData(a,0,0)},toObject:function(){return i(this.callSuper("toObject"),{type:this.type,matrix:this.matrix})}}),e.Image.filters.ColorMatrix.fromObject=function(t){return new e.Image.filters.ColorMatrix(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.Contrast=r(n.BaseFilter,{type:"Contrast",initialize:function(t){t=t||{},this.contrast=t.contrast||0},applyTo:function(t){for(var e=t.getContext("2d"),i=e.getImageData(0,0,t.width,t.height),n=i.data,r=259*(this.contrast+255)/(255*(259-this.contrast)),o=0,s=n.length;o<s;o+=4)n[o]=r*(n[o]-128)+128,n[o+1]=r*(n[o+1]-128)+128,n[o+2]=r*(n[o+2]-128)+128;e.putImageData(i,0,0)},toObject:function(){return i(this.callSuper("toObject"),{contrast:this.contrast})}}),e.Image.filters.Contrast.fromObject=function(t){return new e.Image.filters.Contrast(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.Saturate=r(n.BaseFilter,{type:"Saturate",initialize:function(t){t=t||{},this.saturate=t.saturate||0},applyTo:function(t){for(var e,i=t.getContext("2d"),n=i.getImageData(0,0,t.width,t.height),r=n.data,o=.01*-this.saturate,s=0,a=r.length;s<a;s+=4)e=Math.max(r[s],r[s+1],r[s+2]),r[s]+=e!==r[s]?(e-r[s])*o:0,r[s+1]+=e!==r[s+1]?(e-r[s+1])*o:0,r[s+2]+=e!==r[s+2]?(e-r[s+2])*o:0;i.putImageData(n,0,0)},toObject:function(){return i(this.callSuper("toObject"),{saturate:this.saturate})}}),e.Image.filters.Saturate.fromObject=function(t){return new e.Image.filters.Saturate(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.clone,n=e.util.toFixed,r=e.Object.NUM_FRACTION_DIGITS;if(e.Text)e.warn("fabric.Text is already defined");else{var o=e.Object.prototype.stateProperties.concat();o.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor"),e.Text=e.util.createClass(e.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,fontStyle:!0,lineHeight:!0,text:!0,charSpacing:!0,textAlign:!0,strokeWidth:!1},_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.16,textBackgroundColor:"",stateProperties:o,stroke:null,shadow:null,_fontSizeFraction:.25,_fontSizeMult:1.13,charSpacing:0,initialize:function(t,e){e=e||{},this.text=t,this.__skipDimension=!0,this.setOptions(e),this.__skipDimension=!1,this._initDimensions()},_initDimensions:function(t){this.__skipDimension||(t||(t=e.util.createCanvasElement().getContext("2d"),this._setTextStyles(t)),this._textLines=this._splitTextIntoLines(),this._clearCache(),this.width=this._getTextWidth(t)||this.cursorWidth||2,this.height=this._getTextHeight(t))},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(t){this.clipTo&&e.util.clipContext(this,t),this._setOpacity(t),this._setShadow(t),this._setupCompositeOperation(t),this._renderTextBackground(t),this._setStrokeStyles(t),this._setFillStyles(t),this._renderText(t),this._renderTextDecoration(t),this.clipTo&&t.restore()},_renderText:function(t){this._renderTextFill(t),this._renderTextStroke(t)},_setTextStyles:function(t){t.textBaseline="alphabetic",t.font=this._getFontDeclaration()},_getTextHeight:function(){return this._getHeightOfSingleLine()+(this._textLines.length-1)*this._getHeightOfLine()},_getTextWidth:function(t){for(var e=this._getLineWidth(t,0),i=1,n=this._textLines.length;i<n;i++){var r=this._getLineWidth(t,i);r>e&&(e=r)}return e},_getNonTransformedDimensions:function(){return{x:this.width,y:this.height}},_renderChars:function(t,e,i,n,r){var o,s,a=t.slice(0,-4);if(this[a].toLive){var c=-this.width/2+this[a].offsetX||0,l=-this.height/2+this[a].offsetY||0;e.save(),e.translate(c,l),n-=c,r-=l}if(0!==this.charSpacing)for(var h=this._getWidthOfCharSpacing(),u=0,f=(i=i.split("")).length;u<f;u++)o=i[u],s=e.measureText(o).width+h,e[t](o,n,r),n+=s>0?s:0;else e[t](i,n,r);this[a].toLive&&e.restore()},_renderTextLine:function(t,e,i,n,r,o){r-=this.fontSize*this._fontSizeFraction;var s=this._getLineWidth(e,o);if("justify"!==this.textAlign||this.width<s)this._renderChars(t,e,i,n,r,o);else for(var a,c=i.split(/\s+/),l=0,h=this._getWidthOfWords(e,c.join(" "),o,0),u=this.width-h,f=c.length-1,d=f>0?u/f:0,p=0,g=0,v=c.length;g<v;g++){for(;" "===i[l]&&l<i.length;)l++;a=c[g],this._renderChars(t,e,a,n+p,r,o,l),p+=this._getWidthOfWords(e,a,o,l)+d,l+=a.length}},_getWidthOfWords:function(t,e){var i=t.measureText(e).width;return 0!==this.charSpacing&&(i+=e.split("").length*this._getWidthOfCharSpacing()),i>0?i:0},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},isEmptyStyles:function(){return!0},_renderTextCommon:function(t,e){for(var i=0,n=this._getLeftOffset(),r=this._getTopOffset(),o=0,s=this._textLines.length;o<s;o++){var a=this._getHeightOfLine(t,o),c=a/this.lineHeight,l=this._getLineWidth(t,o),h=this._getLineLeftOffset(l);this._renderTextLine(e,t,this._textLines[o],n+h,r+i+c,o),i+=a}},_renderTextFill:function(t){!this.fill&&this.isEmptyStyles()||this._renderTextCommon(t,"fillText")},_renderTextStroke:function(t){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokedashArray),t.beginPath(),this._renderTextCommon(t,"strokeText"),t.closePath(),t.restore())},_getHeightOfLine:function(){return this._getHeightOfSingleLine()*this.lineHeight},_getHeightOfSingleLine:function(){return this.fontSize*this._fontSizeMult},_renderTextBackground:function(t){this._renderBackground(t),this._renderTextLinesBackground(t)},_renderTextLinesBackground:function(t){if(this.textBackgroundColor){var e,i,n,r=0;t.fillStyle=this.textBackgroundColor;for(var o=0,s=this._textLines.length;o<s;o++)e=this._getHeightOfLine(t,o),(i=this._getLineWidth(t,o))>0&&(n=this._getLineLeftOffset(i),t.fillRect(this._getLeftOffset()+n,this._getTopOffset()+r,i,e/this.lineHeight)),r+=e;this._removeShadow(t)}},_getLineLeftOffset:function(t){return"center"===this.textAlign?(this.width-t)/2:"right"===this.textAlign?this.width-t:0},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[]},_shouldClearCache:function(){var t=!1;if(this._forceClearCache)return this._forceClearCache=!1,!0;for(var e in this._dimensionAffectingProps)this["__"+e]!==this[e]&&(this["__"+e]=this[e],t=!0);return t},_getLineWidth:function(t,e){if(this.__lineWidths[e])return-1===this.__lineWidths[e]?this.width:this.__lineWidths[e];var i,n=this._textLines[e];return i=""===n?0:this._measureLine(t,e),this.__lineWidths[e]=i,i&&"justify"===this.textAlign&&n.split(/\s+/).length>1&&(this.__lineWidths[e]=-1),i},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0},_measureLine:function(t,e){var i,n=this._textLines[e],r=t.measureText(n).width,o=0;return 0!==this.charSpacing&&(o=(n.split("").length-1)*this._getWidthOfCharSpacing()),(i=r+o)>0?i:0},_renderTextDecoration:function(t){if(this.textDecoration){var e=this.height/2,i=this,n=[];this.textDecoration.indexOf("underline")>-1&&n.push(.85),this.textDecoration.indexOf("line-through")>-1&&n.push(.43),this.textDecoration.indexOf("overline")>-1&&n.push(-.12),n.length>0&&function(n){var r,o,s,a,c,l,h,u=0;for(r=0,o=i._textLines.length;r<o;r++){for(c=i._getLineWidth(t,r),l=i._getLineLeftOffset(c),h=i._getHeightOfLine(t,r),s=0,a=n.length;s<a;s++)t.fillRect(i._getLeftOffset()+l,u+(i._fontSizeMult-1+n[s])*i.fontSize-e,c,i.fontSize/15);u+=h}}(n)}},_getFontDeclaration:function(){return[e.isLikelyNode?this.fontWeight:this.fontStyle,e.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",e.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(t,e){this.visible&&(t.save(),this._setTextStyles(t),this._shouldClearCache()&&this._initDimensions(t),this.drawSelectionBackground(t),e||this.transform(t),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this.group&&"path-group"===this.group.type&&t.translate(this.left,this.top),this._render(t),t.restore())},_splitTextIntoLines:function(){return this.text.split(this._reNewline)},toObject:function(t){var e=["text","fontSize","fontWeight","fontFamily","fontStyle","lineHeight","textDecoration","textAlign","textBackgroundColor","charSpacing"].concat(t);return this.callSuper("toObject",e)},toSVG:function(t){this.ctx||(this.ctx=e.util.createCanvasElement().getContext("2d"));var i=this._createBaseSVGMarkup(),n=this._getSVGLeftTopOffsets(this.ctx),r=this._getSVGTextAndBg(n.textTop,n.textLeft);return this._wrapSVGTextAndBg(i,r),t?t(i.join("")):i.join("")},_getSVGLeftTopOffsets:function(t){var e=this._getHeightOfLine(t,0);return{textLeft:-this.width/2+(this.group&&"path-group"===this.group.type?this.left:0),textTop:0+(this.group&&"path-group"===this.group.type?-this.top:0),lineTop:e}},_wrapSVGTextAndBg:function(t,e){var i=this.getSvgFilter(),n=""===i?"":' style="'+i+'"';t.push("\t<g ",this.getSvgId(),'transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"',n,">\n",e.textBgRects.join(""),"\t\t<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(!0),'" >\n',e.textSpans.join(""),"\t\t</text>\n","\t</g>\n")},_getSVGTextAndBg:function(t,e){var i=[],n=[],r=0;this._setSVGBg(n);for(var o=0,s=this._textLines.length;o<s;o++)this.textBackgroundColor&&this._setSVGTextLineBg(n,o,e,t,r),this._setSVGTextLineText(o,i,r,e,t,n),r+=this._getHeightOfLine(this.ctx,o);return{textSpans:i,textBgRects:n}},_setSVGTextLineText:function(t,i,o,s,a){var c=this.fontSize*(this._fontSizeMult-this._fontSizeFraction)-a+o-this.height/2;"justify"!==this.textAlign?i.push('\t\t\t<tspan x="',n(s+this._getLineLeftOffset(this._getLineWidth(this.ctx,t)),r),'" ','y="',n(c,r),'" ',this._getFillAttributes(this.fill),">",e.util.string.escapeXml(this._textLines[t]),"</tspan>\n"):this._setSVGTextLineJustifed(t,i,c,s)},_setSVGTextLineJustifed:function(t,i,o,s){var a=e.util.createCanvasElement().getContext("2d");this._setTextStyles(a);var c,l,h=this._textLines[t].split(/\s+/),u=this._getWidthOfWords(a,h.join("")),f=this.width-u,d=h.length-1,p=d>0?f/d:0,g=this._getFillAttributes(this.fill);for(s+=this._getLineLeftOffset(this._getLineWidth(a,t)),t=0,l=h.length;t<l;t++)c=h[t],i.push('\t\t\t<tspan x="',n(s,r),'" ','y="',n(o,r),'" ',g,">",e.util.string.escapeXml(c),"</tspan>\n"),s+=this._getWidthOfWords(a,c)+p},_setSVGTextLineBg:function(t,e,i,o,s){t.push("\t\t<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',n(i+this._getLineLeftOffset(this._getLineWidth(this.ctx,e)),r),'" y="',n(s-this.height/2,r),'" width="',n(this._getLineWidth(this.ctx,e),r),'" height="',n(this._getHeightOfLine(this.ctx,e)/this.lineHeight,r),'"></rect>\n')},_setSVGBg:function(t){this.backgroundColor&&t.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',n(-this.width/2,r),'" y="',n(-this.height/2,r),'" width="',n(this.width,r),'" height="',n(this.height,r),'"></rect>\n')},_getFillAttributes:function(t){var i=t&&"string"==typeof t?new e.Color(t):"";return i&&i.getSource()&&1!==i.getAlpha()?'opacity="'+i.getAlpha()+'" fill="'+i.setAlpha(1).toRgb()+'"':'fill="'+t+'"'},_set:function(t,e){this.callSuper("_set",t,e),t in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),e.Text.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" ")),e.Text.DEFAULT_SVG_FONT_SIZE=16,e.Text.fromElement=function(t,i){if(!t)return null;var n=e.parseAttributes(t,e.Text.ATTRIBUTE_NAMES);(i=e.util.object.extend(i?e.util.object.clone(i):{},n)).top=i.top||0,i.left=i.left||0,"dx"in n&&(i.left+=n.dx),"dy"in n&&(i.top+=n.dy),"fontSize"in i||(i.fontSize=e.Text.DEFAULT_SVG_FONT_SIZE),i.originX||(i.originX="left");var r="";"textContent"in t?r=t.textContent:"firstChild"in t&&null!==t.firstChild&&"data"in t.firstChild&&null!==t.firstChild.data&&(r=t.firstChild.data),r=r.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var o=new e.Text(r,i),s=o.getHeight()/o.height,a=((o.height+o.strokeWidth)*o.lineHeight-o.height)*s,c=o.getHeight()+a,l=0;return"left"===o.originX&&(l=o.getWidth()/2),"right"===o.originX&&(l=-o.getWidth()/2),o.set({left:o.getLeft()+l,top:o.getTop()-c/2+o.fontSize*(.18+o._fontSizeFraction)/o.lineHeight}),o},e.Text.fromObject=function(t,n){var r=new e.Text(t.text,i(t));return n&&n(r),r},e.util.createAccessors(e.Text)}}(exports),function(){var t=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,styles:null,caching:!0,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],initialize:function(t,e){this.styles=e&&e.styles||{},this.callSuper("initialize",t,e),this.initBehavior()},_clearCache:function(){this.callSuper("_clearCache"),this.__widthOfSpace=[]},isEmptyStyles:function(){if(!this.styles)return!0;var t=this.styles;for(var e in t)for(var i in t[e])for(var n in t[e][i])return!1;return!0},setSelectionStart:function(t){t=Math.max(t,0),this._updateAndFire("selectionStart",t)},setSelectionEnd:function(t){t=Math.min(t,this.text.length),this._updateAndFire("selectionEnd",t)},_updateAndFire:function(t,e){this[t]!==e&&(this._fireSelectionChanged(),this[t]=e),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},getSelectionStyles:function(t,e){if(2===arguments.length){for(var i=[],n=t;n<e;n++)i.push(this.getSelectionStyles(n));return i}var r=this.get2DCursorLocation(t);return this._getStyleDeclaration(r.lineIndex,r.charIndex)||{}},setSelectionStyles:function(t){if(this.selectionStart===this.selectionEnd)this._extendStyles(this.selectionStart,t);else for(var e=this.selectionStart;e<this.selectionEnd;e++)this._extendStyles(e,t);return this._forceClearCache=!0,this},_extendStyles:function(t,e){var i=this.get2DCursorLocation(t);this._getLineStyle(i.lineIndex)||this._setLineStyle(i.lineIndex,{}),this._getStyleDeclaration(i.lineIndex,i.charIndex)||this._setStyleDeclaration(i.lineIndex,i.charIndex,{}),fabric.util.object.extend(this._getStyleDeclaration(i.lineIndex,i.charIndex),e)},render:function(t,e){this.clearContextTop(),this.callSuper("render",t,e)},_render:function(t){this.callSuper("_render",t),this.ctx=t,this.cursorOffsetCache={},this.renderCursorOrSelection()},clearContextTop:function(){if(this.active&&this.isEditing&&this.canvas&&this.canvas.contextTop){var t=this.canvas.contextTop;t.save(),t.transform.apply(t,this.canvas.viewportTransform),this.transform(t),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this._clearTextArea(t),t.restore()}},renderCursorOrSelection:function(){if(this.active&&this.isEditing){var t,e,i=this.text.split("");this.canvas&&this.canvas.contextTop?((e=this.canvas.contextTop).save(),e.transform.apply(e,this.canvas.viewportTransform),this.transform(e),this.transformMatrix&&e.transform.apply(e,this.transformMatrix),this._clearTextArea(e)):(e=this.ctx).save(),this.selectionStart===this.selectionEnd?(t=this._getCursorBoundaries(i,"cursor"),this.renderCursor(t,e)):(t=this._getCursorBoundaries(i,"selection"),this.renderSelection(i,t,e)),e.restore()}},_clearTextArea:function(t){var e=this.width+4,i=this.height+4;t.clearRect(-e/2,-i/2,e,i)},get2DCursorLocation:function(t){void 0===t&&(t=this.selectionStart);for(var e=this._textLines.length,i=0;i<e;i++){if(t<=this._textLines[i].length)return{lineIndex:i,charIndex:t};t-=this._textLines[i].length+1}return{lineIndex:i-1,charIndex:this._textLines[i-1].length<t?this._textLines[i-1].length:t}},getCurrentCharStyle:function(t,e){var i=this._getStyleDeclaration(t,0===e?0:e-1);return{fontSize:i&&i.fontSize||this.fontSize,fill:i&&i.fill||this.fill,textBackgroundColor:i&&i.textBackgroundColor||this.textBackgroundColor,textDecoration:i&&i.textDecoration||this.textDecoration,fontFamily:i&&i.fontFamily||this.fontFamily,fontWeight:i&&i.fontWeight||this.fontWeight,fontStyle:i&&i.fontStyle||this.fontStyle,stroke:i&&i.stroke||this.stroke,strokeWidth:i&&i.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(t,e){var i=this._getStyleDeclaration(t,0===e?0:e-1);return i&&i.fontSize?i.fontSize:this.fontSize},getCurrentCharColor:function(t,e){var i=this._getStyleDeclaration(t,0===e?0:e-1);return i&&i.fill?i.fill:this.cursorColor},_getCursorBoundaries:function(t,e){var i=Math.round(this._getLeftOffset()),n=this._getTopOffset(),r=this._getCursorBoundariesOffsets(t,e);return{left:i,top:n,leftOffset:r.left+r.lineLeft,topOffset:r.top}},_getCursorBoundariesOffsets:function(t,e){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;for(var i,n=0,r=0,o=0,s=0,a=0,c=0;c<this.selectionStart;c++)"\n"===t[c]?(a=0,s+=this._getHeightOfLine(this.ctx,r),r++,o=0):(a+=this._getWidthOfChar(this.ctx,t[c],r,o),o++),n=this._getLineLeftOffset(this._getLineWidth(this.ctx,r));return"cursor"===e&&(s+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,r)/this.lineHeight-this.getCurrentCharFontSize(r,o)*(1-this._fontSizeFraction)),0!==this.charSpacing&&o===this._textLines[r].length&&(a-=this._getWidthOfCharSpacing()),i={top:s,left:a>0?a:0,lineLeft:n},this.cursorOffsetCache=i,this.cursorOffsetCache},renderCursor:function(t,e){var i=this.get2DCursorLocation(),n=i.lineIndex,r=i.charIndex,o=this.getCurrentCharFontSize(n,r),s=0===n&&0===r?this._getLineLeftOffset(this._getLineWidth(e,n)):t.leftOffset,a=this.scaleX*this.canvas.getZoom(),c=this.cursorWidth/a;e.fillStyle=this.getCurrentCharColor(n,r),e.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,e.fillRect(t.left+s-c/2,t.top+t.topOffset,c,o)},renderSelection:function(t,e,i){i.fillStyle=this.selectionColor;for(var n=this.get2DCursorLocation(this.selectionStart),r=this.get2DCursorLocation(this.selectionEnd),o=n.lineIndex,s=r.lineIndex,a=o;a<=s;a++){var c,l=this._getLineLeftOffset(this._getLineWidth(i,a))||0,h=this._getHeightOfLine(this.ctx,a),u=0,f=this._textLines[a];if(a===o){for(var d=0,p=f.length;d<p;d++)d>=n.charIndex&&(a!==s||d<r.charIndex)&&(u+=this._getWidthOfChar(i,f[d],a,d)),d<n.charIndex&&(l+=this._getWidthOfChar(i,f[d],a,d));d===f.length&&(u-=this._getWidthOfCharSpacing())}else if(a>o&&a<s)u+=this._getLineWidth(i,a)||5;else if(a===s){for(var g=0,v=r.charIndex;g<v;g++)u+=this._getWidthOfChar(i,f[g],a,g);r.charIndex===f.length&&(u-=this._getWidthOfCharSpacing())}c=h,(this.lineHeight<1||a===s&&this.lineHeight>1)&&(h/=this.lineHeight),i.fillRect(e.left+l,e.top+e.topOffset,u>0?u:0,h),e.topOffset+=c}},_renderChars:function(t,e,i,n,r,o,s){if(this.isEmptyStyles())return this._renderCharsFast(t,e,i,n,r);s=s||0;var a,c,l=this._getHeightOfLine(e,o),h="";e.save(),r-=l/this.lineHeight*this._fontSizeFraction;for(var u=s,f=i.length+s;u<=f;u++)a=a||this.getCurrentCharStyle(o,u),c=this.getCurrentCharStyle(o,u+1),(this._hasStyleChanged(a,c)||u===f)&&(this._renderChar(t,e,o,u-1,h,n,r,l),h="",a=c),h+=i[u-s];e.restore()},_renderCharsFast:function(t,e,i,n,r){"fillText"===t&&this.fill&&this.callSuper("_renderChars",t,e,i,n,r),"strokeText"===t&&(this.stroke&&this.strokeWidth>0||this.skipFillStrokeCheck)&&this.callSuper("_renderChars",t,e,i,n,r)},_renderChar:function(t,e,i,n,r,o,s,a){var c,l,h,u,f,d,p,g,v,m=this._getStyleDeclaration(i,n);if(m?(l=this._getHeightOfChar(e,r,i,n),u=m.stroke,h=m.fill,d=m.textDecoration):l=this.fontSize,u=(u||this.stroke)&&"strokeText"===t,h=(h||this.fill)&&"fillText"===t,m&&e.save(),c=this._applyCharStylesGetWidth(e,r,i,n,m||null),d=d||this.textDecoration,m&&m.textBackgroundColor&&this._removeShadow(e),0!==this.charSpacing){g=this._getWidthOfCharSpacing(),c=0;for(var b,y=0,_=(p=r.split("")).length;y<_;y++)b=p[y],h&&e.fillText(b,o+c,s),u&&e.strokeText(b,o+c,s),c+=(v=e.measureText(b).width+g)>0?v:0}else h&&e.fillText(r,o,s),u&&e.strokeText(r,o,s);(d||""!==d)&&(f=this._fontSizeFraction*a/this.lineHeight,this._renderCharDecoration(e,d,o,s,f,c,l)),m&&e.restore(),e.translate(c,0)},_hasStyleChanged:function(t,e){return t.fill!==e.fill||t.fontSize!==e.fontSize||t.textBackgroundColor!==e.textBackgroundColor||t.textDecoration!==e.textDecoration||t.fontFamily!==e.fontFamily||t.fontWeight!==e.fontWeight||t.fontStyle!==e.fontStyle||t.stroke!==e.stroke||t.strokeWidth!==e.strokeWidth},_renderCharDecoration:function(t,e,i,n,r,o,s){if(e){var a,c,l=s/15,h={underline:n+s/10,"line-through":n-s*(this._fontSizeFraction+this._fontSizeMult-1)+l,overline:n-(this._fontSizeMult-this._fontSizeFraction)*s},u=["underline","line-through","overline"];for(a=0;a<u.length;a++)c=u[a],e.indexOf(c)>-1&&t.fillRect(i,h[c],o,l)}},_renderTextLine:function(t,e,i,n,r,o){this.isEmptyStyles()||(r+=this.fontSize*(this._fontSizeFraction+.03)),this.callSuper("_renderTextLine",t,e,i,n,r,o)},_renderTextDecoration:function(t){if(this.isEmptyStyles())return this.callSuper("_renderTextDecoration",t)},_renderTextLinesBackground:function(t){this.callSuper("_renderTextLinesBackground",t);for(var e,i,n,r,o,s,a=0,c=this._getLeftOffset(),l=this._getTopOffset(),h=0,u=this._textLines.length;h<u;h++)if(e=this._getHeightOfLine(t,h),""!==(r=this._textLines[h])&&this.styles&&this._getLineStyle(h)){i=this._getLineWidth(t,h),n=this._getLineLeftOffset(i);for(var f=0,d=r.length;f<d;f++)(s=this._getStyleDeclaration(h,f))&&s.textBackgroundColor&&(o=r[f],t.fillStyle=s.textBackgroundColor,t.fillRect(c+n+this._getWidthOfCharsAt(t,h,f),l+a,this._getWidthOfChar(t,o,h,f),e/this.lineHeight));a+=e}else a+=e},_getCacheProp:function(t,e){return t+e.fontSize+e.fontWeight+e.fontStyle},_getFontCache:function(t){return fabric.charWidthsCache[t]||(fabric.charWidthsCache[t]={}),fabric.charWidthsCache[t]},_applyCharStylesGetWidth:function(e,i,n,r,o){var s,a,c,l=o||this._getStyleDeclaration(n,r),h=t(l);if(this._applyFontStyles(h),c=this._getFontCache(h.fontFamily),a=this._getCacheProp(i,h),!l&&c[a]&&this.caching)return c[a];"string"==typeof h.shadow&&(h.shadow=new fabric.Shadow(h.shadow));var u=h.fill||this.fill;return e.fillStyle=u.toLive?u.toLive(e,this):u,h.stroke&&(e.strokeStyle=h.stroke&&h.stroke.toLive?h.stroke.toLive(e,this):h.stroke),e.lineWidth=h.strokeWidth||this.strokeWidth,e.font=this._getFontDeclaration.call(h),h.shadow&&(h.scaleX=this.scaleX,h.scaleY=this.scaleY,h.canvas=this.canvas,h.getObjectScaling=this.getObjectScaling,this._setShadow.call(h,e)),this.caching&&c[a]?c[a]:(s=e.measureText(i).width,this.caching&&(c[a]=s),s)},_applyFontStyles:function(t){t.fontFamily||(t.fontFamily=this.fontFamily),t.fontSize||(t.fontSize=this.fontSize),t.fontWeight||(t.fontWeight=this.fontWeight),t.fontStyle||(t.fontStyle=this.fontStyle)},_getStyleDeclaration:function(e,i,n){return n?this.styles[e]&&this.styles[e][i]?t(this.styles[e][i]):{}:this.styles[e]&&this.styles[e][i]?this.styles[e][i]:null},_setStyleDeclaration:function(t,e,i){this.styles[t][e]=i},_deleteStyleDeclaration:function(t,e){delete this.styles[t][e]},_getLineStyle:function(t){return this.styles[t]},_setLineStyle:function(t,e){this.styles[t]=e},_deleteLineStyle:function(t){delete this.styles[t]},_getWidthOfChar:function(t,e,i,n){if(!this._isMeasuring&&"justify"===this.textAlign&&this._reSpacesAndTabs.test(e))return this._getWidthOfSpace(t,i);t.save();var r=this._applyCharStylesGetWidth(t,e,i,n);return 0!==this.charSpacing&&(r+=this._getWidthOfCharSpacing()),t.restore(),r>0?r:0},_getHeightOfChar:function(t,e,i){var n=this._getStyleDeclaration(e,i);return n&&n.fontSize?n.fontSize:this.fontSize},_getWidthOfCharsAt:function(t,e,i){var n,r,o=0;for(n=0;n<i;n++)r=this._textLines[e][n],o+=this._getWidthOfChar(t,r,e,n);return o},_measureLine:function(t,e){this._isMeasuring=!0;var i=this._getWidthOfCharsAt(t,e,this._textLines[e].length);return 0!==this.charSpacing&&(i-=this._getWidthOfCharSpacing()),this._isMeasuring=!1,i>0?i:0},_getWidthOfSpace:function(t,e){if(this.__widthOfSpace[e])return this.__widthOfSpace[e];var i=this._textLines[e],n=this._getWidthOfWords(t,i,e,0),r=this.width-n,o=i.length-i.replace(this._reSpacesAndTabs,"").length,s=Math.max(r/o,t.measureText(" ").width);return this.__widthOfSpace[e]=s,s},_getWidthOfWords:function(t,e,i,n){for(var r=0,o=0;o<e.length;o++){var s=e[o];s.match(/\s/)||(r+=this._getWidthOfChar(t,s,i,o+n))}return r},_getHeightOfLine:function(t,e){if(this.__lineHeights[e])return this.__lineHeights[e];for(var i=this._textLines[e],n=this._getHeightOfChar(t,e,0),r=1,o=i.length;r<o;r++){var s=this._getHeightOfChar(t,e,r);s>n&&(n=s)}return this.__lineHeights[e]=n*this.lineHeight*this._fontSizeMult,this.__lineHeights[e]},_getTextHeight:function(t){for(var e,i=0,n=0,r=this._textLines.length;n<r;n++)e=this._getHeightOfLine(t,n),i+=n===r-1?e/this.lineHeight:e;return i},toObject:function(e){return fabric.util.object.extend(this.callSuper("toObject",e),{styles:t(this.styles,!0)})}}),fabric.IText.fromObject=function(e,i){var n=new fabric.IText(e.text,t(e));return i&&i(n),n}}(),function(){var t=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},initSelectedHandler:function(){this.on("selected",function(){var t=this;setTimeout(function(){t.selected=!0},100)})},initAddedHandler:function(){var t=this;this.on("added",function(){var e=t.canvas;e&&(e._hasITextHandlers||(e._hasITextHandlers=!0,t._initCanvasHandlers(e)),e._iTextInstances=e._iTextInstances||[],e._iTextInstances.push(t))})},initRemovedHandler:function(){var t=this;this.on("removed",function(){var e=t.canvas;e&&(e._iTextInstances=e._iTextInstances||[],fabric.util.removeFromArray(e._iTextInstances,t),0===e._iTextInstances.length&&(e._hasITextHandlers=!1,t._removeCanvasHandlers(e)))})},_initCanvasHandlers:function(t){t._canvasITextSelectionClearedHanlder=function(){fabric.IText.prototype.exitEditingOnOthers(t)}.bind(this),t._mouseUpITextHandler=function(){t._iTextInstances&&t._iTextInstances.forEach(function(t){t.__isMousedown=!1})}.bind(this),t.on("selection:cleared",t._canvasITextSelectionClearedHanlder),t.on("object:selected",t._canvasITextSelectionClearedHanlder),t.on("mouse:up",t._mouseUpITextHandler)},_removeCanvasHandlers:function(t){t.off("selection:cleared",t._canvasITextSelectionClearedHanlder),t.off("object:selected",t._canvasITextSelectionClearedHanlder),t.off("mouse:up",t._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(t,e,i,n){var r;return r={isAborted:!1,abort:function(){this.isAborted=!0}},t.animate("_currentCursorOpacity",e,{duration:i,onComplete:function(){r.isAborted||t[n]()},onChange:function(){t.canvas&&t.selectionStart===t.selectionEnd&&t.renderCursorOrSelection()},abort:function(){return r.isAborted}}),r},_onTickComplete:function(){var t=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){t._currentTickCompleteState=t._animateCursor(t,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(t){var e=this,i=t?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){e._tick()},i)},abortCursorAnimation:function(){var t=this._currentTickState||this._currentTickCompleteState;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,t&&this.canvas&&this.canvas.clearContext(this.canvas.contextTop||this.ctx)},selectAll:function(){this.selectionStart=0,this.selectionEnd=this.text.length,this._fireSelectionChanged(),this._updateTextarea()},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(t){var e=0,i=t-1;if(this._reSpace.test(this.text.charAt(i)))for(;this._reSpace.test(this.text.charAt(i));)e++,i--;for(;/\S/.test(this.text.charAt(i))&&i>-1;)e++,i--;return t-e},findWordBoundaryRight:function(t){var e=0,i=t;if(this._reSpace.test(this.text.charAt(i)))for(;this._reSpace.test(this.text.charAt(i));)e++,i++;for(;/\S/.test(this.text.charAt(i))&&i<this.text.length;)e++,i++;return t+e},findLineBoundaryLeft:function(t){for(var e=0,i=t-1;!/\n/.test(this.text.charAt(i))&&i>-1;)e++,i--;return t-e},findLineBoundaryRight:function(t){for(var e=0,i=t;!/\n/.test(this.text.charAt(i))&&i<this.text.length;)e++,i++;return t+e},getNumNewLinesInSelectedText:function(){for(var t=this.getSelectedText(),e=0,i=0,n=t.length;i<n;i++)"\n"===t[i]&&e++;return e},searchWordBoundary:function(t,e){for(var i=this._reSpace.test(this.text.charAt(t))?t-1:t,n=this.text.charAt(i),r=/[ \n\.,;!\?\-]/;!r.test(n)&&i>0&&i<this.text.length;)i+=e,n=this.text.charAt(i);return r.test(n)&&"\n"!==n&&(i+=1===e?0:1),i},selectWord:function(t){t=t||this.selectionStart;var e=this.searchWordBoundary(t,-1),i=this.searchWordBoundary(t,1);this.selectionStart=e,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(t){t=t||this.selectionStart;var e=this.findLineBoundaryLeft(t),i=this.findLineBoundaryRight(t);this.selectionStart=e,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea()},enterEditing:function(t){if(!this.isEditing&&this.editable)return this.canvas&&this.exitEditingOnOthers(this.canvas),this.isEditing=!0,this.initHiddenTextarea(t),this.hiddenTextarea.focus(),this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.renderAll(),this):this},exitEditingOnOthers:function(t){t._iTextInstances&&t._iTextInstances.forEach(function(t){t.selected=!1,t.isEditing&&t.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(t){if(this.__isMousedown&&this.isEditing){var e=this.getSelectionStartFromPointer(t.e),i=this.selectionStart,n=this.selectionEnd;e!==this.__selectionStartOnMouseDown&&(e>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=e):(this.selectionStart=e,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===i&&this.selectionEnd===n||(this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){if(this.hiddenTextarea&&!this.inCompositionMode&&(this.cursorOffsetCache={},this.hiddenTextarea.value=this.text,this.hiddenTextarea.selectionStart=this.selectionStart,this.hiddenTextarea.selectionEnd=this.selectionEnd,this.selectionStart===this.selectionEnd)){var t=this._calcTextareaPosition();this.hiddenTextarea.style.left=t.left,this.hiddenTextarea.style.top=t.top,this.hiddenTextarea.style.fontSize=t.fontSize}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var t=this.text.split(""),e=this._getCursorBoundaries(t,"cursor"),i=this.get2DCursorLocation(),n=i.lineIndex,r=i.charIndex,o=this.getCurrentCharFontSize(n,r),s=0===n&&0===r?this._getLineLeftOffset(this._getLineWidth(this.ctx,n)):e.leftOffset,a=this.calcTransformMatrix(),c={x:e.left+s,y:e.top+e.topOffset+o},l=this.canvas.upperCanvasEl,h=l.width-o,u=l.height-o;return c=fabric.util.transformPoint(c,a),(c=fabric.util.transformPoint(c,this.canvas.viewportTransform)).x<0&&(c.x=0),c.x>h&&(c.x=h),c.y<0&&(c.y=0),c.y>u&&(c.y=u),c.x+=this.canvas._offset.left,c.y+=this.canvas._offset.top,{left:c.x+"px",top:c.y+"px",fontSize:o}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var t=this._textBeforeEdit!==this.text;return this.selected=!1,this.isEditing=!1,this.selectable=!0,this.selectionEnd=this.selectionStart,this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this.fire("editing:exited"),t&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),t&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var t in this.styles)this._textLines[t]||delete this.styles[t]},_removeCharsFromTo:function(t,e){for(;e!==t;)this._removeSingleCharAndStyle(t+1),e--;this.selectionStart=t,this.selectionEnd=t},_removeSingleCharAndStyle:function(t){var e="\n"===this.text[t-1],i=e?t:t-1;this.removeStyleObject(e,i),this.text=this.text.slice(0,t-1)+this.text.slice(t),this._textLines=this._splitTextIntoLines()},insertChars:function(t,e){var i;if(this.selectionEnd-this.selectionStart>1&&this._removeCharsFromTo(this.selectionStart,this.selectionEnd),e||!this.isEmptyStyles())for(var n=0,r=t.length;n<r;n++)e&&(i=fabric.copiedTextStyle[n]),this.insertChar(t[n],n<r-1,i);else this.insertChar(t,!1)},insertChar:function(t,e,i){var n="\n"===this.text[this.selectionStart];this.text=this.text.slice(0,this.selectionStart)+t+this.text.slice(this.selectionEnd),this._textLines=this._splitTextIntoLines(),this.insertStyleObjects(t,n,i),this.selectionStart+=t.length,this.selectionEnd=this.selectionStart,e||(this._updateTextarea(),this.setCoords(),this._fireSelectionChanged(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this}),this.canvas&&this.canvas.renderAll())},insertNewlineStyleObject:function(e,i,n){this.shiftLineStyles(e,1),this.styles[e+1]||(this.styles[e+1]={});var r={},o={};if(this.styles[e]&&this.styles[e][i-1]&&(r=this.styles[e][i-1]),n)o[0]=t(r),this.styles[e+1]=o;else{for(var s in this.styles[e])parseInt(s,10)>=i&&(o[parseInt(s,10)-i]=this.styles[e][s],delete this.styles[e][s]);this.styles[e+1]=o}this._forceClearCache=!0},insertCharStyleObject:function(e,i,n){var r=this.styles[e],o=t(r);for(var s in 0!==i||n||(i=1),o){var a=parseInt(s,10);a>=i&&(r[a+1]=o[a],o[a-1]||delete r[a])}this.styles[e][i]=n||t(r[i-1]),this._forceClearCache=!0},insertStyleObjects:function(t,e,i){var n=this.get2DCursorLocation(),r=n.lineIndex,o=n.charIndex;this._getLineStyle(r)||this._setLineStyle(r,{}),"\n"===t?this.insertNewlineStyleObject(r,o,e):this.insertCharStyleObject(r,o,i)},shiftLineStyles:function(e,i){var n=t(this.styles);for(var r in this.styles){var o=parseInt(r,10);o>e&&(this.styles[o+i]=n[o],n[o-i]||delete this.styles[o])}},removeStyleObject:function(t,e){var i=this.get2DCursorLocation(e),n=i.lineIndex,r=i.charIndex;this._removeStyleObject(t,i,n,r)},_getTextOnPreviousLine:function(t){return this._textLines[t-1]},_removeStyleObject:function(e,i,n,r){if(e){var o=this._getTextOnPreviousLine(i.lineIndex),s=o?o.length:0;for(r in this.styles[n-1]||(this.styles[n-1]={}),this.styles[n])this.styles[n-1][parseInt(r,10)+s]=this.styles[n][r];this.shiftLineStyles(i.lineIndex,-1)}else{var a=this.styles[n];a&&delete a[r];var c=t(a);for(var l in c){var h=parseInt(l,10);h>=r&&0!==h&&(a[h-1]=c[h],delete a[h])}}},insertNewline:function(){this.insertChars("\n")},setSelectionStartEndWithShift:function(t,e,i){i<=t?(e===t?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=t),this.selectionStart=i):i>t&&i<e?"right"===this._selectionDirection?this.selectionEnd=i:this.selectionStart=i:(e===t?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=e),this.selectionEnd=i)},setSelectionInBoundaries:function(){var t=this.text.length;this.selectionStart>t?this.selectionStart=t:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>t?this.selectionEnd=t:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(t){this.__newClickTime=+new Date;var e=this.canvas.getPointer(t.e);this.isTripleClick(e)?(this.fire("tripleclick",t),this._stopEvent(t.e)):this.isDoubleClick(e)&&(this.fire("dblclick",t),this._stopEvent(t.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=e,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected},isDoubleClick:function(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y&&this.__lastIsEditing},isTripleClick:function(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y},_stopEvent:function(t){t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler(),this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},initClicks:function(){this.on("dblclick",function(t){this.selectWord(this.getSelectionStartFromPointer(t.e))}),this.on("tripleclick",function(t){this.selectLine(this.getSelectionStartFromPointer(t.e))})},initMousedownHandler:function(){this.on("mousedown",function(t){if(this.editable){var e=this.canvas.getPointer(t.e);this.__mousedownX=e.x,this.__mousedownY=e.y,this.__isMousedown=!0,this.selected&&this.setCursorByClick(t.e),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection())}})},_isObjectMoved:function(t){var e=this.canvas.getPointer(t);return this.__mousedownX!==e.x||this.__mousedownY!==e.y},initMouseupHandler:function(){this.on("mouseup",function(t){this.__isMousedown=!1,this.editable&&!this._isObjectMoved(t.e)&&(this.__lastSelected&&!this.__corner&&(this.enterEditing(t.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()),this.selected=!0)})},setCursorByClick:function(t){var e=this.getSelectionStartFromPointer(t),i=this.selectionStart,n=this.selectionEnd;t.shiftKey?this.setSelectionStartEndWithShift(i,n,e):(this.selectionStart=e,this.selectionEnd=e),this._fireSelectionChanged(),this._updateTextarea()},getSelectionStartFromPointer:function(t){for(var e,i=this.getLocalPointer(t),n=0,r=0,o=0,s=0,a=0,c=this._textLines.length;a<c;a++){e=this._textLines[a],o+=this._getHeightOfLine(this.ctx,a)*this.scaleY;var l=this._getLineWidth(this.ctx,a);r=this._getLineLeftOffset(l)*this.scaleX;for(var h=0,u=e.length;h<u;h++){if(n=r,r+=this._getWidthOfChar(this.ctx,e[h],a,this.flipX?u-h:h)*this.scaleX,!(o<=i.y||r<=i.x))return this._getNewSelectionStartFromOffset(i,n,r,s+a,u);s++}if(i.y<o)return this._getNewSelectionStartFromOffset(i,n,r,s+a-1,u)}return this.text.length},_getNewSelectionStartFromOffset:function(t,e,i,n,r){var o=t.x-e,s=n+(i-t.x>o?0:1);return this.flipX&&(s=r-s),s>this.text.length&&(s=this.text.length),s}}),fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off");var t=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+t.top+"; left: "+t.left+"; opacity: 0; width: 0px; height: 0px; z-index: -999;",fabric.document.body.appendChild(this.hiddenTextarea),fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),fabric.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),fabric.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),fabric.util.addListener(this.hiddenTextarea,"cut",this.cut.bind(this)),fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},_keysMap:{8:"removeChars",9:"exitEditing",27:"exitEditing",13:"insertNewline",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMapUp:{67:"copy",88:"cut"},_ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(t){if(this.isEditing){if(t.keyCode in this._keysMap)this[this._keysMap[t.keyCode]](t);else{if(!(t.keyCode in this._ctrlKeysMapDown&&(t.ctrlKey||t.metaKey)))return;this[this._ctrlKeysMapDown[t.keyCode]](t)}t.stopImmediatePropagation(),t.preventDefault(),this.canvas&&this.canvas.renderAll()}},onKeyUp:function(t){this.isEditing&&!this._copyDone?t.keyCode in this._ctrlKeysMapUp&&(t.ctrlKey||t.metaKey)&&(this[this._ctrlKeysMapUp[t.keyCode]](t),t.stopImmediatePropagation(),t.preventDefault(),this.canvas&&this.canvas.renderAll()):this._copyDone=!1},onInput:function(t){if(this.isEditing&&!this.inCompositionMode){var e,i,n,r=this.selectionStart||0,o=this.selectionEnd||0,s=this.text.length,a=this.hiddenTextarea.value.length;a>s?(n="left"===this._selectionDirection?o:r,e=a-s,i=this.hiddenTextarea.value.slice(n,n+e)):(e=a-s+o-r,i=this.hiddenTextarea.value.slice(r,r+e)),this.insertChars(i),t.stopPropagation()}},onCompositionStart:function(){this.inCompositionMode=!0,this.prevCompositionLength=0,this.compositionStart=this.selectionStart},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(t){var e=t.data;this.selectionStart=this.compositionStart,this.selectionEnd=this.selectionEnd===this.selectionStart?this.compositionStart+this.prevCompositionLength:this.selectionEnd,this.insertChars(e,!1),this.prevCompositionLength=e.length},forwardDelete:function(t){if(this.selectionStart===this.selectionEnd){if(this.selectionStart===this.text.length)return;this.moveCursorRight(t)}this.removeChars(t)},copy:function(t){if(this.selectionStart!==this.selectionEnd){var e=this.getSelectedText(),i=this._getClipboardData(t);i&&i.setData("text",e),fabric.copiedText=e,fabric.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd),t.stopImmediatePropagation(),t.preventDefault(),this._copyDone=!0}},paste:function(t){var e=null,i=this._getClipboardData(t),n=!0;i?(e=i.getData("text").replace(/\r/g,""),fabric.copiedTextStyle&&fabric.copiedText===e||(n=!1)):e=fabric.copiedText,e&&this.insertChars(e,n),t.stopImmediatePropagation(),t.preventDefault()},cut:function(t){this.selectionStart!==this.selectionEnd&&(this.copy(t),this.removeChars(t))},_getClipboardData:function(t){return t&&t.clipboardData||fabric.window.clipboardData},_getWidthBeforeCursor:function(t,e){for(var i,n=this._textLines[t].slice(0,e),r=this._getLineWidth(this.ctx,t),o=this._getLineLeftOffset(r),s=0,a=n.length;s<a;s++)i=n[s],o+=this._getWidthOfChar(this.ctx,i,t,s);return o},getDownCursorOffset:function(t,e){var i=this._getSelectionForOffset(t,e),n=this.get2DCursorLocation(i),r=n.lineIndex;if(r===this._textLines.length-1||t.metaKey||34===t.keyCode)return this.text.length-i;var o=n.charIndex,s=this._getWidthBeforeCursor(r,o),a=this._getIndexOnLine(r+1,s);return this._textLines[r].slice(o).length+a+2},_getSelectionForOffset:function(t,e){return t.shiftKey&&this.selectionStart!==this.selectionEnd&&e?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(t,e){var i=this._getSelectionForOffset(t,e),n=this.get2DCursorLocation(i),r=n.lineIndex;if(0===r||t.metaKey||33===t.keyCode)return-i;var o=n.charIndex,s=this._getWidthBeforeCursor(r,o),a=this._getIndexOnLine(r-1,s),c=this._textLines[r].slice(0,o);return-this._textLines[r-1].length+a-c.length},_getIndexOnLine:function(t,e){for(var i,n=this._getLineWidth(this.ctx,t),r=this._textLines[t],o=this._getLineLeftOffset(n),s=0,a=0,c=r.length;a<c;a++){var l=r[a],h=this._getWidthOfChar(this.ctx,l,t,a);if((o+=h)>e){i=!0;var u=o-h,f=o,d=Math.abs(u-e);s=Math.abs(f-e)<d?a:a-1;break}}return i||(s=r.length-1),s},moveCursorDown:function(t){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||this._moveCursorUpOrDown("Down",t)},moveCursorUp:function(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",t)},_moveCursorUpOrDown:function(t,e){var i=this["get"+t+"CursorOffset"](e,"right"===this._selectionDirection);e.shiftKey?this.moveCursorWithShift(i):this.moveCursorWithoutShift(i),0!==i&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(t){var e="left"===this._selectionDirection?this.selectionStart+t:this.selectionEnd+t;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,e),0!==t},moveCursorWithoutShift:function(t){return t<0?(this.selectionStart+=t,this.selectionEnd=this.selectionStart):(this.selectionEnd+=t,this.selectionStart=this.selectionEnd),0!==t},moveCursorLeft:function(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",t)},_move:function(t,e,i){var n;if(t.altKey)n=this["findWordBoundary"+i](this[e]);else{if(!t.metaKey&&35!==t.keyCode&&36!==t.keyCode)return this[e]+="Left"===i?-1:1,!0;n=this["findLineBoundary"+i](this[e])}if(void 0!==typeof n&&this[e]!==n)return this[e]=n,!0},_moveLeft:function(t,e){return this._move(t,e,"Left")},_moveRight:function(t,e){return this._move(t,e,"Right")},moveCursorLeftWithoutShift:function(t){var e=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(e=this._moveLeft(t,"selectionStart")),this.selectionEnd=this.selectionStart,e},moveCursorLeftWithShift:function(t){return"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(t,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection="left",this._moveLeft(t,"selectionStart")):void 0},moveCursorRight:function(t){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||this._moveCursorLeftOrRight("Right",t)},_moveCursorLeftOrRight:function(t,e){var i="moveCursor"+t+"With";this._currentCursorOpacity=1,e.shiftKey?i+="Shift":i+="outShift",this[i](e)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(t){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(t,"selectionStart"):this.selectionEnd!==this.text.length?(this._selectionDirection="right",this._moveRight(t,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(t){var e=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(e=this._moveRight(t,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,e},removeChars:function(t){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(t):this._removeCharsFromTo(this.selectionStart,this.selectionEnd),this.setSelectionEnd(this.selectionStart),this._removeExtraneousStyles(),this.canvas&&this.canvas.renderAll(),this.setCoords(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(t){if(0!==this.selectionStart)if(t.metaKey){var e=this.findLineBoundaryLeft(this.selectionStart);this._removeCharsFromTo(e,this.selectionStart),this.setSelectionStart(e)}else if(t.altKey){var i=this.findWordBoundaryLeft(this.selectionStart);this._removeCharsFromTo(i,this.selectionStart),this.setSelectionStart(i)}else this._removeSingleCharAndStyle(this.selectionStart),this.setSelectionStart(this.selectionStart-1)}}),function(){var t=fabric.util.toFixed,e=fabric.Object.NUM_FRACTION_DIGITS;fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(t,e,i,n,r,o){this._getLineStyle(t)?this._setSVGTextLineChars(t,e,i,n,o):fabric.Text.prototype._setSVGTextLineText.call(this,t,e,i,n,r)},_setSVGTextLineChars:function(t,e,i,n,r){for(var o=this._textLines[t],s=0,a=this._getLineLeftOffset(this._getLineWidth(this.ctx,t))-this.width/2,c=this._getSVGLineTopOffset(t),l=this._getHeightOfLine(this.ctx,t),h=0,u=o.length;h<u;h++){var f=this._getStyleDeclaration(t,h)||{};e.push(this._createTextCharSpan(o[h],f,a,c.lineTop+c.offset,s));var d=this._getWidthOfChar(this.ctx,o[h],t,h);f.textBackgroundColor&&r.push(this._createTextCharBg(f,a,c.lineTop,l,d,s)),s+=d}},_getSVGLineTopOffset:function(t){for(var e,i=0,n=0;n<t;n++)i+=this._getHeightOfLine(this.ctx,n);return e=this._getHeightOfLine(this.ctx,n),{lineTop:i,offset:(this._fontSizeMult-this._fontSizeFraction)*e/(this.lineHeight*this._fontSizeMult)}},_createTextCharBg:function(i,n,r,o,s,a){return['\t\t<rect fill="',i.textBackgroundColor,'" x="',t(n+a,e),'" y="',t(r-this.height/2,e),'" width="',t(s,e),'" height="',t(o/this.lineHeight,e),'"></rect>\n'].join("")},_createTextCharSpan:function(i,n,r,o,s){var a=this.getSvgStyles.call(fabric.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text",getSvgFilter:fabric.Object.prototype.getSvgFilter},n));return['\t\t\t<tspan x="',t(r+s,e),'" y="',t(o-this.height/2,e),'" ',n.fontFamily?'font-family="'+n.fontFamily.replace(/"/g,"'")+'" ':"",n.fontSize?'font-size="'+n.fontSize+'" ':"",n.fontStyle?'font-style="'+n.fontStyle+'" ':"",n.fontWeight?'font-weight="'+n.fontWeight+'" ':"",n.textDecoration?'text-decoration="'+n.textDecoration+'" ':"",'style="',a,'">',fabric.util.string.escapeXml(i),"</tspan>\n"].join("")}})}(),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.clone;e.Textbox=e.util.createClass(e.IText,e.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingY:!0,lockScalingFlip:!0,initialize:function(t,i){this.ctx=e.util.createCanvasElement().getContext("2d"),this.callSuper("initialize",t,i),this.setControlsVisibility(e.Textbox.getTextboxControlVisibility()),this._dimensionAffectingProps.width=!0},_initDimensions:function(t){this.__skipDimension||(t||(t=e.util.createCanvasElement().getContext("2d"),this._setTextStyles(t)),this.dynamicMinWidth=0,this._textLines=this._splitTextIntoLines(),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this._clearCache(),this.height=this._getTextHeight(t))},_generateStyleMap:function(){for(var t=0,e=0,i=0,n={},r=0;r<this._textLines.length;r++)"\n"===this.text[i]&&r>0?(e=0,i++,t++):" "===this.text[i]&&r>0&&(e++,i++),n[r]={line:t,offset:e},i+=this._textLines[r].length,e+=this._textLines[r].length;return n},_getStyleDeclaration:function(t,e,i){if(this._styleMap){var n=this._styleMap[t];if(!n)return i?{}:null;t=n.line,e=n.offset+e}return this.callSuper("_getStyleDeclaration",t,e,i)},_setStyleDeclaration:function(t,e,i){var n=this._styleMap[t];t=n.line,e=n.offset+e,this.styles[t][e]=i},_deleteStyleDeclaration:function(t,e){var i=this._styleMap[t];t=i.line,e=i.offset+e,delete this.styles[t][e]},_getLineStyle:function(t){var e=this._styleMap[t];return this.styles[e.line]},_setLineStyle:function(t,e){var i=this._styleMap[t];this.styles[i.line]=e},_deleteLineStyle:function(t){var e=this._styleMap[t];delete this.styles[e.line]},_wrapText:function(t,e){var i,n=e.split(this._reNewline),r=[];for(i=0;i<n.length;i++)r=r.concat(this._wrapLine(t,n[i],i));return r},_measureText:function(t,e,i,n){var r=0;n=n||0;for(var o=0,s=e.length;o<s;o++)r+=this._getWidthOfChar(t,e[o],i,o+n);return r},_wrapLine:function(t,e,i){for(var n=0,r=[],o="",s=e.split(" "),a="",c=0,l=0,h=0,u=0,f=!0,d=this._getWidthOfCharSpacing(),p=0;p<s.length;p++)a=s[p],l=this._measureText(t,a,i,c),c+=a.length,(n+=h+l-d)>=this.width&&!f?(r.push(o),o="",n=l,f=!0):n+=d,f||(o+=" "),o+=a,h=this._measureText(t," ",i,c),c++,f=!1,l>u&&(u=l);return p&&r.push(o),u>this.dynamicMinWidth&&(this.dynamicMinWidth=u-d),r},_splitTextIntoLines:function(){var t=this.textAlign;this.ctx.save(),this._setTextStyles(this.ctx),this.textAlign="left";var e=this._wrapText(this.ctx,this.text);return this.textAlign=t,this.ctx.restore(),this._textLines=e,this._styleMap=this._generateStyleMap(),e},setOnGroup:function(t,e){"scaleX"===t&&(this.set("scaleX",Math.abs(1/e)),this.set("width",this.get("width")*e/(void 0===this.__oldScaleX?1:this.__oldScaleX)),this.__oldScaleX=e)},get2DCursorLocation:function(t){void 0===t&&(t=this.selectionStart);for(var e=this._textLines.length,i=0,n=0;n<e;n++){var r=this._textLines[n].length;if(t<=i+r)return{lineIndex:n,charIndex:t-i};i+=r,"\n"!==this.text[i]&&" "!==this.text[i]||i++}return{lineIndex:e-1,charIndex:this._textLines[e-1].length}},_getCursorBoundariesOffsets:function(t,e){for(var i=0,n=0,r=this.get2DCursorLocation(),o=this._textLines[r.lineIndex].split(""),s=this._getLineLeftOffset(this._getLineWidth(this.ctx,r.lineIndex)),a=0;a<r.charIndex;a++)n+=this._getWidthOfChar(this.ctx,o[a],r.lineIndex,a);for(a=0;a<r.lineIndex;a++)i+=this._getHeightOfLine(this.ctx,a);return"cursor"===e&&(i+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,r.lineIndex)/this.lineHeight-this.getCurrentCharFontSize(r.lineIndex,r.charIndex)*(1-this._fontSizeFraction)),{top:i,left:n,lineLeft:s}},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},toObject:function(t){return this.callSuper("toObject",["minWidth"].concat(t))}}),e.Textbox.fromObject=function(t,n){var r=new e.Textbox(t.text,i(t));return n&&n(r),r},e.Textbox.getTextboxControlVisibility=function(){return{tl:!1,tr:!1,br:!1,bl:!1,ml:!0,mt:!1,mr:!0,mb:!1,mtr:!0}}}(exports),function(){var t=fabric.Canvas.prototype._setObjectScale;fabric.Canvas.prototype._setObjectScale=function(e,i,n,r,o,s,a){var c=i.target;if(!(c instanceof fabric.Textbox))return t.call(fabric.Canvas.prototype,e,i,n,r,o,s,a);var l=c.width*(e.x/i.scaleX/(c.width+c.strokeWidth));return l>=c.getMinWidth()?(c.set("width",l),!0):void 0},fabric.Group.prototype._refreshControlsVisibility=function(){if(void 0!==fabric.Textbox)for(var t=this._objects.length;t--;)if(this._objects[t]instanceof fabric.Textbox)return void this.setControlsVisibility(fabric.Textbox.getTextboxControlVisibility())};var e=fabric.util.object.clone;fabric.util.object.extend(fabric.Textbox.prototype,{_removeExtraneousStyles:function(){for(var t in this._styleMap)this._textLines[t]||delete this.styles[this._styleMap[t].line]},insertCharStyleObject:function(t,e,i){var n=this._styleMap[t];t=n.line,e=n.offset+e,fabric.IText.prototype.insertCharStyleObject.apply(this,[t,e,i])},insertNewlineStyleObject:function(t,e,i){var n=this._styleMap[t];t=n.line,e=n.offset+e,fabric.IText.prototype.insertNewlineStyleObject.apply(this,[t,e,i])},shiftLineStyles:function(t,i){var n=e(this.styles),r=this._styleMap[t];for(var o in t=r.line,this.styles){var s=parseInt(o,10);s>t&&(this.styles[s+i]=n[s],n[s-i]||delete this.styles[s])}},_getTextOnPreviousLine:function(t){for(var e=this._textLines[t-1];this._styleMap[t-2]&&this._styleMap[t-2].line===this._styleMap[t-1].line;)e=this._textLines[t-2]+e,t--;return e},removeStyleObject:function(t,e){var i=this.get2DCursorLocation(e),n=this._styleMap[i.lineIndex],r=n.line,o=n.offset+i.charIndex;this._removeStyleObject(t,i,r,o)}})}(),function(){var t=fabric.IText.prototype._getNewSelectionStartFromOffset;fabric.IText.prototype._getNewSelectionStartFromOffset=function(e,i,n,r,o){r=t.call(this,e,i,n,r,o);for(var s=0,a=0,c=0;c<this._textLines.length&&!((s+=this._textLines[c].length)+a>=r);c++)"\n"!==this.text[s+a]&&" "!==this.text[s+a]||a++;return r-c+a}}(),function(){if("undefined"==typeof document||"undefined"==typeof window){var DOMParser=__webpack_require__(23).DOMParser,URL=__webpack_require__(9),HTTP=__webpack_require__(10),HTTPS=__webpack_require__(12),Canvas=__webpack_require__(5),Image=__webpack_require__(5).Image;fabric.util.loadImage=function(t,e,i){function n(n){n?(r.src=new Buffer(n,"binary"),r._src=t,e&&e.call(i,r)):(r=null,e&&e.call(i,null,!0))}var r=new Image;t&&(t instanceof Buffer||0===t.indexOf("data"))?(r.src=r._src=t,e&&e.call(i,r)):t&&0!==t.indexOf("http")?requestFs(t,n):t?request(t,"binary",n):e&&e.call(i,t)},fabric.loadSVGFromURL=function(t,e,i){0!==(t=t.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim()).indexOf("http")?requestFs(t,function(t){fabric.loadSVGFromString(t.toString(),e,i)}):request(t,"",function(t){fabric.loadSVGFromString(t,e,i)})},fabric.loadSVGFromString=function(t,e,i){var n=(new DOMParser).parseFromString(t);fabric.parseSVGDocument(n.documentElement,function(t,i){e&&e(t,i)},i)},fabric.util.getScript=function(url,callback){request(url,"",function(body){eval(body),callback&&callback()})},fabric.createCanvasForNode=function(t,e,i,n){n=n||i;var r=fabric.document.createElement("canvas"),o=new Canvas(t||600,e||600,n),s=new Canvas(t||600,e||600,n);r.style={},r.width=o.width,r.height=o.height,(i=i||{}).nodeCanvas=o,i.nodeCacheCanvas=s;var a=new(fabric.Canvas||fabric.StaticCanvas)(r,i);return a.nodeCanvas=o,a.nodeCacheCanvas=s,a.contextContainer=o.getContext("2d"),a.contextCache=s.getContext("2d"),a.Font=Canvas.Font,a};var originaInitStatic=fabric.StaticCanvas.prototype._initStatic;fabric.StaticCanvas.prototype._initStatic=function(t,e){t=t||fabric.document.createElement("canvas"),this.nodeCanvas=new Canvas(t.width,t.height),this.nodeCacheCanvas=new Canvas(t.width,t.height),originaInitStatic.call(this,t,e),this.contextContainer=this.nodeCanvas.getContext("2d"),this.contextCache=this.nodeCacheCanvas.getContext("2d"),this.Font=Canvas.Font},fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(t){return this.nodeCanvas.createJPEGStream(t)},fabric.StaticCanvas.prototype._initRetinaScaling=function(){if(this._isRetinaScaling())return this.lowerCanvasEl.setAttribute("width",this.width*fabric.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio),this.nodeCanvas.width=this.width*fabric.devicePixelRatio,this.nodeCanvas.height=this.height*fabric.devicePixelRatio,this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio),this},fabric.Canvas&&(fabric.Canvas.prototype._initRetinaScaling=fabric.StaticCanvas.prototype._initRetinaScaling);var origSetBackstoreDimension=fabric.StaticCanvas.prototype._setBackstoreDimension;fabric.StaticCanvas.prototype._setBackstoreDimension=function(t,e){return origSetBackstoreDimension.call(this,t,e),this.nodeCanvas[t]=e,this},fabric.Canvas&&(fabric.Canvas.prototype._setBackstoreDimension=fabric.StaticCanvas.prototype._setBackstoreDimension)}function request(t,e,i){var n=URL.parse(t);n.port||(n.port=0===n.protocol.indexOf("https:")?443:80);var r=(0===n.protocol.indexOf("https:")?HTTPS:HTTP).request({hostname:n.hostname,port:n.port,path:n.path,method:"GET"},function(t){var n="";e&&t.setEncoding(e),t.on("end",function(){i(n)}),t.on("data",function(e){200===t.statusCode&&(n+=e)})});r.on("error",function(t){t.errno===process.ECONNREFUSED?fabric.log("ECONNREFUSED: connection refused to "+n.hostname+":"+n.port):fabric.log(t.message),i(null)}),r.end()}function requestFs(t,e){__webpack_require__(11).readFile(t,function(t,i){if(t)throw fabric.log(t),t;e(i)})}}(),window.fabric=fabric,__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_RESULT__=function(){return fabric}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}).call(this,__webpack_require__(3).Buffer,__webpack_require__(1))},function(t,e,i){
/*!
 * tui-image-editor.js
 * @version 3.2.0
 * @author NHNEnt FE Development Lab <dl_javascript@nhnent.com>
 * @license MIT
 */
!function(e,n){t.exports=n(i(26),i(27))}(0,function(t,e){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={exports:{},id:n,loaded:!1};return t[n].call(r.exports,r,r.exports,i),r.loaded=!0,r.exports}return i.m=t,i.c=e,i.p="dist",i(0)}([function(t,e,i){"use strict";i(1);var n=function(t){return t&&t.__esModule?t:{default:t}}(i(2));i(130),i(132),i(133),i(134),i(135),i(136),i(137),i(138),i(139),i(140),i(141),i(142),i(143),i(144),i(145),i(146),i(147),i(148),i(149),i(150),t.exports=n.default},function(t,e){"use strict";Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,Element.prototype.closest||(Element.prototype.closest=function(t){var e=this;if(!document.documentElement.contains(e))return null;do{if(e.matches(t))return e;e=e.parentElement||e.parentNode}while(null!==e&&1===e.nodeType);return null})
/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js */,"document"in window.self&&("classList"in document.createElement("_")&&(!document.createElementNS||"classList"in document.createElementNS("http://www.w3.org/2000/svg","g"))||function(t){if("Element"in t){var e=t.Element.prototype,i=Object,n=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},r=Array.prototype.indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1},o=function(t,e){this.name=t,this.code=DOMException[t],this.message=e},s=function(t,e){if(""===e)throw new o("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(e))throw new o("INVALID_CHARACTER_ERR","String contains an invalid character");return r.call(t,e)},a=function(t){for(var e=n.call(t.getAttribute("class")||""),i=e?e.split(/\s+/):[],r=0,o=i.length;r<o;r++)this.push(i[r]);this._updateClassName=function(){t.setAttribute("class",this.toString())}},c=a.prototype=[],l=function(){return new a(this)};if(o.prototype=Error.prototype,c.item=function(t){return this[t]||null},c.contains=function(t){return-1!==s(this,t+="")},c.add=function(){var t,e=arguments,i=0,n=e.length,r=!1;do{t=e[i]+"",-1===s(this,t)&&(this.push(t),r=!0)}while(++i<n);r&&this._updateClassName()},c.remove=function(){var t,e,i=arguments,n=0,r=i.length,o=!1;do{for(t=i[n]+"",e=s(this,t);-1!==e;)this.splice(e,1),o=!0,e=s(this,t)}while(++n<r);o&&this._updateClassName()},c.toggle=function(t,e){t+="";var i=this.contains(t),n=i?!0!==e&&"remove":!1!==e&&"add";return n&&this[n](t),!0===e||!1===e?e:!i},c.toString=function(){return this.join(" ")},i.defineProperty){var h={get:l,enumerable:!0,configurable:!0};try{i.defineProperty(e,"classList",h)}catch(t){void 0!==t.number&&-2146823252!==t.number||(h.enumerable=!1,i.defineProperty(e,"classList",h))}}else i.prototype.__defineGetter__&&e.__defineGetter__("classList",l)}}(window.self),function(){var t=document.createElement("_");if(t.classList.add("c1","c2"),!t.classList.contains("c2")){var e=function(t){var e=DOMTokenList.prototype[t];DOMTokenList.prototype[t]=function(t){var i,n=arguments.length;for(i=0;i<n;i++)t=arguments[i],e.call(this,t)}};e("add"),e("remove")}if(t.classList.toggle("c3",!1),t.classList.contains("c3")){var i=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(t,e){return 1 in arguments&&!this.contains(t)==!e?e:i.call(this,t)}}t=null}())
/*!
	 * @copyright Copyright (c) 2017 IcoMoon.io
	 * @license   Licensed under MIT license
	 *            See https://github.com/Keyamoon/svgxuse
	 * @version   1.2.6
	 */,
/*!
	 * @copyright Copyright (c) 2017 IcoMoon.io
	 * @license   Licensed under MIT license
	 *            See https://github.com/Keyamoon/svgxuse
	 * @version   1.2.6
	 */
function(){if("undefined"!=typeof window&&window.addEventListener){var t,e,i,n=Object.create(null),r=function(){clearTimeout(e),e=setTimeout(t,100)},o=function(){},s=function(){var t;window.addEventListener("resize",r,!1),window.addEventListener("orientationchange",r,!1),window.MutationObserver?((t=new MutationObserver(r)).observe(document.documentElement,{childList:!0,subtree:!0,attributes:!0}),o=function(){try{t.disconnect(),window.removeEventListener("resize",r,!1),window.removeEventListener("orientationchange",r,!1)}catch(t){}}):(document.documentElement.addEventListener("DOMSubtreeModified",r,!1),o=function(){document.documentElement.removeEventListener("DOMSubtreeModified",r,!1),window.removeEventListener("resize",r,!1),window.removeEventListener("orientationchange",r,!1)})},a=function(t){function e(t){var e;return void 0!==t.protocol?e=t:(e=document.createElement("a")).href=t,e.protocol.replace(/:/g,"")+e.host}var i,n,r;return window.XMLHttpRequest&&(i=new XMLHttpRequest,n=e(location),r=e(t),i=void 0===i.withCredentials&&""!==r&&r!==n?XDomainRequest||void 0:XMLHttpRequest),i},c="http://www.w3.org/1999/xlink";t=function(){var t,e,i,r,l,h,u,f,d,p,g=0;function v(){0===(g-=1)&&(o(),s())}function m(t){return function(){!0!==n[t.base]&&(t.useEl.setAttributeNS(c,"xlink:href","#"+t.hash),t.useEl.hasAttribute("href")&&t.useEl.setAttribute("href","#"+t.hash))}}function b(t){return function(){var e,i=document.body,n=document.createElement("x");t.onload=null,n.innerHTML=t.responseText,(e=n.getElementsByTagName("svg")[0])&&(e.setAttribute("aria-hidden","true"),e.style.position="absolute",e.style.width=0,e.style.height=0,e.style.overflow="hidden",i.insertBefore(e,i.firstChild)),v()}}function y(t){return function(){t.onerror=null,t.ontimeout=null,v()}}for(o(),d=document.getElementsByTagName("use"),l=0;l<d.length;l+=1){try{e=d[l].getBoundingClientRect()}catch(t){e=!1}t=(f=(r=d[l].getAttribute("href")||d[l].getAttributeNS(c,"href")||d[l].getAttribute("xlink:href"))&&r.split?r.split("#"):["",""])[0],i=f[1],h=e&&0===e.left&&0===e.right&&0===e.top&&0===e.bottom,e&&0===e.width&&0===e.height&&!h?(d[l].hasAttribute("href")&&d[l].setAttributeNS(c,"xlink:href",r),t.length&&(!0!==(p=n[t])&&setTimeout(m({useEl:d[l],base:t,hash:i}),0),void 0===p&&void 0!==(u=a(t))&&(p=new u,n[t]=p,p.onload=b(p),p.onerror=y(p),p.ontimeout=y(p),p.open("GET",t),p.send(),g+=1))):h?t.length&&n[t]&&setTimeout(m({useEl:d[l],base:t,hash:i}),0):void 0===n[t]?n[t]=!0:n[t].onload&&(n[t].abort(),delete n[t].onload,n[t]=!0)}d="",g+=1,v()},i=function(){window.removeEventListener("load",i,!1),e=setTimeout(t,0)},"complete"!==document.readyState?window.addEventListener("load",i,!1):i()}}()},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=d(i(3)),o=d(i(4)),s=d(i(68)),a=d(i(74)),c=d(i(102)),l=d(i(69)),h=d(i(104)),u=d(i(73)),f=i(72);function d(t){return t&&t.__esModule?t:{default:t}}var p=u.default.eventNames,g=u.default.commandNames,v=u.default.keyCodes,m=u.default.rejectMessages,b=r.default.isUndefined,y=r.default.forEach,_=r.default.CustomEvents,x=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),i=r.default.extend({includeUI:!1,usageStatistics:!0},i),this.mode=null,this.activeObjectId=null,i.includeUI&&(this.ui=new a.default(e,i.includeUI,this.getActions()),i=this.ui.setUiDefaultSelectionStyle(i)),this._invoker=new s.default,this._graphics=new h.default(this.ui?this.ui.getEditorArea():e,{cssMaxWidth:i.cssMaxWidth,cssMaxHeight:i.cssMaxHeight,useItext:!!this.ui,useDragAddIcon:!!this.ui}),this._handlers={keydown:this._onKeyDown.bind(this),mousedown:this._onMouseDown.bind(this),objectActivated:this._onObjectActivated.bind(this),objectMoved:this._onObjectMoved.bind(this),objectScaled:this._onObjectScaled.bind(this),createdPath:this._onCreatedPath,addText:this._onAddText.bind(this),addObject:this._onAddObject.bind(this),addObjectAfter:this._onAddObjectAfter.bind(this),textEditing:this._onTextEditing.bind(this),textChanged:this._onTextChanged.bind(this),iconCreateResize:this._onIconCreateResize.bind(this),iconCreateEnd:this._onIconCreateEnd.bind(this),selectionCleared:this._selectionCleared.bind(this),selectionCreated:this._selectionCreated.bind(this)},this._attachInvokerEvents(),this._attachGraphicsEvents(),this._attachDomEvents(),this._setSelectionStyle(i.selectionStyle,{applyCropSelectionStyle:i.applyCropSelectionStyle,applyGroupSelectionStyle:i.applyGroupSelectionStyle}),i.usageStatistics&&(0,f.sendHostName)(),this.ui&&(this.ui.initCanvas(),this.setReAction())}return n(t,[{key:"_setSelectionStyle",value:function(t,e){var i=e.applyCropSelectionStyle,n=e.applyGroupSelectionStyle;t&&this._graphics.setSelectionStyle(t),i&&this._graphics.setCropSelectionStyle(t),n&&this.on("selectionCreated",function(e){"group"===e.type&&e.set(t)})}},{key:"_attachInvokerEvents",value:function(){var t=p.UNDO_STACK_CHANGED,e=p.REDO_STACK_CHANGED;this._invoker.on(t,this.fire.bind(this,t)),this._invoker.on(e,this.fire.bind(this,e))}},{key:"_attachGraphicsEvents",value:function(){this._graphics.on({mousedown:this._handlers.mousedown,objectMoved:this._handlers.objectMoved,objectScaled:this._handlers.objectScaled,objectActivated:this._handlers.objectActivated,addText:this._handlers.addText,addObject:this._handlers.addObject,textEditing:this._handlers.textEditing,textChanged:this._handlers.textChanged,iconCreateResize:this._handlers.iconCreateResize,iconCreateEnd:this._handlers.iconCreateEnd,selectionCleared:this._handlers.selectionCleared,selectionCreated:this._handlers.selectionCreated,addObjectAfter:this._handlers.addObjectAfter})}},{key:"_attachDomEvents",value:function(){document.addEventListener("keydown",this._handlers.keydown)}},{key:"_detachDomEvents",value:function(){document.removeEventListener("keydown",this._handlers.keydown)}},{key:"_onKeyDown",value:function(t){(t.ctrlKey||t.metaKey)&&t.keyCode===v.Z&&this.undo().catch(function(){}),(t.ctrlKey||t.metaKey)&&t.keyCode===v.Y&&this.redo().catch(function(){}),t.keyCode!==v.BACKSPACE&&t.keyCode!==v.DEL||(t.preventDefault(),this.removeActiveObject())}},{key:"removeActiveObject",value:function(){var t=this._graphics.getActiveObject(),e=this._graphics.getActiveGroupObject();if(e){var i=e.getObjects();this.discardSelection(),this._removeObjectStream(i)}else if(t){var n=this._graphics.getObjectId(t);this.removeObject(n)}}},{key:"_removeObjectStream",value:function(t){var e=this;if(!t.length)return!0;var i=t.pop();return this.removeObject(this._graphics.getObjectId(i)).then(function(){return e._removeObjectStream(t)})}},{key:"_onMouseDown",value:function(t,e){this.fire(p.MOUSE_DOWN,t,e)}},{key:"_pushAddObjectCommand",value:function(t){var e=l.default.create(g.ADD_OBJECT,this._graphics,t);this._invoker.pushUndoStack(e)}},{key:"_onObjectActivated",value:function(t){this.fire(p.OBJECT_ACTIVATED,t)}},{key:"_onObjectMoved",value:function(t){this.fire(p.OBJECT_MOVED,t)}},{key:"_onObjectScaled",value:function(t){this.fire(p.OBJECT_SCALED,t)}},{key:"getDrawingMode",value:function(){return this._graphics.getDrawingMode()}},{key:"clearObjects",value:function(){return this.execute(g.CLEAR_OBJECTS)}},{key:"deactivateAll",value:function(){this._graphics.deactivateAll(),this._graphics.renderAll()}},{key:"discardSelection",value:function(){this._graphics.discardSelection()}},{key:"changeSelectableAll",value:function(t){this._graphics.changeSelectableAll(t)}},{key:"execute",value:function(t){for(var e,i=arguments.length,n=Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];var o=[this._graphics].concat(n);return(e=this._invoker).execute.apply(e,[t].concat(o))}},{key:"undo",value:function(){return this._invoker.undo()}},{key:"redo",value:function(){return this._invoker.redo()}},{key:"loadImageFromFile",value:function(t,e){if(!t)return o.default.reject(m.invalidParameters);var i=URL.createObjectURL(t);return e=e||t.name,this.loadImageFromURL(i,e).then(function(e){return URL.revokeObjectURL(t),e})}},{key:"loadImageFromURL",value:function(t,e){return e&&t?this.execute(g.LOAD_IMAGE,e,t):o.default.reject(m.invalidParameters)}},{key:"addImageObject",value:function(t){return t?this.execute(g.ADD_IMAGE_OBJECT,t):o.default.reject(m.invalidParameters)}},{key:"startDrawingMode",value:function(t,e){return this._graphics.startDrawingMode(t,e)}},{key:"stopDrawingMode",value:function(){this._graphics.stopDrawingMode()}},{key:"crop",value:function(t){var e=this._graphics.getCroppedImageData(t);return e?this.loadImageFromURL(e.url,e.imageName):o.default.reject(m.invalidParameters)}},{key:"getCropzoneRect",value:function(){return this._graphics.getCropzoneRect()}},{key:"_flip",value:function(t){return this.execute(g.FLIP_IMAGE,t)}},{key:"flipX",value:function(){return this._flip("flipX")}},{key:"flipY",value:function(){return this._flip("flipY")}},{key:"resetFlip",value:function(){return this._flip("reset")}},{key:"_rotate",value:function(t,e){return this.execute(g.ROTATE_IMAGE,t,e)}},{key:"rotate",value:function(t){return this._rotate("rotate",t)}},{key:"setAngle",value:function(t){return this._rotate("setAngle",t)}},{key:"setBrush",value:function(t){this._graphics.setBrush(t)}},{key:"setDrawingShape",value:function(t,e){this._graphics.setDrawingShape(t,e)}},{key:"addShape",value:function(t,e){return e=e||{},this._setPositions(e),this.execute(g.ADD_SHAPE,t,e)}},{key:"changeShape",value:function(t,e){return this.execute(g.CHANGE_SHAPE,t,e)}},{key:"addText",value:function(t,e){return t=t||"",e=e||{},this.execute(g.ADD_TEXT,t,e)}},{key:"changeText",value:function(t,e){return e=e||"",this.execute(g.CHANGE_TEXT,t,e)}},{key:"changeTextStyle",value:function(t,e){return this.execute(g.CHANGE_TEXT_STYLE,t,e)}},{key:"_changeActivateMode",value:function(t){"ICON"!==t&&this.getDrawingMode()!==t&&this.startDrawingMode(t)}},{key:"_onTextChanged",value:function(t){this.changeText(t.id,t.text)}},{key:"_onIconCreateResize",value:function(t){this.fire(p.ICON_CREATE_RESIZE,t)}},{key:"_onIconCreateEnd",value:function(t){this.fire(p.ICON_CREATE_END,t)}},{key:"_onTextEditing",value:function(){this.fire(p.TEXT_EDITING)}},{key:"_onAddText",value:function(t){this.fire(p.ADD_TEXT,{originPosition:t.originPosition,clientPosition:t.clientPosition})}},{key:"_onAddObject",value:function(t){var e=this._graphics.getObject(t.id);this._pushAddObjectCommand(e)}},{key:"_onAddObjectAfter",value:function(t){this.fire(p.ADD_OBJECT_AFTER,t)}},{key:"_selectionCleared",value:function(){this.fire(p.SELECTION_CLEARED)}},{key:"_selectionCreated",value:function(t){this.fire(p.SELECTION_CREATED,t)}},{key:"registerIcons",value:function(t){this._graphics.registerPaths(t)}},{key:"changeCursor",value:function(t){this._graphics.changeCursor(t)}},{key:"addIcon",value:function(t,e){return e=e||{},this._setPositions(e),this.execute(g.ADD_ICON,t,e)}},{key:"changeIconColor",value:function(t,e){return this.execute(g.CHANGE_ICON_COLOR,t,e)}},{key:"removeObject",value:function(t){return this.execute(g.REMOVE_OBJECT,t)}},{key:"hasFilter",value:function(t){return this._graphics.hasFilter(t)}},{key:"removeFilter",value:function(t){return this.execute(g.REMOVE_FILTER,t)}},{key:"applyFilter",value:function(t,e){return this.execute(g.APPLY_FILTER,t,e)}},{key:"toDataURL",value:function(t){return this._graphics.toDataURL(t)}},{key:"getImageName",value:function(){return this._graphics.getImageName()}},{key:"clearUndoStack",value:function(){this._invoker.clearUndoStack()}},{key:"clearRedoStack",value:function(){this._invoker.clearRedoStack()}},{key:"isEmptyUndoStack",value:function(){return this._invoker.isEmptyUndoStack()}},{key:"isEmptyRedoStack",value:function(){return this._invoker.isEmptyRedoStack()}},{key:"resizeCanvasDimension",value:function(t){return t?this.execute(g.RESIZE_CANVAS_DIMENSION,t):o.default.reject(m.invalidParameters)}},{key:"destroy",value:function(){var t=this;this.stopDrawingMode(),this._detachDomEvents(),this._graphics.destroy(),this._graphics=null,y(this,function(e,i){t[i]=null},this)}},{key:"_setPositions",value:function(t){var e=this._graphics.getCenter();b(t.left)&&(t.left=e.left),b(t.top)&&(t.top=e.top)}},{key:"setObjectProperties",value:function(t,e){return this.execute(g.SET_OBJECT_PROPERTIES,t,e)}},{key:"setObjectPropertiesQuietly",value:function(t,e){this._graphics.setObjectProperties(t,e)}},{key:"getObjectProperties",value:function(t,e){return this._graphics.getObject(t)?this._graphics.getObjectProperties(t,e):null}},{key:"getCanvasSize",value:function(){return this._graphics.getCanvasSize()}},{key:"getObjectPosition",value:function(t,e,i){return this._graphics.getObjectPosition(t,e,i)}},{key:"setObjectPosition",value:function(t,e){return this.execute(g.SET_OBJECT_POSITION,t,e)}}]),t}();c.default.mixin(x),_.mixin(x),t.exports=x},function(e,i){e.exports=t},function(t,e,i){i(5),i(6),i(50),i(54),t.exports=i(14).Promise},function(t,e){},function(t,e,i){"use strict";var n=i(7)(!0);i(10)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,i=this._i;return i>=e.length?{value:void 0,done:!0}:(t=n(e,i),this._i+=t.length,{value:t,done:!1})})},function(t,e,i){var n=i(8),r=i(9);t.exports=function(t){return function(e,i){var o,s,a=String(r(e)),c=n(i),l=a.length;return c<0||c>=l?t?"":void 0:(o=a.charCodeAt(c))<55296||o>56319||c+1===l||(s=a.charCodeAt(c+1))<56320||s>57343?t?a.charAt(c):o:t?a.slice(c,c+2):s-56320+(o-55296<<10)+65536}}},function(t,e){var i=Math.ceil,n=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?n:i)(t)}},function(t,e){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e,i){"use strict";var n=i(11),r=i(12),o=i(27),s=i(17),a=i(28),c=i(29),l=i(30),h=i(46),u=i(48),f=i(47)("iterator"),d=!([].keys&&"next"in[].keys()),p=function(){return this};t.exports=function(t,e,i,g,v,m,b){l(i,e,g);var y,_,x,w=function(t){if(!d&&t in k)return k[t];switch(t){case"keys":case"values":return function(){return new i(this,t)}}return function(){return new i(this,t)}},S=e+" Iterator",C="values"==v,O=!1,k=t.prototype,T=k[f]||k["@@iterator"]||v&&k[v],E=T||w(v),j=v?C?w("entries"):E:void 0,M="Array"==e&&k.entries||T;if(M&&(x=u(M.call(new t)))!==Object.prototype&&(h(x,S,!0),n||a(x,f)||s(x,f,p)),C&&T&&"values"!==T.name&&(O=!0,E=function(){return T.call(this)}),n&&!b||!d&&!O&&k[f]||s(k,f,E),c[e]=E,c[S]=p,v)if(y={values:C?E:w("values"),keys:m?E:w("keys"),entries:j},b)for(_ in y)_ in k||o(k,_,y[_]);else r(r.P+r.F*(d||O),e,y);return y}},function(t,e){t.exports=!0},function(t,e,i){var n=i(13),r=i(14),o=i(15),s=i(17),a=function(t,e,i){var c,l,h,u=t&a.F,f=t&a.G,d=t&a.S,p=t&a.P,g=t&a.B,v=t&a.W,m=f?r:r[e]||(r[e]={}),b=m.prototype,y=f?n:d?n[e]:(n[e]||{}).prototype;for(c in f&&(i=e),i)(l=!u&&y&&void 0!==y[c])&&c in m||(h=l?y[c]:i[c],m[c]=f&&"function"!=typeof y[c]?i[c]:g&&l?o(h,n):v&&y[c]==h?function(t){var e=function(e,i,n){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,i)}return new t(e,i,n)}return t.apply(this,arguments)};return e.prototype=t.prototype,e}(h):p&&"function"==typeof h?o(Function.call,h):h,p&&((m.virtual||(m.virtual={}))[c]=h,t&a.R&&b&&!b[c]&&s(b,c,h)))};a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,a.U=64,a.R=128,t.exports=a},function(t,e){var i=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=i)},function(t,e){var i=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=i)},function(t,e,i){var n=i(16);t.exports=function(t,e,i){if(n(t),void 0===e)return t;switch(i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,n){return t.call(e,i,n)};case 3:return function(i,n,r){return t.call(e,i,n,r)}}return function(){return t.apply(e,arguments)}}},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e,i){var n=i(18),r=i(26);t.exports=i(22)?function(t,e,i){return n.f(t,e,r(1,i))}:function(t,e,i){return t[e]=i,t}},function(t,e,i){var n=i(19),r=i(21),o=i(25),s=Object.defineProperty;e.f=i(22)?Object.defineProperty:function(t,e,i){if(n(t),e=o(e,!0),n(i),r)try{return s(t,e,i)}catch(t){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(t[e]=i.value),t}},function(t,e,i){var n=i(20);t.exports=function(t){if(!n(t))throw TypeError(t+" is not an object!");return t}},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e,i){t.exports=!i(22)&&!i(23)(function(){return 7!=Object.defineProperty(i(24)("div"),"a",{get:function(){return 7}}).a})},function(t,e,i){t.exports=!i(23)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e,i){var n=i(20),r=i(13).document,o=n(r)&&n(r.createElement);t.exports=function(t){return o?r.createElement(t):{}}},function(t,e,i){var n=i(20);t.exports=function(t,e){if(!n(t))return t;var i,r;if(e&&"function"==typeof(i=t.toString)&&!n(r=i.call(t)))return r;if("function"==typeof(i=t.valueOf)&&!n(r=i.call(t)))return r;if(!e&&"function"==typeof(i=t.toString)&&!n(r=i.call(t)))return r;throw TypeError("Can't convert object to primitive value")}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e,i){t.exports=i(17)},function(t,e){var i={}.hasOwnProperty;t.exports=function(t,e){return i.call(t,e)}},function(t,e){t.exports={}},function(t,e,i){"use strict";var n=i(31),r=i(26),o=i(46),s={};i(17)(s,i(47)("iterator"),function(){return this}),t.exports=function(t,e,i){t.prototype=n(s,{next:r(1,i)}),o(t,e+" Iterator")}},function(t,e,i){var n=i(19),r=i(32),o=i(44),s=i(41)("IE_PROTO"),a=function(){},c=function(){var t,e=i(24)("iframe"),n=o.length;for(e.style.display="none",i(45).appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),c=t.F;n--;)delete c.prototype[o[n]];return c()};t.exports=Object.create||function(t,e){var i;return null!==t?(a.prototype=n(t),i=new a,a.prototype=null,i[s]=t):i=c(),void 0===e?i:r(i,e)}},function(t,e,i){var n=i(18),r=i(19),o=i(33);t.exports=i(22)?Object.defineProperties:function(t,e){r(t);for(var i,s=o(e),a=s.length,c=0;a>c;)n.f(t,i=s[c++],e[i]);return t}},function(t,e,i){var n=i(34),r=i(44);t.exports=Object.keys||function(t){return n(t,r)}},function(t,e,i){var n=i(28),r=i(35),o=i(38)(!1),s=i(41)("IE_PROTO");t.exports=function(t,e){var i,a=r(t),c=0,l=[];for(i in a)i!=s&&n(a,i)&&l.push(i);for(;e.length>c;)n(a,i=e[c++])&&(~o(l,i)||l.push(i));return l}},function(t,e,i){var n=i(36),r=i(9);t.exports=function(t){return n(r(t))}},function(t,e,i){var n=i(37);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==n(t)?t.split(""):Object(t)}},function(t,e){var i={}.toString;t.exports=function(t){return i.call(t).slice(8,-1)}},function(t,e,i){var n=i(35),r=i(39),o=i(40);t.exports=function(t){return function(e,i,s){var a,c=n(e),l=r(c.length),h=o(s,l);if(t&&i!=i){for(;l>h;)if((a=c[h++])!=a)return!0}else for(;l>h;h++)if((t||h in c)&&c[h]===i)return t||h||0;return!t&&-1}}},function(t,e,i){var n=i(8),r=Math.min;t.exports=function(t){return t>0?r(n(t),9007199254740991):0}},function(t,e,i){var n=i(8),r=Math.max,o=Math.min;t.exports=function(t,e){return(t=n(t))<0?r(t+e,0):o(t,e)}},function(t,e,i){var n=i(42)("keys"),r=i(43);t.exports=function(t){return n[t]||(n[t]=r(t))}},function(t,e,i){var n=i(13),r=n["__core-js_shared__"]||(n["__core-js_shared__"]={});t.exports=function(t){return r[t]||(r[t]={})}},function(t,e){var i=0,n=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++i+n).toString(36))}},function(t,e){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,e,i){t.exports=i(13).document&&document.documentElement},function(t,e,i){var n=i(18).f,r=i(28),o=i(47)("toStringTag");t.exports=function(t,e,i){t&&!r(t=i?t:t.prototype,o)&&n(t,o,{configurable:!0,value:e})}},function(t,e,i){var n=i(42)("wks"),r=i(43),o=i(13).Symbol,s="function"==typeof o;(t.exports=function(t){return n[t]||(n[t]=s&&o[t]||(s?o:r)("Symbol."+t))}).store=n},function(t,e,i){var n=i(28),r=i(49),o=i(41)("IE_PROTO"),s=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=r(t),n(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?s:null}},function(t,e,i){var n=i(9);t.exports=function(t){return Object(n(t))}},function(t,e,i){i(51);for(var n=i(13),r=i(17),o=i(29),s=i(47)("toStringTag"),a=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],c=0;c<5;c++){var l=a[c],h=n[l],u=h&&h.prototype;u&&!u[s]&&r(u,s,l),o[l]=o.Array}},function(t,e,i){"use strict";var n=i(52),r=i(53),o=i(29),s=i(35);t.exports=i(10)(Array,"Array",function(t,e){this._t=s(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,i=this._i++;return!t||i>=t.length?(this._t=void 0,r(1)):r(0,"keys"==e?i:"values"==e?t[i]:[i,t[i]])},"values"),o.Arguments=o.Array,n("keys"),n("values"),n("entries")},function(t,e){t.exports=function(){}},function(t,e){t.exports=function(t,e){return{value:e,done:!!t}}},function(t,e,i){"use strict";var n,r,o,s=i(11),a=i(13),c=i(15),l=i(55),h=i(12),u=i(20),f=i(16),d=i(56),p=i(57),g=i(61),v=i(62).set,m=i(64)(),b=a.TypeError,y=a.process,_=a.Promise,x="process"==l(y=a.process),w=function(){},S=!!function(){try{var t=_.resolve(1),e=(t.constructor={})[i(47)("species")]=function(t){t(w,w)};return(x||"function"==typeof PromiseRejectionEvent)&&t.then(w)instanceof e}catch(t){}}(),C=function(t,e){return t===e||t===_&&e===o},O=function(t){var e;return!(!u(t)||"function"!=typeof(e=t.then))&&e},k=function(t){return C(_,t)?new T(t):new r(t)},T=r=function(t){var e,i;this.promise=new t(function(t,n){if(void 0!==e||void 0!==i)throw b("Bad Promise constructor");e=t,i=n}),this.resolve=f(e),this.reject=f(i)},E=function(t){try{t()}catch(t){return{error:t}}},j=function(t,e){if(!t._n){t._n=!0;var i=t._c;m(function(){for(var n=t._v,r=1==t._s,o=0,s=function(e){var i,o,s=r?e.ok:e.fail,a=e.resolve,c=e.reject,l=e.domain;try{s?(r||(2==t._h&&A(t),t._h=1),!0===s?i=n:(l&&l.enter(),i=s(n),l&&l.exit()),i===e.promise?c(b("Promise-chain cycle")):(o=O(i))?o.call(i,a,c):a(i)):c(n)}catch(t){c(t)}};i.length>o;)s(i[o++]);t._c=[],t._n=!1,e&&!t._h&&M(t)})}},M=function(t){v.call(a,function(){var e,i,n,r=t._v;if(P(t)&&(e=E(function(){x?y.emit("unhandledRejection",r,t):(i=a.onunhandledrejection)?i({promise:t,reason:r}):(n=a.console)&&n.error&&n.error("Unhandled promise rejection",r)}),t._h=x||P(t)?2:1),t._a=void 0,e)throw e.error})},P=function(t){if(1==t._h)return!1;for(var e,i=t._a||t._c,n=0;i.length>n;)if((e=i[n++]).fail||!P(e.promise))return!1;return!0},A=function(t){v.call(a,function(){var e;x?y.emit("rejectionHandled",t):(e=a.onrejectionhandled)&&e({promise:t,reason:t._v})})},I=function(t){var e=this;e._d||(e._d=!0,(e=e._w||e)._v=t,e._s=2,e._a||(e._a=e._c.slice()),j(e,!0))},D=function(t){var e,i=this;if(!i._d){i._d=!0,i=i._w||i;try{if(i===t)throw b("Promise can't be resolved itself");(e=O(t))?m(function(){var n={_w:i,_d:!1};try{e.call(t,c(D,n,1),c(I,n,1))}catch(t){I.call(n,t)}}):(i._v=t,i._s=1,j(i,!1))}catch(t){I.call({_w:i,_d:!1},t)}}};S||(_=function(t){d(this,_,"Promise","_h"),f(t),n.call(this);try{t(c(D,this,1),c(I,this,1))}catch(t){I.call(this,t)}},(n=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=i(65)(_.prototype,{then:function(t,e){var i=k(g(this,_));return i.ok="function"!=typeof t||t,i.fail="function"==typeof e&&e,i.domain=x?y.domain:void 0,this._c.push(i),this._a&&this._a.push(i),this._s&&j(this,!1),i.promise},catch:function(t){return this.then(void 0,t)}}),T=function(){var t=new n;this.promise=t,this.resolve=c(D,t,1),this.reject=c(I,t,1)}),h(h.G+h.W+h.F*!S,{Promise:_}),i(46)(_,"Promise"),i(66)("Promise"),o=i(14).Promise,h(h.S+h.F*!S,"Promise",{reject:function(t){var e=k(this);return(0,e.reject)(t),e.promise}}),h(h.S+h.F*(s||!S),"Promise",{resolve:function(t){if(t instanceof _&&C(t.constructor,this))return t;var e=k(this);return(0,e.resolve)(t),e.promise}}),h(h.S+h.F*!(S&&i(67)(function(t){_.all(t).catch(w)})),"Promise",{all:function(t){var e=this,i=k(e),n=i.resolve,r=i.reject,o=E(function(){var i=[],o=0,s=1;p(t,!1,function(t){var a=o++,c=!1;i.push(void 0),s++,e.resolve(t).then(function(t){c||(c=!0,i[a]=t,--s||n(i))},r)}),--s||n(i)});return o&&r(o.error),i.promise},race:function(t){var e=this,i=k(e),n=i.reject,r=E(function(){p(t,!1,function(t){e.resolve(t).then(i.resolve,n)})});return r&&n(r.error),i.promise}})},function(t,e,i){var n=i(37),r=i(47)("toStringTag"),o="Arguments"==n(function(){return arguments}());t.exports=function(t){var e,i,s;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),r))?i:o?n(e):"Object"==(s=n(e))&&"function"==typeof e.callee?"Arguments":s}},function(t,e){t.exports=function(t,e,i,n){if(!(t instanceof e)||void 0!==n&&n in t)throw TypeError(i+": incorrect invocation!");return t}},function(t,e,i){var n=i(15),r=i(58),o=i(59),s=i(19),a=i(39),c=i(60),l={},h={};(e=t.exports=function(t,e,i,u,f){var d,p,g,v,m=f?function(){return t}:c(t),b=n(i,u,e?2:1),y=0;if("function"!=typeof m)throw TypeError(t+" is not iterable!");if(o(m)){for(d=a(t.length);d>y;y++)if((v=e?b(s(p=t[y])[0],p[1]):b(t[y]))===l||v===h)return v}else for(g=m.call(t);!(p=g.next()).done;)if((v=r(g,b,p.value,e))===l||v===h)return v}).BREAK=l,e.RETURN=h},function(t,e,i){var n=i(19);t.exports=function(t,e,i,r){try{return r?e(n(i)[0],i[1]):e(i)}catch(e){var o=t.return;throw void 0!==o&&n(o.call(t)),e}}},function(t,e,i){var n=i(29),r=i(47)("iterator"),o=Array.prototype;t.exports=function(t){return void 0!==t&&(n.Array===t||o[r]===t)}},function(t,e,i){var n=i(55),r=i(47)("iterator"),o=i(29);t.exports=i(14).getIteratorMethod=function(t){if(void 0!=t)return t[r]||t["@@iterator"]||o[n(t)]}},function(t,e,i){var n=i(19),r=i(16),o=i(47)("species");t.exports=function(t,e){var i,s=n(t).constructor;return void 0===s||void 0==(i=n(s)[o])?e:r(i)}},function(t,e,i){var n,r,o,s=i(15),a=i(63),c=i(45),l=i(24),h=i(13),u=h.process,f=h.setImmediate,d=h.clearImmediate,p=h.MessageChannel,g=0,v={},m=function(){var t=+this;if(v.hasOwnProperty(t)){var e=v[t];delete v[t],e()}},b=function(t){m.call(t.data)};f&&d||(f=function(t){for(var e=[],i=1;arguments.length>i;)e.push(arguments[i++]);return v[++g]=function(){a("function"==typeof t?t:Function(t),e)},n(g),g},d=function(t){delete v[t]},"process"==i(37)(u)?n=function(t){u.nextTick(s(m,t,1))}:p?(o=(r=new p).port2,r.port1.onmessage=b,n=s(o.postMessage,o,1)):h.addEventListener&&"function"==typeof postMessage&&!h.importScripts?(n=function(t){h.postMessage(t+"","*")},h.addEventListener("message",b,!1)):n="onreadystatechange"in l("script")?function(t){c.appendChild(l("script")).onreadystatechange=function(){c.removeChild(this),m.call(t)}}:function(t){setTimeout(s(m,t,1),0)}),t.exports={set:f,clear:d}},function(t,e){t.exports=function(t,e,i){var n=void 0===i;switch(e.length){case 0:return n?t():t.call(i);case 1:return n?t(e[0]):t.call(i,e[0]);case 2:return n?t(e[0],e[1]):t.call(i,e[0],e[1]);case 3:return n?t(e[0],e[1],e[2]):t.call(i,e[0],e[1],e[2]);case 4:return n?t(e[0],e[1],e[2],e[3]):t.call(i,e[0],e[1],e[2],e[3])}return t.apply(i,e)}},function(t,e,i){var n=i(13),r=i(62).set,o=n.MutationObserver||n.WebKitMutationObserver,s=n.process,a=n.Promise,c="process"==i(37)(s);t.exports=function(){var t,e,i,l=function(){var n,r;for(c&&(n=s.domain)&&n.exit();t;){r=t.fn,t=t.next;try{r()}catch(n){throw t?i():e=void 0,n}}e=void 0,n&&n.enter()};if(c)i=function(){s.nextTick(l)};else if(o){var h=!0,u=document.createTextNode("");new o(l).observe(u,{characterData:!0}),i=function(){u.data=h=!h}}else if(a&&a.resolve){var f=a.resolve();i=function(){f.then(l)}}else i=function(){r.call(n,l)};return function(n){var r={fn:n,next:void 0};e&&(e.next=r),t||(t=r,i()),e=r}}},function(t,e,i){var n=i(17);t.exports=function(t,e,i){for(var r in e)i&&t[r]?t[r]=e[r]:n(t,r,e[r]);return t}},function(t,e,i){"use strict";var n=i(13),r=i(14),o=i(18),s=i(22),a=i(47)("species");t.exports=function(t){var e="function"==typeof r[t]?r[t]:n[t];s&&e&&!e[a]&&o.f(e,a,{configurable:!0,get:function(){return this}})}},function(t,e,i){var n=i(47)("iterator"),r=!1;try{var o=[7][n]();o.return=function(){r=!0},Array.from(o,function(){throw 2})}catch(t){}t.exports=function(t,e){if(!e&&!r)return!1;var i=!1;try{var o=[7],s=o[n]();s.next=function(){return{done:i=!0}},o[n]=function(){return s},t(o)}catch(t){}return i}},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=c(i(3)),o=c(i(4)),s=c(i(69)),a=c(i(73));function c(t){return t&&t.__esModule?t:{default:t}}var l=a.default.eventNames,h=a.default.rejectMessages,u=r.default.isFunction,f=r.default.isString,d=r.default.CustomEvents,p=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._undoStack=[],this._redoStack=[],this._isLocked=!1}return n(t,[{key:"_invokeExecution",value:function(t){var e=this;this.lock();var i=t.args;return i||(i=[]),t.execute.apply(t,i).then(function(i){return e.pushUndoStack(t),e.unlock(),u(t.executeCallback)&&t.executeCallback(i),i}).catch(function(t){return e.unlock(),o.default.reject(t)})}},{key:"_invokeUndo",value:function(t){var e=this;this.lock();var i=t.args;return i||(i=[]),t.undo.apply(t,i).then(function(i){return e.pushRedoStack(t),e.unlock(),u(t.undoCallback)&&t.undoCallback(i),i}).catch(function(t){return e.unlock(),o.default.reject(t)})}},{key:"_fireRedoStackChanged",value:function(){this.fire(l.REDO_STACK_CHANGED,this._redoStack.length)}},{key:"_fireUndoStackChanged",value:function(){this.fire(l.UNDO_STACK_CHANGED,this._undoStack.length)}},{key:"lock",value:function(){this._isLocked=!0}},{key:"unlock",value:function(){this._isLocked=!1}},{key:"execute",value:function(){var t=this;if(this._isLocked)return o.default.reject(h.isLock);for(var e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];var r=i[0];return f(r)&&(r=s.default.create.apply(s.default,i)),this._invokeExecution(r).then(function(e){return t.clearRedoStack(),e})}},{key:"undo",value:function(){var t=this._undoStack.pop(),e=void 0,i="";return t&&this._isLocked&&(this.pushUndoStack(t,!0),t=null),t?(this.isEmptyUndoStack()&&this._fireUndoStackChanged(),e=this._invokeUndo(t)):(i=h.undo,this._isLocked&&(i=i+" Because "+h.isLock),e=o.default.reject(i)),e}},{key:"redo",value:function(){var t=this._redoStack.pop(),e=void 0,i="";return t&&this._isLocked&&(this.pushRedoStack(t,!0),t=null),t?(this.isEmptyRedoStack()&&this._fireRedoStackChanged(),e=this._invokeExecution(t)):(i=h.redo,this._isLocked&&(i=i+" Because "+h.isLock),e=o.default.reject(i)),e}},{key:"pushUndoStack",value:function(t,e){this._undoStack.push(t),e||this._fireUndoStackChanged()}},{key:"pushRedoStack",value:function(t,e){this._redoStack.push(t),e||this._fireRedoStackChanged()}},{key:"isEmptyRedoStack",value:function(){return 0===this._redoStack.length}},{key:"isEmptyUndoStack",value:function(){return 0===this._undoStack.length}},{key:"clearUndoStack",value:function(){this.isEmptyUndoStack()||(this._undoStack=[],this._fireUndoStackChanged())}},{key:"clearRedoStack",value:function(){this.isEmptyRedoStack()||(this._redoStack=[],this._fireRedoStackChanged())}}]),t}();d.mixin(p),t.exports=p},function(t,e,i){"use strict";var n=function(t){return t&&t.__esModule?t:{default:t}}(i(70));var r={};t.exports={create:function(t){var e=r[t];if(e){for(var i=arguments.length,o=Array(i>1?i-1:0),s=1;s<i;s++)o[s-1]=arguments[s];return new n.default(e,o)}return null},register:function(t){r[t.name]=t}}},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=function(t){return t&&t.__esModule?t:{default:t}}(i(71));var o=r.default.create,s=r.default.types,a=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=e.name,this.args=i,this.execute=e.execute,this.undo=e.undo,this.executeCallback=e.executeCallback||null,this.undoCallback=e.undoCallback||null,this.undoData={}}return n(t,[{key:"execute",value:function(){throw new Error(o(s.UN_IMPLEMENTATION,"execute"))}},{key:"undo",value:function(){throw new Error(o(s.UN_IMPLEMENTATION,"undo"))}},{key:"setExecuteCallback",value:function(t){return this.executeCallback=t,this}},{key:"setUndoCallback",value:function(t){return this.undoCallback=t,this}}]),t}();t.exports=a},function(t,e,i){"use strict";var n=function(t){return t&&t.__esModule?t:{default:t}}(i(3));var r=(0,i(72).keyMirror)("UN_IMPLEMENTATION","NO_COMPONENT_NAME"),o="Should implement a method: ",s="Should set a component name",a={UN_IMPLEMENTATION:function(t){return o+t},NO_COMPONENT_NAME:function(){return s}};t.exports={types:n.default.extend({},r),create:function(t){t=t.toLowerCase();for(var e=a[t],i=arguments.length,n=Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];return e.apply(void 0,n)}}},function(t,e,i){"use strict";var n=i(3),r=Math.min,o=Math.max,s=!1;t.exports={clamp:function(t,e,i){var n=void 0;return e>i&&(n=e,e=i,i=n),o(e,r(t,i))},keyMirror:function(){for(var t={},e=arguments.length,i=Array(e),r=0;r<e;r++)i[r]=arguments[r];return(0,n.forEach)(i,function(e){t[e]=e}),t},makeStyleText:function(t){var e="";return(0,n.forEach)(t,function(t,i){e+=i+": "+t+";"}),e},getProperties:function(t,e){var i={},n=e.length,r=0,o=void 0;for(r=0;r<n;r+=1)i[o=e[r]]=t[o];return i},toInteger:function(t){return parseInt(t,10)},toCamelCase:function(t){return t.replace(/-([a-z])/g,function(t,e){return e.toUpperCase()})},isSupportFileApi:function(){return!!(window.File&&window.FileList&&window.FileReader)},getRgb:function(t,e){return 4===t.length&&(t=""+t+t.slice(1,4)),"rgba("+parseInt(t.slice(1,3),16)+", "+parseInt(t.slice(3,5),16)+", "+parseInt(t.slice(5,7),16)+", "+(e||1)+")"},sendHostName:function(){var t=location.hostname;s||(s=!0,(0,n.imagePing)("https://www.google-analytics.com/collect",{v:1,t:"event",tid:"UA-115377265-9",cid:t,dp:t,dh:"image-editor"}))},styleLoad:function(t,e){var i=document.getElementsByTagName("head")[0],n=document.createElement("link"),r=encodeURIComponent(t);e&&(n.id=e),n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("href","data:text/css;charset=UTF-8,"+r),i.appendChild(n)},getSelector:function(t){return function(e){return t.querySelector(e)}},base64ToBlob:function(t){var e="",i=void 0,n=void 0,r=void 0;i=t.replace(/data:(image\/.+);base64,/,function(t,i){return e=i,""});var o=(i=atob(i)).length;for(n=new Uint8Array(o),r=0;r<o;r+=1)n[r]=i.charCodeAt(r);return new Blob([n],{type:e})}}},function(t,e,i){"use strict";var n=function(t){return t&&t.__esModule?t:{default:t}}(i(72));t.exports={componentNames:n.default.keyMirror("IMAGE_LOADER","CROPPER","FLIP","ROTATION","FREE_DRAWING","LINE","TEXT","ICON","FILTER","SHAPE"),commandNames:{CLEAR_OBJECTS:"clearObjects",LOAD_IMAGE:"loadImage",FLIP_IMAGE:"flip",ROTATE_IMAGE:"rotate",ADD_OBJECT:"addObject",REMOVE_OBJECT:"removeObject",APPLY_FILTER:"applyFilter",REMOVE_FILTER:"removeFilter",ADD_ICON:"addIcon",CHANGE_ICON_COLOR:"changeIconColor",ADD_SHAPE:"addShape",CHANGE_SHAPE:"changeShape",ADD_TEXT:"addText",CHANGE_TEXT:"changeText",CHANGE_TEXT_STYLE:"changeTextStyle",ADD_IMAGE_OBJECT:"addImageObject",RESIZE_CANVAS_DIMENSION:"resizeCanvasDimension",SET_OBJECT_PROPERTIES:"setObjectProperties",SET_OBJECT_POSITION:"setObjectPosition"},eventNames:{OBJECT_ACTIVATED:"objectActivated",OBJECT_MOVED:"objectMoved",OBJECT_SCALED:"objectScaled",OBJECT_CREATED:"objectCreated",TEXT_EDITING:"textEditing",TEXT_CHANGED:"textChanged",ICON_CREATE_RESIZE:"iconCreateResize",ICON_CREATE_END:"iconCreateEnd",ADD_TEXT:"addText",ADD_OBJECT:"addObject",ADD_OBJECT_AFTER:"addObjectAfter",MOUSE_DOWN:"mousedown",MOUSE_UP:"mouseup",MOUSE_MOVE:"mousemove",REDO_STACK_CHANGED:"redoStackChanged",UNDO_STACK_CHANGED:"undoStackChanged",SELECTION_CLEARED:"selectionCleared",SELECTION_CREATED:"selectionCreated"},drawingModes:n.default.keyMirror("NORMAL","CROPPER","FREE_DRAWING","LINE_DRAWING","TEXT","SHAPE"),keyCodes:{Z:90,Y:89,SHIFT:16,BACKSPACE:8,DEL:46},fObjectOptions:{SELECTION_STYLE:{borderColor:"red",cornerColor:"green",cornerSize:10,originX:"center",originY:"center",transparentCorners:!1}},rejectMessages:{flip:"The flipX and flipY setting values are not changed.",rotation:"The current angle is same the old angle.",loadImage:"The background image is empty.",isLock:"The executing command state is locked.",undo:"The promise of undo command is reject.",redo:"The promise of redo command is reject.",invalidDrawingMode:"This operation is not supported in the drawing mode",invalidParameters:"Invalid parameters",noActiveObject:"There is no active object.",unsupportedType:"Unsupported object type",noObject:"The object is not in canvas.",addedObject:"The object is already added."},defaultIconPath:{"icon-arrow":"M40 12V0l24 24-24 24V36H0V12h40z","icon-arrow-2":"M49,32 H3 V22 h46 l-18,-18 h12 l23,23 L43,50 h-12 l18,-18  z ","icon-arrow-3":"M43.349998,27 L17.354,53 H1.949999 l25.996,-26 L1.949999,1 h15.404 L43.349998,27  z ","icon-star":"M35,54.557999 l-19.912001,10.468 l3.804,-22.172001 l-16.108,-15.7 l22.26,-3.236 L35,3.746 l9.956,20.172001 l22.26,3.236 l-16.108,15.7 l3.804,22.172001  z ","icon-star-2":"M17,31.212 l-7.194,4.08 l-4.728,-6.83 l-8.234,0.524 l-1.328,-8.226 l-7.644,-3.14 l2.338,-7.992 l-5.54,-6.18 l5.54,-6.176 l-2.338,-7.994 l7.644,-3.138 l1.328,-8.226 l8.234,0.522 l4.728,-6.83 L17,-24.312 l7.194,-4.08 l4.728,6.83 l8.234,-0.522 l1.328,8.226 l7.644,3.14 l-2.338,7.992 l5.54,6.178 l-5.54,6.178 l2.338,7.992 l-7.644,3.14 l-1.328,8.226 l-8.234,-0.524 l-4.728,6.83  z ","icon-polygon":"M3,31 L19,3 h32 l16,28 l-16,28 H19  z ","icon-location":"M24 62C8 45.503 0 32.837 0 24 0 10.745 10.745 0 24 0s24 10.745 24 24c0 8.837-8 21.503-24 38zm0-28c5.523 0 10-4.477 10-10s-4.477-10-10-10-10 4.477-10 10 4.477 10 10 10z","icon-heart":"M49.994999,91.349998 l-6.96,-6.333 C18.324001,62.606995 2.01,47.829002 2.01,29.690998 C2.01,14.912998 13.619999,3.299999 28.401001,3.299999 c8.349,0 16.362,5.859 21.594,12 c5.229,-6.141 13.242001,-12 21.591,-12 c14.778,0 26.390999,11.61 26.390999,26.390999 c0,18.138 -16.314001,32.916 -41.025002,55.374001 l-6.96,6.285  z ","icon-bubble":"M44 48L34 58V48H12C5.373 48 0 42.627 0 36V12C0 5.373 5.373 0 12 0h40c6.627 0 12 5.373 12 12v24c0 6.627-5.373 12-12 12h-8z"},defaultRotateRangeValus:{realTimeEvent:!0,min:-360,max:360,value:0},defaultDrawRangeValus:{min:5,max:30,value:12},defaultShapeStrokeValus:{realTimeEvent:!1,min:2,max:300,value:3},defaultTextRangeValus:{realTimeEvent:!0,min:10,max:100,value:50},defaultFilterRangeValus:{tintOpacityRange:{min:0,max:1,value:.7},removewhiteThresholdRange:{min:0,max:255,value:60},removewhiteDistanceRange:{min:0,max:255,value:10},gradientTransparencyRange:{min:0,max:255,value:100},brightnessRange:{min:-255,max:255,value:100},noiseRange:{min:0,max:1e3,value:100},pixelateRange:{min:2,max:20,value:4},colorfilterThresholeRange:{min:0,max:255,value:45}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=b(i(3)),o=b(i(72)),s=b(i(75)),a=b(i(76)),c=b(i(77)),l=b(i(80)),h=b(i(86)),u=b(i(88)),f=b(i(90)),d=b(i(92)),p=b(i(94)),g=b(i(96)),v=b(i(98)),m=b(i(100));function b(t){return t&&t.__esModule?t:{default:t}}var y={Shape:l.default,Crop:h.default,Flip:u.default,Rotate:f.default,Text:d.default,Mask:p.default,Icon:g.default,Draw:v.default,Filter:m.default},_=function(){function t(e,i,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.options=this._initializeOption(i),this._actions=n,this.submenu=!1,this.imageSize={},this.uiSize={},this.theme=new c.default(this.options.theme),this._submenuChangeTransection=!1,this._selectedElement=null,this._mainElement=null,this._editorElementWrap=null,this._editorElement=null,this._menuElement=null,this._subMenuElement=null,this._makeUiElement(e),this._setUiSize(),this._els={undo:this._menuElement.querySelector("#tie-btn-undo"),redo:this._menuElement.querySelector("#tie-btn-redo"),reset:this._menuElement.querySelector("#tie-btn-reset"),delete:this._menuElement.querySelector("#tie-btn-delete"),deleteAll:this._menuElement.querySelector("#tie-btn-delete-all"),download:this._selectedElement.querySelectorAll(".tui-image-editor-download-btn"),load:this._selectedElement.querySelectorAll(".tui-image-editor-load-btn")},this._makeSubMenu()}return n(t,[{key:"setUiDefaultSelectionStyle",value:function(t){return r.default.extend({applyCropSelectionStyle:!0,applyGroupSelectionStyle:!0,selectionStyle:{cornerStyle:"circle",cornerSize:20,cornerColor:"#fff",cornerStrokeColor:"#000",transparentCorners:!1,lineWidth:2,borderColor:"#fff"}},t)}},{key:"resizeEditor",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.uiSize,i=t.imageSize,n=void 0===i?this.imageSize:i;n!==this.imageSize&&(this.imageSize=n),e&&this._setUiSize(e);var r=this._getEditorDimension(),o=r.width,s=r.height,a=this._editorElement.style,c=this.options.menuBarPosition;a.height=s+"px",a.width=o+"px";var l=this._getEditorPosition(c),h=l.top,u=l.bottom,f=l.left,d=l.right;this._editorElementWrap.style.bottom=u+"px",this._editorElementWrap.style.top=h+"px",this._editorElementWrap.style.left=f+"px",this._editorElementWrap.style.width="calc(100% - "+d+"px)";var p=this._selectedElement.classList;"top"===c&&this._selectedElement.offsetWidth<"1300"?p.add("tui-image-editor-top-optimization"):p.remove("tui-image-editor-top-optimization")}},{key:"changeUndoButtonStatus",value:function(t){t?this._els.undo.classList.add("enabled"):this._els.undo.classList.remove("enabled")}},{key:"changeRedoButtonStatus",value:function(t){t?this._els.redo.classList.add("enabled"):this._els.redo.classList.remove("enabled")}},{key:"changeResetButtonStatus",value:function(t){t?this._els.reset.classList.add("enabled"):this._els.reset.classList.remove("enabled")}},{key:"changeDeleteAllButtonEnabled",value:function(t){t?this._els.deleteAll.classList.add("enabled"):this._els.deleteAll.classList.remove("enabled")}},{key:"changeDeleteButtonEnabled",value:function(t){t?this._els.delete.classList.add("enabled"):this._els.delete.classList.remove("enabled")}},{key:"_initializeOption",value:function(t){return r.default.extend({loadImage:{path:"",name:""},menuIconPath:"",menu:["crop","flip","rotate","draw","shape","icon","text","mask","filter"],initMenu:!1,uiSize:{width:"100%",height:"100%"},menuBarPosition:"bottom"},t)}},{key:"_setUiSize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.uiSize,e=this._selectedElement.style;e.width=t.width,e.height=t.height}},{key:"_makeSubMenu",value:function(){var t=this;r.default.forEach(this.options.menu,function(e){var i=y[e.replace(/^[a-z]/,function(t){return t.toUpperCase()})];t._makeMenuElement(e),t._els[e]=t._menuElement.querySelector("#tie-btn-"+e),t[e]=new i(t._subMenuElement,{iconStyle:t.theme.getStyle("submenu.icon"),menuBarPosition:t.options.menuBarPosition})})}},{key:"_makeUiElement",value:function(t){var e=void 0;window.snippet=r.default,e=t.jquery?t[0]:t.nodeType?t:document.querySelector(t);var i=o.default.getSelector(e);e.classList.add("tui-image-editor-container"),e.innerHTML=(0,a.default)({biImage:this.theme.getStyle("common.bi"),iconStyle:this.theme.getStyle("menu.icon"),loadButtonStyle:this.theme.getStyle("loadButton"),downloadButtonStyle:this.theme.getStyle("downloadButton")})+(0,s.default)({biImage:this.theme.getStyle("common.bi"),commonStyle:this.theme.getStyle("common"),headerStyle:this.theme.getStyle("header"),loadButtonStyle:this.theme.getStyle("loadButton"),downloadButtonStyle:this.theme.getStyle("downloadButton"),submenuStyle:this.theme.getStyle("submenu")}),this._selectedElement=e,this._selectedElement.classList.add(this.options.menuBarPosition),this._mainElement=i(".tui-image-editor-main"),this._editorElementWrap=i(".tui-image-editor-wrap"),this._editorElement=i(".tui-image-editor"),this._menuElement=i(".tui-image-editor-menu"),this._subMenuElement=i(".tui-image-editor-submenu")}},{key:"_makeMenuElement",value:function(t){var e=document.createElement("li"),i=this.theme.getStyle("menu.icon"),n=i.normal,r=i.active,o='\n            <svg class="svg_ic-menu">\n                <use xlink:href="'+n.path+"#"+n.name+"-ic-"+t+'" class="normal"/>\n                <use xlink:href="'+r.path+"#"+r.name+"-ic-"+t+'" class="active"/>\n            </svg>\n        ';e.id="tie-btn-"+t,e.className="tui-image-editor-item",e.title=t,e.innerHTML=o,this._menuElement.appendChild(e)}},{key:"_addHelpActionEvent",value:function(t){var e=this;this._els[t].addEventListener("click",function(){e._actions.main[t]()})}},{key:"_addDownloadEvent",value:function(){var t=this;r.default.forEach(this._els.download,function(e){e.addEventListener("click",function(){t._actions.main.download()})})}},{key:"_addLoadEvent",value:function(){var t=this;r.default.forEach(this._els.load,function(e){e.addEventListener("change",function(e){t._actions.main.load(e.target.files[0])})})}},{key:"_addMenuEvent",value:function(t){var e=this;this._els[t].addEventListener("click",function(){e.changeMenu(t)})}},{key:"_addSubMenuEvent",value:function(t){this[t].addEvent(this._actions[t])}},{key:"getEditorArea",value:function(){return this._editorElement}},{key:"initCanvas",value:function(){var t=this,e=this._getLoadImage();e&&this._actions.main.initLoadImage(e.path,e.name).then(function(){t._addHelpActionEvent("undo"),t._addHelpActionEvent("redo"),t._addHelpActionEvent("reset"),t._addHelpActionEvent("delete"),t._addHelpActionEvent("deleteAll"),t._addDownloadEvent(),t._addLoadEvent(),r.default.forEach(t.options.menu,function(e){t._addMenuEvent(e),t._addSubMenuEvent(e)}),t._initMenu()});var i=document.createElement("div");i.className="tui-image-editor-grid-visual";i.innerHTML='<table>\n           <tr><td class="dot left-top"></td><td></td><td class="dot right-top"></td></tr>\n           <tr><td></td><td></td><td></td></tr>\n           <tr><td class="dot left-bottom"></td><td></td><td class="dot right-bottom"></td></tr>\n         </table>',this._editorContainerElement=this._editorElement.querySelector(".tui-image-editor-canvas-container"),this._editorContainerElement.appendChild(i)}},{key:"_getLoadImage",value:function(){return this.options.loadImage}},{key:"changeMenu",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._submenuChangeTransection||(this._submenuChangeTransection=!0,this._changeMenu(t,e,i),this._submenuChangeTransection=!1)}},{key:"_changeMenu",value:function(t,e,i){this.submenu&&(this._els[this.submenu].classList.remove("active"),this._mainElement.classList.remove("tui-image-editor-menu-"+this.submenu),i&&this._actions.main.discardSelection(),this._actions.main.changeSelectableAll(!0),this[this.submenu].changeStandbyMode()),this.submenu===t&&e?this.submenu=null:(this._els[t].classList.add("active"),this._mainElement.classList.add("tui-image-editor-menu-"+t),this.submenu=t,this[this.submenu].changeStartMode()),this.resizeEditor()}},{key:"_initMenu",value:function(){if(this.options.initMenu){var t=document.createEvent("MouseEvents");t.initEvent("click",!0,!1),this._els[this.options.initMenu].dispatchEvent(t),this.icon&&this.icon.registDefaultIcon()}}},{key:"_getEditorDimension",value:function(){var t=parseFloat(this._editorContainerElement.style.maxHeight),e=this.imageSize.newHeight>t?t:this.imageSize.newHeight,i=parseFloat(this._editorContainerElement.style.maxWidth);return{width:this.imageSize.newWidth>i?i:this.imageSize.newWidth,height:e}}},{key:"_getEditorPosition",value:function(t){var e=0,i=0,n=0,r=0;if(this.submenu)switch(t){case"bottom":e+=150;break;case"top":i+=150;break;case"left":n+=248,r+=248;break;case"right":r+=248}return{top:i,bottom:e,left:n,right:r}}}]),t}();e.default=_},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.biImage;return'\n    <div class="tui-image-editor-main-container" style="'+t.commonStyle+'">\n        <div class="tui-image-editor-header" style="'+t.headerStyle+'">\n            <div class="tui-image-editor-header-logo">\n                <img src="'+e+'" />\n            </div>\n            <div class="tui-image-editor-header-buttons">\n                <button style="'+t.loadButtonStyle+'">\n                    Load\n                    <input type="file" class="tui-image-editor-load-btn" />\n                </button>\n                <button class="tui-image-editor-download-btn" style="'+t.downloadButtonStyle+'">\n                    Download\n                </button>\n            </div>\n        </div>\n        <div class="tui-image-editor-main">\n            <div class="tui-image-editor-submenu" style="'+t.submenuStyle+'">\n            </div>\n            <div class="tui-image-editor-wrap">\n                <div class="tui-image-editor-size-wrap">\n                    <div class="tui-image-editor-align-wrap">\n                        <div class="tui-image-editor"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n'}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.biImage,i=t.iconStyle,n=i.normal,r=i.active,o=t.loadButtonStyle,s=t.downloadButtonStyle;return'\n    <div class="tui-image-editor-controls">\n        <div class="tui-image-editor-controls-logo">\n            <img src="'+e+'" />\n        </div>\n        <ul class="tui-image-editor-menu">\n            <li id="tie-btn-undo" class="tui-image-editor-item" title="undo">\n                <svg class="svg_ic-menu">\n                    <use xlink:href="'+r.path+"#"+r.name+'-ic-undo" class="enabled"/>\n                    <use xlink:href="'+n.path+"#"+n.name+'-ic-undo" class="normal"/>\n                </svg>\n            </li>\n            <li id="tie-btn-redo" class="tui-image-editor-item" title="redo">\n                <svg class="svg_ic-menu">\n                    <use xlink:href="'+r.path+"#"+r.name+'-ic-redo" class="enabled"/>\n                    <use xlink:href="'+n.path+"#"+n.name+'-ic-redo" class="normal"/>\n                </svg>\n            </li>\n            <li id="tie-btn-reset" class="tui-image-editor-item" title="reset">\n                <svg class="svg_ic-menu">\n                    <use xlink:href="'+r.path+"#"+r.name+'-ic-reset" class="enabled"/>\n                    <use xlink:href="'+n.path+"#"+n.name+'-ic-reset" class="normal"/>\n                </svg>\n            </li>\n            <li class="tui-image-editor-item">\n                <div class="tui-image-editor-icpartition"></div>\n            </li>\n            <li id="tie-btn-delete" class="tui-image-editor-item" title="delete">\n                <svg class="svg_ic-menu">\n                    <use xlink:href="'+r.path+"#"+r.name+'-ic-delete" class="enabled"/>\n                    <use xlink:href="'+n.path+"#"+n.name+'-ic-delete" class="normal"/>\n                </svg>\n            </li>\n            <li id="tie-btn-delete-all" class="tui-image-editor-item" title="delete-all">\n                <svg class="svg_ic-menu">\n                    <use xlink:href="'+r.path+"#"+r.name+'-ic-delete-all" class="enabled"/>\n                    <use xlink:href="'+n.path+"#"+n.name+'-ic-delete-all" class="normal"/>\n                </svg>\n            </li>\n            <li class="tui-image-editor-item">\n                <div class="tui-image-editor-icpartition"></div>\n            </li>\n        </ul>\n\n        <div class="tui-image-editor-controls-buttons">\n            <button style="'+o+'">\n                Load\n                <input type="file" class="tui-image-editor-load-btn" />\n            </button>\n            <button class="tui-image-editor-download-btn" style="'+s+'">\n                Download\n            </button>\n        </div>\n    </div>\n'}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i(3),o=i(72),s=c(i(78)),a=c(i(79));function c(t){return t&&t.__esModule?t:{default:t}}var l=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.styles=this._changeToObject((0,r.extend)(a.default,e)),(0,o.styleLoad)(this._styleMaker())}return n(t,[{key:"getStyle",value:function(t){var e=null,i=t.replace(/\..+$/,""),n=this.styles[t];switch(t){case"common.bi":e=this.styles[t].image;break;case"menu.icon":case"submenu.icon":e={active:this.styles[i+".activeIcon"],normal:this.styles[i+".normalIcon"]};break;case"submenu.label":e={active:this._makeCssText(this.styles[i+".activeLabel"]),normal:this._makeCssText(this.styles[i+".normalLabel"])};break;case"submenu.partition":e={vertical:this._makeCssText((0,r.extend)({},n,{borderLeft:"1px solid "+n.color})),horizontal:this._makeCssText((0,r.extend)({},n,{borderBottom:"1px solid "+n.color}))};break;case"range.pointer":case"range.bar":case"range.subbar":n.backgroundColor=n.color,e=this._makeCssText(n);break;default:e=this._makeCssText(n)}return e}},{key:"_styleMaker",value:function(){var t=this.getStyle("submenu.label"),e=this.getStyle("submenu.partition");return(0,s.default)({subMenuLabelActive:t.active,subMenuLabelNormal:t.normal,submenuPartitionVertical:e.vertical,submenuPartitionHorizontal:e.horizontal,biSize:this.getStyle("common.bisize"),subMenuRangeTitle:this.getStyle("range.title"),submenuRangePointer:this.getStyle("range.pointer"),submenuRangeBar:this.getStyle("range.bar"),submenuRangeSubbar:this.getStyle("range.subbar"),submenuRangeValue:this.getStyle("range.value"),submenuColorpickerTitle:this.getStyle("colorpicker.title"),submenuColorpickerButton:this.getStyle("colorpicker.button"),submenuCheckbox:this.getStyle("checkbox"),menuIconSize:this.getStyle("menu.iconSize"),submenuIconSize:this.getStyle("submenu.iconSize")})}},{key:"_changeToObject",value:function(t){var e={};return(0,r.forEach)(t,function(t,i){var n=i.match(/^(.+)\.([a-z]+)$/i),r=n[1],o=n[2];e[r]||(e[r]={}),e[r][o]=t}),e}},{key:"_makeCssText",value:function(t){var e=this,i=[];return(0,r.forEach)(t,function(t,n){["backgroundImage"].indexOf(n)>-1&&"none"!==t&&(t="url("+t+")"),i.push(e._toUnderScore(n)+": "+t)}),i.join(";")}},{key:"_toUnderScore",value:function(t){return t.replace(/([A-Z])/g,function(t,e){return"-"+e.toLowerCase()})}}]),t}();e.default=l},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.subMenuLabelActive,i=t.subMenuLabelNormal,n=t.subMenuRangeTitle,r=t.submenuPartitionVertical,o=t.submenuPartitionHorizontal,s=t.submenuCheckbox,a=t.submenuRangePointer,c=t.submenuRangeValue,l=t.submenuColorpickerTitle,h=t.submenuColorpickerButton,u=t.submenuRangeBar,f=t.submenuRangeSubbar,d=t.submenuIconSize;return'\n    #tie-icon-add-button.icon-bubble .tui-image-editor-button[data-icontype="icon-bubble"] label,\n    #tie-icon-add-button.icon-heart .tui-image-editor-button[data-icontype="icon-heart"] label,\n    #tie-icon-add-button.icon-location .tui-image-editor-button[data-icontype="icon-location"] label,\n    #tie-icon-add-button.icon-polygon .tui-image-editor-button[data-icontype="icon-polygon"] label,\n    #tie-icon-add-button.icon-star .tui-image-editor-button[data-icontype="icon-star"] label,\n    #tie-icon-add-button.icon-arrow-3 .tui-image-editor-button[data-icontype="icon-arrow-3"] label,\n    #tie-icon-add-button.icon-arrow-2 .tui-image-editor-button[data-icontype="icon-arrow-2"] label,\n    #tie-icon-add-button.icon-arrow .tui-image-editor-button[data-icontype="icon-arrow"] label,\n    #tie-icon-add-button.icon-bubble .tui-image-editor-button[data-icontype="icon-bubble"] label,\n    #tie-draw-line-select-button.line .tui-image-editor-button.line label,\n    #tie-draw-line-select-button.free .tui-image-editor-button.free label,\n    #tie-flip-button.flipX .tui-image-editor-button.flipX label,\n    #tie-flip-button.flipY .tui-image-editor-button.flipY label,\n    #tie-flip-button.resetFlip .tui-image-editor-button.resetFlip label,\n    #tie-crop-button .tui-image-editor-button.apply.active label,\n    #tie-shape-button.rect .tui-image-editor-button.rect label,\n    #tie-shape-button.circle .tui-image-editor-button.circle label,\n    #tie-shape-button.triangle .tui-image-editor-button.triangle label,\n    #tie-text-effect-button .tui-image-editor-button.active label,\n    #tie-text-align-button.left .tui-image-editor-button.left label,\n    #tie-text-align-button.center .tui-image-editor-button.center label,\n    #tie-text-align-button.right .tui-image-editor-button.right label,\n    #tie-mask-apply.apply.active .tui-image-editor-button.apply label,\n    .tui-image-editor-container .tui-image-editor-submenu .tui-image-editor-button:hover > label,\n    .tui-image-editor-container .tui-image-editor-checkbox input + label {\n        '+e+"\n    }\n    .tui-image-editor-container .tui-image-editor-submenu .tui-image-editor-button > label,\n    .tui-image-editor-container .tui-image-editor-range-wrap.tui-image-editor-newline.short label {\n        "+i+"\n    }\n    .tui-image-editor-container .tui-image-editor-range-wrap label {\n        "+n+"\n    }\n    .tui-image-editor-container .tui-image-editor-partition > div {\n        "+r+"\n    }\n    .tui-image-editor-container.left .tui-image-editor-submenu .tui-image-editor-partition > div,\n    .tui-image-editor-container.right .tui-image-editor-submenu .tui-image-editor-partition > div {\n        "+o+"\n    }\n    .tui-image-editor-container .tui-image-editor-checkbox input + label:before {\n        "+s+"\n    }\n    .tui-image-editor-container .tui-image-editor-virtual-range-pointer {\n        "+a+"\n    }\n    .tui-image-editor-container .tui-image-editor-virtual-range-bar {\n        "+u+"\n    }\n    .tui-image-editor-container .tui-image-editor-virtual-range-subbar {\n        "+f+"\n    }\n    .tui-image-editor-container .tui-image-editor-range-value {\n        "+c+"\n    }\n    .tui-image-editor-container .tui-image-editor-submenu .tui-image-editor-button .color-picker-value + label {\n        "+l+"\n    }\n    .tui-image-editor-container .tui-image-editor-submenu .tui-image-editor-button .color-picker-value {\n        "+h+"\n    }\n    .tui-image-editor-container .svg_ic-menu {\n        "+t.menuIconSize+"\n    }\n    .tui-image-editor-container .svg_ic-submenu {\n        "+d+"\n    }\n    .tui-image-editor-container .tui-image-editor-controls-logo > img,\n    .tui-image-editor-container .tui-image-editor-header-logo > img {\n        "+t.biSize+"\n    }\n\n"}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={"common.bi.image":"https://uicdn.toast.com/toastui/img/tui-image-editor-bi.png","common.bisize.width":"251px","common.bisize.height":"21px","common.backgroundImage":"none","common.backgroundColor":"#1e1e1e","common.border":"0px","header.backgroundImage":"none","header.backgroundColor":"transparent","header.border":"0px","loadButton.backgroundColor":"#fff","loadButton.border":"1px solid #ddd","loadButton.color":"#222","loadButton.fontFamily":"NotoSans, sans-serif","loadButton.fontSize":"12px","downloadButton.backgroundColor":"#fdba3b","downloadButton.border":"1px solid #fdba3b","downloadButton.color":"#fff","downloadButton.fontFamily":"NotoSans, sans-serif","downloadButton.fontSize":"12px","menu.normalIcon.path":"icon-b.svg","menu.normalIcon.name":"icon-b","menu.activeIcon.path":"icon-a.svg","menu.activeIcon.name":"icon-a","menu.iconSize.width":"24px","menu.iconSize.height":"24px","submenu.backgroundColor":"transparent","submenu.partition.color":"#858585","submenu.normalIcon.path":"icon-a.svg","submenu.normalIcon.name":"icon-a","submenu.activeIcon.path":"icon-c.svg","submenu.activeIcon.name":"icon-c","submenu.iconSize.width":"32px","submenu.iconSize.height":"32px","submenu.normalLabel.color":"#858585","submenu.normalLabel.fontWeight":"lighter","submenu.activeLabel.color":"#fff","submenu.activeLabel.fontWeight":"lighter","checkbox.border":"1px solid #ccc","checkbox.backgroundColor":"#fff","range.pointer.color":"#fff","range.bar.color":"#666","range.subbar.color":"#d1d1d1","range.value.color":"#fff","range.value.fontWeight":"lighter","range.value.fontSize":"11px","range.value.border":"1px solid #353535","range.value.backgroundColor":"#151515","range.title.color":"#fff","range.title.fontWeight":"lighter","colorpicker.button.border":"1px solid #1e1e1e","colorpicker.title.color":"#fff"}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=h(i(81)),o=h(i(83)),s=h(i(84)),a=h(i(85)),c=i(72),l=i(73);function h(t){return t&&t.__esModule?t:{default:t}}var u={stroke:"#ffbb3b",fill:"",strokeWidth:3},f=function(t){function e(t,i){var n=i.iconStyle,s=i.menuBarPosition;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var c=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,{name:"shape",iconStyle:n,menuBarPosition:s,templateHtml:a.default}));return c.type=null,c.options=u,c._els={shapeSelectButton:c.selector("#tie-shape-button"),shapeColorButton:c.selector("#tie-shape-color-button"),strokeRange:new o.default(c.selector("#tie-stroke-range"),l.defaultShapeStrokeValus),strokeRangeValue:c.selector("#tie-stroke-range-value"),fillColorpicker:new r.default(c.selector("#tie-color-fill"),"",c.toggleDirection),strokeColorpicker:new r.default(c.selector("#tie-color-stroke"),"#ffbb3b",c.toggleDirection)},c}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,s.default),n(e,[{key:"addEvent",value:function(t){this.actions=t,this._els.shapeSelectButton.addEventListener("click",this._changeShapeHandler.bind(this)),this._els.strokeRange.on("change",this._changeStrokeRangeHandler.bind(this)),this._els.fillColorpicker.on("change",this._changeFillColorHandler.bind(this)),this._els.strokeColorpicker.on("change",this._changeStrokeColorHandler.bind(this)),this._els.strokeRangeValue.value=this._els.strokeRange.value,this._els.strokeRangeValue.setAttribute("readonly",!0)}},{key:"setShapeStatus",value:function(t){var e=t.strokeWidth,i=t.strokeColor,n=t.fillColor;this._els.strokeRange.value=e,this._els.strokeRange.trigger("change"),this._els.strokeColorpicker.color=i,this._els.fillColorpicker.color=n,this.options.stroke=i,this.options.fill=n,this.options.strokeWidth=e}},{key:"changeStartMode",value:function(){this.actions.stopDrawingMode()}},{key:"changeStandbyMode",value:function(){this.type=null,this.actions.changeSelectableAll(!0),this._els.shapeSelectButton.classList.remove("circle"),this._els.shapeSelectButton.classList.remove("triangle"),this._els.shapeSelectButton.classList.remove("rect")}},{key:"setMaxStrokeValue",value:function(t){var e=t;e<=0&&(e=l.defaultShapeStrokeValus.max),this._els.strokeRange.max=e}},{key:"setStrokeValue",value:function(t){this._els.strokeRange.value=t,this._els.strokeRange.trigger("change")}},{key:"getStrokeValue",value:function(){return this._els.strokeRange.value}},{key:"_changeShapeHandler",value:function(t){var e=t.target.closest(".tui-image-editor-button");if(e){this.actions.stopDrawingMode(),this.actions.discardSelection();var i=this.getButtonType(e,["circle","triangle","rect"]);if(this.type===i)return void this.changeStandbyMode();this.changeStandbyMode(),this.type=i,t.currentTarget.classList.add(i),this.actions.changeSelectableAll(!1),this.actions.modeChange("shape")}}},{key:"_changeStrokeRangeHandler",value:function(t){this.options.strokeWidth=(0,c.toInteger)(t),this._els.strokeRangeValue.value=(0,c.toInteger)(t),this.actions.changeShape({strokeWidth:t}),this.actions.setDrawingShape(this.type,this.options)}},{key:"_changeFillColorHandler",value:function(t){t=t||"transparent",this.options.fill=t,this.actions.changeShape({fill:t})}},{key:"_changeStrokeColorHandler",value:function(t){t=t||"transparent",this.options.stroke=t,this.actions.changeShape({stroke:t})}}]),e}();e.default=f},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=a(i(3)),o=i(72),s=a(i(82));function a(t){return t&&t.__esModule?t:{default:t}}var c=["#000000","#2a2a2a","#545454","#7e7e7e","#a8a8a8","#d2d2d2","#ffffff","","#ff4040","#ff6518","#ffbb3b","#03bd9e","#00a9ff","#515ce6","#9e5fff","#ff5583"],l=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#7e7e7e",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"up";!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var r=e.getAttribute("title");this._show=!1,this._toggleDirection=n,this._makePickerButtonElement(e,i),this._makePickerLayerElement(e,r),this._color=i,this.picker=s.default.create({container:this.pickerElement,preset:c,color:i}),this._addEvent(e)}return n(t,[{key:"_changeColorElement",value:function(t){t?(this.colorElement.classList.remove("transparent"),this.colorElement.style.backgroundColor=t):(this.colorElement.style.backgroundColor="#fff",this.colorElement.classList.add("transparent"))}},{key:"_makePickerButtonElement",value:function(t,e){t.classList.add("tui-image-editor-button"),this.colorElement=document.createElement("div"),this.colorElement.className="color-picker-value",e?this.colorElement.style.backgroundColor=e:this.colorElement.classList.add("transparent")}},{key:"_makePickerLayerElement",value:function(t,e){var i=document.createElement("label"),n=document.createElement("div");this.pickerControl=document.createElement("div"),this.pickerControl.className="color-picker-control",this.pickerElement=document.createElement("div"),this.pickerElement.className="color-picker",i.innerHTML=e,n.className="triangle",this.pickerControl.appendChild(this.pickerElement),this.pickerControl.appendChild(n),t.appendChild(this.pickerControl),t.appendChild(this.colorElement),t.appendChild(i),this._setPickerControlPosition()}},{key:"_addEvent",value:function(t){var e=this;this.picker.on("selectColor",function(t){e._changeColorElement(t.color),e._color=t.color,e.fire("change",t.color)}),t.addEventListener("click",function(t){e._show=!e._show,e.pickerControl.style.display=e._show?"block":"none",t.stopPropagation()}),document.body.addEventListener("click",function(){e._show=!1,e.pickerControl.style.display="none"})}},{key:"_setPickerControlPosition",value:function(){var t=this.pickerControl.style,e=(0,o.toInteger)(window.getComputedStyle(this.pickerControl,null).width)/2-20,i=-1*((0,o.toInteger)(window.getComputedStyle(this.pickerControl,null).height)+12);"down"===this._toggleDirection&&(i=30),t.top=i+"px",t.left="-"+e+"px"}},{key:"color",get:function(){return this._color},set:function(t){this._color=t,this._changeColorElement(t)}}]),t}();r.default.CustomEvents.mixin(l),e.default=l},function(t,e,i){
/*!
	 * Toast UI Colorpicker
	 * @version 2.2.0
	 * @author NHNEnt FE Development Team <dl_javascript@nhnent.com>
	 * @license MIT
	 */
!function(e,n){t.exports=n(i(3))}(0,function(t){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={exports:{},id:n,loaded:!1};return t[n].call(r.exports,r,r.exports,i),r.loaded=!0,r.exports}return i.m=t,i.c=e,i.p="dist",i(0)}([function(t,e,i){i(1),t.exports=i(6)},function(t,e){},,,,,function(t,e,i){"use strict";var n={domutil:i(7),domevent:i(9),Collection:i(10),View:i(11),Drag:i(12),create:i(13),Palette:i(16),Slider:i(18),colorutil:i(14),svgvml:i(19)};t.exports=n},function(t,e,i){"use strict";var n,r,o=i(8),s=i(9),a=i(10),c=o,l="onselectstart"in document,h="",u=/^auto$|^$|%/;r=(n={appendHTMLElement:function(t,e,i){var n;return i=i||"",(n=document.createElement(t)).className=i,e?e.appendChild(n):document.body.appendChild(n),n},remove:function(t){t&&t.parentNode&&t.parentNode.removeChild(t)},get:function(t){return document.getElementById(t)},_matcher:function(t,e){return/^\./.test(e)?n.hasClass(t,e.replace(".","")):/^#/.test(e)?t.id===e.replace("#",""):t.nodeName.toLowerCase()===e.toLowerCase()},find:function(t,e,i){var r=[],o=!1,s=c.isUndefined(i)||!1===i,a=c.isFunction(i);return c.isString(e)&&(e=n.get(e)),function t(e,c){for(var l,h=e.childNodes,u=0,f=h.length;u<f;u+=1)if("#text"!==(l=h[u]).nodeName)if(n._matcher(l,c)){if((a&&i(l)||!a)&&r.push(l),s){o=!0;break}}else if(l.childNodes.length>0&&(t(l,c),o))break}(e=e||window.document.body,t),s?r[0]||null:r},closest:function(t,e){var i=t.parentNode;if(n._matcher(t,e))return t;for(;i&&i!==window.document.body;){if(n._matcher(i,e))return i;i=i.parentNode}},text:function(t){var e="",i=0,r=t.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)e+=n.text(t)}else if(3===r||4===r)return t.nodeValue}else for(;t[i];i+=1)e+=n.text(t[i]);return e},setData:function(t,e,i){"dataset"in t?t.dataset[e]=i:t.setAttribute("data-"+e,i)},getData:function(t,e){return"dataset"in t?t.dataset[e]:t.getAttribute("data-"+e)},hasClass:function(t,e){var i;return c.isUndefined(t.classList)?(i=n.getClass(t)).length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(i):t.classList.contains(e)},addClass:function(t,e){var i;c.isUndefined(t.classList)?n.hasClass(t,e)||(i=n.getClass(t),n.setClass(t,(i?i+" ":"")+e)):c.forEachArray(e.split(" "),function(e){t.classList.add(e)})},setClass:function(t,e){c.isUndefined(t.className.baseVal)?t.className=e:t.className.baseVal=e},removeClass:function(t,e){var i="";c.isUndefined(t.classList)?(i=(" "+n.getClass(t)+" ").replace(" "+e+" "," "),n.setClass(t,function(t){return t.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}(i))):t.classList.remove(e)},getClass:function(t){return t&&t.className?c.isUndefined(t.className.baseVal)?t.className:t.className.baseVal:""},getStyle:function(t,e){var i,n=t.style[e]||t.currentStyle&&t.currentStyle[e];return n&&"auto"!==n||!document.defaultView||(n=(i=document.defaultView.getComputedStyle(t,null))?i[e]:null),"auto"===n?null:n},getComputedStyle:function(t){var e=document.defaultView;return e&&e.getComputedStyle?document.defaultView.getComputedStyle(t):{getPropertyValue:function(e){var i=/(\-([a-z]){1})/g;return"float"===e&&(e="styleFloat"),i.test(e)&&(e=e.replace(i,function(){return arguments[2].toUpperCase()})),t.currentStyle[e]?t.currentStyle[e]:null}}},setPosition:function(t,e,i){e=c.isUndefined(e)?0:e,i=c.isUndefined(i)?0:i,t._pos=[e,i],t.style.left=e+"px",t.style.top=i+"px"},getPosition:function(t,e){var i,n,r;return e&&(t._pos=null),t._pos?t._pos:(i=0,n=0,(u.test(t.style.left)||u.test(t.style.top))&&"getBoundingClientRect"in t?(i=(r=t.getBoundingClientRect()).left,n=r.top):(i=parseFloat(t.style.left||0),n=parseFloat(t.style.top||0)),[i,n])},getSize:function(t){var e,i=n.getStyle(t,"width"),r=n.getStyle(t,"height");return(u.test(i)||u.test(r))&&"getBoundingClientRect"in t?(i=(e=t.getBoundingClientRect()).width,r=e.height):(i=parseFloat(i||0),r=parseFloat(r||0)),[i,r]},testProp:function(t){for(var e=document.documentElement.style,i=0,n=t.length;i<n;i+=1)if(t[i]in e)return t[i];return!1},getFormData:function(t){var e=new a(function(){return this.length}),i=function(t){return!t.disabled},r={};return e.add.apply(e,n.find("input",t,i).concat(n.find("select",t,i)).concat(n.find("textarea",t,i))),e=e.groupBy(function(t){return t&&t.getAttribute("name")||"_other"}),c.forEach(e,function(t,e){"_other"!==e&&t.each(function(i){var o=i.nodeName.toLowerCase(),s=i.type,a=[];"radio"===s?a=[t.find(function(t){return t.checked}).toArray().pop()]:"checkbox"===s?a=t.find(function(t){return t.checked}).toArray():"select"===o?t.find(function(t){return!!t.childNodes.length}).each(function(t){a=a.concat(n.find("option",t,function(t){return t.selected}))}):a=t.find(function(t){return""!==t.value}).toArray(),(a=c.map(a,function(t){return t.value})).length?1===a.length&&(a=a[0]):a="",r[e]=a})}),r}}).testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]),n.disableTextSelection=l?function(){s.on(window,"selectstart",s.preventDefault)}:function(){var t=document.documentElement.style;h=t[r],t[r]="none"},n.enableTextSelection=l?function(){s.off(window,"selectstart",s.preventDefault)}:function(){document.documentElement.style[r]=h},n.disableImageDrag=function(){s.on(window,"dragstart",s.preventDefault)},n.enableImageDrag=function(){s.off(window,"dragstart",s.preventDefault)},n.applyTemplate=function(t,e){return t.replace(/\{\{(\w*)\}\}/g,function(t,i){return e.hasOwnProperty(i)?e[i]:""})},t.exports=n},function(e,i){e.exports=t},function(t,e,i){"use strict";var n=i(8),r=n.browser,o={START:["touchstart","mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},s={on:function(t,e,i,r){n.isString(e)?n.forEach(e.split(" "),function(e){s._on(t,e,i,r)}):n.forEachOwnProperties(e,function(e,n){s._on(t,n,e,i)})},_on:function(t,e,i,r){var o,a,c;o=e+n.stamp(i)+(r?"_"+n.stamp(r):""),t._evt&&t._evt[o]||(c=a=function(e){i.call(r||t,e||window.event)},"addEventListener"in t?"mouseenter"===e||"mouseleave"===e?(a=function(e){e=e||window.event,s._checkMouse(t,e)&&c(e)},t.addEventListener("mouseenter"===e?"mouseover":"mouseout",a,!1)):("mousewheel"===e&&t.addEventListener("DOMMouseScroll",a,!1),t.addEventListener(e,a,!1)):"attachEvent"in t&&t.attachEvent("on"+e,a),t._evt=t._evt||{},t._evt[o]=a)},off:function(t,e,i,r){n.isString(e)?n.forEach(e.split(" "),function(e){s._off(t,e,i,r)}):n.forEachOwnProperties(e,function(e,n){s._off(t,n,e,i)})},_off:function(t,e,i,r){var o=e+n.stamp(i)+(r?"_"+n.stamp(r):""),s=t._evt&&t._evt[o];if(s){if("removeEventListener"in t)"mouseenter"===e||"mouseleave"===e?t.removeEventListener("mouseenter"===e?"mouseover":"mouseout",s,!1):("mousewheel"===e&&t.removeEventListener("DOMMouseScroll",s,!1),t.removeEventListener(e,s,!1));else if("detachEvent"in t)try{t.detachEvent("on"+e,s)}catch(t){}delete t._evt[o],n.keys(t._evt).length||(n.browser.msie&&n.browser.version<9?t._evt=null:delete t._evt)}},once:function(t,e,i,r){var o=this;n.isObject(e)?n.forEachOwnProperties(e,function(e,n){s.once(t,n,e,i)}):s.on(t,e,function n(){i.apply(r||t,arguments),o._off(t,e,n,r)},r)},stopPropagation:function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},preventDefault:function(t){t.preventDefault?t.preventDefault():t.returnValue=!1},stop:function(t){s.preventDefault(t),s.stopPropagation(t)},disableScrollPropagation:function(t){s.on(t,"mousewheel MozMousePixelScroll",s.stopPropagation)},disableClickPropagation:function(t){s.on(t,o.START.join(" ")+" click dblclick",s.stopPropagation)},getMousePosition:function(t,e){var i;return e?(i=e.getBoundingClientRect(),[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]):[t.clientX,t.clientY]},getWheelDelta:function(t){var e=0;return t.wheelDelta&&(e=t.wheelDelta/120),t.detail&&(e=-t.detail/3),e},_checkMouse:function(t,e){var i=e.relatedTarget;if(!i)return!0;try{for(;i&&i!==t;)i=i.parentNode}catch(t){return!1}return i!==t},trigger:function(t,e,i){n.isUndefined(i)&&/(mouse|click)/.exec(e)&&(i=s.mouseEvent(e)),t.dispatchEvent?t.dispatchEvent(i):t.fireEvent&&t.fireEvent("on"+e,i)},mouseEvent:function(t,e){var i,o;return o=n.extend({bubbles:!0,cancelable:"mousemove"!==t,view:window,wheelDelta:0,detail:0,screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:void 0},e),r.msie&&r.version<9&&delete o.wheelDelta,"function"==typeof document.createEvent?(i=document.createEvent("MouseEvents")).initMouseEvent(t,o.bubbles,o.cancelable,o.view,o.detail,o.screenX,o.screenY,o.clientX,o.clientY,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.button,document.body.parentNode):document.createEventObject&&(i=document.createEventObject(),n.forEach(o,function(t,e){i[e]=t},this),i.button={0:1,1:4,2:2}[i.button]||i.button),i},getMouseButton:function(t){var e;return document.implementation.hasFeature("MouseEvents","2.0")?t.button:(e=t.button+"",~"0,1,3,5,7".indexOf(e)?0:~"2,6".indexOf(e)?2:~"4".indexOf(e)?1:void 0)}};t.exports=s},function(t,e,i){"use strict";var n=i(8),r=n.forEachOwnProperties,o=n.forEachArray,s=n.isFunction,a=n.isObject,c=Array.prototype.slice;function l(t){this.items={},this.length=0,s(t)&&(this.getItemID=t)}l.and=function(t){var e;return t=c.call(arguments),e=t.length,function(i){for(var n=0;n<e;n+=1)if(!t[n].call(null,i))return!1;return!0}},l.or=function(t){var e;return t=c.call(arguments),e=t.length,function(i){for(var n=1,r=t[0].call(null,i);n<e;n+=1)r=r||t[n].call(null,i);return r}},l.merge=function(t){var e=c.call(arguments),i={},r=new l(e[0].getItemID),s=n.extend;return o(e,function(t){s(i,t.items)}),r.items=i,r.length=n.keys(r.items).length,r},l.prototype.getItemID=function(t){return t._id+""},l.prototype.add=function(t){var e,i;arguments.length>1?o(c.call(arguments),function(t){this.add(t)},this):(e=this.getItemID(t),(i=this.items)[e]||(this.length+=1),i[e]=t)},l.prototype.remove=function(t){var e,i,r=[];return this.length?arguments.length>1?r=n.map(c.call(arguments),function(t){return this.remove(t)},this):(e=this.items,a(t)&&(t=this.getItemID(t)),e[t]?(this.length-=1,i=e[t],delete e[t],i):r):r},l.prototype.clear=function(){this.items={},this.length=0},l.prototype.has=function(t){var e,i;return!!this.length&&(e=s(t),i=!1,e?this.each(function(e){return!0!==t(e)||(i=!0,!1)}):(t=a(t)?this.getItemID(t):t,i=n.isExisty(this.items[t])),i)},l.prototype.doWhenHas=function(t,e,i){var r=this.items[t];n.isExisty(r)&&e.call(i||this,r)},l.prototype.find=function(t){var e=new l;return this.hasOwnProperty("getItemID")&&(e.getItemID=this.getItemID),this.each(function(i){!0===t(i)&&e.add(i)}),e},l.prototype.groupBy=function(t,e){var i,r,o={},a=s(t),c=this.getItemID;if(n.isArray(t)){if(n.forEachArray(t,function(t){o[t+""]=new l(c)}),!e)return o;t=e,a=!0}return this.each(function(e){a?r=t(e):(r=e[t],s(r)&&(r=r.apply(e))),(i=o[r])||(i=o[r]=new l(c)),i.add(e)}),o},l.prototype.single=function(){var t;return this.each(function(e){return t=e,!1},this),t},l.prototype.sort=function(t){var e=[];return this.each(function(t){e.push(t)}),s(t)&&(e=e.sort(t)),e},l.prototype.each=function(t,e){r(this.items,t,e||this)},l.prototype.toArray=function(){return this.length?n.map(this.items,function(t){return t}):[]},t.exports=l},function(t,e,i){"use strict";var n=i(8),r=i(7),o=i(10);function s(t,e){var i=n.stamp(this);t=t||{},n.isUndefined(e)&&(e=r.appendHTMLElement("div")),r.addClass(e,"tui-view-"+i),this.id=i,this.container=e,this.childs=new o(function(t){return n.stamp(t)}),this.parent=null}s.prototype.addChild=function(t,e){e&&e.call(t,this),t.parent=this,this.childs.add(t)},s.prototype.removeChild=function(t,e){var i=n.isNumber(t)?this.childs.items[t]:t;t=n.stamp(i),e&&e.call(i,this),this.childs.remove(t)},s.prototype.render=function(){this.childs.each(function(t){t.render()})},s.prototype.recursive=function(t,e){n.isFunction(t)&&(e||t(this),this.childs.each(function(e){e.recursive(t)}))},s.prototype.resize=function(){for(var t=Array.prototype.slice.call(arguments),e=this.parent;e;)n.isFunction(e._onResize)&&e._onResize.apply(e,t),e=e.parent},s.prototype._beforeDestroy=function(){},s.prototype._destroy=function(){this._beforeDestroy(),this.childs.clear(),this.container.innerHTML="",this.id=this.parent=this.childs=this.container=null},s.prototype.destroy=function(t){this.childs.each(function(t){t.destroy(!0),t._destroy()}),t||this._destroy()},s.prototype.getViewBound=function(){var t=this.container,e=r.getPosition(t),i=r.getSize(t);return{x:e[0],y:e[1],width:i[0],height:i[1]}},t.exports=s},function(t,e,i){(function(e){"use strict";var n=i(8),r=i(7),o=i(9);function s(t,e){o.on(e,"mousedown",this._onMouseDown,this),this.options=n.extend({distance:10},t),this.container=e,this._isMoved=!1,this._distance=0,this._dragStartFired=!1,this._dragStartEventData=null}s.prototype.destroy=function(){o.off(this.container,"mousedown",this._onMouseDown,this),this.options=this.container=this._isMoved=this._distance=this._dragStartFired=this._dragStartEventData=null},s.prototype._toggleDragEvent=function(t){var i,n,s=this.container;t?(i="on",n="disable"):(i="off",n="enable"),r[n+"TextSelection"](s),r[n+"ImageDrag"](s),o[i](e.document,{mousemove:this._onMouseMove,mouseup:this._onMouseUp},this)},s.prototype._getEventData=function(t){return{target:t.target||t.srcElement,originEvent:t}},s.prototype._onMouseDown=function(t){0===o.getMouseButton(t)&&(this._distance=0,this._dragStartFired=!1,this._dragStartEventData=this._getEventData(t),this._toggleDragEvent(!0))},s.prototype._onMouseMove=function(t){var e=this.options.distance;o.preventDefault(t),this._isMoved=!0,this._distance<e?this._distance+=1:this._dragStartFired||(this._dragStartFired=!0,this.invoke("dragStart",this._dragStartEventData))?this.fire("drag",this._getEventData(t)):this._toggleDragEvent(!1)},s.prototype._onMouseUp=function(t){if(this._toggleDragEvent(!1),this._isMoved)return this._isMoved=!1,void this.fire("dragEnd",this._getEventData(t));this.fire("click",this._getEventData(t))},n.CustomEvents.mixin(s),t.exports=s}).call(e,function(){return this}())},function(t,e,i){"use strict";var n=i(8),r=i(14),o=i(15),s=i(16),a=i(18),c=!1;function l(t){var e;if(!(this instanceof l))return new l(t);if(!(t=this.options=n.extend({container:null,color:"#f8f8f8",preset:["#181818","#282828","#383838","#585858","#b8b8b8","#d8d8d8","#e8e8e8","#f8f8f8","#ab4642","#dc9656","#f7ca88","#a1b56c","#86c1b9","#7cafc2","#ba8baf","#a16946"],cssPrefix:"tui-colorpicker-",detailTxt:"Detail",usageStatistics:!0},t)).container)throw new Error("ColorPicker(): need container option.");e=this.layout=new o(t,t.container),this.palette=new s(t,e.container),this.palette.on({_selectColor:this._onSelectColorInPalette,_toggleSlider:this._onToggleSlider},this),this.slider=new a(t,e.container),this.slider.on("_selectColor",this._onSelectColorInSlider,this),e.addChild(this.palette),e.addChild(this.slider),this.render(t.color),t.usageStatistics&&function(){var t=location.hostname;c||(c=!0,n.imagePing("https://www.google-analytics.com/collect",{v:1,t:"event",tid:"UA-115377265-9",cid:t,dp:t,dh:"color-picker"}))}()}l.prototype._onSelectColorInPalette=function(t){var e=t.color,i=this.options;r.isValidRGB(e)||""===e?(this.fire("selectColor",{color:e,origin:"palette"}),i.color!==e&&(i.color=e,this.render(e))):this.render()},l.prototype._onToggleSlider=function(){this.slider.toggle(!this.slider.isVisible())},l.prototype._onSelectColorInSlider=function(t){var e=t.color,i=this.options;this.fire("selectColor",{color:e,origin:"slider"}),i.color!==e&&(i.color=e,this.palette.render(e))},l.prototype.setColor=function(t){if(!r.isValidRGB(t))throw new Error("ColorPicker#setColor(): need valid hex string color value");this.options.color=t,this.render(t)},l.prototype.getColor=function(){return this.options.color},l.prototype.toggle=function(t){this.layout.container.style.display=t?"block":"none"},l.prototype.render=function(t){this.layout.render(t||this.options.color)},l.prototype.destroy=function(){this.layout.destroy(),this.options.container.innerHTML="",this.layout=this.slider=this.palette=this.options=null},n.CustomEvents.mixin(l),t.exports=l},function(t,e){"use strict";var i=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i,n={leadingZero:function(t,e){var i="",n=0;if((t+"").length>e)return t+"";for(;n<e-1;n+=1)i+="0";return(i+t).slice(-1*e)},isValidRGB:function(t){return i.test(t)},
// @license RGB <-> HSV conversion utilities based off of http://www.cs.rit.edu/~ncs/color/t_convert.html
hexToRGB:function(t){return!!n.isValidRGB(t)&&(t=t.substring(1),[parseInt(t.substr(0,2),16),parseInt(t.substr(2,2),16),parseInt(t.substr(4,2),16)])},rgbToHEX:function(t,e,i){var r="#"+n.leadingZero(t.toString(16),2)+n.leadingZero(e.toString(16),2)+n.leadingZero(i.toString(16),2);return!!n.isValidRGB(r)&&r},rgbToHSV:function(t,e,i){var n,r,o,s,a,c;if(t/=255,e/=255,i/=255,a=n=Math.max(t,e,i),c=n-(r=Math.min(t,e,i)),s=0===n?0:c/n,n===r)o=0;else{switch(n){case t:o=(e-i)/c+(e<i?6:0);break;case e:o=(i-t)/c+2;break;case i:o=(t-e)/c+4}o/=6}return[Math.round(360*o),Math.round(100*s),Math.round(100*a)]},hsvToRGB:function(t,e,i){var n,r,o,s,a,c,l,h;if(t=Math.max(0,Math.min(360,t)),e=Math.max(0,Math.min(100,e)),i=Math.max(0,Math.min(100,i)),i/=100,0===(e/=100))return n=r=o=i,[Math.round(255*n),Math.round(255*r),Math.round(255*o)];switch(c=i*(1-e),l=i*(1-e*(a=(t/=60)-(s=Math.floor(t)))),h=i*(1-e*(1-a)),s){case 0:n=i,r=h,o=c;break;case 1:n=l,r=i,o=c;break;case 2:n=c,r=i,o=h;break;case 3:n=c,r=l,o=i;break;case 4:n=h,r=c,o=i;break;default:n=i,r=c,o=l}return[Math.round(255*n),Math.round(255*r),Math.round(255*o)]}};t.exports=n},function(t,e,i){"use strict";var n=i(8),r=i(7),o=i(11);function s(t,e){this.options=n.extend({cssPrefix:"tui-colorpicker-"},t),e=r.appendHTMLElement("div",e,this.options.cssPrefix+"container"),o.call(this,t,e),this.render()}n.inherit(s,o),s.prototype.render=function(t){this.recursive(function(e){e.render(t)},!0)},t.exports=s},function(t,e,i){"use strict";var n=i(8),r=i(7),o=i(14),s=i(9),a=i(11),c=i(17);function l(t,e){this.options=n.extend({cssPrefix:"tui-colorpicker-",preset:["#181818","#282828","#383838","#585858","#B8B8B8","#D8D8D8","#E8E8E8","#F8F8F8","#AB4642","#DC9656","#F7CA88","#A1B56C","#86C1B9","#7CAFC2","#BA8BAF","#A16946"],detailTxt:"Detail"},t),e=r.appendHTMLElement("div",e,this.options.cssPrefix+"palette-container"),a.call(this,t,e)}n.inherit(l,a),l.prototype._onClick=function(t){var e=this.options,i=t.srcElement||t.target,n={};if(r.hasClass(i,e.cssPrefix+"palette-button"))return n.color=i.value,void this.fire("_selectColor",n);r.hasClass(i,e.cssPrefix+"palette-toggle-slider")&&this.fire("_toggleSlider")},l.prototype._onChange=function(t){var e=this.options,i=t.srcElement||t.target,n={};r.hasClass(i,e.cssPrefix+"palette-hex")&&(n.color=i.value,this.fire("_selectColor",n))},l.prototype._beforeDestroy=function(){this._toggleEvent(!1)},l.prototype._toggleEvent=function(t){var e,i=this.options,n=this.container,o=s[t?"on":"off"];o(n,"click",this._onClick,this),(e=r.find("."+i.cssPrefix+"palette-hex",n))&&o(e,"change",this._onChange,this)},l.prototype.render=function(t){var e=this.options,i="";this._toggleEvent(!1),i=c.layout.replace("{{colorList}}",n.map(e.preset,function(i){var n="";return o.isValidRGB(i)&&(n=r.applyTemplate(c.itemStyle,{color:i})),r.applyTemplate(c.item,{itemStyle:n,itemClass:i?"":" "+e.cssPrefix+"color-transparent",color:i,cssPrefix:e.cssPrefix,selected:i===t?" "+e.cssPrefix+"selected":""})}).join("")),i=r.applyTemplate(i,{cssPrefix:e.cssPrefix,detailTxt:e.detailTxt,color:t}),this.container.innerHTML=i,this._toggleEvent(!0)},n.CustomEvents.mixin(l),t.exports=l},function(t,e){"use strict";var i=['<ul class="{{cssPrefix}}clearfix">{{colorList}}</ul>','<div class="{{cssPrefix}}clearfix" style="overflow:hidden">','<input type="button" class="{{cssPrefix}}palette-toggle-slider" value="{{detailTxt}}" />','<input type="text" class="{{cssPrefix}}palette-hex" value="{{color}}" maxlength="7" />','<span class="{{cssPrefix}}palette-preview" style="background-color:{{color}};color:{{color}}">{{color}}</span>',"</div>"].join("\n");t.exports={layout:i,item:'<li><input class="{{cssPrefix}}palette-button{{selected}}{{itemClass}}" type="button" style="{{itemStyle}}" title="{{color}}" value="{{color}}" /></li>',itemStyle:"background-color:{{color}};color:{{color}}"}},function(t,e,i){"use strict";var n=i(8),r=i(7),o=i(9),s=i(19),a=i(14),c=i(11),l=i(12),h=i(20),u=[-7,112],f=[-3,115];function d(t,e){(e=r.appendHTMLElement("div",e,t.cssPrefix+"slider-container")).style.display="none",c.call(this,t,e),this.options=n.extend({color:"#f8f8f8",cssPrefix:"tui-colorpicker-"},t),this._dragDataCache={},this.sliderHandleElement=null,this.huebarHandleElement=null,this.baseColorElement=null,this.drag=new l({distance:0},e),this.drag.on({dragStart:this._onDragStart,drag:this._onDrag,dragEnd:this._onDragEnd,click:this._onClick},this)}n.inherit(d,c),d.prototype._beforeDestroy=function(){this.drag.off(),this.drag=this.options=this._dragDataCache=this.sliderHandleElement=this.huebarHandleElement=this.baseColorElement=null},d.prototype.toggle=function(t){this.container.style.display=t?"block":"none"},d.prototype.isVisible=function(){return"block"===this.container.style.display},d.prototype.render=function(t){var e,i,n=this.container,o=this.options,s=h.layout;a.isValidRGB(t)&&(s=(s=(s=s.replace(/{{slider}}/,h.slider)).replace(/{{huebar}}/,h.huebar)).replace(/{{cssPrefix}}/g,o.cssPrefix),this.container.innerHTML=s,this.sliderHandleElement=r.find("."+o.cssPrefix+"slider-handle",n),this.huebarHandleElement=r.find("."+o.cssPrefix+"huebar-handle",n),this.baseColorElement=r.find("."+o.cssPrefix+"slider-basecolor",n),e=a.hexToRGB(t),i=a.rgbToHSV.apply(null,e),this.moveHue(i[0],!0),this.moveSaturationAndValue(i[1],i[2],!0))},d.prototype._moveColorSliderHandle=function(t,e,i){var n,r=this.sliderHandleElement;e=Math.max(u[0],e),e=Math.min(u[1],e),t=Math.max(u[0],t),t=Math.min(u[1],t),s.setTranslateXY(r,t,e),n=e>50?"white":"black",s.setStrokeColor(r,n),i||this.fire("_selectColor",{color:a.rgbToHEX.apply(null,this.getRGB())})},d.prototype.moveSaturationAndValue=function(t,e,i){var n,r,o,s;t=t||0,e=e||0,n=Math.abs(u[0]),o=t*(r=u[1])/100-n,s=r-e*r/100-n,this._moveColorSliderHandle(o,s,i)},d.prototype._moveColorSliderByPosition=function(t,e){var i=u[0];this._moveColorSliderHandle(t+i,e+i)},d.prototype.getSaturationAndValue=function(){var t=Math.abs(u[0]),e=t+u[1],i=s.getTranslateXY(this.sliderHandleElement);return[(i[1]+t)/e*100,100-(i[0]+t)/e*100]},d.prototype._moveHueHandle=function(t,e){var i,n,r=this.huebarHandleElement,o=this.baseColorElement;t=Math.max(f[0],t),t=Math.min(f[1],t),s.setTranslateY(r,t),i=a.hsvToRGB(this.getHue(),100,100),n=a.rgbToHEX.apply(null,i),s.setGradientColorStop(o,n),e||this.fire("_selectColor",{color:a.rgbToHEX.apply(null,this.getRGB())})},d.prototype.moveHue=function(t,e){var i,n;i=((n=Math.abs(f[0]))+f[1])*(t=t||0)/359.99-n,this._moveHueHandle(i,e)},d.prototype._moveHueByPosition=function(t){var e=f[0];this._moveHueHandle(t+e)},d.prototype.getHue=function(){var t,e,i=this.huebarHandleElement,n=s.getTranslateXY(i);return e=(t=Math.abs(f[0]))+f[1],359.99*(n[0]+t)/e},d.prototype.getHSV=function(){var t=this.getSaturationAndValue();return[this.getHue()].concat(t)},d.prototype.getRGB=function(){return a.hsvToRGB.apply(null,this.getHSV())},d.prototype._prepareColorSliderForMouseEvent=function(t){var e=this.options,i=r.closest(t.target,"."+e.cssPrefix+"slider-part");return this._dragDataCache={isColorSlider:r.hasClass(i,e.cssPrefix+"slider-left"),parentElement:i}},d.prototype._onClick=function(t){var e=this._prepareColorSliderForMouseEvent(t),i=o.getMousePosition(t.originEvent,e.parentElement);e.isColorSlider?this._moveColorSliderByPosition(i[0],i[1]):this._moveHueByPosition(i[1]),this._dragDataCache=null},d.prototype._onDragStart=function(t){this._prepareColorSliderForMouseEvent(t)},d.prototype._onDrag=function(t){var e=this._dragDataCache,i=o.getMousePosition(t.originEvent,e.parentElement);e.isColorSlider?this._moveColorSliderByPosition(i[0],i[1]):this._moveHueByPosition(i[1])},d.prototype._onDragEnd=function(){this._dragDataCache=null},n.CustomEvents.mixin(d),t.exports=d},function(t,e,i){"use strict";var n=i(8),r=/[\.\-0-9]+/g,o={isOldBrowser:function(){var t=o._isOldBrowser;return n.isExisty(t)||(o._isOldBrowser=t=n.browser.msie&&n.browser.version<9),t},getTranslateXY:function(t){var e;return o.isOldBrowser()?(e=t.style,[parseFloat(e.top),parseFloat(e.left)]):(e=t.getAttribute("transform"))?(e=e.match(r),[parseFloat(e[1]),parseFloat(e[0])]):[0,0]},setTranslateXY:function(t,e,i){o.isOldBrowser()?(t.style.left=e+"px",t.style.top=i+"px"):t.setAttribute("transform","translate("+e+","+i+")")},setTranslateY:function(t,e){o.isOldBrowser()?t.style.top=e+"px":t.setAttribute("transform","translate(-6,"+e+")")},setStrokeColor:function(t,e){o.isOldBrowser()?t.strokecolor=e:t.setAttribute("stroke",e)},setGradientColorStop:function(t,e){o.isOldBrowser()?t.color=e:t.setAttribute("stop-color",e)}};t.exports=o},function(t,e,i){(function(e){"use strict";var n=i(8),r=['<div class="{{cssPrefix}}slider-left {{cssPrefix}}slider-part">{{slider}}</div>','<div class="{{cssPrefix}}slider-right {{cssPrefix}}slider-part">{{huebar}}</div>'].join("\n"),o=['<svg class="{{cssPrefix}}svg {{cssPrefix}}svg-slider">',"<defs>",'<linearGradient id="{{cssPrefix}}svg-fill-color" x1="0%" y1="0%" x2="100%" y2="0%">','<stop offset="0%" stop-color="rgb(255,255,255)" />','<stop class="{{cssPrefix}}slider-basecolor" offset="100%" stop-color="rgb(255,0,0)" />',"</linearGradient>",'<linearGradient id="{{cssPrefix}}svn-fill-black" x1="0%" y1="0%" x2="0%" y2="100%">','<stop offset="0%" style="stop-color:rgb(0,0,0);stop-opacity:0" />','<stop offset="100%" style="stop-color:rgb(0,0,0);stop-opacity:1" />',"</linearGradient>","</defs>",'<rect width="100%" height="100%" fill="url(#{{cssPrefix}}svg-fill-color)"></rect>','<rect width="100%" height="100%" fill="url(#{{cssPrefix}}svn-fill-black)"></rect>','<path transform="translate(0,0)" class="{{cssPrefix}}slider-handle" d="M0 7.5 L15 7.5 M7.5 15 L7.5 0 M2 7 a5.5 5.5 0 1 1 0 1 Z" stroke="black" stroke-width="0.75" fill="none" />',"</svg>"].join("\n"),s=['<div class="{{cssPrefix}}vml-slider">','<v:rect strokecolor="none" class="{{cssPrefix}}vml {{cssPrefix}}vml-slider-bg">','<v:fill class="{{cssPrefix}}vml {{cssPrefix}}slider-basecolor" type="gradient" method="none" color="#ff0000" color2="#fff" angle="90" />',"</v:rect>",'<v:rect strokecolor="#ccc" class="{{cssPrefix}}vml {{cssPrefix}}vml-slider-bg">','<v:fill type="gradient" method="none" color="black" color2="white" o:opacity2="0%" class="{{cssPrefix}}vml" />',"</v:rect>",'<v:shape class="{{cssPrefix}}vml {{cssPrefix}}slider-handle" coordsize="1 1" style="width:1px;height:1px;"path="m 0,7 l 14,7 m 7,14 l 7,0 ar 12,12 2,2 z" filled="false" stroked="true" />',"</div>"].join("\n"),a=['<svg class="{{cssPrefix}}svg {{cssPrefix}}svg-huebar">',"<defs>",'<linearGradient id="g" x1="0%" y1="0%" x2="0%" y2="100%">','<stop offset="0%" stop-color="rgb(255,0,0)" />','<stop offset="16.666%" stop-color="rgb(255,255,0)" />','<stop offset="33.333%" stop-color="rgb(0,255,0)" />','<stop offset="50%" stop-color="rgb(0,255,255)" />','<stop offset="66.666%" stop-color="rgb(0,0,255)" />','<stop offset="83.333%" stop-color="rgb(255,0,255)" />','<stop offset="100%" stop-color="rgb(255,0,0)" />',"</linearGradient>","</defs>",'<rect width="18px" height="100%" fill="url(#g)"></rect>','<path transform="translate(-6,-3)" class="{{cssPrefix}}huebar-handle" d="M0 0 L4 4 L0 8 L0 0 Z" fill="black" stroke="none" />',"</svg>"].join("\n"),c=['<div class="{{cssPrefix}}vml-huebar">','<v:rect strokecolor="#ccc" class="{{cssPrefix}}vml {{cssPrefix}}vml-huebar-bg">','<v:fill type="gradient" method="none" colors="0% rgb(255,0,0), 16.666% rgb(255,255,0), 33.333% rgb(0,255,0), 50% rgb(0,255,255), 66.666% rgb(0,0,255), 83.333% rgb(255,0,255), 100% rgb(255,0,0)" angle="180" class="{{cssPrefix}}vml" />',"</v:rect>",'<v:shape class="{{cssPrefix}}vml {{cssPrefix}}huebar-handle" coordsize="1 1" style="width:1px;height:1px;position:absolute;z-index:1;right:22px;top:-3px;"path="m 0,0 l 4,4 l 0,8 l 0,0 z" filled="true" fillcolor="black" stroked="false" />',"</div>"].join("\n"),l=n.browser.msie&&n.browser.version<9;l&&e.document.namespaces.add("v","urn:schemas-microsoft-com:vml"),t.exports={layout:r,slider:l?s:o,huebar:l?c:a}}).call(e,function(){return this}())}])})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=function(t){return t&&t.__esModule?t:{default:t}}(i(3)),o=i(72);var s=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._value=i.value||0,this.rangeElement=e,this._drawRangeElement(),this.rangeWidth=(0,o.toInteger)(window.getComputedStyle(e,null).width)-12,this._min=i.min||0,this._max=i.max||100,this._absMax=-1*this._min+this._max,this.realTimeEvent=i.realTimeEvent||!1,this._addClickEvent(),this._addDragEvent(),this.value=i.value,this.trigger("change")}return n(t,[{key:"trigger",value:function(t){this.fire(t,this._value)}},{key:"_drawRangeElement",value:function(){this.rangeElement.classList.add("tui-image-editor-range"),this.bar=document.createElement("div"),this.bar.className="tui-image-editor-virtual-range-bar",this.subbar=document.createElement("div"),this.subbar.className="tui-image-editor-virtual-range-subbar",this.pointer=document.createElement("div"),this.pointer.className="tui-image-editor-virtual-range-pointer",this.bar.appendChild(this.subbar),this.bar.appendChild(this.pointer),this.rangeElement.appendChild(this.bar)}},{key:"_addClickEvent",value:function(){var t=this;this.rangeElement.addEventListener("click",function(e){if(e.stopPropagation(),"tui-image-editor-range"===e.target.className){var i=e.offsetX/t.rangeWidth,n=t._absMax*i+t._min;t.pointer.style.left=i*t.rangeWidth+"px",t.subbar.style.right=(1-i)*t.rangeWidth+"px",t._value=n,t.fire("change",n)}})}},{key:"_addDragEvent",value:function(){var t=this;this.pointer.addEventListener("mousedown",function(e){t.firstPosition=e.screenX,t.firstLeft=(0,o.toInteger)(t.pointer.style.left)||0,t.dragEventHandler={changeAngle:t._changeAngle.bind(t),stopChangingAngle:t._stopChangingAngle.bind(t)},document.addEventListener("mousemove",t.dragEventHandler.changeAngle),document.addEventListener("mouseup",t.dragEventHandler.stopChangingAngle)})}},{key:"_changeAngle",value:function(t){var e=t.screenX-this.firstPosition,i=this.firstLeft+e;i=(i=i>this.rangeWidth?this.rangeWidth:i)<0?0:i,this.pointer.style.left=i+"px",this.subbar.style.right=this.rangeWidth-i+"px";var n=i/this.rangeWidth,r=this._absMax*n+this._min;this._value=r,this.realTimeEvent&&this.fire("change",r)}},{key:"_stopChangingAngle",value:function(){this.fire("change",this._value),document.removeEventListener("mousemove",this.dragEventHandler.changeAngle),document.removeEventListener("mouseup",this.dragEventHandler.stopChangingAngle)}},{key:"max",set:function(t){this._max=t,this._absMax=-1*this._min+this._max,this.value=this._value},get:function(){return this._max}},{key:"value",get:function(){return this._value},set:function(t){var e=(t-this._min)*this.rangeWidth/this._absMax;this.rangeWidth<e&&(e=this.rangeWidth),this.pointer.style.left=e+"px",this.subbar.style.right=this.rangeWidth-e+"px",this._value=t}}]),t}();r.default.CustomEvents.mixin(s),e.default=s},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var n=function(){function t(e,i){var n=i.name,r=i.iconStyle,o=i.menuBarPosition,s=i.templateHtml;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.selector=function(t){return e.querySelector(t)},this.menuBarPosition=o,this.toggleDirection="top"===o?"down":"up",this._makeSubMenuElement(e,{name:n,iconStyle:r,templateHtml:s})}return i(t,[{key:"getButtonType",value:function(t,e){return t.className.match(RegExp("("+e.join("|")+")"))[0]}},{key:"changeClass",value:function(t,e,i){t.classList.remove(e),t.classList.add(i)}},{key:"changeStandbyMode",value:function(){}},{key:"changeStartMode",value:function(){}},{key:"_makeSubMenuElement",value:function(t,e){var i=e.name,n=e.iconStyle,r=e.templateHtml,o=document.createElement("div");o.className="tui-image-editor-menu-"+i,o.innerHTML=r({iconStyle:n}),t.appendChild(o)}}]),t}();e.default=n},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.iconStyle,i=e.normal,n=e.active;return'\n    <ul class="tui-image-editor-submenu-item">\n        <li id="tie-shape-button">\n            <div class="tui-image-editor-button rect">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+i.path+"#"+i.name+'-ic-shape-rectangle"\n                            class="normal"/>\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-shape-rectangle"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label> Rectangle </label>\n            </div>\n            <div class="tui-image-editor-button circle">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+i.path+"#"+i.name+'-ic-shape-circle"\n                            class="normal"/>\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-shape-circle"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label> Circle </label>\n            </div>\n            <div class="tui-image-editor-button triangle">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+i.path+"#"+i.name+'-ic-shape-triangle"\n                            class="normal"/>\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-shape-triangle"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label> Triangle </label>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition">\n            <div></div>\n        </li>\n        <li id="tie-shape-color-button">\n            <div id="tie-color-fill" title="fill"></div>\n            <div id="tie-color-stroke" title="stroke"></div>\n        </li>\n        <li class="tui-image-editor-partition only-left-right">\n            <div></div>\n        </li>\n        <li class="tui-image-editor-newline tui-image-editor-range-wrap">\n            <label class="range">Stroke</label>\n            <div id="tie-stroke-range"></div>\n            <input id="tie-stroke-range-value" class="tui-image-editor-range-value" value="0" />\n        </li>\n    </ul>\n'}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=s(i(84)),o=s(i(87));function s(t){return t&&t.__esModule?t:{default:t}}var a=function(t){function e(t,i){var n=i.iconStyle,r=i.menuBarPosition;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,{name:"crop",iconStyle:n,menuBarPosition:r,templateHtml:o.default}));return s.status="active",s._els={apply:s.selector("#tie-crop-button .apply"),cancel:s.selector("#tie-crop-button .cancel")},s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r.default),n(e,[{key:"addEvent",value:function(t){var e=this;this.actions=t,this._els.apply.addEventListener("click",function(){e.actions.crop(),e._els.apply.classList.remove("active")}),this._els.cancel.addEventListener("click",function(){e.actions.cancel(),e._els.apply.classList.remove("active")})}},{key:"changeStartMode",value:function(){this.actions.modeChange("crop")}},{key:"changeStandbyMode",value:function(){this.actions.stopDrawingMode()}},{key:"changeApplyButtonStatus",value:function(t){t?this._els.apply.classList.add("active"):this._els.apply.classList.remove("active")}}]),e}();e.default=a},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.iconStyle,i=e.normal,n=e.active;return'\n    <ul class="tui-image-editor-submenu-item">\n        <li id="tie-crop-button" class="apply">\n            <div class="tui-image-editor-button apply">\n                <svg class="svg_ic-menu">\n                    <use xlink:href="'+i.path+"#"+i.name+'-ic-apply" class="normal"/>\n                    <use xlink:href="'+n.path+"#"+n.name+'-ic-apply" class="active"/>\n                </svg>\n                <label>\n                    Apply\n                </label>\n            </div>\n            <div class="tui-image-editor-button cancel">\n                <svg class="svg_ic-menu">\n                    <use xlink:href="'+i.path+"#"+i.name+'-ic-cancel" class="normal"/>\n                    <use xlink:href="'+n.path+"#"+n.name+'-ic-cancel" class="active"/>\n                </svg>\n                <label>\n                    Cancel\n                </label>\n            </div>\n        </li>\n    </ul>\n'}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=a(i(3)),o=a(i(84)),s=a(i(89));function a(t){return t&&t.__esModule?t:{default:t}}var c=function(t){function e(t,i){var n=i.iconStyle,r=i.menuBarPosition;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,{name:"flip",iconStyle:n,menuBarPosition:r,templateHtml:s.default}));return o.flipStatus=!1,o._els={flipButton:o.selector("#tie-flip-button")},o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,o.default),n(e,[{key:"addEvent",value:function(t){this._actions=t,this._els.flipButton.addEventListener("click",this._changeFlip.bind(this))}},{key:"_changeFlip",value:function(t){var e=this,i=t.target.closest(".tui-image-editor-button");if(i){var n=this.getButtonType(i,["flipX","flipY","resetFlip"]);if(!this.flipStatus&&"resetFlip"===n)return;this._actions.flip(n).then(function(t){var i=e._els.flipButton.classList;e.flipStatus=!1,i.remove("resetFlip"),r.default.forEach(["flipX","flipY"],function(n){i.remove(n),t[n]&&(i.add(n),i.add("resetFlip"),e.flipStatus=!0)})})}}}]),e}();e.default=c},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.iconStyle,i=e.normal,n=e.active;return'\n    <ul id="tie-flip-button" class="tui-image-editor-submenu-item">\n        <li>\n            <div class="tui-image-editor-button flipX">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+i.path+"#"+i.name+'-ic-flip-x" class="normal"/>\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-flip-x" class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    Flip X\n                </label>\n            </div>\n            <div class="tui-image-editor-button flipY">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+i.path+"#"+i.name+'-ic-flip-y" class="normal"/>\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-flip-y" class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    Flip Y\n                </label>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition">\n            <div></div>\n        </li>\n        <li>\n            <div class="tui-image-editor-button resetFlip">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+i.path+"#"+i.name+'-ic-flip-reset"\n                            class="normal"/>\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-flip-reset"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    Reset\n                </label>\n            </div>\n        </li>\n    </ul>\n'}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=l(i(83)),o=l(i(84)),s=l(i(91)),a=i(72),c=i(73);function l(t){return t&&t.__esModule?t:{default:t}}var h=function(t){function e(t,i){var n=i.iconStyle,o=i.menuBarPosition;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var a=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,{name:"rotate",iconStyle:n,menuBarPosition:o,templateHtml:s.default}));return a._els={rotateButton:a.selector("#tie-retate-button"),rotateRange:new r.default(a.selector("#tie-rotate-range"),c.defaultRotateRangeValus),rotateRangeValue:a.selector("#tie-ratate-range-value")},a}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,o.default),n(e,[{key:"addEvent",value:function(t){this.actions=t,this._els.rotateButton.addEventListener("click",this._changeRotateForButton.bind(this)),this._els.rotateRange.on("change",this._changeRotateForRange.bind(this)),this._els.rotateRangeValue.setAttribute("readonly",!0)}},{key:"_changeRotateForRange",value:function(t){var e=(0,a.toInteger)(t);this._els.rotateRangeValue.value=e,this.actions.setAngle(e)}},{key:"_changeRotateForButton",value:function(t){var e=t.target.closest(".tui-image-editor-button");if(e){var i={clockwise:30,counterclockwise:-30}[this.getButtonType(e,["counterclockwise","clockwise"])];this.actions.rotate(i)}}}]),e}();e.default=h},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.iconStyle,i=e.normal,n=e.active;return'\n    <ul class="tui-image-editor-submenu-item">\n        <li id="tie-retate-button">\n            <div class="tui-image-editor-button clockwise">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+i.path+"#"+i.name+'-ic-rotate-clockwise"\n                            class="normal"/>\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-rotate-clockwise"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label> 30 </label>\n            </div>\n            <div class="tui-image-editor-button counterclockwise">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+i.path+"#"+i.name+'-ic-rotate-counterclockwise"\n                            class="normal"/>\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-rotate-counterclockwise"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label> -30 </label>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition only-left-right">\n            <div></div>\n        </li>\n        <li class="tui-image-editor-newline tui-image-editor-range-wrap">\n            <label class="range">Range</label>\n            <div id="tie-rotate-range"></div>\n            <input id="tie-ratate-range-value" class="tui-image-editor-range-value" value="0" />\n        </li>\n    </ul>\n'}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=h(i(83)),o=h(i(81)),s=h(i(84)),a=h(i(93)),c=i(72),l=i(73);function h(t){return t&&t.__esModule?t:{default:t}}var u=function(t){function e(t,i){var n=i.iconStyle,s=i.menuBarPosition;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var c=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,{name:"text",iconStyle:n,menuBarPosition:s,templateHtml:a.default}));return c.effect={bold:!1,italic:!1,underline:!1},c.align="left",c._els={textEffectButton:c.selector("#tie-text-effect-button"),textAlignButton:c.selector("#tie-text-align-button"),textColorpicker:new o.default(c.selector("#tie-text-color"),"#ffbb3b",c.toggleDirection),textRange:new r.default(c.selector("#tie-text-range"),l.defaultTextRangeValus),textRangeValue:c.selector("#tie-text-range-value")},c}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,s.default),n(e,[{key:"addEvent",value:function(t){this.actions=t,this._els.textEffectButton.addEventListener("click",this._setTextEffectHandler.bind(this)),this._els.textAlignButton.addEventListener("click",this._setTextAlignHandler.bind(this)),this._els.textRange.on("change",this._changeTextRnageHandler.bind(this)),this._els.textRangeValue.value=this._els.textRange.value,this._els.textRangeValue.setAttribute("readonly",!0),this._els.textColorpicker.on("change",this._changeColorHandler.bind(this))}},{key:"changeStandbyMode",value:function(){this.actions.stopDrawingMode()}},{key:"changeStartMode",value:function(){this.actions.modeChange("text")}},{key:"_setTextEffectHandler",value:function(t){var e=t.target.closest(".tui-image-editor-button"),i=e.className.match(/(bold|italic|underline)/)[0],n={bold:{fontWeight:"bold"},italic:{fontStyle:"italic"},underline:{textDecoration:"underline"}}[i];this.effect[i]=!this.effect[i],e.classList.toggle("active"),this.actions.changeTextStyle(n)}},{key:"_setTextAlignHandler",value:function(t){var e=t.target.closest(".tui-image-editor-button");if(e){var i=this.getButtonType(e,["left","center","right"]);t.currentTarget.classList.remove(this.align),this.align!==i&&t.currentTarget.classList.add(i),this.actions.changeTextStyle({textAlign:i}),this.align=i}}},{key:"_changeTextRnageHandler",value:function(t){t=(0,c.toInteger)(t),(0,c.toInteger)(this._els.textRangeValue.value)!==t&&(this.actions.changeTextStyle({fontSize:t}),this._els.textRangeValue.value=t)}},{key:"_changeColorHandler",value:function(t){t=t||"transparent",this.actions.changeTextStyle({fill:t})}},{key:"textColor",get:function(){return this._els.textColorpicker.color}},{key:"fontSize",get:function(){return this._els.textRange.value},set:function(t){this._els.textRange.value=t,this._els.textRangeValue.value=t}}]),e}();e.default=u},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.iconStyle,i=e.normal,n=e.active;return'\n    <ul class="tui-image-editor-submenu-item">\n        <li id="tie-text-effect-button">\n            <div class="tui-image-editor-button bold">\n                <div>\n                    <svg class="svg_ic-submenu">\n                    <use xlink:href="'+i.path+"#"+i.name+'-ic-text-bold" class="normal"/>\n                    <use xlink:href="'+n.path+"#"+n.name+'-ic-text-bold" class="active"/>\n                    </svg>\n                </div>\n                <label> Bold </label>\n            </div>\n            <div class="tui-image-editor-button italic">\n                <div>\n                    <svg class="svg_ic-submenu">\n                    <use xlink:href="'+i.path+"#"+i.name+'-ic-text-italic" class="normal"/>\n                    <use xlink:href="'+n.path+"#"+n.name+'-ic-text-italic" class="active"/>\n                    </svg>\n                </div>\n                <label> Italic </label>\n            </div>\n            <div class="tui-image-editor-button underline">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+i.path+"#"+i.name+'-ic-text-underline"\n                            class="normal"/>\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-text-underline"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label> Underline </label>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition">\n            <div></div>\n        </li>\n        <li id="tie-text-align-button">\n            <div class="tui-image-editor-button left">\n                <div>\n                    <svg class="svg_ic-submenu">\n                     <use xlink:href="'+i.path+"#"+i.name+'-ic-text-align-left"\n                        class="normal"/>\n                     <use xlink:href="'+n.path+"#"+n.name+'-ic-text-align-left"\n                        class="active"/>\n                    </svg>\n                </div>\n                <label> left </label>\n            </div>\n            <div class="tui-image-editor-button center">\n                <div>\n                    <svg class="svg_ic-submenu">\n                     <use xlink:href="'+i.path+"#"+i.name+'-ic-text-align-center"\n                        class="normal"/>\n                     <use xlink:href="'+n.path+"#"+n.name+'-ic-text-align-center"\n                        class="active"/>\n                    </svg>\n                </div>\n                <label> center </label>\n            </div>\n            <div class="tui-image-editor-button right">\n                <div>\n                    <svg class="svg_ic-submenu">\n                     <use xlink:href="'+i.path+"#"+i.name+'-ic-text-align-right"\n                        class="normal"/>\n                     <use xlink:href="'+n.path+"#"+n.name+'-ic-text-align-right"\n                        class="active"/>\n                    </svg>\n                </div>\n                <label> right </label>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition">\n            <div></div>\n        </li>\n        <li>\n            <div id="tie-text-color" title="Color"></div>\n        </li>\n        <li class="tui-image-editor-partition only-left-right">\n            <div></div>\n        </li>\n        <li class="tui-image-editor-newline tui-image-editor-range-wrap">\n            <label class="range">Text size</label>\n            <div id="tie-text-range"></div>\n            <input id="tie-text-range-value" class="tui-image-editor-range-value" value="0" />\n        </li>\n    </ul>\n'}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=a(i(84)),o=a(i(72)),s=a(i(95));function a(t){return t&&t.__esModule?t:{default:t}}var c=function(t){function e(t,i){var n=i.iconStyle,r=i.menuBarPosition;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,{name:"mask",iconStyle:n,menuBarPosition:r,templateHtml:s.default}));return o._els={applyButton:o.selector("#tie-mask-apply"),maskImageButton:o.selector("#tie-mask-image-file")},o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r.default),n(e,[{key:"addEvent",value:function(t){this.actions=t,this._els.maskImageButton.addEventListener("change",this._loadMaskFile.bind(this)),this._els.applyButton.addEventListener("click",this._applyMask.bind(this))}},{key:"_applyMask",value:function(){this.actions.applyFilter(),this._els.applyButton.classList.remove("active")}},{key:"_loadMaskFile",value:function(t){var e=void 0;o.default.isSupportFileApi()||alert("This browser does not support file-api");var i=t.target.files[0];i&&(e=URL.createObjectURL(i),this.actions.loadImageFromURL(e,i),this._els.applyButton.classList.add("active"))}}]),e}();e.default=c},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.iconStyle,i=e.normal,n=e.active;return'\n    <ul class="tui-image-editor-submenu-item">\n        <li>\n            <div class="tui-image-editor-button">\n                <div>\n                    <input type="file" accept="image/*" id="tie-mask-image-file">\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+i.path+"#"+i.name+'-ic-mask-load" class="normal"/>\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-mask-load" class="active"/>\n                    </svg>\n                </div>\n                <label> Load Mask Image </label>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition only-left-right">\n            <div></div>\n        </li>\n        <li id="tie-mask-apply" class="tui-image-editor-newline apply">\n            <div class="tui-image-editor-button apply">\n                <svg class="svg_ic-menu">\n                    <use xlink:href="'+i.path+"#"+i.name+'-ic-apply" class="normal"/>\n                    <use xlink:href="'+n.path+"#"+n.name+'-ic-apply" class="active"/>\n                </svg>\n                <label>\n                    Apply\n                </label>\n            </div>\n        </li>\n    </ul>\n'}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=h(i(3)),o=h(i(81)),s=h(i(84)),a=h(i(97)),c=i(72),l=i(73);function h(t){return t&&t.__esModule?t:{default:t}}var u=function(t){function e(t,i){var n=i.iconStyle,r=i.menuBarPosition;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,{name:"icon",iconStyle:n,menuBarPosition:r,templateHtml:a.default}));return s.iconType=null,s._iconMap={},s._els={registIconButton:s.selector("#tie-icon-image-file"),addIconButton:s.selector("#tie-icon-add-button"),iconColorpicker:new o.default(s.selector("#tie-icon-color"),"#ffbb3b",s.toggleDirection)},s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,s.default),n(e,[{key:"addEvent",value:function(t){this.actions=t,this._els.iconColorpicker.on("change",this._changeColorHandler.bind(this)),this._els.registIconButton.addEventListener("change",this._registeIconHandler.bind(this)),this._els.addIconButton.addEventListener("click",this._addIconHandler.bind(this))}},{key:"clearIconType",value:function(){this._els.addIconButton.classList.remove(this.iconType),this.iconType=null}},{key:"registDefaultIcon",value:function(){var t=this;r.default.forEach(l.defaultIconPath,function(e,i){t.actions.registDefalutIcons(i,e)})}},{key:"setIconPickerColor",value:function(t){this._els.iconColorpicker.color=t}},{key:"changeStandbyMode",value:function(){this.clearIconType(),this.actions.cancelAddIcon()}},{key:"_changeColorHandler",value:function(t){t=t||"transparent",this.actions.changeColor(t)}},{key:"_addIconHandler",value:function(t){var e=t.target.closest(".tui-image-editor-button");if(e){var i=e.getAttribute("data-icontype"),n=this._els.iconColorpicker.color;this.actions.discardSelection(),this.actions.changeSelectableAll(!1),this._els.addIconButton.classList.remove(this.iconType),this._els.addIconButton.classList.add(i),this.iconType===i?this.changeStandbyMode():(this.actions.addIcon(i,n),this.iconType=i)}}},{key:"_registeIconHandler",value:function(t){var e=void 0;c.isSupportFileApi||alert("This browser does not support file-api");var i=t.target.files[0];i&&(e=URL.createObjectURL(i),this.actions.registCustomIcon(e,i))}}]),e}();e.default=u},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.iconStyle,i=e.normal,n=e.active;return'\n    <ul class="tui-image-editor-submenu-item">\n        <li id="tie-icon-add-button">\n            <div class="tui-image-editor-button" data-icontype="icon-arrow">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+i.path+"#"+i.name+'-ic-icon-arrow"\n                            class="normal"/>\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-icon-arrow"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    Arrow\n                </label>\n            </div>\n            <div class="tui-image-editor-button" data-icontype="icon-arrow-2">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+i.path+"#"+i.name+'-ic-icon-arrow-2"\n                            class="normal"/>\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-icon-arrow-2"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    Arrow-2\n                </label>\n            </div>\n            <div class="tui-image-editor-button" data-icontype="icon-arrow-3">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+i.path+"#"+i.name+'-ic-icon-arrow-3"\n                            class="normal"/>\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-icon-arrow-3"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    Arrow-3\n                </label>\n            </div>\n            <div class="tui-image-editor-button" data-icontype="icon-star">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+i.path+"#"+i.name+'-ic-icon-star" class="normal"/>\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-icon-star" class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    Star-1\n                </label>\n            </div>\n            <div class="tui-image-editor-button" data-icontype="icon-star-2">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+i.path+"#"+i.name+'-ic-icon-star-2"\n                            class="normal"/>\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-icon-star-2"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    Star-2\n                </label>\n            </div>\n\n            <div class="tui-image-editor-button" data-icontype="icon-polygon">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+i.path+"#"+i.name+'-ic-icon-polygon"\n                            class="normal"/>\n                        <use xlink:href="'+i.path+"#"+i.name+'-ic-icon-polygon"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    Polygon\n                </label>\n            </div>\n\n            <div class="tui-image-editor-button" data-icontype="icon-location">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+i.path+"#"+i.name+'-ic-icon-location"\n                            class="normal"/>\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-icon-location"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    Location\n                </label>\n            </div>\n\n            <div class="tui-image-editor-button" data-icontype="icon-heart">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+i.path+"#"+i.name+'-ic-icon-heart"\n                            class="normal"/>\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-icon-heart"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    Heart\n                </label>\n            </div>\n\n            <div class="tui-image-editor-button" data-icontype="icon-bubble">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+i.path+"#"+i.name+'-ic-icon-bubble"\n                            class="normal"/>\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-icon-bubble"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    Bubble\n                </label>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition">\n            <div></div>\n        </li>\n        <li id="tie-icon-add-button">\n            <div class="tui-image-editor-button">\n                <div>\n                    <input type="file" accept="image/*" id="tie-icon-image-file">\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+i.path+"#"+i.name+'-ic-icon-load" class="normal"/>\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-icon-load" class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    Custom icon\n                </label>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition">\n            <div></div>\n        </li>\n        <li>\n            <div id="tie-icon-color" title="Color"></div>\n        </li>\n    </ul>\n'}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=h(i(72)),o=h(i(81)),s=h(i(83)),a=h(i(84)),c=h(i(99)),l=i(73);function h(t){return t&&t.__esModule?t:{default:t}}var u=function(t){function e(t,i){var n=i.iconStyle,r=i.menuBarPosition;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var a=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,{name:"draw",iconStyle:n,menuBarPosition:r,templateHtml:c.default}));return a._els={lineSelectButton:a.selector("#tie-draw-line-select-button"),drawColorpicker:new o.default(a.selector("#tie-draw-color"),"#00a9ff",a.toggleDirection),drawRange:new s.default(a.selector("#tie-draw-range"),l.defaultDrawRangeValus),drawRangeValue:a.selector("#tie-draw-range-value")},a.type=null,a.color=a._els.drawColorpicker.color,a.width=a._els.drawRange.value,a}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,a.default),n(e,[{key:"addEvent",value:function(t){this.actions=t,this._els.lineSelectButton.addEventListener("click",this._changeDrawType.bind(this)),this._els.drawColorpicker.on("change",this._changeDrawColor.bind(this)),this._els.drawRange.on("change",this._changeDrawRange.bind(this)),this._els.drawRangeValue.value=this._els.drawRange.value,this._els.drawRangeValue.setAttribute("readonly",!0)}},{key:"setDrawMode",value:function(){this.actions.setDrawMode(this.type,{width:this.width,color:r.default.getRgb(this.color,.7)})}},{key:"changeStandbyMode",value:function(){this.type=null,this.actions.stopDrawingMode(),this.actions.changeSelectableAll(!0),this._els.lineSelectButton.classList.remove("free"),this._els.lineSelectButton.classList.remove("line")}},{key:"changeStartMode",value:function(){this.type="free",this._els.lineSelectButton.classList.add("free"),this.setDrawMode()}},{key:"_changeDrawType",value:function(t){var e=t.target.closest(".tui-image-editor-button");if(e){var i=this.getButtonType(e,["free","line"]);if(this.actions.discardSelection(),this.type===i)return void this.changeStandbyMode();this.changeStandbyMode(),this.type=i,this._els.lineSelectButton.classList.add(i),this.setDrawMode()}}},{key:"_changeDrawColor",value:function(t){this.color=t||"transparent",this.type?this.setDrawMode():this.changeStartMode()}},{key:"_changeDrawRange",value:function(t){t=r.default.toInteger(t),this._els.drawRangeValue.value=t,this.width=t,this.type?this.setDrawMode():this.changeStartMode()}}]),e}();e.default=u},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.iconStyle,i=e.normal,n=e.active;return'\n    <ul class="tui-image-editor-submenu-item">\n        <li id="tie-draw-line-select-button">\n            <div class="tui-image-editor-button free">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+i.path+"#"+i.name+'-ic-draw-free" class="normal"/>\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-draw-free" class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    Free\n                </label>\n            </div>\n            <div class="tui-image-editor-button line">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+i.path+"#"+i.name+'-ic-draw-line" class="normal"/>\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-draw-line" class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    Straight\n                </label>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition">\n            <div></div>\n        </li>\n        <li>\n            <div id="tie-draw-color" title="Color"></div>\n        </li>\n        <li class="tui-image-editor-partition only-left-right">\n            <div></div>\n        </li>\n        <li class="tui-image-editor-newline tui-image-editor-range-wrap">\n            <label class="range">Range</label>\n            <div id="tie-draw-range"></div>\n            <input id="tie-draw-range-value" class="tui-image-editor-range-value" value="0" />\n        </li>\n    </ul>\n'}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=u(i(3)),o=u(i(81)),s=u(i(83)),a=u(i(84)),c=u(i(101)),l=i(72),h=i(73);function u(t){return t&&t.__esModule?t:{default:t}}var f=["add","diff","subtract","multiply","screen","lighten","darken"],d=["grayscale","invert","sepia","sepia2","blur","sharpen","emboss","remove-white","gradient-transparency","brightness","noise","pixelate","color-filter","tint","multiply","blend"],p=function(t){function e(t,i){var n=i.iconStyle,r=i.menuBarPosition;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,{name:"filter",iconStyle:n,menuBarPosition:r,templateHtml:c.default}));return o.checkedMap={},o._makeControlElement(),o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,a.default),n(e,[{key:"addEvent",value:function(t){var e=this,i=t.applyFilter,n=function(t){var n=e.checkedMap[t].checked,r=t;i(n,r,e._getFilterOption(r))};r.default.forEach(d,function(t){var i=e.selector("#tie-"+t),r=(0,l.toCamelCase)(t);e.checkedMap[r]=i,i.addEventListener("change",function(){return n(r)})}),this._els.removewhiteThresholdRange.on("change",function(){return n("removeWhite")}),this._els.removewhiteDistanceRange.on("change",function(){return n("removeWhite")}),this._els.gradientTransparencyRange.on("change",function(){return n("gradientTransparency")}),this._els.colorfilterThresholeRange.on("change",function(){return n("colorFilter")}),this._els.pixelateRange.on("change",function(){return n("pixelate")}),this._els.noiseRange.on("change",function(){return n("noise")}),this._els.brightnessRange.on("change",function(){return n("brightness")}),this._els.blendType.addEventListener("change",function(){return n("blend")}),this._els.filterBlendColor.on("change",function(){return n("blend")}),this._els.filterMultiplyColor.on("change",function(){return n("multiply")}),this._els.tintOpacity.on("change",function(){return n("tint")}),this._els.filterTintColor.on("change",function(){return n("tint")}),this._els.blendType.addEventListener("click",function(t){return t.stopPropagation()})}},{key:"_getFilterOption",value:function(t){var e={};switch(t){case"removeWhite":e.threshold=(0,l.toInteger)(this._els.removewhiteThresholdRange.value),e.distance=(0,l.toInteger)(this._els.removewhiteDistanceRange.value);break;case"gradientTransparency":e.threshold=(0,l.toInteger)(this._els.gradientTransparencyRange.value);break;case"colorFilter":e.color="#FFFFFF",e.threshold=this._els.colorfilterThresholeRange.value;break;case"pixelate":e.blocksize=(0,l.toInteger)(this._els.pixelateRange.value);break;case"noise":e.noise=(0,l.toInteger)(this._els.noiseRange.value);break;case"brightness":e.brightness=(0,l.toInteger)(this._els.brightnessRange.value);break;case"blend":e.color=this._els.filterBlendColor.color,e.mode=this._els.blendType.value;break;case"multiply":e.color=this._els.filterMultiplyColor.color;break;case"tint":e.color=this._els.filterTintColor.color,e.opacity=this._els.tintOpacity.value}return e}},{key:"_makeControlElement",value:function(){var t=this.selector;this._els={removewhiteThresholdRange:new s.default(t("#tie-removewhite-threshold-range"),h.defaultFilterRangeValus.removewhiteThresholdRange),removewhiteDistanceRange:new s.default(t("#tie-removewhite-distance-range"),h.defaultFilterRangeValus.removewhiteDistanceRange),gradientTransparencyRange:new s.default(t("#tie-gradient-transparency-range"),h.defaultFilterRangeValus.gradientTransparencyRange),brightnessRange:new s.default(t("#tie-brightness-range"),h.defaultFilterRangeValus.brightnessRange),noiseRange:new s.default(t("#tie-noise-range"),h.defaultFilterRangeValus.noiseRange),pixelateRange:new s.default(t("#tie-pixelate-range"),h.defaultFilterRangeValus.pixelateRange),colorfilterThresholeRange:new s.default(t("#tie-colorfilter-threshole-range"),h.defaultFilterRangeValus.colorfilterThresholeRange),filterTintColor:new o.default(t("#tie-filter-tint-color"),"#03bd9e",this.toggleDirection),filterMultiplyColor:new o.default(t("#tie-filter-multiply-color"),"#515ce6",this.toggleDirection),filterBlendColor:new o.default(t("#tie-filter-blend-color"),"#ffbb3b",this.toggleDirection)},this._els.tintOpacity=this._pickerWithRange(this._els.filterTintColor.pickerControl),this._els.blendType=this._pickerWithSelectbox(this._els.filterBlendColor.pickerControl)}},{key:"_pickerWithRange",value:function(t){var e=document.createElement("div"),i=document.createElement("label"),n=document.createElement("div");return n.id="tie-filter-tint-opacity",i.innerHTML="Opacity",e.appendChild(i),e.appendChild(n),t.appendChild(e),t.style.height="130px",new s.default(n,h.defaultFilterRangeValus.tintOpacityRange)}},{key:"_pickerWithSelectbox",value:function(t){var e=document.createElement("div"),i=document.createElement("select");return e.className="tui-image-editor-selectlist-wrap",e.appendChild(i),this._makeSelectOptionList(i),t.appendChild(e),t.style.height="130px",i}},{key:"_makeSelectOptionList",value:function(t){r.default.forEach(f,function(e){var i=document.createElement("option");i.setAttribute("value",e),i.innerHTML=e.replace(/^[a-z]/,function(t){return t.toUpperCase()}),t.appendChild(i)})}}]),e}();e.default=p},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return'\n    <ul class="tui-image-editor-submenu-item">\n        <li class="tui-image-editor-submenu-align">\n            <div class="tui-image-editor-checkbox-wrap fixed-width">\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-grayscale">\n                    <label for="tie-grayscale">Grayscale</label>\n                </div>\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-invert">\n                    <label for="tie-invert">Invert</label>\n                </div>\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-sepia">\n                    <label for="tie-sepia">Sepia</label>\n                </div>\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-sepia2">\n                    <label for="tie-sepia2">Sepia2</label>\n                </div>\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-blur">\n                    <label for="tie-blur">Blur</label>\n                </div>\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-sharpen">\n                    <label for="tie-sharpen">Sharpen</label>\n                </div>\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-emboss">\n                    <label for="tie-emboss">Emboss</label>\n                </div>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition">\n            <div></div>\n        </li>\n        <li class="tui-image-editor-submenu-align">\n            <div>\n                <div class="tui-image-editor-checkbox-wrap">\n                    <div class="tui-image-editor-checkbox">\n                        <input type="checkbox" id="tie-remove-white">\n                        <label for="tie-remove-white">Remove White</label>\n                    </div>\n                </div>\n                <div class="tui-image-editor-newline tui-image-editor-range-wrap short">\n                    <label>Threshold</label>\n                    <div id="tie-removewhite-threshold-range"></div>\n                </div>\n                <div class="tui-image-editor-newline tui-image-editor-range-wrap short">\n                    <label>Distance</label>\n                    <div id="tie-removewhite-distance-range"></div>\n                </div>\n            </div>\n            <div>\n                <div class="tui-image-editor-newline tui-image-editor-checkbox-wrap">\n                    <div class="tui-image-editor-checkbox">\n                        <input type="checkbox" id="tie-gradient-transparency">\n                        <label for="tie-gradient-transparency">Grayscale</label>\n                    </div>\n                </div>\n                <div class="tui-image-editor-newline tui-image-editor-range-wrap short">\n                    <label>Value</label>\n                    <div id="tie-gradient-transparency-range"></div>\n                </div>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition only-left-right">\n            <div></div>\n        </li>\n        <li class="tui-image-editor-submenu-align">\n            <div>\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-brightness">\n                    <label for="tie-brightness">Brightness</label>\n                </div>\n                <div class="tui-image-editor-range-wrap short">\n                    <div id="tie-brightness-range"></div>\n                </div>\n            </div>\n            <div>\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-noise">\n                    <label for="tie-noise">Noise</label>\n                </div>\n                <div class="tui-image-editor-range-wrap short">\n                    <div id="tie-noise-range"></div>\n                </div>\n            </div>\n\n            <div>\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-pixelate">\n                    <label for="tie-pixelate">Pixelate</label>\n                </div>\n                <div class="tui-image-editor-range-wrap short">\n                    <div id="tie-pixelate-range"></div>\n                </div>\n            </div>\n            <div>\n                <div class="tui-image-editor-newline tui-image-editor-checkbox-wrap">\n                    <div class="tui-image-editor-checkbox">\n                        <input type="checkbox" id="tie-color-filter">\n                        <label for="tie-color-filter">Color Filter</label>\n                    </div>\n                </div>\n                <div class="tui-image-editor-newline tui-image-editor-range-wrap short">\n                    <label>Threshold</label>\n                    <div id="tie-colorfilter-threshole-range"></div>\n                </div>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition">\n            <div></div>\n        </li>\n        <li>\n            <div class="filter-color-item">\n                <div id="tie-filter-tint-color" title="Tint"></div>\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-tint">\n                    <label for="tie-tint"></label>\n                </div>\n            </div>\n            <div class="filter-color-item">\n                <div id="tie-filter-multiply-color" title="Multiply"></div>\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-multiply">\n                    <label for="tie-multiply"></label>\n                </div>\n            </div>\n            <div class="filter-color-item">\n                <div id="tie-filter-blend-color" title="Blend"></div>\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-blend">\n                    <label for="tie-blend"></label>\n                </div>\n            </div>\n        </li>\n    </ul>\n'}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(3),r=s(i(72)),o=s(i(103));function s(t){return t&&t.__esModule?t:{default:t}}e.default={getActions:function(){return{main:this._mainAction(),shape:this._shapeAction(),crop:this._cropAction(),flip:this._flipAction(),rotate:this._rotateAction(),text:this._textAction(),mask:this._maskAction(),draw:this._drawAction(),icon:this._iconAction(),filter:this._filterAction()}},_mainAction:function(){var t=this,e=function(){"crop"===t.ui.submenu&&(t.stopDrawingMode(),t.ui.changeMenu("crop"))};return(0,n.extend)({initLoadImage:function(i,n){return t.loadImageFromURL(i,n).then(function(n){e(),t.ui.initializeImgUrl=i,t.ui.resizeEditor({imageSize:n}),t.clearUndoStack()})},undo:function(){t.isEmptyUndoStack()||(e(),t.undo())},redo:function(){t.isEmptyRedoStack()||(e(),t.redo())},reset:function(){e(),t.loadImageFromURL(t.ui.initializeImgUrl,"resetImage").then(function(i){e(),t.ui.resizeEditor({imageSize:i}),t.clearUndoStack()})},delete:function(){t.ui.changeDeleteButtonEnabled(!1),e(),t.removeActiveObject(),t.activeObjectId=null},deleteAll:function(){e(),t.clearObjects(),t.ui.changeDeleteButtonEnabled(!1),t.ui.changeDeleteAllButtonEnabled(!1)},load:function(i){r.default.isSupportFileApi()||alert("This browser does not support file-api"),t.ui.initializeImgUrl=URL.createObjectURL(i),t.loadImageFromFile(i).then(function(){e(),t.clearUndoStack(),t.ui.resizeEditor()}).catch(function(t){return Promise.reject(t)})},download:function(){var e=t.toDataURL(),i=t.getImageName(),n=void 0,o=void 0;r.default.isSupportFileApi()&&window.saveAs?(o=(n=r.default.base64ToBlob(e)).type.split("/")[1],i.split(".").pop()!==o&&(i+="."+o),saveAs(n,i)):window.open().document.body.innerHTML="<img src='"+e+"'>"}},this._commonAction())},_iconAction:function(){var t=this,e=void 0,i=void 0,r=void 0,s=void 0,a=void 0,c=void 0,l=void 0;this.on({iconCreateResize:function(e){var i=e.moveOriginPointer,n=(i.x-r)/a,o=(i.y-s)/c;t.setObjectPropertiesQuietly(l,{scaleX:Math.abs(2*n),scaleY:Math.abs(2*o)})},iconCreateEnd:function(){t.ui.icon.clearIconType(),t.changeSelectableAll(!0)}});return(0,n.extend)({changeColor:function(e){t.activeObjectId&&t.changeIconColor(t.activeObjectId,e)},addIcon:function(n,o){e=n,i=o,t.changeCursor("crosshair"),t.off("mousedown"),t.once("mousedown",function(n,o){r=o.x,s=o.y,t.addIcon(e,{left:o.x,top:o.y,fill:i}).then(function(t){l=t.id,a=t.width,c=t.height})}.bind(t))},cancelAddIcon:function(){t.off("mousedown"),t.ui.icon.clearIconType(),t.changeSelectableAll(!0),t.changeCursor("default")},registDefalutIcons:function(e,i){var n={};n[e]=i,t.registerIcons(n)},registCustomIcon:function(e,i){(new o.default).imageToSVG(e,function(e){var n=e.match(/path[^>]*d="([^"]*)"/)[1],r={};r[i.name]=n,t.registerIcons(r),t.addIcon(i.name,{left:100,top:100})},o.default.tracerDefaultOption())}},this._commonAction())},_drawAction:function(){var t=this;return(0,n.extend)({setDrawMode:function(e,i){t.stopDrawingMode(),"free"===e?t.startDrawingMode("FREE_DRAWING",i):t.startDrawingMode("LINE_DRAWING",i)},setColor:function(e){t.setBrush({color:e})}},this._commonAction())},_maskAction:function(){var t=this;return(0,n.extend)({loadImageFromURL:function(e,i){return t.loadImageFromURL(t.toDataURL(),"FilterImage").then(function(){t.addImageObject(e).then(function(){URL.revokeObjectURL(i)})})},applyFilter:function(){t.applyFilter("mask",{maskObjId:t.activeObjectId})}},this._commonAction())},_textAction:function(){var t=this;return(0,n.extend)({changeTextStyle:function(e){t.activeObjectId&&t.changeTextStyle(t.activeObjectId,e)}},this._commonAction())},_rotateAction:function(){var t=this;return(0,n.extend)({rotate:function(e){t.rotate(e),t.ui.resizeEditor()},setAngle:function(e){t.setAngle(e),t.ui.resizeEditor()}},this._commonAction())},_shapeAction:function(){var t=this;return(0,n.extend)({changeShape:function(e){t.activeObjectId&&t.changeShape(t.activeObjectId,e)},setDrawingShape:function(e){t.setDrawingShape(e)}},this._commonAction())},_cropAction:function(){var t=this;return(0,n.extend)({crop:function(){var e=t.getCropzoneRect();e&&t.crop(e).then(function(){t.stopDrawingMode(),t.ui.resizeEditor(),t.ui.changeMenu("crop")}).catch(function(t){return Promise.reject(t)})},cancel:function(){t.stopDrawingMode(),t.ui.changeMenu("crop")}},this._commonAction())},_flipAction:function(){var t=this;return(0,n.extend)({flip:function(e){return t[e]()}},this._commonAction())},_filterAction:function(){var t=this;return(0,n.extend)({applyFilter:function(e,i,n){e?t.applyFilter(i,n):t.hasFilter(i)&&t.removeFilter(i)}},this._commonAction())},setReAction:function(){var t=this;this.on({undoStackChanged:function(e){e?(t.ui.changeUndoButtonStatus(!0),t.ui.changeResetButtonStatus(!0)):(t.ui.changeUndoButtonStatus(!1),t.ui.changeResetButtonStatus(!1)),t.ui.resizeEditor()},redoStackChanged:function(e){e?t.ui.changeRedoButtonStatus(!0):t.ui.changeRedoButtonStatus(!1),t.ui.resizeEditor()},objectActivated:function(e){t.activeObjectId=e.id,t.ui.changeDeleteButtonEnabled(!0),t.ui.changeDeleteAllButtonEnabled(!0),"cropzone"===e.type?t.ui.crop.changeApplyButtonStatus(!0):["rect","circle","triangle"].indexOf(e.type)>-1?(t.stopDrawingMode(),"shape"!==t.ui.submenu&&t.ui.changeMenu("shape",!1,!1),t.ui.shape.setShapeStatus({strokeColor:e.stroke,strokeWidth:e.strokeWidth,fillColor:e.fill}),t.ui.shape.setMaxStrokeValue(Math.min(e.width,e.height))):"path"===e.type||"line"===e.type?"draw"!==t.ui.submenu&&(t.ui.changeMenu("draw",!1,!1),t.ui.draw.changeStandbyMode()):["i-text","text"].indexOf(e.type)>-1?"text"!==t.ui.submenu&&t.ui.changeMenu("text",!1,!1):"icon"===e.type&&(t.stopDrawingMode(),"icon"!==t.ui.submenu&&t.ui.changeMenu("icon",!1,!1),t.ui.icon.setIconPickerColor(e.fill))},addText:function(e){t.addText("Double Click",{position:e.originPosition,styles:{fill:t.ui.text.textColor,fontSize:r.default.toInteger(t.ui.text.fontSize)}}).then(function(){t.changeCursor("default")})},addObjectAfter:function(e){["rect","circle","triangle"].indexOf(e.type)>-1&&(t.ui.shape.setMaxStrokeValue(Math.min(e.width,e.height)),t.ui.shape.changeStandbyMode())},objectScaled:function(e){if(["i-text","text"].indexOf(e.type)>-1)t.ui.text.fontSize=r.default.toInteger(e.fontSize);else if(["rect","circle","triangle"].indexOf(e.type)>=0){var i=e.width,n=e.height,o=t.ui.shape.getStrokeValue();i<o&&t.ui.shape.setStrokeValue(i),n<o&&t.ui.shape.setStrokeValue(n)}},selectionCleared:function(){t.activeObjectId=null,"text"===t.ui.submenu?t.changeCursor("text"):"draw"!==t.ui.submenu&&"crop"!==t.ui.submenu&&t.stopDrawingMode()}})},_commonAction:function(){var t=this;return{modeChange:function(e){switch(e){case"text":t._changeActivateMode("TEXT");break;case"crop":t.startDrawingMode("CROPPER");break;case"shape":t._changeActivateMode("SHAPE"),t.setDrawingShape(t.ui.shape.type,t.ui.shape.options)}},deactivateAll:this.deactivateAll.bind(this),changeSelectableAll:this.changeSelectableAll.bind(this),discardSelection:this.discardSelection.bind(this),stopDrawingMode:this.stopDrawingMode.bind(this)}},mixin:function(t){(0,n.extend)(t.prototype,this)}}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var n=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.versionnumber="1.2.4",this.optionpresets={default:{corsenabled:!1,ltres:1,qtres:1,pathomit:8,rightangleenhance:!0,colorsampling:2,numberofcolors:16,mincolorratio:0,colorquantcycles:3,layering:0,strokewidth:1,linefilter:!1,scale:1,roundcoords:1,viewbox:!1,desc:!1,lcpr:0,qcpr:0,blurradius:0,blurdelta:20},posterized1:{colorsampling:0,numberofcolors:2},posterized2:{numberofcolors:4,blurradius:5},curvy:{ltres:.01,linefilter:!0,rightangleenhance:!1},sharp:{qtres:.01,linefilter:!1},detailed:{pathomit:0,roundcoords:2,ltres:.5,qtres:.5,numberofcolors:64},smoothed:{blurradius:5,blurdelta:64},grayscale:{colorsampling:0,colorquantcycles:1,numberofcolors:7},fixedpalette:{colorsampling:0,colorquantcycles:1,numberofcolors:27},randomsampling1:{colorsampling:1,numberofcolors:8},randomsampling2:{colorsampling:1,numberofcolors:64},artistic1:{colorsampling:0,colorquantcycles:1,pathomit:0,blurradius:5,blurdelta:64,ltres:.01,linefilter:!0,numberofcolors:16,strokewidth:2},artistic2:{qtres:.01,colorsampling:0,colorquantcycles:1,numberofcolors:4,strokewidth:0},artistic3:{qtres:10,ltres:10,numberofcolors:8},artistic4:{qtres:10,ltres:10,numberofcolors:64,blurradius:5,blurdelta:256,strokewidth:2},posterized3:{ltres:1,qtres:1,pathomit:20,rightangleenhance:!0,colorsampling:0,numberofcolors:3,mincolorratio:0,colorquantcycles:3,blurradius:3,blurdelta:20,strokewidth:0,linefilter:!1,roundcoords:1,pal:[{r:0,g:0,b:100,a:255},{r:255,g:255,b:255,a:255}]}},this.pathscan_combined_lookup=[[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[0,1,0,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[0,2,-1,0]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[0,1,0,-1],[0,0,1,0]],[[0,0,1,0],[-1,-1,-1,-1],[0,2,-1,0],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[0,0,1,0],[0,3,0,1],[-1,-1,-1,-1]],[[13,3,0,1],[13,2,-1,0],[7,1,0,-1],[7,0,1,0]],[[-1,-1,-1,-1],[0,1,0,-1],[-1,-1,-1,-1],[0,3,0,1]],[[0,3,0,1],[0,2,-1,0],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[0,3,0,1],[0,2,-1,0],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[0,1,0,-1],[-1,-1,-1,-1],[0,3,0,1]],[[11,1,0,-1],[14,0,1,0],[14,3,0,1],[11,2,-1,0]],[[-1,-1,-1,-1],[0,0,1,0],[0,3,0,1],[-1,-1,-1,-1]],[[0,0,1,0],[-1,-1,-1,-1],[0,2,-1,0],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[0,1,0,-1],[0,0,1,0]],[[0,1,0,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[0,2,-1,0]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]]],this.gks=[[.27901,.44198,.27901],[.135336,.228569,.272192,.228569,.135336],[.086776,.136394,.178908,.195843,.178908,.136394,.086776],[.063327,.093095,.122589,.144599,.152781,.144599,.122589,.093095,.063327],[.049692,.069304,.089767,.107988,.120651,.125194,.120651,.107988,.089767,.069304,.049692]],this.specpalette=[{r:0,g:0,b:0,a:255},{r:128,g:128,b:128,a:255},{r:0,g:0,b:128,a:255},{r:64,g:64,b:128,a:255},{r:192,g:192,b:192,a:255},{r:255,g:255,b:255,a:255},{r:128,g:128,b:192,a:255},{r:0,g:0,b:192,a:255},{r:128,g:0,b:0,a:255},{r:128,g:64,b:64,a:255},{r:128,g:0,b:128,a:255},{r:168,g:168,b:168,a:255},{r:192,g:128,b:128,a:255},{r:192,g:0,b:0,a:255},{r:255,g:255,b:255,a:255},{r:0,g:128,b:0,a:255}]}return i(t,null,[{key:"tracerDefaultOption",value:function(){return{pathomit:100,ltres:.1,qtres:1,scale:1,strokewidth:5,viewbox:!1,linefilter:!0,desc:!1,rightangleenhance:!1,pal:[{r:0,g:0,b:0,a:255},{r:255,g:255,b:255,a:255}]}}}]),i(t,[{key:"imageToSVG",value:function(t,e,i){var n=this;i=this.checkoptions(i),this.loadImage(t,function(t){e(n.imagedataToSVG(n.getImgdata(t),i))},i)}},{key:"imagedataToSVG",value:function(t,e){e=this.checkoptions(e);var i=this.imagedataToTracedata(t,e);return this.getsvgstring(i,e)}},{key:"imageToTracedata",value:function(t,e,i){var n=this;i=this.checkoptions(i),this.loadImage(t,function(t){e(n.imagedataToTracedata(n.getImgdata(t),i))},i)}},{key:"imagedataToTracedata",value:function(t,e){e=this.checkoptions(e);var i=this.colorquantization(t,e),n=void 0;if(0===e.layering){n={layers:[],palette:i.palette,width:i.array[0].length-2,height:i.array.length-2};for(var r=0;r<i.palette.length;r+=1){var o=this.batchtracepaths(this.internodes(this.pathscan(this.layeringstep(i,r),e.pathomit),e),e.ltres,e.qtres);n.layers.push(o)}}else{var s=this.layering(i);e.layercontainerid&&this.drawLayers(s,this.specpalette,e.scale,e.layercontainerid);var a=this.batchpathscan(s,e.pathomit),c=this.batchinternodes(a,e);n={layers:this.batchtracelayers(c,e.ltres,e.qtres),palette:i.palette,width:t.width,height:t.height}}return n}},{key:"checkoptions",value:function(t){"string"==typeof(t=t||{})&&(t=t.toLowerCase(),t=this.optionpresets[t]?this.optionpresets[t]:{});for(var e=Object.keys(this.optionpresets.default),i=0;i<e.length;i+=1)t.hasOwnProperty(e[i])||(t[e[i]]=this.optionpresets.default[e[i]]);return t}},{key:"colorquantization",value:function(t,e){var i=[],n=0,r=void 0,o=void 0,s=void 0,a=[],c=t.width*t.height,l=void 0,h=void 0,u=void 0,f=void 0,d=void 0;for(h=0;h<t.height+2;h+=1)for(i[h]=[],l=0;l<t.width+2;l+=1)i[h][l]=-1;for(d=e.pal?e.pal:0===e.colorsampling?this.generatepalette(e.numberofcolors):1===e.colorsampling?this.samplepalette(e.numberofcolors,t):this.samplepalette2(e.numberofcolors,t),e.blurradius>0&&(t=this.blur(t,e.blurradius,e.blurdelta)),f=0;f<e.colorquantcycles;f+=1){if(f>0)for(u=0;u<d.length;u+=1)a[u].n>0&&(d[u]={r:Math.floor(a[u].r/a[u].n),g:Math.floor(a[u].g/a[u].n),b:Math.floor(a[u].b/a[u].n),a:Math.floor(a[u].a/a[u].n)}),a[u].n/c<e.mincolorratio&&f<e.colorquantcycles-1&&(d[u]={r:Math.floor(255*Math.random()),g:Math.floor(255*Math.random()),b:Math.floor(255*Math.random()),a:Math.floor(255*Math.random())});for(l=0;l<d.length;l+=1)a[l]={r:0,g:0,b:0,a:0,n:0};for(h=0;h<t.height;h+=1)for(l=0;l<t.width;l+=1){for(n=4*(h*t.width+l),s=0,o=1024,u=0;u<d.length;u+=1)(r=Math.abs(d[u].r-t.data[n])+Math.abs(d[u].g-t.data[n+1])+Math.abs(d[u].b-t.data[n+2])+Math.abs(d[u].a-t.data[n+3]))<o&&(o=r,s=u);a[s].r+=t.data[n],a[s].g+=t.data[n+1],a[s].b+=t.data[n+2],a[s].a+=t.data[n+3],a[s].n+=1,i[h+1][l+1]=s}}return{array:i,palette:d}}},{key:"samplepalette",value:function(t,e){for(var i=void 0,n=[],r=0;r<t;r+=1)i=4*Math.floor(Math.random()*e.data.length/4),n.push({r:e.data[i],g:e.data[i+1],b:e.data[i+2],a:e.data[i+3]});return n}},{key:"samplepalette2",value:function(t,e){for(var i=void 0,n=[],r=Math.ceil(Math.sqrt(t)),o=Math.ceil(t/r),s=e.width/(r+1),a=e.height/(o+1),c=0;c<o;c+=1)for(var l=0;l<r&&n.length!==t;l+=1)i=4*Math.floor((c+1)*a*e.width+(l+1)*s),n.push({r:e.data[i],g:e.data[i+1],b:e.data[i+2],a:e.data[i+3]});return n}},{key:"generatepalette",value:function(t){var e=[],i=void 0,n=void 0,r=void 0;if(t<8)for(var o=Math.floor(255/(t-1)),s=0;s<t;s+=1)e.push({r:s*o,g:s*o,b:s*o,a:255});else{var a=Math.floor(Math.pow(t,1/3)),c=Math.floor(255/(a-1)),l=t-a*a*a;for(i=0;i<a;i+=1)for(n=0;n<a;n+=1)for(r=0;r<a;r+=1)e.push({r:i*c,g:n*c,b:r*c,a:255});for(i=0;i<l;i+=1)e.push({r:Math.floor(255*Math.random()),g:Math.floor(255*Math.random()),b:Math.floor(255*Math.random()),a:Math.floor(255*Math.random())})}return e}},{key:"layering",value:function(t){var e=[],i=0,n=t.array.length,r=t.array[0].length,o=void 0,s=void 0,a=void 0,c=void 0,l=void 0,h=void 0,u=void 0,f=void 0,d=void 0,p=void 0,g=void 0;for(g=0;g<t.palette.length;g+=1)for(e[g]=[],p=0;p<n;p+=1)for(e[g][p]=[],d=0;d<r;d+=1)e[g][p][d]=0;for(p=1;p<n-1;p+=1)for(d=1;d<r-1;d+=1)i=t.array[p][d],o=t.array[p-1][d-1]===i?1:0,s=t.array[p-1][d]===i?1:0,a=t.array[p-1][d+1]===i?1:0,c=t.array[p][d-1]===i?1:0,l=t.array[p][d+1]===i?1:0,h=t.array[p+1][d-1]===i?1:0,u=t.array[p+1][d]===i?1:0,f=t.array[p+1][d+1]===i?1:0,e[i][p+1][d+1]=1+2*l+4*f+8*u,c||(e[i][p+1][d]=2+4*u+8*h),s||(e[i][p][d+1]=0+2*a+4*l+8),o||(e[i][p][d]=0+2*s+4+8*c);return e}},{key:"layeringstep",value:function(t,e){var i=[],n=t.array.length,r=t.array[0].length,o=void 0,s=void 0;for(s=0;s<n;s+=1)for(i[s]=[],o=0;o<r;o+=1)i[s][o]=0;for(s=1;s<n;s+=1)for(o=1;o<r;o+=1)i[s][o]=(t.array[s-1][o-1]===e?1:0)+(t.array[s-1][o]===e?2:0)+(t.array[s][o-1]===e?8:0)+(t.array[s][o]===e?4:0);return i}},{key:"pathscan",value:function(t,e){for(var i=[],n=0,r=0,o=0,s=0,a=t[0].length,c=t.length,l=0,h=!0,u=!1,f=void 0,d=0;d<c;d+=1)for(var p=0;p<a;p+=1)if(4===t[d][p]||11===t[d][p])for(o=p,s=d,i[n]={},i[n].points=[],i[n].boundingbox=[o,s,o,s],i[n].holechildren=[],h=!1,r=0,u=11===t[d][p],l=1;!h;){if(i[n].points[r]={},i[n].points[r].x=o-1,i[n].points[r].y=s-1,i[n].points[r].t=t[s][o],o-1<i[n].boundingbox[0]&&(i[n].boundingbox[0]=o-1),o-1>i[n].boundingbox[2]&&(i[n].boundingbox[2]=o-1),s-1<i[n].boundingbox[1]&&(i[n].boundingbox[1]=s-1),s-1>i[n].boundingbox[3]&&(i[n].boundingbox[3]=s-1),f=this.pathscan_combined_lookup[t[s][o]][l],t[s][o]=f[0],l=f[1],o+=f[2],s+=f[3],o-1===i[n].points[0].x&&s-1===i[n].points[0].y)if(h=!0,i[n].points.length<e)i.pop();else{if(i[n].isholepath=!!u,u){for(var g=0,v=[-1,-1,a+1,c+1],m=0;m<n;m++)!i[m].isholepath&&this.boundingboxincludes(i[m].boundingbox,i[n].boundingbox)&&this.boundingboxincludes(v,i[m].boundingbox)&&(g=m,v=i[m].boundingbox);i[g].holechildren.push(n)}n+=1}r+=1}return i}},{key:"boundingboxincludes",value:function(t,e){return t[0]<e[0]&&t[1]<e[1]&&t[2]>e[2]&&t[3]>e[3]}},{key:"batchpathscan",value:function(t,e){var i=[];for(var n in t)t.hasOwnProperty(n)&&(i[n]=this.pathscan(t[n],e));return i}},{key:"internodes",value:function(t,e){var i=[],n=0,r=0,o=0,s=0,a=0,c=void 0,l=void 0;for(c=0;c<t.length;c+=1)for(i[c]={},i[c].points=[],i[c].boundingbox=t[c].boundingbox,i[c].holechildren=t[c].holechildren,i[c].isholepath=t[c].isholepath,n=t[c].points.length,l=0;l<n;l+=1)r=(l+1)%n,o=(l+2)%n,s=(l-1+n)%n,a=(l-2+n)%n,e.rightangleenhance&&this.testrightangle(t[c],a,s,l,r,o)&&(i[c].points.length>0&&(i[c].points[i[c].points.length-1].linesegment=this.getdirection(i[c].points[i[c].points.length-1].x,i[c].points[i[c].points.length-1].y,t[c].points[l].x,t[c].points[l].y)),i[c].points.push({x:t[c].points[l].x,y:t[c].points[l].y,linesegment:this.getdirection(t[c].points[l].x,t[c].points[l].y,(t[c].points[l].x+t[c].points[r].x)/2,(t[c].points[l].y+t[c].points[r].y)/2)})),i[c].points.push({x:(t[c].points[l].x+t[c].points[r].x)/2,y:(t[c].points[l].y+t[c].points[r].y)/2,linesegment:this.getdirection((t[c].points[l].x+t[c].points[r].x)/2,(t[c].points[l].y+t[c].points[r].y)/2,(t[c].points[r].x+t[c].points[o].x)/2,(t[c].points[r].y+t[c].points[o].y)/2)});return i}},{key:"testrightangle",value:function(t,e,i,n,r,o){return t.points[n].x===t.points[e].x&&t.points[n].x===t.points[i].x&&t.points[n].y===t.points[r].y&&t.points[n].y===t.points[o].y||t.points[n].y===t.points[e].y&&t.points[n].y===t.points[i].y&&t.points[n].x===t.points[r].x&&t.points[n].x===t.points[o].x}},{key:"getdirection",value:function(t,e,i,n){return t<i?e<n?1:e>n?7:0:t>i?e<n?3:e>n?5:4:e<n?2:e>n?6:8}},{key:"batchinternodes",value:function(t,e){var i=[];for(var n in t)t.hasOwnProperty(n)&&(i[n]=this.internodes(t[n],e));return i}},{key:"tracepath",value:function(t,e,i){var n=0,r=void 0,o=void 0,s=void 0,a={segments:[]};for(a.boundingbox=t.boundingbox,a.holechildren=t.holechildren,a.isholepath=t.isholepath;n<t.points.length;){for(r=t.points[n].linesegment,o=-1,s=n+1;(t.points[s].linesegment===r||t.points[s].linesegment===o||-1===o)&&s<t.points.length-1;)t.points[s].linesegment!==r&&-1===o&&(o=t.points[s].linesegment),s+=1;s===t.points.length-1&&(s=0),a.segments=a.segments.concat(this.fitseq(t,e,i,n,s)),n=s>0?s:t.points.length}return a}},{key:"fitseq",value:function(t,e,i,n,r){if(r>t.points.length||r<0)return[];var o=n,s=0,a=!0,c=void 0,l=void 0,h=void 0,u=r-n;u<0&&(u+=t.points.length);for(var f=(t.points[r].x-t.points[n].x)/u,d=(t.points[r].y-t.points[n].y)/u,p=(n+1)%t.points.length,g=void 0;p!=r;)(g=p-n)<0&&(g+=t.points.length),c=t.points[n].x+f*g,l=t.points[n].y+d*g,(h=(t.points[p].x-c)*(t.points[p].x-c)+(t.points[p].y-l)*(t.points[p].y-l))>e&&(a=!1),h>s&&(o=p,s=h),p=(p+1)%t.points.length;if(a)return[{type:"L",x1:t.points[n].x,y1:t.points[n].y,x2:t.points[r].x,y2:t.points[r].y}];var v=o;a=!0,s=0;var m=(v-n)/u,b=(1-m)*(1-m),y=2*(1-m)*m,_=m*m,x=(b*t.points[n].x+_*t.points[r].x-t.points[v].x)/-y,w=(b*t.points[n].y+_*t.points[r].y-t.points[v].y)/-y;for(p=n+1;p!=r;)y=2*(1-(m=(p-n)/u))*m,_=m*m,c=(b=(1-m)*(1-m))*t.points[n].x+y*x+_*t.points[r].x,l=b*t.points[n].y+y*w+_*t.points[r].y,(h=(t.points[p].x-c)*(t.points[p].x-c)+(t.points[p].y-l)*(t.points[p].y-l))>i&&(a=!1),h>s&&(o=p,s=h),p=(p+1)%t.points.length;if(a)return[{type:"Q",x1:t.points[n].x,y1:t.points[n].y,x2:x,y2:w,x3:t.points[r].x,y3:t.points[r].y}];var S=v;return this.fitseq(t,e,i,n,S).concat(this.fitseq(t,e,i,S,r))}},{key:"batchtracepaths",value:function(t,e,i){var n=[];for(var r in t)t.hasOwnProperty(r)&&n.push(this.tracepath(t[r],e,i));return n}},{key:"batchtracelayers",value:function(t,e,i){var n=[];for(var r in t)t.hasOwnProperty(r)&&(n[r]=this.batchtracepaths(t[r],e,i));return n}},{key:"roundtodec",value:function(t,e){return Number(t.toFixed(e))}},{key:"svgpathstring",value:function(t,e,i,n){var r=t.layers[e],o=r[i],s="",a=void 0;if(n.linefilter&&o.segments.length<3)return s;if(s="<path "+(n.desc?'desc="l '+e+" p "+i+'" ':"")+this.tosvgcolorstr(t.palette[e],n)+'d="',-1===n.roundcoords){for(s+="M "+o.segments[0].x1*n.scale+" "+o.segments[0].y1*n.scale+" ",a=0;a<o.segments.length;a++)s+=o.segments[a].type+" "+o.segments[a].x2*n.scale+" "+o.segments[a].y2*n.scale+" ",o.segments[a].hasOwnProperty("x3")&&(s+=o.segments[a].x3*n.scale+" "+o.segments[a].y3*n.scale+" ");s+="Z "}else{for(s+="M "+this.roundtodec(o.segments[0].x1*n.scale,n.roundcoords)+" "+this.roundtodec(o.segments[0].y1*n.scale,n.roundcoords)+" ",a=0;a<o.segments.length;a++)s+=o.segments[a].type+" "+this.roundtodec(o.segments[a].x2*n.scale,n.roundcoords)+" "+this.roundtodec(o.segments[a].y2*n.scale,n.roundcoords)+" ",o.segments[a].hasOwnProperty("x3")&&(s+=this.roundtodec(o.segments[a].x3*n.scale,n.roundcoords)+" "+this.roundtodec(o.segments[a].y3*n.scale,n.roundcoords)+" ");s+="Z "}for(var c=0;c<o.holechildren.length;c++){var l=r[o.holechildren[c]];if(-1===n.roundcoords)for(l.segments[l.segments.length-1].hasOwnProperty("x3")?s+="M "+l.segments[l.segments.length-1].x3*n.scale+" "+l.segments[l.segments.length-1].y3*n.scale+" ":s+="M "+l.segments[l.segments.length-1].x2*n.scale+" "+l.segments[l.segments.length-1].y2*n.scale+" ",a=l.segments.length-1;a>=0;a--)s+=l.segments[a].type+" ",l.segments[a].hasOwnProperty("x3")&&(s+=l.segments[a].x2*n.scale+" "+l.segments[a].y2*n.scale+" "),s+=l.segments[a].x1*n.scale+" "+l.segments[a].y1*n.scale+" ";else for(l.segments[l.segments.length-1].hasOwnProperty("x3")?s+="M "+this.roundtodec(l.segments[l.segments.length-1].x3*n.scale)+" "+this.roundtodec(l.segments[l.segments.length-1].y3*n.scale)+" ":s+="M "+this.roundtodec(l.segments[l.segments.length-1].x2*n.scale)+" "+this.roundtodec(l.segments[l.segments.length-1].y2*n.scale)+" ",a=l.segments.length-1;a>=0;a--)s+=l.segments[a].type+" ",l.segments[a].hasOwnProperty("x3")&&(s+=this.roundtodec(l.segments[a].x2*n.scale)+" "+this.roundtodec(l.segments[a].y2*n.scale)+" "),s+=this.roundtodec(l.segments[a].x1*n.scale)+" "+this.roundtodec(l.segments[a].y1*n.scale)+" ";s+="Z "}if(s+='" />',n.lcpr||n.qcpr){for(a=0;a<o.segments.length;a++)o.segments[a].hasOwnProperty("x3")&&n.qcpr&&(s+='<circle cx="'+o.segments[a].x2*n.scale+'" cy="'+o.segments[a].y2*n.scale+'" r="'+n.qcpr+'" fill="cyan" stroke-width="'+.2*n.qcpr+'" stroke="black" />',s+='<circle cx="'+o.segments[a].x3*n.scale+'" cy="'+o.segments[a].y3*n.scale+'" r="'+n.qcpr+'" fill="white" stroke-width="'+.2*n.qcpr+'" stroke="black" />',s+='<line x1="'+o.segments[a].x1*n.scale+'" y1="'+o.segments[a].y1*n.scale+'" x2="'+o.segments[a].x2*n.scale+'" y2="'+o.segments[a].y2*n.scale+'" stroke-width="'+.2*n.qcpr+'" stroke="cyan" />',s+='<line x1="'+o.segments[a].x2*n.scale+'" y1="'+o.segments[a].y2*n.scale+'" x2="'+o.segments[a].x3*n.scale+'" y2="'+o.segments[a].y3*n.scale+'" stroke-width="'+.2*n.qcpr+'" stroke="cyan" />'),!o.segments[a].hasOwnProperty("x3")&&n.lcpr&&(s+='<circle cx="'+o.segments[a].x2*n.scale+'" cy="'+o.segments[a].y2*n.scale+'" r="'+n.lcpr+'" fill="white" stroke-width="'+.2*n.lcpr+'" stroke="black" />');for(c=0;c<o.holechildren.length;c++){l=r[o.holechildren[c]];for(a=0;a<l.segments.length;a++)l.segments[a].hasOwnProperty("x3")&&n.qcpr&&(s+='<circle cx="'+l.segments[a].x2*n.scale+'" cy="'+l.segments[a].y2*n.scale+'" r="'+n.qcpr+'" fill="cyan" stroke-width="'+.2*n.qcpr+'" stroke="black" />',s+='<circle cx="'+l.segments[a].x3*n.scale+'" cy="'+l.segments[a].y3*n.scale+'" r="'+n.qcpr+'" fill="white" stroke-width="'+.2*n.qcpr+'" stroke="black" />',s+='<line x1="'+l.segments[a].x1*n.scale+'" y1="'+l.segments[a].y1*n.scale+'" x2="'+l.segments[a].x2*n.scale+'" y2="'+l.segments[a].y2*n.scale+'" stroke-width="'+.2*n.qcpr+'" stroke="cyan" />',s+='<line x1="'+l.segments[a].x2*n.scale+'" y1="'+l.segments[a].y2*n.scale+'" x2="'+l.segments[a].x3*n.scale+'" y2="'+l.segments[a].y3*n.scale+'" stroke-width="'+.2*n.qcpr+'" stroke="cyan" />'),!l.segments[a].hasOwnProperty("x3")&&n.lcpr&&(s+='<circle cx="'+l.segments[a].x2*n.scale+'" cy="'+l.segments[a].y2*n.scale+'" r="'+n.lcpr+'" fill="white" stroke-width="'+.2*n.lcpr+'" stroke="black" />')}}return s}},{key:"getsvgstring",value:function(t,e){e=this.checkoptions(e);for(var i=t.width*e.scale,n=t.height*e.scale,r="<svg "+(e.viewbox?'viewBox="0 0 '+i+" "+n+'" ':'width="'+i+'" height="'+n+'" ')+'version="1.1" xmlns="http://www.w3.org/2000/svg" desc="Created with imagetracer.js version '+this.versionnumber+'" >',o=0;o<t.layers.length;o+=1)for(var s=0;s<t.layers[o].length;s+=1)t.layers[o][s].isholepath||(r+=this.svgpathstring(t,o,s,e));return r+="</svg>"}},{key:"compareNumbers",value:function(t,e){return t-e}},{key:"torgbastr",value:function(t){return"rgba("+t.r+","+t.g+","+t.b+","+t.a+")"}},{key:"tosvgcolorstr",value:function(t,e){return'fill="rgb('+t.r+","+t.g+","+t.b+')" stroke="rgb('+t.r+","+t.g+","+t.b+')" stroke-width="'+e.strokewidth+'" opacity="'+t.a/255+'" '}},{key:"appendSVGString",value:function(t,e){var i=void 0;e?(i=document.getElementById(e))||((i=document.createElement("div")).id=e,document.body.appendChild(i)):(i=document.createElement("div"),document.body.appendChild(i)),i.innerHTML+=t}},{key:"blur",value:function(t,e,i){var n=void 0,r=void 0,o=void 0,s=void 0,a=void 0,c=void 0,l=void 0,h=void 0,u=void 0,f={width:t.width,height:t.height,data:[]};if((e=Math.floor(e))<1)return t;e>5&&(e=5),(i=Math.abs(i))>1024&&(i=1024);var d=this.gks[e-1];for(r=0;r<t.height;r++)for(n=0;n<t.width;n++){for(a=0,c=0,l=0,h=0,u=0,o=-e;o<e+1;o++)n+o>0&&n+o<t.width&&(s=4*(r*t.width+n+o),a+=t.data[s]*d[o+e],c+=t.data[s+1]*d[o+e],l+=t.data[s+2]*d[o+e],h+=t.data[s+3]*d[o+e],u+=d[o+e]);s=4*(r*t.width+n),f.data[s]=Math.floor(a/u),f.data[s+1]=Math.floor(c/u),f.data[s+2]=Math.floor(l/u),f.data[s+3]=Math.floor(h/u)}var p=new Uint8ClampedArray(f.data);for(r=0;r<t.height;r++)for(n=0;n<t.width;n++){for(a=0,c=0,l=0,h=0,u=0,o=-e;o<e+1;o++)r+o>0&&r+o<t.height&&(a+=p[s=4*((r+o)*t.width+n)]*d[o+e],c+=p[s+1]*d[o+e],l+=p[s+2]*d[o+e],h+=p[s+3]*d[o+e],u+=d[o+e]);s=4*(r*t.width+n),f.data[s]=Math.floor(a/u),f.data[s+1]=Math.floor(c/u),f.data[s+2]=Math.floor(l/u),f.data[s+3]=Math.floor(h/u)}for(r=0;r<t.height;r++)for(n=0;n<t.width;n++)s=4*(r*t.width+n),Math.abs(f.data[s]-t.data[s])+Math.abs(f.data[s+1]-t.data[s+1])+Math.abs(f.data[s+2]-t.data[s+2])+Math.abs(f.data[s+3]-t.data[s+3])>i&&(f.data[s]=t.data[s],f.data[s+1]=t.data[s+1],f.data[s+2]=t.data[s+2],f.data[s+3]=t.data[s+3]);return f}},{key:"loadImage",value:function(t,e,i){var n=new Image;i&&i.corsenabled&&(n.crossOrigin="Anonymous"),n.src=t,n.onload=function(){var t=document.createElement("canvas");t.width=n.width,t.height=n.height,t.getContext("2d").drawImage(n,0,0),e(t)}}},{key:"getImgdata",value:function(t){return t.getContext("2d").getImageData(0,0,t.width,t.height)}},{key:"drawLayers",value:function(t,e,i,n){i=i||1;var r=void 0,o=void 0,s=void 0,a=void 0,c=void 0,l=void 0;for(c in n?(l=document.getElementById(n))||((l=document.createElement("div")).id=n,document.body.appendChild(l)):(l=document.createElement("div"),document.body.appendChild(l)),t)if(t.hasOwnProperty(c)){r=t[c][0].length,o=t[c].length;var h=document.createElement("canvas");h.width=r*i,h.height=o*i;var u=h.getContext("2d");for(a=0;a<o;a+=1)for(s=0;s<r;s+=1)u.fillStyle=this.torgbastr(e[t[c][a][s]%e.length]),u.fillRect(s*i,a*i,i,i);l.appendChild(h)}}}]),t}();e.default=n},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=C(i(3)),o=C(i(4)),s=C(i(105)),a=C(i(106)),c=C(i(108)),l=C(i(110)),h=C(i(111)),u=C(i(112)),f=C(i(113)),d=C(i(114)),p=C(i(115)),g=C(i(116)),v=C(i(122)),m=C(i(124)),b=C(i(126)),y=C(i(127)),_=C(i(128)),x=C(i(129)),w=C(i(73)),S=C(i(72));function C(t){return t&&t.__esModule?t:{default:t}}var O=w.default.componentNames,k=w.default.eventNames,T=w.default.drawingModes,E=w.default.fObjectOptions,j=r.default.extend,M=r.default.stamp,P=r.default.isArray,A=r.default.isString,I=r.default.forEachArray,D=r.default.forEachOwnProperties,L=r.default.CustomEvents,R=1e3,B=800,F={cssOnly:!0},N={backstoreOnly:!0},X=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.cssMaxWidth,r=i.cssMaxHeight,o=i.useItext,s=void 0!==o&&o,a=i.useDragAddIcon,c=void 0!==a&&a;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvasImage=null,this.cssMaxWidth=n||R,this.cssMaxHeight=r||B,this.useItext=s,this.useDragAddIcon=c,this.cropSelectionStyle={},this.imageName="",this._objects={},this._canvas=null,this._drawingMode=T.NORMAL,this._drawingModeMap={},this._componentMap={},this._handler={onMouseDown:this._onMouseDown.bind(this),onObjectAdded:this._onObjectAdded.bind(this),onObjectRemoved:this._onObjectRemoved.bind(this),onObjectMoved:this._onObjectMoved.bind(this),onObjectScaled:this._onObjectScaled.bind(this),onObjectSelected:this._onObjectSelected.bind(this),onPathCreated:this._onPathCreated.bind(this),onSelectionCleared:this._onSelectionCleared.bind(this),onSelectionCreated:this._onSelectionCreated.bind(this)},this._setCanvasElement(e),this._createDrawingModeInstances(),this._createComponents(),this._attachCanvasEvents()}return n(t,[{key:"destroy",value:function(){var t=this._canvas.wrapperEl;this._canvas.clear(),t.parentNode.removeChild(t)}},{key:"deactivateAll",value:function(){return this._canvas.deactivateAll(),this}},{key:"renderAll",value:function(){return this._canvas.renderAll(),this}},{key:"add",value:function(t){var e,i=[];P(t)?i=t:i.push(t),(e=this._canvas).add.apply(e,i)}},{key:"contains",value:function(t){return this._canvas.contains(t)}},{key:"getObjects",value:function(){return this._canvas.getObjects().slice()}},{key:"getObject",value:function(t){return this._objects[t]}},{key:"remove",value:function(t){this._canvas.remove(t)}},{key:"removeAll",value:function(t){var e=this._canvas,i=e.getObjects().slice();return e.remove.apply(e,this._canvas.getObjects()),t&&e.clear(),i}},{key:"removeObjectById",value:function(t){var e=[],i=this._canvas,n=this.getObject(t);return n&&n.isType("group")&&!n.isEmpty()?(i.discardActiveGroup(),n.forEachObject(function(t){e.push(t),t.remove()})):i.contains(n)&&(e.push(n),n.remove()),e}},{key:"getObjectId",value:function(t){var e=null;for(e in this._objects)if(this._objects.hasOwnProperty(e)&&t===this._objects[e])return e;return null}},{key:"getActiveObject",value:function(){return this._canvas.getActiveObject()}},{key:"getActiveGroupObject",value:function(){return this._canvas.getActiveGroup()}},{key:"setActiveObject",value:function(t){this._canvas.setActiveObject(t)}},{key:"setCropSelectionStyle",value:function(t){this.cropSelectionStyle=t}},{key:"getComponent",value:function(t){return this._componentMap[t]}},{key:"getDrawingMode",value:function(){return this._drawingMode}},{key:"startDrawingMode",value:function(t,e){if(this._isSameDrawingMode(t))return!0;this.stopDrawingMode();var i=this._getDrawingModeInstance(t);return i&&i.start&&(i.start(this,e),this._drawingMode=t),!!i}},{key:"stopDrawingMode",value:function(){if(!this._isSameDrawingMode(T.NORMAL)){var t=this._getDrawingModeInstance(this.getDrawingMode());t&&t.end&&t.end(this),this._drawingMode=T.NORMAL}}},{key:"toDataURL",value:function(t){return this._canvas&&this._canvas.toDataURL(t)}},{key:"setCanvasImage",value:function(t,e){e&&M(e),this.imageName=t,this.canvasImage=e}},{key:"setCssMaxDimension",value:function(t){this.cssMaxWidth=t.width||this.cssMaxWidth,this.cssMaxHeight=t.height||this.cssMaxHeight}},{key:"adjustCanvasDimension",value:function(){var t=this.canvasImage.scale(1),e=t.getBoundingRect(),i=e.width,n=e.height,r=this._calcMaxDimension(i,n);this.setCanvasCssDimension({width:"100%",height:"100%","max-width":r.width+"px","max-height":r.height+"px"}),this.setCanvasBackstoreDimension({width:i,height:n}),this._canvas.centerObject(t)}},{key:"setCanvasCssDimension",value:function(t){this._canvas.setDimensions(t,F)}},{key:"setCanvasBackstoreDimension",value:function(t){this._canvas.setDimensions(t,N)}},{key:"setImageProperties",value:function(t,e){var i=this.canvasImage;i&&(i.set(t).setCoords(),e&&this._canvas.renderAll())}},{key:"getCanvasElement",value:function(){return this._canvas.getElement()}},{key:"getCanvas",value:function(){return this._canvas}},{key:"getCanvasImage",value:function(){return this.canvasImage}},{key:"getImageName",value:function(){return this.imageName}},{key:"addImageObject",value:function(t){var e=this,i=this._callbackAfterLoadingImageObject.bind(this);return new o.default(function(n){s.default.Image.fromURL(t,function(t){i(t),n(e.createObjectProperties(t))},{crossOrigin:"Anonymous"})})}},{key:"getCenter",value:function(){return this._canvas.getCenter()}},{key:"getCropzoneRect",value:function(){return this.getComponent(O.CROPPER).getCropzoneRect()}},{key:"getCroppedImageData",value:function(t){return this.getComponent(O.CROPPER).getCroppedImageData(t)}},{key:"setBrush",value:function(t){var e=this._drawingMode,i=O.FREE_DRAWING;e===T.LINE&&(i=T.LINE),this.getComponent(i).setBrush(t)}},{key:"setDrawingShape",value:function(t,e){this.getComponent(O.SHAPE).setStates(t,e)}},{key:"registerPaths",value:function(t){this.getComponent(O.ICON).registerPaths(t)}},{key:"changeCursor",value:function(t){var e=this.getCanvas();e.defaultCursor=t,e.renderAll()}},{key:"hasFilter",value:function(t){return this.getComponent(O.FILTER).hasFilter(t)}},{key:"setSelectionStyle",value:function(t){j(E.SELECTION_STYLE,t)}},{key:"setObjectProperties",value:function(t,e){var i=this.getObject(t),n=j({},e);return i.set(n),i.setCoords(),this.getCanvas().renderAll(),n}},{key:"getObjectProperties",value:function(t,e){var i=this.getObject(t),n={};return A(e)?n[e]=i[e]:P(e)?I(e,function(t){n[t]=i[t]}):D(e,function(t,e){n[e]=i[e]}),n}},{key:"getObjectPosition",value:function(t,e,i){var n=this.getObject(t);return n?n.getPointByOrigin(e,i):null}},{key:"setObjectPosition",value:function(t,e){var i=this.getObject(t),n=e.x,r=e.y,o=e.originX,s=e.originY;if(!i)return!1;var a=i.getPointByOrigin(o,s),c=i.getPointByOrigin("center","center"),l=c.x-a.x,h=c.y-a.y;return i.set({left:n+l,top:r+h}),i.setCoords(),!0}},{key:"getCanvasSize",value:function(){var t=this.getCanvasImage();return{width:t?t.width:0,height:t?t.height:0}}},{key:"_getDrawingModeInstance",value:function(t){return this._drawingModeMap[t]}},{key:"_setCanvasElement",value:function(t){var e=void 0,i=void 0;"CANVAS"!==(e=t.jquery?t[0]:t.nodeType?t:document.querySelector(t)).nodeName.toUpperCase()&&(i=document.createElement("canvas"),e.appendChild(i)),this._canvas=new s.default.Canvas(i,{containerClass:"tui-image-editor-canvas-container",enableRetinaScaling:!1})}},{key:"_createDrawingModeInstances",value:function(){this._register(this._drawingModeMap,new m.default),this._register(this._drawingModeMap,new b.default),this._register(this._drawingModeMap,new y.default),this._register(this._drawingModeMap,new _.default),this._register(this._drawingModeMap,new x.default)}},{key:"_createComponents",value:function(){this._register(this._componentMap,new a.default(this)),this._register(this._componentMap,new c.default(this)),this._register(this._componentMap,new l.default(this)),this._register(this._componentMap,new h.default(this)),this._register(this._componentMap,new u.default(this)),this._register(this._componentMap,new f.default(this)),this._register(this._componentMap,new d.default(this)),this._register(this._componentMap,new p.default(this)),this._register(this._componentMap,new g.default(this)),this._register(this._componentMap,new v.default(this))}},{key:"_register",value:function(t,e){t[e.getName()]=e}},{key:"_isSameDrawingMode",value:function(t){return this.getDrawingMode()===t}},{key:"_calcMaxDimension",value:function(t,e){var i=this.cssMaxWidth/t,n=this.cssMaxHeight/e,r=Math.min(t,this.cssMaxWidth),o=Math.min(e,this.cssMaxHeight);return i<1&&i<n?(r=t*i,o=e*i):n<1&&n<i&&(r=t*n,o=e*n),{width:Math.floor(r),height:Math.floor(o)}}},{key:"_callbackAfterLoadingImageObject",value:function(t){var e=this.getCanvasImage().getCenterPoint();t.set(w.default.fObjectOptions.SELECTION_STYLE),t.set({left:e.x,top:e.y,crossOrigin:"Anonymous"}),this.getCanvas().add(t).setActiveObject(t)}},{key:"_attachCanvasEvents",value:function(){var t=this._canvas,e=this._handler;t.on({"mouse:down":e.onMouseDown,"object:added":e.onObjectAdded,"object:removed":e.onObjectRemoved,"object:moving":e.onObjectMoved,"object:scaling":e.onObjectScaled,"object:selected":e.onObjectSelected,"path:created":e.onPathCreated,"selection:cleared":e.onSelectionCleared,"selection:created":e.onSelectionCreated})}},{key:"_onMouseDown",value:function(t){var e=this._canvas.getPointer(t.e);this.fire(k.MOUSE_DOWN,t.e,e)}},{key:"_onObjectAdded",value:function(t){var e=t.target;e.isType("cropzone")||this._addFabricObject(e)}},{key:"_onObjectRemoved",value:function(t){var e=t.target;this._removeFabricObject(M(e))}},{key:"_onObjectMoved",value:function(t){var e=t.target,i=this.createObjectProperties(e);this.fire(k.OBJECT_MOVED,i)}},{key:"_onObjectScaled",value:function(t){var e=t.target,i=this.createObjectProperties(e);this.fire(k.OBJECT_SCALED,i)}},{key:"_onObjectSelected",value:function(t){var e=t.target,i=this.createObjectProperties(e);this.fire(k.OBJECT_ACTIVATED,i)}},{key:"_onPathCreated",value:function(t){t.path.set(w.default.fObjectOptions.SELECTION_STYLE);var e=this.createObjectProperties(t.path);this.fire(k.ADD_OBJECT,e)}},{key:"_onSelectionCleared",value:function(){this.fire(k.SELECTION_CLEARED)}},{key:"_onSelectionCreated",value:function(t){this.fire(k.SELECTION_CREATED,t.target)}},{key:"discardSelection",value:function(){this._canvas.discardActiveGroup(),this._canvas.discardActiveObject(),this._canvas.renderAll()}},{key:"changeSelectableAll",value:function(t){this._canvas.forEachObject(function(e){e.selectable=t,e.hoverCursor=t?"move":"crosshair"})}},{key:"createObjectProperties",value:function(t){var e={id:M(t),type:t.type};return j(e,S.default.getProperties(t,["left","top","width","height","fill","stroke","strokeWidth","opacity"])),["i-text","text"].indexOf(t.type)>-1&&j(e,this._createTextProperties(t,e)),e}},{key:"_createTextProperties",value:function(t){var e={};return j(e,S.default.getProperties(t,["text","fontFamily","fontSize","fontStyle","textAlign","textDecoration"])),e}},{key:"_addFabricObject",value:function(t){var e=M(t);return this._objects[e]=t,e}},{key:"_removeFabricObject",value:function(t){delete this._objects[t]}}]),t}();L.mixin(X),t.exports=X},function(t,i){t.exports=e},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=a(i(4)),o=a(i(107)),s=a(i(73));function a(t){return t&&t.__esModule?t:{default:t}}var c=s.default.componentNames,l=s.default.rejectMessages,h={padding:0,crossOrigin:"Anonymous"},u=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,c.IMAGE_LOADER,t))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,o.default),n(e,[{key:"load",value:function(t,e){var i=this,n=void 0;if(t||e)n=this._setBackgroundImage(e).then(function(e){return i.setCanvasImage(t,e),i.adjustCanvasDimension(),e});else{var o=this.getCanvas();o.backgroundImage=null,o.renderAll(),n=new r.default(function(t){i.setCanvasImage("",null),t()})}return n}},{key:"_setBackgroundImage",value:function(t){var e=this;return t?new r.default(function(i,n){var r=e.getCanvas();r.setBackgroundImage(t,function(){var t=r.backgroundImage;t.getElement()?i(t):n(l.loadingImageFailed)},h)}):r.default.reject(l.loadImage)}}]),e}();t.exports=u},function(t,e){"use strict";var i=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var n=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=e,this.graphics=i}return i(t,[{key:"fire",value:function(){for(var t=this.graphics,e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];return this.graphics.fire.apply(t,i)}},{key:"setCanvasImage",value:function(t,e){this.graphics.setCanvasImage(t,e)}},{key:"getCanvasElement",value:function(){return this.graphics.getCanvasElement()}},{key:"getCanvas",value:function(){return this.graphics.getCanvas()}},{key:"getCanvasImage",value:function(){return this.graphics.getCanvasImage()}},{key:"getImageName",value:function(){return this.graphics.getImageName()}},{key:"getEditor",value:function(){return this.graphics.getEditor()}},{key:"getName",value:function(){return this.name}},{key:"setImageProperties",value:function(t,e){this.graphics.setImageProperties(t,e)}},{key:"setCanvasCssDimension",value:function(t){this.graphics.setCanvasCssDimension(t)}},{key:"setCanvasBackstoreDimension",value:function(t){this.graphics.setCanvasBackstoreDimension(t)}},{key:"adjustCanvasDimension",value:function(){this.graphics.adjustCanvasDimension()}}]),t}();t.exports=n},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=l(i(105)),o=l(i(107)),s=l(i(109)),a=i(73),c=i(72);function l(t){return t&&t.__esModule?t:{default:t}}var h=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,a.componentNames.CROPPER,t));return i._cropzone=null,i._startX=null,i._startY=null,i._withShiftKey=!1,i._listeners={keydown:i._onKeyDown.bind(i),keyup:i._onKeyUp.bind(i),mousedown:i._onFabricMouseDown.bind(i),mousemove:i._onFabricMouseMove.bind(i),mouseup:i._onFabricMouseUp.bind(i)},i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,o.default),n(e,[{key:"start",value:function(){if(!this._cropzone){var t=this.getCanvas();t.forEachObject(function(t){t.evented=!1}),this._cropzone=new s.default({left:-10,top:-10,width:1,height:1,strokeWidth:0,cornerSize:10,cornerColor:"black",fill:"transparent",hasRotatingPoint:!1,hasBorders:!1,lockScalingFlip:!0,lockRotation:!0},this.graphics.cropSelectionStyle),t.deactivateAll(),t.add(this._cropzone),t.on("mouse:down",this._listeners.mousedown),t.selection=!1,t.defaultCursor="crosshair",r.default.util.addListener(document,"keydown",this._listeners.keydown),r.default.util.addListener(document,"keyup",this._listeners.keyup)}}},{key:"end",value:function(){var t=this.getCanvas(),e=this._cropzone;e&&(e.remove(),t.selection=!0,t.defaultCursor="default",t.off("mouse:down",this._listeners.mousedown),t.forEachObject(function(t){t.evented=!0}),this._cropzone=null,r.default.util.removeListener(document,"keydown",this._listeners.keydown),r.default.util.removeListener(document,"keyup",this._listeners.keyup))}},{key:"_onFabricMouseDown",value:function(t){var e=this.getCanvas();if(!t.target){e.selection=!1;var i=e.getPointer(t.e);this._startX=i.x,this._startY=i.y,e.on({"mouse:move":this._listeners.mousemove,"mouse:up":this._listeners.mouseup})}}},{key:"_onFabricMouseMove",value:function(t){var e=this.getCanvas(),i=e.getPointer(t.e),n=i.x,r=i.y,o=this._cropzone;Math.abs(n-this._startX)+Math.abs(r-this._startY)>10&&(o.remove(),o.set(this._calcRectDimensionFromPoint(n,r)),e.add(o))}},{key:"_calcRectDimensionFromPoint",value:function(t,e){var i=this.getCanvas(),n=i.getWidth(),r=i.getHeight(),o=this._startX,s=this._startY,a=(0,c.clamp)(t,0,o),l=(0,c.clamp)(e,0,s),h=(0,c.clamp)(t,o,n)-a,u=(0,c.clamp)(e,s,r)-l;return this._withShiftKey&&(h>u?u=h:u>h&&(h=u),o>=t&&(a=o-h),s>=e&&(l=s-u)),{left:a,top:l,width:h,height:u}}},{key:"_onFabricMouseUp",value:function(){var t=this._cropzone,e=this._listeners,i=this.getCanvas();i.setActiveObject(t),i.off({"mouse:move":e.mousemove,"mouse:up":e.mouseup})}},{key:"getCroppedImageData",value:function(t){var e=this.getCanvas(),i=e.contains(this._cropzone);if(!t)return null;i&&this._cropzone.remove();var n={imageName:this.getImageName(),url:e.toDataURL(t)};return i&&e.add(this._cropzone),n}},{key:"getCropzoneRect",value:function(){var t=this._cropzone;return t.isValid()?{left:t.getLeft(),top:t.getTop(),width:t.getWidth(),height:t.getHeight()}:null}},{key:"_onKeyDown",value:function(t){t.keyCode===a.keyCodes.SHIFT&&(this._withShiftKey=!0)}},{key:"_onKeyUp",value:function(t){t.keyCode===a.keyCodes.SHIFT&&(this._withShiftKey=!1)}}]),e}();t.exports=h},function(t,e,i){"use strict";var n=s(i(3)),r=s(i(105)),o=i(72);function s(t){return t&&t.__esModule?t:{default:t}}var a=r.default.util.createClass(r.default.Rect,{initialize:function(t,e){(t=n.default.extend(t,e)).type="cropzone",this.callSuper("initialize",t),this.options=t,this.on({moving:this._onMoving,scaling:this._onScaling})},_render:function(t){this.callSuper("_render",t);var e=this.flipX?-1:1,i=this.flipY?-1:1,n=e/this.scaleX,r=i/this.scaleY;t.scale(n,r),this._fillOuterRect(t,"rgba(0, 0, 0, 0.55)"),this.options.lineWidth?this._fillInnerRect(t):(this._strokeBorder(t,"rgb(0, 0, 0)",{lineDashWidth:7}),this._strokeBorder(t,"rgb(255, 255, 255)",{lineDashWidth:7,lineDashOffset:7})),t.scale(1/n,1/r)},_fillOuterRect:function(t,e){var i=this._getCoordinates(t),n=i.x,r=i.y;t.save(),t.fillStyle=e,t.beginPath(),t.moveTo(n[0]-1,r[0]-1),t.lineTo(n[3]+1,r[0]-1),t.lineTo(n[3]+1,r[3]+1),t.lineTo(n[0]-1,r[3]+1),t.lineTo(n[0]-1,r[0]-1),t.closePath(),t.moveTo(n[1],r[1]),t.lineTo(n[1],r[2]),t.lineTo(n[2],r[2]),t.lineTo(n[2],r[1]),t.lineTo(n[1],r[1]),t.closePath(),t.fill(),t.restore()},_fillInnerRect:function(t){var e=this._getCoordinates(t),i=e.x,n=e.y,r=this._caculateInnerPosition(i,(i[2]-i[1])/3),o=this._caculateInnerPosition(n,(n[2]-n[1])/3);t.save(),t.strokeStyle="rgba(255, 255, 255, 0.7)",t.lineWidth=this.options.lineWidth,t.beginPath(),t.moveTo(r[0],o[1]),t.lineTo(r[3],o[1]),t.moveTo(r[0],o[2]),t.lineTo(r[3],o[2]),t.moveTo(r[1],o[0]),t.lineTo(r[1],o[3]),t.moveTo(r[2],o[0]),t.lineTo(r[2],o[3]),t.stroke(),t.closePath(),t.restore()},_caculateInnerPosition:function(t,e){var i=[];return i[0]=t[1],i[1]=t[1]+e,i[2]=t[1]+2*e,i[3]=t[2],i},_getCoordinates:function(t){var e=this.getWidth(),i=this.getHeight(),r=e/2,o=i/2,s=this.getLeft(),a=this.getTop(),c=t.canvas;return{x:n.default.map([-(r+s),-r,r,r+(c.width-s-e)],Math.ceil),y:n.default.map([-(o+a),-o,o,o+(c.height-a-i)],Math.ceil)}},_strokeBorder:function(t,e,i){var n=i.lineDashWidth,r=i.lineDashOffset,o=i.lineWidth,s=this.getWidth()/2,a=this.getHeight()/2;t.save(),t.strokeStyle=e,t.setLineDash&&t.setLineDash([n,n]),r&&(t.lineDashOffset=r),o&&(t.lineWidth=o),t.beginPath(),t.moveTo(-s,-a),t.lineTo(s,-a),t.lineTo(s,a),t.lineTo(-s,a),t.lineTo(-s,-a),t.stroke(),t.restore()},_onMoving:function(){var t=this.getLeft(),e=this.getTop(),i=this.getWidth(),n=this.getHeight(),r=this.canvas.getWidth()-i,s=this.canvas.getHeight()-n;this.setLeft((0,o.clamp)(t,0,r)),this.setTop((0,o.clamp)(e,0,s))},_onScaling:function(t){var e=this.canvas.getPointer(t.e),i=this._calcScalingSizeFromPointer(e);this.scale(1).set(i)},_calcScalingSizeFromPointer:function(t){var e=t.x,i=t.y,n=this._calcTopLeftScalingSizeFromPointer(e,i),r=this._calcBottomRightScalingSizeFromPointer(e,i);return this._makeScalingSettings(n,r)},_calcTopLeftScalingSizeFromPointer:function(t,e){var i=this.getHeight()+this.top,n=this.getWidth()+this.left,r=(0,o.clamp)(e,0,i-1),s=(0,o.clamp)(t,0,n-1);return{top:r,left:s,width:n-s,height:i-r}},_calcBottomRightScalingSizeFromPointer:function(t,e){var i=this.canvas,n=i.width,r=i.height,s=this.left,a=this.top;return{width:(0,o.clamp)(t,s+1,n)-s,height:(0,o.clamp)(e,a+1,r)-a}},_makeScalingSettings:function(t,e){var i=t.width,n=t.height,r=e.height,o=e.width,s=t.left,a=t.top,c=void 0;switch(this.__corner){case"tl":c=t;break;case"tr":c={width:o,height:n,top:a};break;case"bl":c={width:i,height:r,left:s};break;case"br":c=e;break;case"ml":c={width:i,left:s};break;case"mt":c={height:n,top:a};break;case"mr":c={width:o};break;case"mb":c={height:r}}return c},isValid:function(){return this.left>=0&&this.top>=0&&this.width>0&&this.height>0}});t.exports=a},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=c(i(3)),o=c(i(4)),s=c(i(107)),a=c(i(73));function c(t){return t&&t.__esModule?t:{default:t}}var l=a.default.componentNames,h=a.default.rejectMessages,u=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,l.FLIP,t))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,s.default),n(e,[{key:"getCurrentSetting",value:function(){var t=this.getCanvasImage();return{flipX:t.flipX,flipY:t.flipY}}},{key:"set",value:function(t){var e=this.getCurrentSetting(),i=e.flipX!==t.flipX,n=e.flipY!==t.flipY;return i||n?(r.default.extend(e,t),this.setImageProperties(e,!0),this._invertAngle(i,n),this._flipObjects(i,n),o.default.resolve({flipX:e.flipX,flipY:e.flipY,angle:this.getCanvasImage().angle})):o.default.reject(h.flip)}},{key:"_invertAngle",value:function(t,e){var i=this.getCanvasImage(),n=i.angle;t&&(n*=-1),e&&(n*=-1),i.setAngle(parseFloat(n)).setCoords()}},{key:"_flipObjects",value:function(t,e){var i=this.getCanvas();t&&i.forEachObject(function(t){t.set({angle:parseFloat(-1*t.angle),flipX:!t.flipX,left:i.width-t.left}).setCoords()}),e&&i.forEachObject(function(t){t.set({angle:parseFloat(-1*t.angle),flipY:!t.flipY,top:i.height-t.top}).setCoords()}),i.renderAll()}},{key:"reset",value:function(){return this.set({flipX:!1,flipY:!1})}},{key:"flipX",value:function(){var t=this.getCurrentSetting();return this.set({flipX:!t.flipX,flipY:t.flipY})}},{key:"flipY",value:function(){var t=this.getCurrentSetting();return this.set({flipX:t.flipX,flipY:!t.flipY})}}]),e}();t.exports=u},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=a(i(105)),o=a(i(4)),s=a(i(107));function a(t){return t&&t.__esModule?t:{default:t}}var c=a(i(73)).default.componentNames,l=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,c.ROTATION,t))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,s.default),n(e,[{key:"getCurrentAngle",value:function(){return this.getCanvasImage().angle}},{key:"setAngle",value:function(t){var e=this.getCurrentAngle()%360;t%=360;var i=this.getCanvasImage(),n=i.getCenterPoint();i.setAngle(t).setCoords(),this.adjustCanvasDimension();var r=i.getCenterPoint();return this._rotateForEachObject(n,r,t-e),o.default.resolve(t)}},{key:"_rotateForEachObject",value:function(t,e,i){var n=this.getCanvas(),o=t.x-e.x,s=t.y-e.y;n.forEachObject(function(e){var n=e.getCenterPoint(),a=r.default.util.degreesToRadians(i),c=r.default.util.rotatePoint(n,t,a);e.set({left:c.x-o,top:c.y-s,angle:(e.angle+i)%360}),e.setCoords()}),n.renderAll()}},{key:"rotate",value:function(t){var e=this.getCurrentAngle();return this.setAngle(e+t)}}]),e}();t.exports=l},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=a(i(105)),o=a(i(107)),s=a(i(73));function a(t){return t&&t.__esModule?t:{default:t}}var c=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,s.default.componentNames.FREE_DRAWING,t));return i.width=12,i.oColor=new r.default.Color("rgba(0, 0, 0, 0.5)"),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,o.default),n(e,[{key:"start",value:function(t){this.getCanvas().isDrawingMode=!0,this.setBrush(t)}},{key:"setBrush",value:function(t){var e=this.getCanvas().freeDrawingBrush;t=t||{},this.width=t.width||this.width,t.color&&(this.oColor=new r.default.Color(t.color)),e.width=this.width,e.color=this.oColor.toRgba()}},{key:"end",value:function(){this.getCanvas().isDrawingMode=!1}}]),e}();t.exports=c},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=a(i(105)),o=a(i(107)),s=a(i(73));function a(t){return t&&t.__esModule?t:{default:t}}var c=s.default.eventNames,l=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,s.default.componentNames.LINE,t));return i._width=12,i._oColor=new r.default.Color("rgba(0, 0, 0, 0.5)"),i._listeners={mousedown:i._onFabricMouseDown.bind(i),mousemove:i._onFabricMouseMove.bind(i),mouseup:i._onFabricMouseUp.bind(i)},i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,o.default),n(e,[{key:"start",value:function(t){var e=this.getCanvas();e.defaultCursor="crosshair",e.selection=!1,this.setBrush(t),e.forEachObject(function(t){t.set({evented:!1})}),e.on({"mouse:down":this._listeners.mousedown})}},{key:"setBrush",value:function(t){var e=this.getCanvas().freeDrawingBrush;t=t||{},this._width=t.width||this._width,t.color&&(this._oColor=new r.default.Color(t.color)),e.width=this._width,e.color=this._oColor.toRgba()}},{key:"end",value:function(){var t=this.getCanvas();t.defaultCursor="default",t.selection=!0,t.forEachObject(function(t){t.set({evented:!0})}),t.off("mouse:down",this._listeners.mousedown)}},{key:"_onFabricMouseDown",value:function(t){var e=this.getCanvas(),i=e.getPointer(t.e),n=[i.x,i.y,i.x,i.y];this._line=new r.default.Line(n,{stroke:this._oColor.toRgba(),strokeWidth:this._width,evented:!1}),this._line.set(s.default.fObjectOptions.SELECTION_STYLE),e.add(this._line),e.on({"mouse:move":this._listeners.mousemove,"mouse:up":this._listeners.mouseup})}},{key:"_onFabricMouseMove",value:function(t){var e=this.getCanvas(),i=e.getPointer(t.e);this._line.set({x2:i.x,y2:i.y}),this._line.setCoords(),e.renderAll()}},{key:"_onFabricMouseUp",value:function(){var t=this.getCanvas(),e=this.graphics.createObjectProperties(this._line);this.fire(c.ADD_OBJECT,e),this._line=null,t.off({"mouse:move":this._listeners.mousemove,"mouse:up":this._listeners.mouseup})}}]),e}();t.exports=l},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=h(i(105)),o=h(i(3)),s=h(i(4)),a=h(i(107)),c=h(i(73)),l=h(i(72));function h(t){return t&&t.__esModule?t:{default:t}}var u=c.default.eventNames,f={fill:"#000000",left:0,top:0},d={fill:"#000000",fontStyle:"normal",fontWeight:"normal",textAlign:"left",textDecoraiton:""},p=o.default.browser,g=l.default.makeStyleText({position:"absolute",padding:0,display:"none",border:"1px dotted red",overflow:"hidden",resize:"none",outline:"none","border-radius":0,"background-color":"transparent","-webkit-appearance":"none","z-index":9999,"white-space":"pre"}),v=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,c.default.componentNames.TEXT,t));return i._defaultStyles=f,i._isSelected=!1,i._selectedObj={},i._editingObj={},i._listeners={mousedown:i._onFabricMouseDown.bind(i),select:i._onFabricSelect.bind(i),selectClear:i._onFabricSelectClear.bind(i),scaling:i._onFabricScaling.bind(i)},i._textarea=null,i._ratio=1,i._lastClickTime=(new Date).getTime(),i._editingObjInfos={},i.isPrevEditing=!1,i.useItext=t.useItext,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,a.default),n(e,[{key:"start",value:function(){var t=this.getCanvas();t.selection=!1,t.defaultCursor="text",t.on({"mouse:down":this._listeners.mousedown,"object:selected":this._listeners.select,"before:selection:cleared":this._listeners.selectClear,"object:scaling":this._listeners.scaling,"text:editing":this._listeners.modify}),this.useItext?t.forEachObject(function(t){"i-text"===t.type&&t.set({left:t.left-t.width/2,top:t.top-t.height/2,originX:"left",originY:"top"})}):this._createTextarea(),this.setCanvasRatio()}},{key:"end",value:function(){var t=this.getCanvas();t.selection=!0,t.defaultCursor="default",this.useItext?t.forEachObject(function(t){"i-text"===t.type&&(""===t.text?t.remove():t.set({left:t.left+t.width/2,top:t.top+t.height/2,originX:"center",originY:"center"}))}):(t.deactivateAllWithDispatch(),this._removeTextarea()),t.off({"mouse:down":this._listeners.mousedown,"object:selected":this._listeners.select,"before:selection:cleared":this._listeners.selectClear,"object:scaling":this._listeners.scaling,"text:editing":this._listeners.modify})}},{key:"add",value:function(t,e){var i=this;return new s.default(function(n){var s=i.getCanvas(),a=null,l=c.default.fObjectOptions.SELECTION_STYLE,h=i._defaultStyles;i._setInitPos(e.position),e.styles&&(h=o.default.extend(h,e.styles)),i.useItext?(a=new r.default.IText(t,h),l=o.default.extend({},l,{originX:"left",originY:"top"})):a=new r.default.Text(t,h),a.set(l),a.on({mouseup:i._onFabricMouseUp.bind(i)}),s.add(a),s.getActiveObject()||s.setActiveObject(a),i.isPrevEditing=!0,n(i.graphics.createObjectProperties(a))})}},{key:"change",value:function(t,e){var i=this;return new s.default(function(n){t.set("text",e),i.getCanvas().renderAll(),n()})}},{key:"setStyle",value:function(t,e){var i=this;return new s.default(function(n){o.default.forEach(e,function(i,n){t[n]===i&&(e[n]=d[n]||"")},i),t.set(e),i.getCanvas().renderAll(),n()})}},{key:"getText",value:function(t){return t.getText()}},{key:"setSelectedInfo",value:function(t,e){this._selectedObj=t,this._isSelected=e}},{key:"isSelected",value:function(){return this._isSelected}},{key:"getSelectedObj",value:function(){return this._selectedObj}},{key:"setCanvasRatio",value:function(){var t=this.getCanvasElement(),e=parseInt(t.style.maxWidth,10),i=t.width/e;this._ratio=i}},{key:"getCanvasRatio",value:function(){return this._ratio}},{key:"_setInitPos",value:function(t){t=t||this.getCanvasImage().getCenterPoint(),this._defaultStyles.left=t.x,this._defaultStyles.top=t.y}},{key:"_createTextarea",value:function(){var t=this.getCanvasElement().parentNode,e=document.createElement("textarea");e.className="tui-image-eidtor-textarea",e.setAttribute("style",g),e.setAttribute("wrap","off"),t.appendChild(e),this._textarea=e,this._listeners=o.default.extend(this._listeners,{input:this._onInput.bind(this),keydown:this._onKeyDown.bind(this),blur:this._onBlur.bind(this),scroll:this._onScroll.bind(this)}),p.msie&&9===p.version?r.default.util.addListener(e,"keydown",this._listeners.keydown):r.default.util.addListener(e,"input",this._listeners.input),r.default.util.addListener(e,"blur",this._listeners.blur),r.default.util.addListener(e,"scroll",this._listeners.scroll)}},{key:"_removeTextarea",value:function(){var t=this.getCanvasElement().parentNode,e=t.querySelector("textarea");t.removeChild(e),this._textarea=null,p.msie&&p.version<10?r.default.util.removeListener(e,"keydown",this._listeners.keydown):r.default.util.removeListener(e,"input",this._listeners.input),r.default.util.removeListener(e,"blur",this._listeners.blur),r.default.util.removeListener(e,"scroll",this._listeners.scroll)}},{key:"_onInput",value:function(){var t=this.getCanvasRatio(),e=this._editingObj,i=this._textarea.style;i.width=Math.ceil(e.getWidth()/t)+"px",i.height=Math.ceil(e.getHeight()/t)+"px"}},{key:"_onKeyDown",value:function(){var t=this,e=this.getCanvasRatio(),i=this._editingObj,n=this._textarea.style;setTimeout(function(){i.setText(t._textarea.value),n.width=Math.ceil(i.getWidth()/e)+"px",n.height=Math.ceil(i.getHeight()/e)+"px"},0)}},{key:"_onBlur",value:function(){var t=this.getCanvasRatio(),e=this._editingObj,i=this._editingObjInfos,n=this._textarea.value,r=e.getWidth()/t-i.width/t,s=e.getHeight()/t-i.height/t;if(1===t&&(r/=2,s/=2),this._textarea.style.display="none",e.set({left:i.left+r,top:i.top+s}),n.length){this.getCanvas().add(e);var a={id:o.default.stamp(e),type:e.type,text:n};this.fire(u.TEXT_CHANGED,a)}}},{key:"_onScroll",value:function(){this._textarea.scrollLeft=0,this._textarea.scrollTop=0}},{key:"_onFabricScaling",value:function(t){var e=t.target,i=e.getFontSize()*e.getScaleY();e.setFontSize(i),e.setScaleX(1),e.setScaleY(1)}},{key:"_onFabricSelectClear",value:function(t){var e=this.getSelectedObj();this.isPrevEditing=!0,this.setSelectedInfo(t.target,!1),e&&""===e.text&&e.remove()}},{key:"_onFabricSelect",value:function(t){this.isPrevEditing=!0,this.setSelectedInfo(t.target,!0)}},{key:"_onFabricMouseDown",value:function(t){var e=t.target;e&&!e.isType("text")||(this.isPrevEditing?this.isPrevEditing=!1:this._fireAddText(t))}},{key:"_fireAddText",value:function(t){var e=t.target,i=t.e||{},n=this.getCanvas().getPointer(i);e||this.fire(u.ADD_TEXT,{originPosition:{x:n.x,y:n.y},clientPosition:{x:i.clientX||0,y:i.clientY||0}})}},{key:"_onFabricMouseUp",value:function(t){var e=(new Date).getTime();this._isDoubleClick(e)&&(this.useItext||this._changeToEditingMode(t.target),this.fire(u.TEXT_EDITING)),this._lastClickTime=e}},{key:"_isDoubleClick",value:function(t){return t-this._lastClickTime<500}},{key:"_changeToEditingMode",value:function(t){var e=this.getCanvasRatio(),i=this._textarea.style;this.isPrevEditing=!0,t.remove(),this._editingObj=t,this._textarea.value=t.getText(),this._editingObjInfos={left:this._editingObj.getLeft(),top:this._editingObj.getTop(),width:this._editingObj.getWidth(),height:this._editingObj.getHeight()},i.display="block",i.left=t.oCoords.tl.x/e+"px",i.top=t.oCoords.tl.y/e+"px",i.width=Math.ceil(t.getWidth()/e)+"px",i.height=Math.ceil(t.getHeight()/e)+"px",i.transform="rotate("+t.getAngle()+"deg)",i.color=t.getFill(),i["font-size"]=t.getFontSize()/e+"px",i["font-family"]=t.getFontFamily(),i["font-style"]=t.getFontStyle(),i["font-weight"]=t.getFontWeight(),i["text-align"]=t.getTextAlign(),i["line-height"]=t.getLineHeight()+.1,i["transform-origin"]="left top",this._textarea.focus()}}]),e}();t.exports=v},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=l(i(105)),o=l(i(3)),s=l(i(4)),a=l(i(107)),c=l(i(73));function l(t){return t&&t.__esModule?t:{default:t}}var h=c.default.eventNames,u=c.default.rejectMessages,f={arrow:"M 0 90 H 105 V 120 L 160 60 L 105 0 V 30 H 0 Z",cancel:"M 0 30 L 30 60 L 0 90 L 30 120 L 60 90 L 90 120 L 120 90 L 90 60 L 120 30 L 90 0 L 60 30 L 30 0 Z"},d=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,c.default.componentNames.ICON,t));return i._oColor="#000000",i._pathMap=f,i.useDragAddIcon=t.useDragAddIcon,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,a.default),n(e,[{key:"add",value:function(t,e){var i=this;return new s.default(function(n,r){var s=i.getCanvas(),a=i._pathMap[t],l=c.default.fObjectOptions.SELECTION_STYLE;a||r(u.invalidParameters);var f=i._createIcon(a);f.set(o.default.extend({type:"icon",fill:i._oColor},l,e,i.graphics.controlStyle)),i.useDragAddIcon?(s.add(f).setActiveObject(f),s.on({"mouse:move":function(t){s.selection=!1,i.fire(h.ICON_CREATE_RESIZE,{moveOriginPointer:s.getPointer(t.e)})},"mouse:up":function(t){i.fire(h.ICON_CREATE_END,{moveOriginPointer:s.getPointer(t.e)}),s.defaultCursor="default",s.off("mouse:up"),s.off("mouse:move"),s.selection=!0}})):s.add(f).setActiveObject(f),n(i.graphics.createObjectProperties(f))})}},{key:"registerPaths",value:function(t){var e=this;o.default.forEach(t,function(t,i){e._pathMap[i]=t},this)}},{key:"setColor",value:function(t,e){this._oColor=t,e&&"icon"===e.get("type")&&(e.setFill(this._oColor),this.getCanvas().renderAll())}},{key:"getColor",value:function(t){return t.fill}},{key:"_createIcon",value:function(t){return new r.default.Path(t)}}]),e}();t.exports=d},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i(3),o=p(i(4)),s=p(i(105)),a=p(i(107)),c=p(i(117)),l=p(i(73)),h=p(i(118)),u=p(i(119)),f=p(i(120)),d=p(i(121));function p(t){return t&&t.__esModule?t:{default:t}}var g=l.default.rejectMessages,v=s.default.Image.filters;v.Mask=c.default,v.Blur=h.default,v.Sharpen=u.default,v.Emboss=f.default,v.ColorFilter=d.default;var m=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,l.default.componentNames.FILTER,t))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,a.default),n(e,[{key:"add",value:function(t,e){var i=this;return new o.default(function(n,r){var o=i._getSourceImage(),s=i.getCanvas(),a=i._getFilter(o,t);a||(a=i._createFilter(o,t,e)),a||r(g.invalidParameters),i._changeFilterValues(a,e),i._apply(o,function(){s.renderAll(),n({type:t,action:"add"})})})}},{key:"remove",value:function(t){var e=this;return new o.default(function(i,n){var r=e._getSourceImage(),o=e.getCanvas();r.filters.length||n(g.unsupportedOperation),e._removeFilter(r,t),e._apply(r,function(){o.renderAll(),i({type:t,action:"remove"})})})}},{key:"hasFilter",value:function(t){return!!this._getFilter(this._getSourceImage(),t)}},{key:"getOptions",value:function(t){var e=this._getSourceImage(),i=this._getFilter(e,t);return i?(0,r.extend)({},i.options):null}},{key:"_changeFilterValues",value:function(t,e){(0,r.forEach)(e,function(e,i){(0,r.isUndefined)(t[i])||(t[i]=e)}),(0,r.forEach)(t.options,function(i,n){(0,r.isUndefined)(e[n])||(t.options[n]=e[n])})}},{key:"_apply",value:function(t,e){t.applyFilters(e)}},{key:"_getSourceImage",value:function(){return this.getCanvasImage()}},{key:"_createFilter",value:function(t,e,i){var n=void 0,r=this._getFabricFilterType(e),o=s.default.Image.filters[r];return o&&((n=new o(i)).options=i,t.filters.push(n)),n}},{key:"_getFilter",value:function(t,e){var i=null;if(t){var n=this._getFabricFilterType(e),r=t.filters.length,o=void 0,s=void 0;for(s=0;s<r;s+=1)if((o=t.filters[s]).type===n){i=o;break}}return i}},{key:"_removeFilter",value:function(t,e){var i=this._getFabricFilterType(e);t.filters=(0,r.filter)(t.filters,function(t){return t.type!==i})}},{key:"_getFabricFilterType",value:function(t){return t.charAt(0).toUpperCase()+t.slice(1)}}]),e}();t.exports=m},function(t,e,i){"use strict";var n=function(t){return t&&t.__esModule?t:{default:t}}(i(105));var r=n.default.util.createClass(n.default.Image.filters.Mask,{applyTo:function(t){if(this.mask){var e=t.width,i=t.height,n=this._createCanvasOfMask(e,i),r=t.getContext("2d"),o=n.getContext("2d"),s=r.getImageData(0,0,e,i);this._drawMask(o,t,r),this._mapData(o,s,e,i),r.putImageData(s,0,0)}},_createCanvasOfMask:function(t,e){var i=n.default.util.createCanvasElement();return i.width=t,i.height=e,i},_drawMask:function(t){var e=this.mask,i=e.getElement(),n=e.getLeft(),r=e.getTop(),o=e.getAngle();t.save(),t.translate(n,r),t.rotate(o*Math.PI/180),t.scale(e.scaleX,e.scaleY),t.drawImage(i,-i.width/2,-i.height/2),t.restore()},_mapData:function(t,e,i,n){for(var r=e.data,o=t.getImageData(0,0,i,n).data,s=this.channel,a=e.width*e.height*4,c=0;c<a;c+=4)r[c+3]=o[c+s]}});t.exports=r},function(t,e,i){"use strict";var n=function(t){return t&&t.__esModule?t:{default:t}}(i(105));var r=n.default.util.createClass(n.default.Image.filters.Convolute,{type:"Blur",initialize:function(){this.matrix=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]}});t.exports=r},function(t,e,i){"use strict";var n=function(t){return t&&t.__esModule?t:{default:t}}(i(105));var r=n.default.util.createClass(n.default.Image.filters.Convolute,{type:"Sharpen",initialize:function(){this.matrix=[0,-1,0,-1,5,-1,0,-1,0]}});t.exports=r},function(t,e,i){"use strict";var n=function(t){return t&&t.__esModule?t:{default:t}}(i(105));var r=n.default.util.createClass(n.default.Image.filters.Convolute,{type:"Emboss",initialize:function(){this.matrix=[1,1,1,1,.7,-1,-1,-1,-1]}});t.exports=r},function(t,e,i){"use strict";var n=function(t){return t&&t.__esModule?t:{default:t}}(i(105));var r=n.default.util.createClass(n.default.Image.filters.BaseFilter,{type:"ColorFilter",initialize:function(t){t||(t={}),this.color=t.color||"#FFFFFF",this.threshold=t.threshold||45,this.x=t.x||null,this.y=t.y||null},applyTo:function(t){var e,i=t.getContext("2d"),r=i.getImageData(0,0,t.width,t.height),o=r.data,s=this.threshold,a=n.default.Color.sourceFromHex(this.color),c=void 0;for(this.x&&this.y&&(a=this._getColor(r,this.x,this.y)),c=0,e=o.length;c<e;c+=4)this._isOutsideThreshold(o[c],a[0],s)||this._isOutsideThreshold(o[c+1],a[1],s)||this._isOutsideThreshold(o[c+2],a[2],s)||(o[c]=o[c+1]=o[c+2]=o[c+3]=0);i.putImageData(r,0,0)},_isOutsideThreshold:function(t,e,i){var n=t-e;return Math.abs(n)>i},_getColor:function(t,e,i){var n=[0,0,0,0],r=t.data,o=4*(t.width*i+e);return n[0]=r[o],n[1]=r[o+1],n[2]=r[o+2],n[3]=r[o+3],n}});t.exports=r},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=h(i(105)),o=h(i(4)),s=h(i(107)),a=h(i(73)),c=h(i(123)),l=i(3);function h(t){return t&&t.__esModule?t:{default:t}}var u=a.default.rejectMessages,f=a.default.eventNames,d=a.default.keyCodes,p="rect",g={strokeWidth:1,stroke:"#000000",fill:"#ffffff",width:1,height:1,rx:0,ry:0,lockSkewingX:!0,lockSkewingY:!0,lockUniScaling:!1,bringForward:!0,isRegular:!1},v=["rect","circle","triangle"],m=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,a.default.componentNames.SHAPE,t));return i._shapeObj=null,i._type=p,i._options=(0,l.extend)({},g),i._isSelected=!1,i._startPoint={},i._withShiftKey=!1,i._handlers={mousedown:i._onFabricMouseDown.bind(i),mousemove:i._onFabricMouseMove.bind(i),mouseup:i._onFabricMouseUp.bind(i),keydown:i._onKeyDown.bind(i),keyup:i._onKeyUp.bind(i)},i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,s.default),n(e,[{key:"start",value:function(){var t=this.getCanvas();this._isSelected=!1,t.defaultCursor="crosshair",t.selection=!1,t.uniScaleTransform=!0,t.on({"mouse:down":this._handlers.mousedown}),r.default.util.addListener(document,"keydown",this._handlers.keydown),r.default.util.addListener(document,"keyup",this._handlers.keyup)}},{key:"end",value:function(){var t=this.getCanvas();this._isSelected=!1,t.defaultCursor="default",t.selection=!0,t.uniScaleTransform=!1,t.off({"mouse:down":this._handlers.mousedown}),r.default.util.removeListener(document,"keydown",this._handlers.keydown),r.default.util.removeListener(document,"keyup",this._handlers.keyup)}},{key:"setStates",value:function(t,e){this._type=t,e&&(this._options=(0,l.extend)(this._options,e))}},{key:"add",value:function(t,e){var i=this;return new o.default(function(n){var r=i.getCanvas();e=i._createOptions(e);var o=i._createInstance(t,e);i._bindEventOnShape(o),r.add(o).setActiveObject(o),n(i.graphics.createObjectProperties(o))})}},{key:"change",value:function(t,e){var i=this;return new o.default(function(n,r){(0,l.inArray)(t.get("type"),v)<0&&r(u.unsupportedType),t.set(e),i.getCanvas().renderAll(),n()})}},{key:"_createInstance",value:function(t,e){var i=void 0;switch(t){case"rect":i=new r.default.Rect(e);break;case"circle":i=new r.default.Ellipse((0,l.extend)({type:"circle"},e));break;case"triangle":i=new r.default.Triangle(e);break;default:i={}}return i}},{key:"_createOptions",value:function(t){var e=a.default.fObjectOptions.SELECTION_STYLE;return(t=(0,l.extend)({},g,this._options,e,t)).isRegular&&(t.lockUniScaling=!0),t}},{key:"_bindEventOnShape",value:function(t){var e=this,i=this.getCanvas();t.on({added:function(){e._shapeObj=this,c.default.setOrigins(e._shapeObj)},selected:function(){e._isSelected=!0,e._shapeObj=this,i.uniScaleTransform=!0,i.defaultCursor="default",c.default.setOrigins(e._shapeObj)},deselected:function(){e._isSelected=!1,e._shapeObj=null,i.defaultCursor="crosshair",i.uniScaleTransform=!1},modified:function(){var t=e._shapeObj;c.default.adjustOriginToCenter(t),c.default.setOrigins(t)},scaling:function(t){var n=i.getPointer(t.e),r=e._shapeObj;i.setCursor("crosshair"),c.default.resize(r,n,!0)}})}},{key:"_onFabricMouseDown",value:function(t){if(t.target||(this._isSelected=!1,this._shapeObj=!1),!this._isSelected&&!this._shapeObj){var e=this.getCanvas();this._startPoint=e.getPointer(t.e),e.on({"mouse:move":this._handlers.mousemove,"mouse:up":this._handlers.mouseup})}}},{key:"_onFabricMouseMove",value:function(t){var e=this,i=this.getCanvas(),n=i.getPointer(t.e),r=this._startPoint.x,o=this._startPoint.y,s=r-n.x,a=o-n.y,l=this._shapeObj;l?(this._shapeObj.set({isRegular:this._withShiftKey}),c.default.resize(l,n),i.renderAll()):this.add(this._type,{left:r,top:o,width:s,height:a}).then(function(t){e.fire(f.ADD_OBJECT,t)})}},{key:"_onFabricMouseUp",value:function(){var t=this.getCanvas(),e=this._shapeObj;e&&c.default.adjustOriginToCenter(e),this.fire(f.ADD_OBJECT_AFTER,this.graphics.createObjectProperties(e)),t.off({"mouse:move":this._handlers.mousemove,"mouse:up":this._handlers.mouseup})}},{key:"_onKeyDown",value:function(t){t.keyCode===d.SHIFT&&(this._withShiftKey=!0,this._shapeObj&&(this._shapeObj.isRegular=!0))}},{key:"_onKeyUp",value:function(t){t.keyCode===d.SHIFT&&(this._withShiftKey=!1,this._shapeObj&&(this._shapeObj.isRegular=!1))}}]),e}();t.exports=m},function(t,e){"use strict";var i={rect:1,circle:2,triangle:1},n={rect:{w:"width",h:"height"},circle:{w:"rx",h:"ry"},triangle:{w:"width",h:"height"}};function r(t,e,i){var n=t.x,r=t.y,o=e.x,s=e.y,a=i*Math.PI/180,c=(o-n)*Math.cos(a)-(s-r)*Math.sin(a)+n,l=(o-n)*Math.sin(a)+(s-r)*Math.cos(a)+r;return{originX:n>c?"right":"left",originY:r>l?"bottom":"top"}}t.exports={setOrigins:function(t){var e=t.getPointByOrigin("left","top"),i=t.getPointByOrigin("right","top"),n=t.getPointByOrigin("right","bottom"),r=t.getPointByOrigin("left","bottom");t.origins={lt:e,rt:i,rb:n,lb:r}},resize:function(t,e,o){(function(t){return"center"===t.getOriginX()&&"center"===t.getOriginY()})(t)&&(function(t,e){var i=e.getPointByOrigin("center","center"),n=r(i,t,-e.getAngle()),o=n.originX,s=n.originY,a=e.getPointByOrigin(o,s),c=e.getLeft()-(i.x-a.x),l=e.getTop()-(i.x-a.y);e.set({originX:o,originY:s,left:c,top:l}),e.setCoords()}(e,t),function(t){var e=t.getOriginX(),i=t.getOriginY(),n=e.substring(0,1)+i.substring(0,1);t.startPoint=t.origins[n]}(t)),o?function(t){var e=t.type,i=t.scaleX,r=t.scaleY,o=n[e],s=t[o.w]*i,a=t[o.h]*r;if(t.isRegular){var c=Math.max(i,r);s=t[o.w]*c,a=t[o.h]*c}var l={hasControls:!1,hasBorders:!1,scaleX:1,scaleY:1};l[o.w]=s,l[o.h]=a,t.set(l)}(t):function(t,e){var r=e.type,o=e.strokeWidth,s=e.startPoint,a=i[r],c=n[r],l=!("triangle"!==e.type),h={},u=Math.abs(s.x-t.x)/a,f=Math.abs(s.y-t.y)/a;u>o&&(u-=o/a),f>o&&(f-=o/a),e.isRegular&&(u=f=Math.max(u,f),l&&(f=Math.sqrt(3)/2*u)),h[c.w]=u,h[c.h]=f,e.set(h)}(e,t),function(t,e){var i=e.startPoint,n=r(i,t,-e.getAngle()),o=n.originX,s=n.originY;e.setPositionByOrigin(i,o,s)}(e,t)},adjustOriginToCenter:function(t){var e=t.getPointByOrigin("center","center"),i=t.getOriginX(),n=t.getOriginY(),r=t.getPointByOrigin(i,n),o=t.getLeft()+(e.x-r.x),s=t.getTop()+(e.y-r.y);t.set({hasControls:!0,hasBorders:!0,originX:"center",originY:"center",left:o,top:s}),t.setCoords()}}},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=s(i(125)),o=s(i(73));function s(t){return t&&t.__esModule?t:{default:t}}var a=o.default.drawingModes,c=o.default.componentNames,l=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,a.CROPPER))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r.default),n(e,[{key:"start",value:function(t){t.getComponent(c.CROPPER).start()}},{key:"end",value:function(t){t.getComponent(c.CROPPER).end()}}]),e}();t.exports=l},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=function(t){return t&&t.__esModule?t:{default:t}}(i(71));var o=r.default.create,s=r.default.types,a=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=e}return n(t,[{key:"getName",value:function(){return this.name}},{key:"start",value:function(){throw new Error(o(s.UN_IMPLEMENTATION,"start"))}},{key:"stop",value:function(){throw new Error(o(s.UN_IMPLEMENTATION,"stop"))}}]),t}();t.exports=a},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=s(i(125)),o=s(i(73));function s(t){return t&&t.__esModule?t:{default:t}}var a=o.default.drawingModes,c=o.default.componentNames,l=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,a.FREE_DRAWING))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r.default),n(e,[{key:"start",value:function(t,e){t.getComponent(c.FREE_DRAWING).start(e)}},{key:"end",value:function(t){t.getComponent(c.FREE_DRAWING).end()}}]),e}();t.exports=l},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=s(i(125)),o=s(i(73));function s(t){return t&&t.__esModule?t:{default:t}}var a=o.default.drawingModes,c=o.default.componentNames,l=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,a.LINE_DRAWING))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r.default),n(e,[{key:"start",value:function(t,e){t.getComponent(c.LINE).start(e)}},{key:"end",value:function(t){t.getComponent(c.LINE).end()}}]),e}();t.exports=l},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=s(i(125)),o=s(i(73));function s(t){return t&&t.__esModule?t:{default:t}}var a=o.default.drawingModes,c=o.default.componentNames,l=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,a.SHAPE))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r.default),n(e,[{key:"start",value:function(t){t.getComponent(c.SHAPE).start()}},{key:"end",value:function(t){t.getComponent(c.SHAPE).end()}}]),e}();t.exports=l},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=s(i(125)),o=s(i(73));function s(t){return t&&t.__esModule?t:{default:t}}var a=o.default.drawingModes,c=o.default.componentNames,l=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,a.TEXT))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r.default),n(e,[{key:"start",value:function(t){t.getComponent(c.TEXT).start()}},{key:"end",value:function(t){t.getComponent(c.TEXT).end()}}]),e}();t.exports=l},function(t,e){},,function(t,e,i){"use strict";var n=s(i(69)),r=s(i(4)),o=s(i(73));function s(t){return t&&t.__esModule?t:{default:t}}var a=o.default.componentNames,c=o.default.commandNames,l=a.ICON,h={name:c.ADD_ICON,execute:function(t,e,i){var n=this;return t.getComponent(l).add(e,i).then(function(e){return n.undoData.object=t.getObject(e.id),e})},undo:function(t){return t.remove(this.undoData.object),r.default.resolve()}};n.default.register(h),t.exports=h},function(t,e,i){"use strict";var n=o(i(69)),r=o(i(4));function o(t){return t&&t.__esModule?t:{default:t}}var s={name:o(i(73)).default.commandNames.ADD_IMAGE_OBJECT,execute:function(t,e){var i=this;return t.addImageObject(e).then(function(e){return i.undoData.object=t.getObject(e.id),e})},undo:function(t){return t.remove(this.undoData.object),r.default.resolve()}};n.default.register(s),t.exports=s},function(t,e,i){"use strict";var n=s(i(69)),r=s(i(4)),o=s(i(73));function s(t){return t&&t.__esModule?t:{default:t}}var a=o.default.commandNames,c=o.default.rejectMessages,l={name:a.ADD_OBJECT,execute:function(t,e){return new r.default(function(i,n){t.contains(e)?n(c.addedObject):(t.add(e),i(e))})},undo:function(t,e){return new r.default(function(i,n){t.contains(e)?(t.remove(e),i(e)):n(c.noObject)})}};n.default.register(l),t.exports=l},function(t,e,i){"use strict";var n=s(i(69)),r=s(i(4)),o=s(i(73));function s(t){return t&&t.__esModule?t:{default:t}}var a=o.default.componentNames,c=o.default.commandNames,l=a.SHAPE,h={name:c.ADD_SHAPE,execute:function(t,e,i){var n=this;return t.getComponent(l).add(e,i).then(function(e){return n.undoData.object=t.getObject(e.id),e})},undo:function(t){return t.remove(this.undoData.object),r.default.resolve()}};n.default.register(h),t.exports=h},function(t,e,i){"use strict";var n=s(i(69)),r=s(i(4)),o=s(i(73));function s(t){return t&&t.__esModule?t:{default:t}}var a=o.default.componentNames,c=o.default.commandNames,l=a.TEXT,h={name:c.ADD_TEXT,execute:function(t,e,i){var n=this;return t.getComponent(l).add(e,i).then(function(e){return n.undoData.object=t.getObject(e.id),e})},undo:function(t){return t.remove(this.undoData.object),r.default.resolve()}};n.default.register(h),t.exports=h},function(t,e,i){"use strict";var n=o(i(69)),r=o(i(73));function o(t){return t&&t.__esModule?t:{default:t}}var s=r.default.componentNames,a=r.default.rejectMessages,c=r.default.commandNames,l=s.FILTER,h={name:c.APPLY_FILTER,execute:function(t,e,i){var n=t.getComponent(l);if("mask"===e){var r=t.getObject(i.maskObjId);if(!r||!r.isType("image"))return Promise.reject(a.invalidParameters);i={mask:r}}return"mask"===e?(this.undoData.object=i.mask,t.remove(i.mask)):this.undoData.options=n.getOptions(e),n.add(e,i)},undo:function(t,e){var i=t.getComponent(l);if("mask"===e){var n=this.undoData.object;return t.add(n),t.setActiveObject(n),i.remove(e)}return this.undoData.options?i.add(e,this.undoData.options):i.remove(e)}};n.default.register(h),t.exports=h},function(t,e,i){"use strict";var n=s(i(69)),r=s(i(4)),o=s(i(73));function s(t){return t&&t.__esModule?t:{default:t}}var a=o.default.componentNames,c=o.default.rejectMessages,l=o.default.commandNames,h=a.ICON,u={name:l.CHANGE_ICON_COLOR,execute:function(t,e,i){var n=this;return new r.default(function(r,o){var s=t.getComponent(h),a=t.getObject(e);a||o(c.noObject),n.undoData.object=a,n.undoData.color=s.getColor(a),s.setColor(i,a),r()})},undo:function(t){var e=t.getComponent(h),i=this.undoData.object,n=i.object,o=i.color;return e.setColor(o,n),r.default.resolve()}};n.default.register(u),t.exports=u},function(t,e,i){"use strict";var n=a(i(3)),r=a(i(69)),o=a(i(4)),s=a(i(73));function a(t){return t&&t.__esModule?t:{default:t}}var c=s.default.componentNames,l=s.default.rejectMessages,h=s.default.commandNames,u=c.SHAPE,f={name:h.CHANGE_SHAPE,execute:function(t,e,i){var r=this,s=t.getComponent(u),a=t.getObject(e);return a?(this.undoData.object=a,this.undoData.options={},n.default.forEachOwnProperties(i,function(t,e){r.undoData.options[e]=a[e]}),s.change(a,i)):o.default.reject(l.noObject)},undo:function(t){var e=t.getComponent(u),i=this.undoData,n=i.object,r=i.options;return e.change(n,r)}};r.default.register(f),t.exports=f},function(t,e,i){"use strict";var n=s(i(69)),r=s(i(4)),o=s(i(73));function s(t){return t&&t.__esModule?t:{default:t}}var a=o.default.componentNames,c=o.default.rejectMessages,l=o.default.commandNames,h=a.TEXT,u={name:l.CHANGE_TEXT,execute:function(t,e,i){var n=t.getComponent(h),o=t.getObject(e);return o?(this.undoData.object=o,this.undoData.text=n.getText(o),n.change(o,i)):r.default.reject(c.noObject)},undo:function(t){var e=t.getComponent(h),i=this.undoData,n=i.object,r=i.text;return e.change(n,r)}};n.default.register(u),t.exports=u},function(t,e,i){"use strict";var n=a(i(3)),r=a(i(69)),o=a(i(4)),s=a(i(73));function a(t){return t&&t.__esModule?t:{default:t}}var c=s.default.componentNames,l=s.default.rejectMessages,h=s.default.commandNames,u=c.TEXT,f={name:h.CHANGE_TEXT_STYLE,execute:function(t,e,i){var r=this,s=t.getComponent(u),a=t.getObject(e);return a?(this.undoData.object=a,this.undoData.styles={},n.default.forEachOwnProperties(i,function(t,e){r.undoData.styles[e]=a[e]}),s.setStyle(a,i)):o.default.reject(l.noObject)},undo:function(t){var e=t.getComponent(u),i=this.undoData,n=i.object,r=i.styles;return e.setStyle(n,r)}};r.default.register(f),t.exports=f},function(t,e,i){"use strict";var n=o(i(69)),r=o(i(4));function o(t){return t&&t.__esModule?t:{default:t}}var s={name:o(i(73)).default.commandNames.CLEAR_OBJECTS,execute:function(t){var e=this;return new r.default(function(i){e.undoData.objects=t.removeAll(),i()})},undo:function(t){return t.add(this.undoData.objects),r.default.resolve()}};n.default.register(s),t.exports=s},function(t,e,i){"use strict";var n=o(i(69)),r=o(i(73));function o(t){return t&&t.__esModule?t:{default:t}}var s=r.default.componentNames,a=r.default.commandNames,c=s.FLIP,l={name:a.FLIP_IMAGE,execute:function(t,e){var i=t.getComponent(c);return this.undoData.setting=i.getCurrentSetting(),i[e]()},undo:function(t){return t.getComponent(c).set(this.undoData.setting)}};n.default.register(l),t.exports=l},function(t,e,i){"use strict";var n=o(i(69)),r=o(i(73));function o(t){return t&&t.__esModule?t:{default:t}}var s=r.default.componentNames,a=r.default.commandNames,c=s.IMAGE_LOADER,l={name:a.LOAD_IMAGE,execute:function(t,e,i){var n=t.getComponent(c),r=n.getCanvasImage(),o=r?r.width:0,s=r?r.height:0;return this.undoData={name:n.getImageName(),image:r,objects:t.removeAll(!0)},n.load(e,i).then(function(t){return{oldWidth:o,oldHeight:s,newWidth:t.width,newHeight:t.height}})},undo:function(t){var e=t.getComponent(c),i=this.undoData,n=i.objects,r=i.name,o=i.image;return t.removeAll(!0),t.add(n),e.load(r,o)}};n.default.register(l),t.exports=l},function(t,e,i){"use strict";var n=o(i(69)),r=o(i(73));function o(t){return t&&t.__esModule?t:{default:t}}var s=r.default.componentNames,a=r.default.commandNames,c=s.FILTER,l={name:a.REMOVE_FILTER,execute:function(t,e){var i=t.getComponent(c);return this.undoData.options=i.getOptions(e),i.remove(e)},undo:function(t,e){var i=t.getComponent(c),n=this.undoData.options;return i.add(e,n)}};n.default.register(l),t.exports=l},function(t,e,i){"use strict";var n=s(i(69)),r=s(i(4)),o=s(i(73));function s(t){return t&&t.__esModule?t:{default:t}}var a=o.default.commandNames,c=o.default.rejectMessages,l={name:a.REMOVE_OBJECT,execute:function(t,e){var i=this;return new r.default(function(n,r){i.undoData.objects=t.removeObjectById(e),i.undoData.objects.length?n():r(c.noObject)})},undo:function(t){return t.add(this.undoData.objects),r.default.resolve()}};n.default.register(l),t.exports=l},function(t,e,i){"use strict";var n=o(i(69)),r=o(i(4));function o(t){return t&&t.__esModule?t:{default:t}}var s={name:o(i(73)).default.commandNames.RESIZE_CANVAS_DIMENSION,execute:function(t,e){var i=this;return new r.default(function(n){i.undoData.size={width:t.cssMaxWidth,height:t.cssMaxHeight},t.setCssMaxDimension(e),t.adjustCanvasDimension(),n()})},undo:function(t){return t.setCssMaxDimension(this.undoData.size),t.adjustCanvasDimension(),r.default.resolve()}};n.default.register(s),t.exports=s},function(t,e,i){"use strict";var n=o(i(69)),r=o(i(73));function o(t){return t&&t.__esModule?t:{default:t}}var s=r.default.componentNames,a=r.default.commandNames,c=s.ROTATION,l={name:a.ROTATE_IMAGE,execute:function(t,e,i){var n=t.getComponent(c);return this.undoData.angle=n.getCurrentAngle(),n[e](i)},undo:function(t){var e=t.getComponent(c),i=this.undoData.angle;return e.setAngle(i)}};n.default.register(l),t.exports=l},function(t,e,i){"use strict";var n=a(i(3)),r=a(i(69)),o=a(i(4)),s=a(i(73));function a(t){return t&&t.__esModule?t:{default:t}}var c=s.default.commandNames,l=s.default.rejectMessages,h={name:c.SET_OBJECT_PROPERTIES,execute:function(t,e,i){var r=this,s=t.getObject(e);return s?(this.undoData.props={},n.default.forEachOwnProperties(i,function(t,e){r.undoData.props[e]=s[e]}),t.setObjectProperties(e,i),o.default.resolve()):o.default.reject(l.noObject)},undo:function(t,e){var i=this.undoData.props;return t.setObjectProperties(e,i),o.default.resolve()}};r.default.register(h),t.exports=h},function(t,e,i){"use strict";var n=s(i(69)),r=s(i(4)),o=s(i(73));function s(t){return t&&t.__esModule?t:{default:t}}var a=o.default.commandNames,c=o.default.rejectMessages,l={name:a.SET_OBJECT_POSITION,execute:function(t,e,i){return t.getObject(e)?(this.undoData.objectId=e,this.undoData.props=t.getObjectProperties(e,["left","top"]),t.setObjectPosition(e,i),t.renderAll(),r.default.resolve()):r.default.reject(c.noObject)},undo:function(t){var e=this.undoData,i=e.objectId,n=e.props;return t.setObjectProperties(i,n),t.renderAll(),r.default.resolve()}};n.default.register(l),t.exports=l}])})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.whiteTheme=void 0;e.whiteTheme={"common.bi.image":"","common.bisize.width":"251px","common.bisize.height":"21px","common.backgroundImage":"./img/bg.png","common.backgroundColor":"#fff","common.border":"1px solid #c1c1c1","header.backgroundImage":"none","header.backgroundColor":"transparent","header.border":"0px","loadButton.backgroundColor":"#fff","loadButton.border":"1px solid #ddd","loadButton.color":"#222","loadButton.fontFamily":"NotoSans, sans-serif","loadButton.fontSize":"12px","downloadButton.backgroundColor":"#fdba3b","downloadButton.border":"1px solid #fdba3b","downloadButton.color":"#fff","downloadButton.fontFamily":"NotoSans, sans-serif","downloadButton.fontSize":"12px","menu.normalIcon.path":"../dist/svg/icon-b.svg","menu.normalIcon.name":"icon-b","menu.activeIcon.path":"../dist/svg/icon-a.svg","menu.activeIcon.name":"icon-a","menu.iconSize.width":"24px","menu.iconSize.height":"24px","submenu.backgroundColor":"transparent","submenu.partition.color":"#858585","submenu.normalIcon.path":"../dist/svg/icon-a.svg","submenu.normalIcon.name":"icon-a","submenu.activeIcon.path":"../dist/svg/icon-d.svg","submenu.activeIcon.name":"icon-d","submenu.iconSize.width":"32px","submenu.iconSize.height":"32px","submenu.normalLabel.color":"#858585","submenu.normalLabel.fontWeight":"normal","submenu.activeLabel.color":"#000","submenu.activeLabel.fontWeight":"normal","checkbox.border":"1px solid #ccc","checkbox.backgroundColor":"#fff","range.pointer.color":"#333","range.bar.color":"#ccc","range.subbar.color":"#606060","range.value.color":"#000","range.value.fontWeight":"normal","range.value.fontSize":"11px","range.value.border":"0","range.value.backgroundColor":"#f5f5f5","range.title.color":"#000","range.title.fontWeight":"lighter","colorpicker.button.border":"1px solid #cbcbcb","colorpicker.title.color":"#000"}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.blackTheme=void 0;e.blackTheme={"common.bi.image":"//cdn.photoeditor.cloud/img/logo.png","common.bisize.width":"251px","common.bisize.height":"21px","common.backgroundImage":"none","common.backgroundColor":"#1e1e1e","common.border":"0px","header.backgroundImage":"none","header.backgroundColor":"transparent","header.border":"0px","loadButton.backgroundColor":"#fff","loadButton.border":"1px solid #ddd","loadButton.color":"#222","loadButton.fontFamily":"NotoSans, sans-serif","loadButton.fontSize":"12px","downloadButton.backgroundColor":"#fdba3b","downloadButton.border":"1px solid #fdba3b","downloadButton.color":"#fff","downloadButton.fontFamily":"NotoSans, sans-serif","downloadButton.fontSize":"12px","menu.normalIcon.path":"//cdn.photoeditor.cloud/svg/icon-b.svg","menu.normalIcon.name":"icon-b","menu.activeIcon.path":"//cdn.photoeditor.cloud/svg/icon-a.svg","menu.activeIcon.name":"icon-a","menu.iconSize.width":"24px","menu.iconSize.height":"24px","submenu.backgroundColor":"#1e1e1e","submenu.partition.color":"#858585","submenu.normalIcon.path":"//cdn.photoeditor.cloud/svg/icon-a.svg","submenu.normalIcon.name":"icon-a","submenu.activeIcon.path":"//cdn.photoeditor.cloud/svg/icon-c.svg","submenu.activeIcon.name":"icon-c","submenu.iconSize.width":"32px","submenu.iconSize.height":"32px","submenu.normalLabel.color":"#858585","submenu.normalLabel.fontWeight":"lighter","submenu.activeLabel.color":"#fff","submenu.activeLabel.fontWeight":"lighter","checkbox.border":"1px solid #ccc","checkbox.backgroundColor":"#fff","range.pointer.color":"#fff","range.bar.color":"#666","range.subbar.color":"#d1d1d1","range.value.color":"#fff","range.value.fontWeight":"lighter","range.value.fontSize":"11px","range.value.border":"1px solid #353535","range.value.backgroundColor":"#151515","range.title.color":"#fff","range.title.fontWeight":"lighter","colorpicker.button.border":"1px solid #1e1e1e","colorpicker.title.color":"#fff"}},function(t,e){t.exports={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"}},function(t,e){t.exports=function(){for(var t={},e=0;e<arguments.length;e++){var n=arguments[e];for(var r in n)i.call(n,r)&&(t[r]=n[r])}return t};var i=Object.prototype.hasOwnProperty},function(t,e,i){var n=i(3).Buffer;t.exports=function(t){if(t instanceof Uint8Array){if(0===t.byteOffset&&t.byteLength===t.buffer.byteLength)return t.buffer;if("function"==typeof t.buffer.slice)return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}if(n.isBuffer(t)){for(var e=new Uint8Array(t.length),i=t.length,r=0;r<i;r++)e[r]=t[r];return e.buffer}throw new Error("Argument must be a Buffer")}},function(t,e,i){"use strict";t.exports=o;var n=i(13),r=i(6);function o(t){if(!(this instanceof o))return new o(t);n.call(this,t)}r.inherits=i(2),r.inherits(o,n),o.prototype._transform=function(t,e,i){i(null,t)}},function(t,e,i){(function(e){function i(t){try{if(!e.localStorage)return!1}catch(t){return!1}var i=e.localStorage[t];return null!=i&&"true"===String(i).toLowerCase()}t.exports=function(t,e){if(i("noDeprecation"))return t;var n=!1;return function(){if(!n){if(i("throwDeprecation"))throw new Error(e);i("traceDeprecation")?console.trace(e):console.warn(e),n=!0}return t.apply(this,arguments)}}}).call(this,i(0))},function(t,e,i){(function(t,e){!function(t,i){"use strict";if(!t.setImmediate){var n,r=1,o={},s=!1,a=t.document,c=Object.getPrototypeOf&&Object.getPrototypeOf(t);c=c&&c.setTimeout?c:t,"[object process]"==={}.toString.call(t.process)?n=function(t){e.nextTick(function(){h(t)})}:function(){if(t.postMessage&&!t.importScripts){var e=!0,i=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=i,e}}()?function(){var e="setImmediate$"+Math.random()+"$",i=function(i){i.source===t&&"string"==typeof i.data&&0===i.data.indexOf(e)&&h(+i.data.slice(e.length))};t.addEventListener?t.addEventListener("message",i,!1):t.attachEvent("onmessage",i),n=function(i){t.postMessage(e+i,"*")}}():t.MessageChannel?function(){var t=new MessageChannel;t.port1.onmessage=function(t){h(t.data)},n=function(e){t.port2.postMessage(e)}}():a&&"onreadystatechange"in a.createElement("script")?function(){var t=a.documentElement;n=function(e){var i=a.createElement("script");i.onreadystatechange=function(){h(e),i.onreadystatechange=null,t.removeChild(i),i=null},t.appendChild(i)}}():n=function(t){setTimeout(h,0,t)},c.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),i=0;i<e.length;i++)e[i]=arguments[i+1];var s={callback:t,args:e};return o[r]=s,n(r),r++},c.clearImmediate=l}function l(t){delete o[t]}function h(t){if(s)setTimeout(h,0,t);else{var e=o[t];if(e){s=!0;try{!function(t){var e=t.callback,n=t.args;switch(n.length){case 0:e();break;case 1:e(n[0]);break;case 2:e(n[0],n[1]);break;case 3:e(n[0],n[1],n[2]);break;default:e.apply(i,n)}}(e)}finally{l(t),s=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,i(0),i(1))},function(t,e,i){(function(t){var n=void 0!==t&&t||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function o(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new o(r.call(setTimeout,n,arguments),clearTimeout)},e.setInterval=function(){return new o(r.call(setInterval,n,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(n,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},i(36),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,i(0))},function(t,e){},function(t,e,i){"use strict";var n=i(7).Buffer,r=i(38);function o(t,e,i){t.copy(e,i)}t.exports=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.head=null,this.tail=null,this.length=0}return t.prototype.push=function(t){var e={data:t,next:null};this.length>0?this.tail.next=e:this.head=e,this.tail=e,++this.length},t.prototype.unshift=function(t){var e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},t.prototype.shift=function(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}},t.prototype.clear=function(){this.head=this.tail=null,this.length=0},t.prototype.join=function(t){if(0===this.length)return"";for(var e=this.head,i=""+e.data;e=e.next;)i+=t+e.data;return i},t.prototype.concat=function(t){if(0===this.length)return n.alloc(0);if(1===this.length)return this.head.data;for(var e=n.allocUnsafe(t>>>0),i=this.head,r=0;i;)o(i.data,e,r),r+=i.data.length,i=i.next;return e},t}(),r&&r.inspect&&r.inspect.custom&&(t.exports.prototype[r.inspect.custom]=function(){var t=r.inspect({length:this.length});return this.constructor.name+" "+t})},function(t,e){},function(t,e,i){(function(e,n,r){var o=i(22),s=i(2),a=i(21),c=i(20),l=i(33),h=a.IncomingMessage,u=a.readyStates;var f=t.exports=function(t){var i,n=this;c.Writable.call(n),n._opts=t,n._body=[],n._headers={},t.auth&&n.setHeader("Authorization","Basic "+new e(t.auth).toString("base64")),Object.keys(t.headers).forEach(function(e){n.setHeader(e,t.headers[e])});var r=!0;if("disable-fetch"===t.mode||"requestTimeout"in t&&!o.abortController)r=!1,i=!0;else if("prefer-streaming"===t.mode)i=!1;else if("allow-wrong-content-type"===t.mode)i=!o.overrideMimeType;else{if(t.mode&&"default"!==t.mode&&"prefer-fast"!==t.mode)throw new Error("Invalid value for opts.mode");i=!0}n._mode=function(t,e){return o.fetch&&e?"fetch":o.mozchunkedarraybuffer?"moz-chunked-arraybuffer":o.msstream?"ms-stream":o.arraybuffer&&t?"arraybuffer":o.vbArray&&t?"text:vbarray":"text"}(i,r),n._fetchTimer=null,n.on("finish",function(){n._onFinish()})};s(f,c.Writable),f.prototype.setHeader=function(t,e){var i=t.toLowerCase();-1===d.indexOf(i)&&(this._headers[i]={name:t,value:e})},f.prototype.getHeader=function(t){var e=this._headers[t.toLowerCase()];return e?e.value:null},f.prototype.removeHeader=function(t){delete this._headers[t.toLowerCase()]},f.prototype._onFinish=function(){var t=this;if(!t._destroyed){var i=t._opts,s=t._headers,a=null;"GET"!==i.method&&"HEAD"!==i.method&&(a=o.arraybuffer?l(e.concat(t._body)):o.blobConstructor?new n.Blob(t._body.map(function(t){return l(t)}),{type:(s["content-type"]||{}).value||""}):e.concat(t._body).toString());var c=[];if(Object.keys(s).forEach(function(t){var e=s[t].name,i=s[t].value;Array.isArray(i)?i.forEach(function(t){c.push([e,t])}):c.push([e,i])}),"fetch"===t._mode){var h=null;if(o.abortController){var f=new AbortController;h=f.signal,t._fetchAbortController=f,"requestTimeout"in i&&0!==i.requestTimeout&&(t._fetchTimer=n.setTimeout(function(){t.emit("requestTimeout"),t._fetchAbortController&&t._fetchAbortController.abort()},i.requestTimeout))}n.fetch(t._opts.url,{method:t._opts.method,headers:c,body:a||void 0,mode:"cors",credentials:i.withCredentials?"include":"same-origin",signal:h}).then(function(e){t._fetchResponse=e,t._connect()},function(e){n.clearTimeout(t._fetchTimer),t._destroyed||t.emit("error",e)})}else{var d=t._xhr=new n.XMLHttpRequest;try{d.open(t._opts.method,t._opts.url,!0)}catch(e){return void r.nextTick(function(){t.emit("error",e)})}"responseType"in d&&(d.responseType=t._mode.split(":")[0]),"withCredentials"in d&&(d.withCredentials=!!i.withCredentials),"text"===t._mode&&"overrideMimeType"in d&&d.overrideMimeType("text/plain; charset=x-user-defined"),"requestTimeout"in i&&(d.timeout=i.requestTimeout,d.ontimeout=function(){t.emit("requestTimeout")}),c.forEach(function(t){d.setRequestHeader(t[0],t[1])}),t._response=null,d.onreadystatechange=function(){switch(d.readyState){case u.LOADING:case u.DONE:t._onXHRProgress()}},"moz-chunked-arraybuffer"===t._mode&&(d.onprogress=function(){t._onXHRProgress()}),d.onerror=function(){t._destroyed||t.emit("error",new Error("XHR error"))};try{d.send(a)}catch(e){return void r.nextTick(function(){t.emit("error",e)})}}}},f.prototype._onXHRProgress=function(){(function(t){try{var e=t.status;return null!==e&&0!==e}catch(t){return!1}})(this._xhr)&&!this._destroyed&&(this._response||this._connect(),this._response._onXHRProgress())},f.prototype._connect=function(){var t=this;t._destroyed||(t._response=new h(t._xhr,t._fetchResponse,t._mode,t._fetchTimer),t._response.on("error",function(e){t.emit("error",e)}),t.emit("response",t._response))},f.prototype._write=function(t,e,i){this._body.push(t),i()},f.prototype.abort=f.prototype.destroy=function(){this._destroyed=!0,n.clearTimeout(this._fetchTimer),this._response&&(this._response._destroyed=!0),this._xhr?this._xhr.abort():this._fetchAbortController&&this._fetchAbortController.abort()},f.prototype.end=function(t,e,i){"function"==typeof t&&(i=t,t=void 0),c.Writable.prototype.end.call(this,t,e,i)},f.prototype.flushHeaders=function(){},f.prototype.setTimeout=function(){},f.prototype.setNoDelay=function(){},f.prototype.setSocketKeepAlive=function(){};var d=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via"]}).call(this,i(3).Buffer,i(0),i(1))},function(t,e,i){"use strict";var n=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};t.exports=function(t,e,i,a){return e=e||"&",i=i||"=",null===t&&(t=void 0),"object"==typeof t?o(s(t),function(s){var a=encodeURIComponent(n(s))+i;return r(t[s])?o(t[s],function(t){return a+encodeURIComponent(n(t))}).join(e):a+encodeURIComponent(n(t[s]))}).join(e):a?encodeURIComponent(n(a))+i+encodeURIComponent(n(t)):""};var r=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function o(t,e){if(t.map)return t.map(e);for(var i=[],n=0;n<t.length;n++)i.push(e(t[n],n));return i}var s=Object.keys||function(t){var e=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.push(i);return e}},function(t,e,i){"use strict";function n(t,e){return Object.prototype.hasOwnProperty.call(t,e)}t.exports=function(t,e,i,o){e=e||"&",i=i||"=";var s={};if("string"!=typeof t||0===t.length)return s;var a=/\+/g;t=t.split(e);var c=1e3;o&&"number"==typeof o.maxKeys&&(c=o.maxKeys);var l=t.length;c>0&&l>c&&(l=c);for(var h=0;h<l;++h){var u,f,d,p,g=t[h].replace(a,"%20"),v=g.indexOf(i);v>=0?(u=g.substr(0,v),f=g.substr(v+1)):(u=g,f=""),d=decodeURIComponent(u),p=decodeURIComponent(f),n(s,d)?r(s[d])?s[d].push(p):s[d]=[s[d],p]:s[d]=p}return s};var r=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},function(t,e,i){"use strict";e.decode=e.parse=i(43),e.encode=e.stringify=i(42)},function(t,e,i){"use strict";t.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,i){(function(t,n){var r;/*! https://mths.be/punycode v1.4.1 by @mathias */!function(o){"object"==typeof e&&e&&e.nodeType,"object"==typeof t&&t&&t.nodeType;var s="object"==typeof n&&n;s.global!==s&&s.window!==s&&s.self;var a,c=2147483647,l=36,h=1,u=26,f=38,d=700,p=72,g=128,v="-",m=/^xn--/,b=/[^\x20-\x7E]/,y=/[\x2E\u3002\uFF0E\uFF61]/g,_={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},x=l-h,w=Math.floor,S=String.fromCharCode;function C(t){throw new RangeError(_[t])}function O(t,e){for(var i=t.length,n=[];i--;)n[i]=e(t[i]);return n}function k(t,e){var i=t.split("@"),n="";return i.length>1&&(n=i[0]+"@",t=i[1]),n+O((t=t.replace(y,".")).split("."),e).join(".")}function T(t){for(var e,i,n=[],r=0,o=t.length;r<o;)(e=t.charCodeAt(r++))>=55296&&e<=56319&&r<o?56320==(64512&(i=t.charCodeAt(r++)))?n.push(((1023&e)<<10)+(1023&i)+65536):(n.push(e),r--):n.push(e);return n}function E(t){return O(t,function(t){var e="";return t>65535&&(e+=S((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=S(t)}).join("")}function j(t){return t-48<10?t-22:t-65<26?t-65:t-97<26?t-97:l}function M(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function P(t,e,i){var n=0;for(t=i?w(t/d):t>>1,t+=w(t/e);t>x*u>>1;n+=l)t=w(t/x);return w(n+(x+1)*t/(t+f))}function A(t){var e,i,n,r,o,s,a,f,d,m,b=[],y=t.length,_=0,x=g,S=p;for((i=t.lastIndexOf(v))<0&&(i=0),n=0;n<i;++n)t.charCodeAt(n)>=128&&C("not-basic"),b.push(t.charCodeAt(n));for(r=i>0?i+1:0;r<y;){for(o=_,s=1,a=l;r>=y&&C("invalid-input"),((f=j(t.charCodeAt(r++)))>=l||f>w((c-_)/s))&&C("overflow"),_+=f*s,!(f<(d=a<=S?h:a>=S+u?u:a-S));a+=l)s>w(c/(m=l-d))&&C("overflow"),s*=m;S=P(_-o,e=b.length+1,0==o),w(_/e)>c-x&&C("overflow"),x+=w(_/e),_%=e,b.splice(_++,0,x)}return E(b)}function I(t){var e,i,n,r,o,s,a,f,d,m,b,y,_,x,O,k=[];for(y=(t=T(t)).length,e=g,i=0,o=p,s=0;s<y;++s)(b=t[s])<128&&k.push(S(b));for(n=r=k.length,r&&k.push(v);n<y;){for(a=c,s=0;s<y;++s)(b=t[s])>=e&&b<a&&(a=b);for(a-e>w((c-i)/(_=n+1))&&C("overflow"),i+=(a-e)*_,e=a,s=0;s<y;++s)if((b=t[s])<e&&++i>c&&C("overflow"),b==e){for(f=i,d=l;!(f<(m=d<=o?h:d>=o+u?u:d-o));d+=l)O=f-m,x=l-m,k.push(S(M(m+O%x,0))),f=w(O/x);k.push(S(M(f,0))),o=P(i,_,n==r),i=0,++n}++i,++e}return k.join("")}a={version:"1.4.1",ucs2:{decode:T,encode:E},decode:A,encode:I,toASCII:function(t){return k(t,function(t){return b.test(t)?"xn--"+I(t):t})},toUnicode:function(t){return k(t,function(t){return m.test(t)?A(t.slice(4).toLowerCase()):t})}},void 0===(r=function(){return a}.call(e,i,e,t))||(t.exports=r)}()}).call(this,i(46)(t),i(0))},function(t,e){e.read=function(t,e,i,n,r){var o,s,a=8*r-n-1,c=(1<<a)-1,l=c>>1,h=-7,u=i?r-1:0,f=i?-1:1,d=t[e+u];for(u+=f,o=d&(1<<-h)-1,d>>=-h,h+=a;h>0;o=256*o+t[e+u],u+=f,h-=8);for(s=o&(1<<-h)-1,o>>=-h,h+=n;h>0;s=256*s+t[e+u],u+=f,h-=8);if(0===o)o=1-l;else{if(o===c)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,n),o-=l}return(d?-1:1)*s*Math.pow(2,o-n)},e.write=function(t,e,i,n,r,o){var s,a,c,l=8*o-r-1,h=(1<<l)-1,u=h>>1,f=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:o-1,p=n?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=h):(s=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-s))<1&&(s--,c*=2),(e+=s+u>=1?f/c:f*Math.pow(2,1-u))*c>=2&&(s++,c/=2),s+u>=h?(a=0,s=h):s+u>=1?(a=(e*c-1)*Math.pow(2,r),s+=u):(a=e*Math.pow(2,u-1)*Math.pow(2,r),s=0));r>=8;t[i+d]=255&a,d+=p,a/=256,r-=8);for(s=s<<r|a,l+=r;l>0;t[i+d]=255&s,d+=p,s/=256,l-=8);t[i+d-p]|=128*g}},function(t,e,i){"use strict";e.byteLength=function(t){var e=l(t),i=e[0],n=e[1];return 3*(i+n)/4-n},e.toByteArray=function(t){for(var e,i=l(t),n=i[0],s=i[1],a=new o(function(t,e,i){return 3*(e+i)/4-i}(0,n,s)),c=0,h=s>0?n-4:n,u=0;u<h;u+=4)e=r[t.charCodeAt(u)]<<18|r[t.charCodeAt(u+1)]<<12|r[t.charCodeAt(u+2)]<<6|r[t.charCodeAt(u+3)],a[c++]=e>>16&255,a[c++]=e>>8&255,a[c++]=255&e;2===s&&(e=r[t.charCodeAt(u)]<<2|r[t.charCodeAt(u+1)]>>4,a[c++]=255&e);1===s&&(e=r[t.charCodeAt(u)]<<10|r[t.charCodeAt(u+1)]<<4|r[t.charCodeAt(u+2)]>>2,a[c++]=e>>8&255,a[c++]=255&e);return a},e.fromByteArray=function(t){for(var e,i=t.length,r=i%3,o=[],s=0,a=i-r;s<a;s+=16383)o.push(u(t,s,s+16383>a?a:s+16383));1===r?(e=t[i-1],o.push(n[e>>2]+n[e<<4&63]+"==")):2===r&&(e=(t[i-2]<<8)+t[i-1],o.push(n[e>>10]+n[e>>4&63]+n[e<<2&63]+"="));return o.join("")};for(var n=[],r=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=s.length;a<c;++a)n[a]=s[a],r[s.charCodeAt(a)]=a;function l(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=t.indexOf("=");return-1===i&&(i=e),[i,i===e?0:4-i%4]}function h(t){return n[t>>18&63]+n[t>>12&63]+n[t>>6&63]+n[63&t]}function u(t,e,i){for(var n,r=[],o=e;o<i;o+=3)n=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(255&t[o+2]),r.push(h(n));return r.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},function(module,exports,__webpack_require__){(function(Buffer,process){
/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */
var fabric=fabric||{version:"1.6.7"};exports.fabric=fabric,"undefined"!=typeof document&&"undefined"!=typeof window?(fabric.document=document,fabric.window=window,window.fabric=fabric):(fabric.document=__webpack_require__(24).jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),fabric.document.createWindow?fabric.window=fabric.document.createWindow():fabric.window=fabric.document.parentWindow),fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement,fabric.isLikelyNode=void 0!==Buffer&&"undefined"==typeof window,fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id"],fabric.DPI=96,fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",fabric.fontPaths={},fabric.charWidthsCache={},fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1,function(){function t(t,e){if(this.__eventListeners[t]){var i=this.__eventListeners[t];e?i[i.indexOf(e)]=!1:fabric.util.array.fill(i,!1)}}function e(t,e){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var i in t)this.on(i,t[i]);else this.__eventListeners[t]||(this.__eventListeners[t]=[]),this.__eventListeners[t].push(e);return this}function i(e,i){if(this.__eventListeners){if(0===arguments.length)for(e in this.__eventListeners)t.call(this,e);else if(1===arguments.length&&"object"==typeof arguments[0])for(var n in e)t.call(this,n,e[n]);else t.call(this,e,i);return this}}function n(t,e){if(this.__eventListeners){var i=this.__eventListeners[t];if(i){for(var n=0,r=i.length;n<r;n++)i[n]&&i[n].call(this,e||{});return this.__eventListeners[t]=i.filter(function(t){return!1!==t}),this}}}fabric.Observable={observe:e,stopObserving:i,fire:n,on:e,off:i,trigger:n}}(),fabric.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var t=0,e=arguments.length;t<e;t++)this._onObjectAdded(arguments[t]);return this.renderOnAddRemove&&this.renderAll(),this},insertAt:function(t,e,i){var n=this.getObjects();return i?n[e]=t:n.splice(e,0,t),this._onObjectAdded&&this._onObjectAdded(t),this.renderOnAddRemove&&this.renderAll(),this},remove:function(){for(var t,e=this.getObjects(),i=!1,n=0,r=arguments.length;n<r;n++)-1!==(t=e.indexOf(arguments[n]))&&(i=!0,e.splice(t,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[n]));return this.renderOnAddRemove&&i&&this.renderAll(),this},forEachObject:function(t,e){for(var i=this.getObjects(),n=0,r=i.length;n<r;n++)t.call(e,i[n],n,i);return this},getObjects:function(t){return void 0===t?this._objects:this._objects.filter(function(e){return e.type===t})},item:function(t){return this.getObjects()[t]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(t){return this.getObjects().indexOf(t)>-1},complexity:function(){return this.getObjects().reduce(function(t,e){return t+=e.complexity?e.complexity():0},0)}},function(t){var e=Math.sqrt,i=Math.atan2,n=Math.pow,r=Math.abs,o=Math.PI/180;fabric.util={removeFromArray:function(t,e){var i=t.indexOf(e);return-1!==i&&t.splice(i,1),t},getRandomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},degreesToRadians:function(t){return t*o},radiansToDegrees:function(t){return t/o},rotatePoint:function(t,e,i){t.subtractEquals(e);var n=fabric.util.rotateVector(t,i);return new fabric.Point(n.x,n.y).addEquals(e)},rotateVector:function(t,e){var i=Math.sin(e),n=Math.cos(e);return{x:t.x*n-t.y*i,y:t.x*i+t.y*n}},transformPoint:function(t,e,i){return i?new fabric.Point(e[0]*t.x+e[2]*t.y,e[1]*t.x+e[3]*t.y):new fabric.Point(e[0]*t.x+e[2]*t.y+e[4],e[1]*t.x+e[3]*t.y+e[5])},makeBoundingBoxFromPoints:function(t){var e=[t[0].x,t[1].x,t[2].x,t[3].x],i=fabric.util.array.min(e),n=fabric.util.array.max(e),r=Math.abs(i-n),o=[t[0].y,t[1].y,t[2].y,t[3].y],s=fabric.util.array.min(o),a=fabric.util.array.max(o);return{left:i,top:s,width:r,height:Math.abs(s-a)}},invertTransform:function(t){var e=1/(t[0]*t[3]-t[1]*t[2]),i=[e*t[3],-e*t[1],-e*t[2],e*t[0]],n=fabric.util.transformPoint({x:t[4],y:t[5]},i,!0);return i[4]=-n.x,i[5]=-n.y,i},toFixed:function(t,e){return parseFloat(Number(t).toFixed(e))},parseUnit:function(t,e){var i=/\D{0,2}$/.exec(t),n=parseFloat(t);switch(e||(e=fabric.Text.DEFAULT_SVG_FONT_SIZE),i[0]){case"mm":return n*fabric.DPI/25.4;case"cm":return n*fabric.DPI/2.54;case"in":return n*fabric.DPI;case"pt":return n*fabric.DPI/72;case"pc":return n*fabric.DPI/72*12;case"em":return n*e;default:return n}},falseFunction:function(){return!1},getKlass:function(t,e){return t=fabric.util.string.camelize(t.charAt(0).toUpperCase()+t.slice(1)),fabric.util.resolveNamespace(e)[t]},resolveNamespace:function(e){if(!e)return fabric;var i,n=e.split("."),r=n.length,o=t||fabric.window;for(i=0;i<r;++i)o=o[n[i]];return o},loadImage:function(t,e,i,n){if(t){var r=fabric.util.createImage();r.onload=function(){e&&e.call(i,r),r=r.onload=r.onerror=null},r.onerror=function(){fabric.log("Error loading "+r.src),e&&e.call(i,null,!0),r=r.onload=r.onerror=null},0!==t.indexOf("data")&&n&&(r.crossOrigin=n),r.src=t}else e&&e.call(i,t)},enlivenObjects:function(t,e,i,n){function r(){++s===a&&e&&e(o)}var o=[],s=0,a=(t=t||[]).length;a?t.forEach(function(t,e){if(t&&t.type){var s=fabric.util.getKlass(t.type,i);s.async?s.fromObject(t,function(i,s){s||(o[e]=i,n&&n(t,o[e])),r()}):(o[e]=s.fromObject(t),n&&n(t,o[e]),r())}else r()}):e&&e(o)},groupSVGElements:function(t,e,i){var n;return n=new fabric.PathGroup(t,e),void 0!==i&&n.setSourcePath(i),n},populateWithProperties:function(t,e,i){if(i&&"[object Array]"===Object.prototype.toString.call(i))for(var n=0,r=i.length;n<r;n++)i[n]in t&&(e[i[n]]=t[i[n]])},drawDashedLine:function(t,n,r,o,s,a){var c=o-n,l=s-r,h=e(c*c+l*l),u=i(l,c),f=a.length,d=0,p=!0;for(t.save(),t.translate(n,r),t.moveTo(0,0),t.rotate(u),n=0;h>n;)(n+=a[d++%f])>h&&(n=h),t[p?"lineTo":"moveTo"](n,0),p=!p;t.restore()},createCanvasElement:function(t){return t||(t=fabric.document.createElement("canvas")),t.getContext||"undefined"==typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(t),t},createImage:function(){return fabric.isLikelyNode?new(__webpack_require__(5).Image):fabric.document.createElement("img")},createAccessors:function(t){var e,i,n,r,o,s=t.prototype;for(e=s.stateProperties.length;e--;)r="set"+(n=(i=s.stateProperties[e]).charAt(0).toUpperCase()+i.slice(1)),s[o="get"+n]||(s[o]=new Function('return this.get("'+i+'")')),s[r]||(s[r]=new Function("value",'return this.set("'+i+'", value)'))},clipContext:function(t,e){e.save(),e.beginPath(),t.clipTo(e),e.clip()},multiplyTransformMatrices:function(t,e,i){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],i?0:t[0]*e[4]+t[2]*e[5]+t[4],i?0:t[1]*e[4]+t[3]*e[5]+t[5]]},qrDecompose:function(t){var r=i(t[1],t[0]),s=n(t[0],2)+n(t[1],2),a=e(s),c=(t[0]*t[3]-t[2]*t[1])/a,l=i(t[0]*t[2]+t[1]*t[3],s);return{angle:r/o,scaleX:a,scaleY:c,skewX:l/o,skewY:0,translateX:t[4],translateY:t[5]}},customTransformMatrix:function(t,e,i){var n=[1,0,r(Math.tan(i*o)),1],s=[r(t),0,0,r(e)];return fabric.util.multiplyTransformMatrices(s,n,!0)},resetObjectTransform:function(t){t.scaleX=1,t.scaleY=1,t.skewX=0,t.skewY=0,t.flipX=!1,t.flipY=!1,t.setAngle(0)},getFunctionBody:function(t){return(String(t).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(t,e,i,n){n>0&&(e>n?e-=n:e=0,i>n?i-=n:i=0);var r,o=!0,s=t.getImageData(e,i,2*n||1,2*n||1),a=s.data.length;for(r=3;r<a&&!1!==(o=s.data[r]<=0);r+=4);return s=null,o},parsePreserveAspectRatioAttribute:function(t){var e,i="meet",n=t.split(" ");return n&&n.length&&("meet"!==(i=n.pop())&&"slice"!==i?(e=i,i="meet"):n.length&&(e=n.pop())),{meetOrSlice:i,alignX:"none"!==e?e.slice(1,4):"none",alignY:"none"!==e?e.slice(5,8):"none"}},clearFabricFontCache:function(t){t?fabric.charWidthsCache[t]&&delete fabric.charWidthsCache[t]:fabric.charWidthsCache={}}}}(exports),function(){var t={},e={},i={},n=Array.prototype.join;function r(e,i,r,a,c,l,h){var u=n.call(arguments);if(t[u])return t[u];var f=Math.PI,d=h*f/180,p=Math.sin(d),g=Math.cos(d),v=0,m=0,b=-g*e*.5-p*i*.5,y=-g*i*.5+p*e*.5,_=(r=Math.abs(r))*r,x=(a=Math.abs(a))*a,w=y*y,S=b*b,C=_*x-_*w-x*S,O=0;if(C<0){var k=Math.sqrt(1-C/(_*x));r*=k,a*=k}else O=(c===l?-1:1)*Math.sqrt(C/(_*w+x*S));var T=O*r*y/a,E=-O*a*b/r,j=g*T-p*E+.5*e,M=p*T+g*E+.5*i,P=s(1,0,(b-T)/r,(y-E)/a),A=s((b-T)/r,(y-E)/a,(-b-T)/r,(-y-E)/a);0===l&&A>0?A-=2*f:1===l&&A<0&&(A+=2*f);for(var I=Math.ceil(Math.abs(A/f*2)),D=[],L=A/I,R=8/3*Math.sin(L/4)*Math.sin(L/4)/Math.sin(L/2),B=P+L,F=0;F<I;F++)D[F]=o(P,B,g,p,r,a,j,M,R,v,m),v=D[F][4],m=D[F][5],P=B,B+=L;return t[u]=D,D}function o(t,i,r,o,s,a,c,l,h,u,f){var d=n.call(arguments);if(e[d])return e[d];var p=Math.cos(t),g=Math.sin(t),v=Math.cos(i),m=Math.sin(i),b=r*s*v-o*a*m+c,y=o*s*v+r*a*m+l,_=u+h*(-r*s*g-o*a*p),x=f+h*(-o*s*g+r*a*p),w=b+h*(r*s*m+o*a*v),S=y+h*(o*s*m-r*a*v);return e[d]=[_,x,w,S,b,y],e[d]}function s(t,e,i,n){var r=Math.atan2(e,t),o=Math.atan2(n,i);return o>=r?o-r:2*Math.PI-(r-o)}function a(t,e,r,o,s,a,c,l){var h=n.call(arguments);if(i[h])return i[h];var u,f,d,p,g,v,m,b,y=Math.sqrt,_=Math.min,x=Math.max,w=Math.abs,S=[],C=[[],[]];f=6*t-12*r+6*s,u=-3*t+9*r-9*s+3*c,d=3*r-3*t;for(var O=0;O<2;++O)if(O>0&&(f=6*e-12*o+6*a,u=-3*e+9*o-9*a+3*l,d=3*o-3*e),w(u)<1e-12){if(w(f)<1e-12)continue;0<(p=-d/f)&&p<1&&S.push(p)}else(m=f*f-4*d*u)<0||(0<(g=(-f+(b=y(m)))/(2*u))&&g<1&&S.push(g),0<(v=(-f-b)/(2*u))&&v<1&&S.push(v));for(var k,T,E,j=S.length,M=j;j--;)k=(E=1-(p=S[j]))*E*E*t+3*E*E*p*r+3*E*p*p*s+p*p*p*c,C[0][j]=k,T=E*E*E*e+3*E*E*p*o+3*E*p*p*a+p*p*p*l,C[1][j]=T;C[0][M]=t,C[1][M]=e,C[0][M+1]=c,C[1][M+1]=l;var P=[{x:_.apply(null,C[0]),y:_.apply(null,C[1])},{x:x.apply(null,C[0]),y:x.apply(null,C[1])}];return i[h]=P,P}fabric.util.drawArc=function(t,e,i,n){for(var o=n[0],s=n[1],a=n[2],c=n[3],l=n[4],h=[[],[],[],[]],u=r(n[5]-e,n[6]-i,o,s,c,l,a),f=0,d=u.length;f<d;f++)h[f][0]=u[f][0]+e,h[f][1]=u[f][1]+i,h[f][2]=u[f][2]+e,h[f][3]=u[f][3]+i,h[f][4]=u[f][4]+e,h[f][5]=u[f][5]+i,t.bezierCurveTo.apply(t,h[f])},fabric.util.getBoundsOfArc=function(t,e,i,n,o,s,c,l,h){for(var u,f=0,d=0,p=[],g=r(l-t,h-e,i,n,s,c,o),v=0,m=g.length;v<m;v++)u=a(f,d,g[v][0],g[v][1],g[v][2],g[v][3],g[v][4],g[v][5]),p.push({x:u[0].x+t,y:u[0].y+e}),p.push({x:u[1].x+t,y:u[1].y+e}),f=g[v][4],d=g[v][5];return p},fabric.util.getBoundsOfCurve=a}(),function(){var t=Array.prototype.slice;function e(t,e,i){if(t&&0!==t.length){var n=t.length-1,r=e?t[n][e]:t[n];if(e)for(;n--;)i(t[n][e],r)&&(r=t[n][e]);else for(;n--;)i(t[n],r)&&(r=t[n]);return r}}Array.prototype.indexOf||(Array.prototype.indexOf=function(t){if(void 0===this||null===this)throw new TypeError;var e=Object(this),i=e.length>>>0;if(0===i)return-1;var n=0;if(arguments.length>0&&((n=Number(arguments[1]))!=n?n=0:0!==n&&n!==Number.POSITIVE_INFINITY&&n!==Number.NEGATIVE_INFINITY&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=i)return-1;for(var r=n>=0?n:Math.max(i-Math.abs(n),0);r<i;r++)if(r in e&&e[r]===t)return r;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){for(var i=0,n=this.length>>>0;i<n;i++)i in this&&t.call(e,this[i],i,this)}),Array.prototype.map||(Array.prototype.map=function(t,e){for(var i=[],n=0,r=this.length>>>0;n<r;n++)n in this&&(i[n]=t.call(e,this[n],n,this));return i}),Array.prototype.every||(Array.prototype.every=function(t,e){for(var i=0,n=this.length>>>0;i<n;i++)if(i in this&&!t.call(e,this[i],i,this))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(t,e){for(var i=0,n=this.length>>>0;i<n;i++)if(i in this&&t.call(e,this[i],i,this))return!0;return!1}),Array.prototype.filter||(Array.prototype.filter=function(t,e){for(var i,n=[],r=0,o=this.length>>>0;r<o;r++)r in this&&(i=this[r],t.call(e,i,r,this)&&n.push(i));return n}),Array.prototype.reduce||(Array.prototype.reduce=function(t){var e,i=this.length>>>0,n=0;if(arguments.length>1)e=arguments[1];else for(;;){if(n in this){e=this[n++];break}if(++n>=i)throw new TypeError}for(;n<i;n++)n in this&&(e=t.call(null,e,this[n],n,this));return e}),fabric.util.array={fill:function(t,e){for(var i=t.length;i--;)t[i]=e;return t},invoke:function(e,i){for(var n=t.call(arguments,2),r=[],o=0,s=e.length;o<s;o++)r[o]=n.length?e[o][i].apply(e[o],n):e[o][i].call(e[o]);return r},min:function(t,i){return e(t,i,function(t,e){return t<e})},max:function(t,i){return e(t,i,function(t,e){return t>=e})}}}(),function(){function t(t,i,n){if(n)if(!fabric.isLikelyNode&&i instanceof Element)t=i;else if(i instanceof Array)t=i.map(function(t){return e(t,n)});else if(i instanceof Object)for(var r in i)t[r]=e(i[r],n);else t=i;else for(var r in i)t[r]=i[r];return t}function e(e,i){return t({},e,i)}fabric.util.object={extend:t,clone:e}}(),function(){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}),fabric.util.string={camelize:function(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})},capitalize:function(t,e){return t.charAt(0).toUpperCase()+(e?t.slice(1):t.slice(1).toLowerCase())},escapeXml:function(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}}(),function(){var t=Array.prototype.slice,e=Function.prototype.apply,i=function(){};Function.prototype.bind||(Function.prototype.bind=function(n){var r,o=this,s=t.call(arguments,1);return r=s.length?function(){return e.call(o,this instanceof i?this:n,s.concat(t.call(arguments)))}:function(){return e.call(o,this instanceof i?this:n,arguments)},i.prototype=this.prototype,r.prototype=new i,r})}(),function(){var t=Array.prototype.slice,e=function(){},i=function(){for(var t in{toString:1})if("toString"===t)return!1;return!0}(),n=function(t,e,n){for(var r in e)r in t.prototype&&"function"==typeof t.prototype[r]&&(e[r]+"").indexOf("callSuper")>-1?t.prototype[r]=function(t){return function(){var i=this.constructor.superclass;this.constructor.superclass=n;var r=e[t].apply(this,arguments);if(this.constructor.superclass=i,"initialize"!==t)return r}}(r):t.prototype[r]=e[r],i&&(e.toString!==Object.prototype.toString&&(t.prototype.toString=e.toString),e.valueOf!==Object.prototype.valueOf&&(t.prototype.valueOf=e.valueOf))};function r(){}function o(e){var i=this.constructor.superclass.prototype[e];return arguments.length>1?i.apply(this,t.call(arguments,1)):i.call(this)}fabric.util.createClass=function(){var i=null,s=t.call(arguments,0);function a(){this.initialize.apply(this,arguments)}"function"==typeof s[0]&&(i=s.shift()),a.superclass=i,a.subclasses=[],i&&(r.prototype=i.prototype,a.prototype=new r,i.subclasses.push(a));for(var c=0,l=s.length;c<l;c++)n(a,s[c],i);return a.prototype.initialize||(a.prototype.initialize=e),a.prototype.constructor=a,a.prototype.callSuper=o,a}}(),function(){var t="unknown";function e(t){var e,i,n=Array.prototype.slice.call(arguments,1),r=n.length;for(i=0;i<r;i++)if(e=typeof t[n[i]],!/^(?:function|object|unknown)$/.test(e))return!1;return!0}var i,n,r=function(){var t=0;return function(e){return e.__uniqueID||(e.__uniqueID="uniqueID__"+t++)}}();function o(t,e){return{handler:e,wrappedHandler:function(t,e){return function(n){e.call(i(t),n||fabric.window.event)}}(t,e)}}!function(){var t={};i=function(e){return t[e]},n=function(e,i){t[e]=i}}();var s,a,c=e(fabric.document.documentElement,"addEventListener","removeEventListener")&&e(fabric.window,"addEventListener","removeEventListener"),l=e(fabric.document.documentElement,"attachEvent","detachEvent")&&e(fabric.window,"attachEvent","detachEvent"),h={},u={};c?(s=function(t,e,i){t.addEventListener(e,i,!1)},a=function(t,e,i){t.removeEventListener(e,i,!1)}):l?(s=function(t,e,i){var s=r(t);n(s,t),h[s]||(h[s]={}),h[s][e]||(h[s][e]=[]);var a=o(s,i);h[s][e].push(a),t.attachEvent("on"+e,a.wrappedHandler)},a=function(t,e,i){var n,o=r(t);if(h[o]&&h[o][e])for(var s=0,a=h[o][e].length;s<a;s++)(n=h[o][e][s])&&n.handler===i&&(t.detachEvent("on"+e,n.wrappedHandler),h[o][e][s]=null)}):(s=function(t,e,i){var n=r(t);if(u[n]||(u[n]={}),!u[n][e]){u[n][e]=[];var o=t["on"+e];o&&u[n][e].push(o),t["on"+e]=function(t,e){return function(i){if(u[t]&&u[t][e])for(var n=u[t][e],r=0,o=n.length;r<o;r++)n[r].call(this,i||fabric.window.event)}}(n,e)}u[n][e].push(i)},a=function(t,e,i){var n=r(t);if(u[n]&&u[n][e])for(var o=u[n][e],s=0,a=o.length;s<a;s++)o[s]===i&&o.splice(s,1)}),fabric.util.addListener=s,fabric.util.removeListener=a;var f=function(e){return typeof e.clientX!==t?e.clientX:0},d=function(e){return typeof e.clientY!==t?e.clientY:0};function p(t,e,i){var n="touchend"===t.type?"changedTouches":"touches";return t[n]&&t[n][0]&&t[n][0][e]-(t[n][0][e]-t[n][0][i])||t[i]}fabric.isTouchSupported&&(f=function(t){return p(t,"pageX","clientX")},d=function(t){return p(t,"pageY","clientY")}),fabric.util.getPointer=function(e){e||(e=fabric.window.event);var i=e.target||(typeof e.srcElement!==t?e.srcElement:null),n=fabric.util.getScrollLeftTop(i);return{x:f(e)+n.left,y:d(e)+n.top}},fabric.util.object.extend(fabric.util,fabric.Observable)}(),function(){var t=fabric.document.createElement("div"),e="string"==typeof t.style.opacity,i="string"==typeof t.style.filter,n=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,r=function(t){return t};e?r=function(t,e){return t.style.opacity=e,t}:i&&(r=function(t,e){var i=t.style;return t.currentStyle&&!t.currentStyle.hasLayout&&(i.zoom=1),n.test(i.filter)?(e=e>=.9999?"":"alpha(opacity="+100*e+")",i.filter=i.filter.replace(n,e)):i.filter+=" alpha(opacity="+100*e+")",t}),fabric.util.setStyle=function(t,e){var i=t.style;if(!i)return t;if("string"==typeof e)return t.style.cssText+=";"+e,e.indexOf("opacity")>-1?r(t,e.match(/opacity:\s*(\d?\.?\d*)/)[1]):t;for(var n in e)"opacity"===n?r(t,e[n]):i["float"===n||"cssFloat"===n?void 0===i.styleFloat?"cssFloat":"styleFloat":n]=e[n];return t}}(),function(){var t=Array.prototype.slice;var e,i,n=function(e){return t.call(e,0)};try{e=n(fabric.document.childNodes)instanceof Array}catch(t){}function r(t,e){var i=fabric.document.createElement(t);for(var n in e)"class"===n?i.className=e[n]:"for"===n?i.htmlFor=e[n]:i.setAttribute(n,e[n]);return i}function o(t){for(var e=0,i=0,n=fabric.document.documentElement,r=fabric.document.body||{scrollLeft:0,scrollTop:0};t&&(t.parentNode||t.host)&&((t=t.parentNode||t.host)===fabric.document?(e=r.scrollLeft||n.scrollLeft||0,i=r.scrollTop||n.scrollTop||0):(e+=t.scrollLeft||0,i+=t.scrollTop||0),1!==t.nodeType||"fixed"!==fabric.util.getElementStyle(t,"position")););return{left:e,top:i}}e||(n=function(t){for(var e=new Array(t.length),i=t.length;i--;)e[i]=t[i];return e}),i=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(t,e){var i=fabric.document.defaultView.getComputedStyle(t,null);return i?i[e]:void 0}:function(t,e){var i=t.style[e];return!i&&t.currentStyle&&(i=t.currentStyle[e]),i},function(){var t=fabric.document.documentElement.style,e="userSelect"in t?"userSelect":"MozUserSelect"in t?"MozUserSelect":"WebkitUserSelect"in t?"WebkitUserSelect":"KhtmlUserSelect"in t?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=function(t){return void 0!==t.onselectstart&&(t.onselectstart=fabric.util.falseFunction),e?t.style[e]="none":"string"==typeof t.unselectable&&(t.unselectable="on"),t},fabric.util.makeElementSelectable=function(t){return void 0!==t.onselectstart&&(t.onselectstart=null),e?t.style[e]="":"string"==typeof t.unselectable&&(t.unselectable=""),t}}(),function(){fabric.util.getScript=function(t,e){var i=fabric.document.getElementsByTagName("head")[0],n=fabric.document.createElement("script"),r=!0;n.onload=n.onreadystatechange=function(t){if(r){if("string"==typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)return;r=!1,e(t||fabric.window.event),n=n.onload=n.onreadystatechange=null}},n.src=t,i.appendChild(n)}}(),fabric.util.getById=function(t){return"string"==typeof t?fabric.document.getElementById(t):t},fabric.util.toArray=n,fabric.util.makeElement=r,fabric.util.addClass=function(t,e){t&&-1===(" "+t.className+" ").indexOf(" "+e+" ")&&(t.className+=(t.className?" ":"")+e)},fabric.util.wrapElement=function(t,e,i){return"string"==typeof e&&(e=r(e,i)),t.parentNode&&t.parentNode.replaceChild(e,t),e.appendChild(t),e},fabric.util.getScrollLeftTop=o,fabric.util.getElementOffset=function(t){var e,n,r=t&&t.ownerDocument,s={left:0,top:0},a={left:0,top:0},c={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!r)return a;for(var l in c)a[c[l]]+=parseInt(i(t,l),10)||0;return e=r.documentElement,void 0!==t.getBoundingClientRect&&(s=t.getBoundingClientRect()),n=o(t),{left:s.left+n.left-(e.clientLeft||0)+a.left,top:s.top+n.top-(e.clientTop||0)+a.top}},fabric.util.getElementStyle=i}(),function(){var t=function(){for(var t=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],e=t.length;e--;)try{if(t[e]())return t[e]}catch(t){}}();function e(){}fabric.util.request=function(i,n){n||(n={});var r=n.method?n.method.toUpperCase():"GET",o=n.onComplete||function(){},s=t(),a=n.body||n.parameters;return s.onreadystatechange=function(){4===s.readyState&&(o(s),s.onreadystatechange=e)},"GET"===r&&(a=null,"string"==typeof n.parameters&&(i=function(t,e){return t+(/\?/.test(t)?"&":"?")+e}(i,n.parameters))),s.open(r,i,!0),"POST"!==r&&"PUT"!==r||s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send(a),s}}(),fabric.log=function(){},fabric.warn=function(){},"undefined"!=typeof console&&["log","warn"].forEach(function(t){void 0!==console[t]&&"function"==typeof console[t].apply&&(fabric[t]=function(){return console[t].apply(console,arguments)})}),function(){var t=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(t){fabric.window.setTimeout(t,1e3/60)};function e(){return t.apply(fabric.window,arguments)}fabric.util.animate=function(t){e(function(i){t||(t={});var n,r=i||+new Date,o=t.duration||500,s=r+o,a=t.onChange||function(){},c=t.abort||function(){return!1},l=t.easing||function(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e},h="startValue"in t?t.startValue:0,u="endValue"in t?t.endValue:100,f=t.byValue||u-h;t.onStart&&t.onStart(),function i(u){var d=(n=u||+new Date)>s?o:n-r;c()?t.onComplete&&t.onComplete():(a(l(d,h,f,o)),n>s?t.onComplete&&t.onComplete():e(i))}(r)})},fabric.util.requestAnimFrame=e}(),function(){function t(t,e,i,n){return t<Math.abs(e)?(t=e,n=i/4):n=0===e&&0===t?i/(2*Math.PI)*Math.asin(1):i/(2*Math.PI)*Math.asin(e/t),{a:t,c:e,p:i,s:n}}function e(t,e,i){return t.a*Math.pow(2,10*(e-=1))*Math.sin((e*i-t.s)*(2*Math.PI)/t.p)}function i(t,e,i,r){return i-n(r-t,0,i,r)+e}function n(t,e,i,n){return(t/=n)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e}fabric.util.ease={easeInQuad:function(t,e,i,n){return i*(t/=n)*t+e},easeOutQuad:function(t,e,i,n){return-i*(t/=n)*(t-2)+e},easeInOutQuad:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},easeInCubic:function(t,e,i,n){return i*(t/=n)*t*t+e},easeOutCubic:function(t,e,i,n){return i*((t=t/n-1)*t*t+1)+e},easeInOutCubic:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},easeInQuart:function(t,e,i,n){return i*(t/=n)*t*t*t+e},easeOutQuart:function(t,e,i,n){return-i*((t=t/n-1)*t*t*t-1)+e},easeInOutQuart:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},easeInQuint:function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},easeOutQuint:function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},easeInOutQuint:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},easeInSine:function(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e},easeOutSine:function(t,e,i,n){return i*Math.sin(t/n*(Math.PI/2))+e},easeInOutSine:function(t,e,i,n){return-i/2*(Math.cos(Math.PI*t/n)-1)+e},easeInExpo:function(t,e,i,n){return 0===t?e:i*Math.pow(2,10*(t/n-1))+e},easeOutExpo:function(t,e,i,n){return t===n?e+i:i*(1-Math.pow(2,-10*t/n))+e},easeInOutExpo:function(t,e,i,n){return 0===t?e:t===n?e+i:(t/=n/2)<1?i/2*Math.pow(2,10*(t-1))+e:i/2*(2-Math.pow(2,-10*--t))+e},easeInCirc:function(t,e,i,n){return-i*(Math.sqrt(1-(t/=n)*t)-1)+e},easeOutCirc:function(t,e,i,n){return i*Math.sqrt(1-(t=t/n-1)*t)+e},easeInOutCirc:function(t,e,i,n){return(t/=n/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e},easeInElastic:function(i,n,r,o){var s=0;return 0===i?n:1==(i/=o)?n+r:(s||(s=.3*o),-e(t(r,r,s,1.70158),i,o)+n)},easeOutElastic:function(e,i,n,r){var o=0,s=n;if(0===e)return i;if(1==(e/=r))return i+n;o||(o=.3*r);var a=t(s,n,o,1.70158);return a.a*Math.pow(2,-10*e)*Math.sin((e*r-a.s)*(2*Math.PI)/a.p)+a.c+i},easeInOutElastic:function(i,n,r,o){var s=0,a=r;if(0===i)return n;if(2==(i/=o/2))return n+r;s||(s=o*(.3*1.5));var c=t(a,r,s,1.70158);return i<1?-.5*e(c,i,o)+n:c.a*Math.pow(2,-10*(i-=1))*Math.sin((i*o-c.s)*(2*Math.PI)/c.p)*.5+c.c+n},easeInBack:function(t,e,i,n,r){return void 0===r&&(r=1.70158),i*(t/=n)*t*((r+1)*t-r)+e},easeOutBack:function(t,e,i,n,r){return void 0===r&&(r=1.70158),i*((t=t/n-1)*t*((r+1)*t+r)+1)+e},easeInOutBack:function(t,e,i,n,r){return void 0===r&&(r=1.70158),(t/=n/2)<1?i/2*(t*t*((1+(r*=1.525))*t-r))+e:i/2*((t-=2)*t*((1+(r*=1.525))*t+r)+2)+e},easeInBounce:i,easeOutBounce:n,easeInOutBounce:function(t,e,r,o){return t<o/2?.5*i(2*t,0,r,o)+e:.5*n(2*t-o,0,r,o)+.5*r+e}}}(),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.string.capitalize,r=e.util.object.clone,o=e.util.toFixed,s=e.util.parseUnit,a=e.util.multiplyTransformMatrices,c=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/i,l=/^(symbol|image|marker|pattern|view|svg)$/i,h=/^(?:pattern|defs|symbol|metadata)$/i,u=/^(symbol|g|a|svg)$/i,f={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"originX"},d={stroke:"strokeOpacity",fill:"fillOpacity"};function p(t){return t in f?f[t]:t}function g(t,i,n,r){var o,c="[object Array]"===Object.prototype.toString.call(i);return"fill"!==t&&"stroke"!==t||"none"!==i?"strokeDashArray"===t?i=i.replace(/,/g," ").split(/\s+/).map(function(t){return parseFloat(t)}):"transformMatrix"===t?i=n&&n.transformMatrix?a(n.transformMatrix,e.parseTransformAttribute(i)):e.parseTransformAttribute(i):"visible"===t?(i="none"!==i&&"hidden"!==i,n&&!1===n.visible&&(i=!1)):"originX"===t?i="start"===i?"left":"end"===i?"right":"center":o=c?i.map(s):s(i,r):i="",!c&&isNaN(o)?i:o}function v(t,e){for(var i,n,r=[],o=0;o<e.length;o++)i=e[o],n=t.getElementsByTagName(i),r=r.concat(Array.prototype.slice.call(n));return r}function m(t,e){var i,n=!0;return(i=b(t,e.pop()))&&e.length&&(n=function(t,e){var i,n=!0;for(;t.parentNode&&1===t.parentNode.nodeType&&e.length;)n&&(i=e.pop()),t=t.parentNode,n=b(t,i);return 0===e.length}(t,e)),i&&n&&0===e.length}function b(t,e){var i,n=t.nodeName,r=t.getAttribute("class"),o=t.getAttribute("id");if(i=new RegExp("^"+n,"i"),e=e.replace(i,""),o&&e.length&&(i=new RegExp("#"+o+"(?![a-zA-Z\\-]+)","i"),e=e.replace(i,"")),r&&e.length)for(var s=(r=r.split(" ")).length;s--;)i=new RegExp("\\."+r[s]+"(?![a-zA-Z\\-]+)","i"),e=e.replace(i,"");return 0===e.length}function y(t,e){var i;if(t.getElementById&&(i=t.getElementById(e)),i)return i;var n,r,o=t.getElementsByTagName("*");for(r=0;r<o.length;r++)if(e===(n=o[r]).getAttribute("id"))return n}e.cssRules={},e.gradientDefs={},e.parseTransformAttribute=function(){var t=[1,0,0,1,0,0],i=e.reNum,n="(?:\\s+,?\\s*|,\\s*)",r="(?:"+("(?:(matrix)\\s*\\(\\s*("+i+")"+n+"("+i+")"+n+"("+i+")"+n+"("+i+")"+n+"("+i+")"+n+"("+i+")\\s*\\))")+"|"+("(?:(translate)\\s*\\(\\s*("+i+")(?:"+n+"("+i+"))?\\s*\\))")+"|"+("(?:(scale)\\s*\\(\\s*("+i+")(?:"+n+"("+i+"))?\\s*\\))")+"|"+("(?:(rotate)\\s*\\(\\s*("+i+")(?:"+n+"("+i+")"+n+"("+i+"))?\\s*\\))")+"|"+("(?:(skewX)\\s*\\(\\s*("+i+")\\s*\\))")+"|"+("(?:(skewY)\\s*\\(\\s*("+i+")\\s*\\))")+")",o=new RegExp("^\\s*(?:"+("(?:"+r+"(?:"+n+"*"+r+")*)")+"?)\\s*$"),s=new RegExp(r,"g");return function(i){var n=t.concat(),a=[];if(!i||i&&!o.test(i))return n;i.replace(s,function(i){var o=new RegExp(r).exec(i).filter(function(t){return!!t}),s=o[1],c=o.slice(2).map(parseFloat);switch(s){case"translate":!function(t,e){t[4]=e[0],2===e.length&&(t[5]=e[1])}(n,c);break;case"rotate":c[0]=e.util.degreesToRadians(c[0]),function(t,e){var i=e[0],n=3===e.length?e[1]:0,r=3===e.length?e[2]:0;t[0]=Math.cos(i),t[1]=Math.sin(i),t[2]=-Math.sin(i),t[3]=Math.cos(i),t[4]=n-(t[0]*n+t[2]*r),t[5]=r-(t[1]*n+t[3]*r)}(n,c);break;case"scale":!function(t,e){var i=e[0],n=2===e.length?e[1]:e[0];t[0]=i,t[3]=n}(n,c);break;case"skewX":!function(t,i){t[2]=Math.tan(e.util.degreesToRadians(i[0]))}(n,c);break;case"skewY":!function(t,i){t[1]=Math.tan(e.util.degreesToRadians(i[0]))}(n,c);break;case"matrix":n=c}a.push(n.concat()),n=t.concat()});for(var c=a[0];a.length>1;)a.shift(),c=e.util.multiplyTransformMatrices(c,a[0]);return c}}();var _=new RegExp("^\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*$");function x(t){var i,n,r,o,a,c,h=t.getAttribute("viewBox"),u=1,f=1,d=t.getAttribute("width"),p=t.getAttribute("height"),g=t.getAttribute("x")||0,v=t.getAttribute("y")||0,m=t.getAttribute("preserveAspectRatio")||"",b=!h||!l.test(t.nodeName)||!(h=h.match(_)),y=!d||!p||"100%"===d||"100%"===p,x=b&&y,w={},S="";if(w.width=0,w.height=0,w.toBeParsed=x,x)return w;if(b)return w.width=s(d),w.height=s(p),w;if(i=-parseFloat(h[1]),n=-parseFloat(h[2]),r=parseFloat(h[3]),o=parseFloat(h[4]),y?(w.width=r,w.height=o):(w.width=s(d),w.height=s(p),u=w.width/r,f=w.height/o),"none"!==(m=e.util.parsePreserveAspectRatioAttribute(m)).alignX&&(f=u=u>f?f:u),1===u&&1===f&&0===i&&0===n&&0===g&&0===v)return w;if((g||v)&&(S=" translate("+s(g)+" "+s(v)+") "),a=S+" matrix("+u+" 0 0 "+f+" "+i*u+" "+n*f+") ","svg"===t.nodeName){for(c=t.ownerDocument.createElement("g");t.firstChild;)c.appendChild(t.firstChild);t.appendChild(c)}else a=(c=t).getAttribute("transform")+a;return c.setAttribute("transform",a),w}e.parseSVGDocument=function(){return function(t,i,n){if(t){!function(t){for(var e=v(t,["use","svg:use"]),i=0;e.length&&i<e.length;){var n,r,o,s,a=e[i],c=a.getAttribute("xlink:href").substr(1),l=a.getAttribute("x")||0,h=a.getAttribute("y")||0,u=y(t,c).cloneNode(!0),f=(u.getAttribute("transform")||"")+" translate("+l+", "+h+")",d=e.length;if(x(u),/^svg$/i.test(u.nodeName)){var p=u.ownerDocument.createElement("g");for(r=0,s=(o=u.attributes).length;r<s;r++)n=o.item(r),p.setAttribute(n.nodeName,n.nodeValue);for(;u.firstChild;)p.appendChild(u.firstChild);u=p}for(r=0,s=(o=a.attributes).length;r<s;r++)"x"!==(n=o.item(r)).nodeName&&"y"!==n.nodeName&&"xlink:href"!==n.nodeName&&("transform"===n.nodeName?f=n.nodeValue+" "+f:u.setAttribute(n.nodeName,n.nodeValue));u.setAttribute("transform",f),u.setAttribute("instantiated_by_use","1"),u.removeAttribute("id"),a.parentNode.replaceChild(u,a),e.length===d&&i++}}(t);var o=new Date,s=e.Object.__uid++,a=x(t),l=e.util.toArray(t.getElementsByTagName("*"));if(a.svgUid=s,0===l.length&&e.isLikelyNode){for(var u=[],f=0,d=(l=t.selectNodes('//*[name(.)!="svg"]')).length;f<d;f++)u[f]=l[f];l=u}var p=l.filter(function(t){return x(t),c.test(t.nodeName.replace("svg:",""))&&!function(t,e){for(;t&&(t=t.parentNode);)if(t.nodeName&&e.test(t.nodeName.replace("svg:",""))&&!t.getAttribute("instantiated_by_use"))return!0;return!1}(t,h)});!p||p&&!p.length?i&&i([],{}):(e.gradientDefs[s]=e.getGradientDefs(t),e.cssRules[s]=e.getCSSRules(t),e.parseElements(p,function(t){e.documentParsingTime=new Date-o,i&&i(t,a)},r(a),n))}}}();var w={has:function(t,e){e(!1)},get:function(){},set:function(){}};function S(t,e,i){e[i]&&e[i].toSVG&&t.push('\t<pattern x="0" y="0" id="',i,'Pattern" ','width="',e[i].source.width,'" height="',e[i].source.height,'" patternUnits="userSpaceOnUse">\n','\t\t<image x="0" y="0" ','width="',e[i].source.width,'" height="',e[i].source.height,'" xlink:href="',e[i].source.src,'"></image>\n\t</pattern>\n')}var C=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+e.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+e.reNum+"))?\\s+(.*)");i(e,{parseFontDeclaration:function(t,e){var i=t.match(C);if(i){var n=i[1],r=i[3],o=i[4],a=i[5],c=i[6];n&&(e.fontStyle=n),r&&(e.fontWeight=isNaN(parseFloat(r))?r:parseFloat(r)),o&&(e.fontSize=s(o)),c&&(e.fontFamily=c),a&&(e.lineHeight="normal"===a?1:a)}},getGradientDefs:function(t){var e,i,n,r=v(t,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),o=0,s={},a={};for(o=r.length;o--;)n=(e=r[o]).getAttribute("xlink:href"),i=e.getAttribute("id"),n&&(a[i]=n.substr(1)),s[i]=e;for(i in a){var c=s[a[i]].cloneNode(!0);for(e=s[i];c.firstChild;)e.appendChild(c.firstChild)}return s},parseAttributes:function(t,n,r){if(t){var s,a,c={};void 0===r&&(r=t.getAttribute("svgUid")),t.parentNode&&u.test(t.parentNode.nodeName)&&(c=e.parseAttributes(t.parentNode,n,r)),a=c&&c.fontSize||t.getAttribute("font-size")||e.Text.DEFAULT_SVG_FONT_SIZE;var l=n.reduce(function(e,i){return(s=t.getAttribute(i))&&(i=p(i),s=g(i,s,c,a),e[i]=s),e},{});return(l=i(l,i(function(t,i){var n={};for(var r in e.cssRules[i])if(m(t,r.split(" ")))for(var o in e.cssRules[i][r])n[o]=e.cssRules[i][r][o];return n}(t,r),e.parseStyleAttribute(t)))).font&&e.parseFontDeclaration(l.font,l),function(t){for(var i in d)if(void 0!==t[d[i]]&&""!==t[i]){if(void 0===t[i]){if(!e.Object.prototype[i])continue;t[i]=e.Object.prototype[i]}if(0!==t[i].indexOf("url(")){var n=new e.Color(t[i]);t[i]=n.setAlpha(o(n.getAlpha()*t[d[i]],2)).toRgba()}}return t}(i(c,l))}},parseElements:function(t,i,n,r){new e.ElementsParser(t,i,n,r).parse()},parseStyleAttribute:function(t){var e={},i=t.getAttribute("style");return i?("string"==typeof i?function(t,e){var i,n;t.replace(/;\s*$/,"").split(";").forEach(function(t){var r=t.split(":");i=p(r[0].trim().toLowerCase()),n=g(i,r[1].trim()),e[i]=n})}(i,e):function(t,e){var i,n;for(var r in t)void 0!==t[r]&&(n=g(i=p(r.toLowerCase()),t[r]),e[i]=n)}(i,e),e):e},parsePointsAttribute:function(t){if(!t)return null;var e,i,n=[];for(e=0,i=(t=(t=t.replace(/,/g," ").trim()).split(/\s+/)).length;e<i;e+=2)n.push({x:parseFloat(t[e]),y:parseFloat(t[e+1])});return n},getCSSRules:function(t){for(var i=t.getElementsByTagName("style"),n={},r=0,o=i.length;r<o;r++){var s=i[r].textContent||i[r].text;""!==(s=s.replace(/\/\*[\s\S]*?\*\//g,"")).trim()&&s.match(/[^{]*\{[\s\S]*?\}/g).map(function(t){return t.trim()}).forEach(function(t){for(var i=t.match(/([\s\S]*?)\s*\{([^}]*)\}/),r={},o=i[2].trim().replace(/;$/,"").split(/\s*;\s*/),s=0,a=o.length;s<a;s++){var c=o[s].split(/\s*:\s*/),l=p(c[0]),h=g(l,c[1],c[0]);r[l]=h}(t=i[1]).split(",").forEach(function(t){""!==(t=t.replace(/^svg/i,"").trim())&&(n[t]?e.util.object.extend(n[t],r):n[t]=e.util.object.clone(r))})})}return n},loadSVGFromURL:function(t,i,r){function o(n){var o=n.responseXML;o&&!o.documentElement&&e.window.ActiveXObject&&n.responseText&&((o=new ActiveXObject("Microsoft.XMLDOM")).async="false",o.loadXML(n.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),o&&o.documentElement||i&&i(null),e.parseSVGDocument(o.documentElement,function(n,r){w.set(t,{objects:e.util.array.invoke(n,"toObject"),options:r}),i&&i(n,r)},r)}t=t.replace(/^\n\s*/,"").trim(),w.has(t,function(r){r?w.get(t,function(t){var r=function(t){var i=t.objects,r=t.options;return{objects:i=i.map(function(t){return e[n(t.type)].fromObject(t)}),options:r}}(t);i(r.objects,r.options)}):new e.util.request(t,{method:"get",onComplete:o})})},loadSVGFromString:function(t,i,n){var r;if(t=t.trim(),"undefined"!=typeof DOMParser){var o=new DOMParser;o&&o.parseFromString&&(r=o.parseFromString(t,"text/xml"))}else e.window.ActiveXObject&&((r=new ActiveXObject("Microsoft.XMLDOM")).async="false",r.loadXML(t.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));e.parseSVGDocument(r.documentElement,function(t,e){i(t,e)},n)},createSVGFontFacesMarkup:function(t){for(var i,n,r,o,s,a,c="",l={},h=e.fontPaths,u=0,f=t.length;u<f;u++)if(n=(i=t[u]).fontFamily,-1!==i.type.indexOf("text")&&!l[n]&&h[n]&&(l[n]=!0,i.styles))for(s in r=i.styles)for(a in o=r[s])!l[n=o[a].fontFamily]&&h[n]&&(l[n]=!0);for(var d in l)c+=["\t\t@font-face {\n","\t\t\tfont-family: '",d,"';\n","\t\t\tsrc: url('",h[d],"');\n","\t\t}\n"].join("");return c&&(c=['\t<style type="text/css">',"<![CDATA[\n",c,"]]>","</style>\n"].join("")),c},createSVGRefElementsMarkup:function(t){var e=[];return S(e,t,"backgroundColor"),S(e,t,"overlayColor"),e.join("")}})}(exports),fabric.ElementsParser=function(t,e,i,n){this.elements=t,this.callback=e,this.options=i,this.reviver=n,this.svgUid=i&&i.svgUid||0},fabric.ElementsParser.prototype.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},fabric.ElementsParser.prototype.createObjects=function(){for(var t=0,e=this.elements.length;t<e;t++)this.elements[t].setAttribute("svgUid",this.svgUid),function(t,e){setTimeout(function(){t.createObject(t.elements[e],e)},0)}(this,t)},fabric.ElementsParser.prototype.createObject=function(t,e){var i=fabric[fabric.util.string.capitalize(t.tagName.replace("svg:",""))];if(i&&i.fromElement)try{this._createObject(i,t,e)}catch(t){fabric.log(t)}else this.checkIfDone()},fabric.ElementsParser.prototype._createObject=function(t,e,i){if(t.async)t.fromElement(e,this.createCallback(i,e),this.options);else{var n=t.fromElement(e,this.options);this.resolveGradient(n,"fill"),this.resolveGradient(n,"stroke"),this.reviver&&this.reviver(e,n),this.instances[i]=n,this.checkIfDone()}},fabric.ElementsParser.prototype.createCallback=function(t,e){var i=this;return function(n){i.resolveGradient(n,"fill"),i.resolveGradient(n,"stroke"),i.reviver&&i.reviver(e,n),i.instances[t]=n,i.checkIfDone()}},fabric.ElementsParser.prototype.resolveGradient=function(t,e){var i=t.get(e);if(/^url\(/.test(i)){var n=i.slice(5,i.length-1);fabric.gradientDefs[this.svgUid][n]&&t.set(e,fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][n],t))}},fabric.ElementsParser.prototype.checkIfDone=function(){0==--this.numElements&&(this.instances=this.instances.filter(function(t){return null!=t}),this.callback(this.instances))},function(t){"use strict";var e=t.fabric||(t.fabric={});function i(t,e){this.x=t,this.y=e}e.Point?e.warn("fabric.Point is already defined"):(e.Point=i,i.prototype={type:"point",constructor:i,add:function(t){return new i(this.x+t.x,this.y+t.y)},addEquals:function(t){return this.x+=t.x,this.y+=t.y,this},scalarAdd:function(t){return new i(this.x+t,this.y+t)},scalarAddEquals:function(t){return this.x+=t,this.y+=t,this},subtract:function(t){return new i(this.x-t.x,this.y-t.y)},subtractEquals:function(t){return this.x-=t.x,this.y-=t.y,this},scalarSubtract:function(t){return new i(this.x-t,this.y-t)},scalarSubtractEquals:function(t){return this.x-=t,this.y-=t,this},multiply:function(t){return new i(this.x*t,this.y*t)},multiplyEquals:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return new i(this.x/t,this.y/t)},divideEquals:function(t){return this.x/=t,this.y/=t,this},eq:function(t){return this.x===t.x&&this.y===t.y},lt:function(t){return this.x<t.x&&this.y<t.y},lte:function(t){return this.x<=t.x&&this.y<=t.y},gt:function(t){return this.x>t.x&&this.y>t.y},gte:function(t){return this.x>=t.x&&this.y>=t.y},lerp:function(t,e){return void 0===e&&(e=.5),e=Math.max(Math.min(1,e),0),new i(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)},distanceFrom:function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},midPointFrom:function(t){return this.lerp(t)},min:function(t){return new i(Math.min(this.x,t.x),Math.min(this.y,t.y))},max:function(t){return new i(Math.max(this.x,t.x),Math.max(this.y,t.y))},toString:function(){return this.x+","+this.y},setXY:function(t,e){return this.x=t,this.y=e,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setFromPoint:function(t){return this.x=t.x,this.y=t.y,this},swap:function(t){var e=this.x,i=this.y;this.x=t.x,this.y=t.y,t.x=e,t.y=i},clone:function(){return new i(this.x,this.y)}})}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={});function i(t){this.status=t,this.points=[]}e.Intersection?e.warn("fabric.Intersection is already defined"):(e.Intersection=i,e.Intersection.prototype={constructor:i,appendPoint:function(t){return this.points.push(t),this},appendPoints:function(t){return this.points=this.points.concat(t),this}},e.Intersection.intersectLineLine=function(t,n,r,o){var s,a=(o.x-r.x)*(t.y-r.y)-(o.y-r.y)*(t.x-r.x),c=(n.x-t.x)*(t.y-r.y)-(n.y-t.y)*(t.x-r.x),l=(o.y-r.y)*(n.x-t.x)-(o.x-r.x)*(n.y-t.y);if(0!==l){var h=a/l,u=c/l;0<=h&&h<=1&&0<=u&&u<=1?(s=new i("Intersection")).appendPoint(new e.Point(t.x+h*(n.x-t.x),t.y+h*(n.y-t.y))):s=new i}else s=new i(0===a||0===c?"Coincident":"Parallel");return s},e.Intersection.intersectLinePolygon=function(t,e,n){for(var r,o,s,a=new i,c=n.length,l=0;l<c;l++)r=n[l],o=n[(l+1)%c],s=i.intersectLineLine(t,e,r,o),a.appendPoints(s.points);return a.points.length>0&&(a.status="Intersection"),a},e.Intersection.intersectPolygonPolygon=function(t,e){for(var n=new i,r=t.length,o=0;o<r;o++){var s=t[o],a=t[(o+1)%r],c=i.intersectLinePolygon(s,a,e);n.appendPoints(c.points)}return n.points.length>0&&(n.status="Intersection"),n},e.Intersection.intersectPolygonRectangle=function(t,n,r){var o=n.min(r),s=n.max(r),a=new e.Point(s.x,o.y),c=new e.Point(o.x,s.y),l=i.intersectLinePolygon(o,a,t),h=i.intersectLinePolygon(a,s,t),u=i.intersectLinePolygon(s,c,t),f=i.intersectLinePolygon(c,o,t),d=new i;return d.appendPoints(l.points),d.appendPoints(h.points),d.appendPoints(u.points),d.appendPoints(f.points),d.points.length>0&&(d.status="Intersection"),d})}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={});function i(t){t?this._tryParsingColor(t):this.setSource([0,0,0,1])}function n(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}e.Color?e.warn("fabric.Color is already defined."):(e.Color=i,e.Color.prototype={_tryParsingColor:function(t){var e;t in i.colorNameMap&&(t=i.colorNameMap[t]),"transparent"===t&&(e=[255,255,255,0]),e||(e=i.sourceFromHex(t)),e||(e=i.sourceFromRgb(t)),e||(e=i.sourceFromHsl(t)),e||(e=[0,0,0,1]),e&&this.setSource(e)},_rgbToHsl:function(t,i,n){t/=255,i/=255,n/=255;var r,o,s,a=e.util.array.max([t,i,n]),c=e.util.array.min([t,i,n]);if(s=(a+c)/2,a===c)r=o=0;else{var l=a-c;switch(o=s>.5?l/(2-a-c):l/(a+c),a){case t:r=(i-n)/l+(i<n?6:0);break;case i:r=(n-t)/l+2;break;case n:r=(t-i)/l+4}r/=6}return[Math.round(360*r),Math.round(100*o),Math.round(100*s)]},getSource:function(){return this._source},setSource:function(t){this._source=t},toRgb:function(){var t=this.getSource();return"rgb("+t[0]+","+t[1]+","+t[2]+")"},toRgba:function(){var t=this.getSource();return"rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")"},toHsl:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsl("+e[0]+","+e[1]+"%,"+e[2]+"%)"},toHsla:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsla("+e[0]+","+e[1]+"%,"+e[2]+"%,"+t[3]+")"},toHex:function(){var t,e,i,n=this.getSource();return t=1===(t=n[0].toString(16)).length?"0"+t:t,e=1===(e=n[1].toString(16)).length?"0"+e:e,i=1===(i=n[2].toString(16)).length?"0"+i:i,t.toUpperCase()+e.toUpperCase()+i.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(t){var e=this.getSource();return e[3]=t,this.setSource(e),this},toGrayscale:function(){var t=this.getSource(),e=parseInt((.3*t[0]+.59*t[1]+.11*t[2]).toFixed(0),10),i=t[3];return this.setSource([e,e,e,i]),this},toBlackWhite:function(t){var e=this.getSource(),i=(.3*e[0]+.59*e[1]+.11*e[2]).toFixed(0),n=e[3];return t=t||127,i=Number(i)<Number(t)?0:255,this.setSource([i,i,i,n]),this},overlayWith:function(t){t instanceof i||(t=new i(t));for(var e=[],n=this.getAlpha(),r=this.getSource(),o=t.getSource(),s=0;s<3;s++)e.push(Math.round(.5*r[s]+.5*o[s]));return e[3]=n,this.setSource(e),this}},e.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,e.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,e.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,e.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",grey:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},e.Color.fromRgb=function(t){return i.fromSource(i.sourceFromRgb(t))},e.Color.sourceFromRgb=function(t){var e=t.match(i.reRGBa);if(e){var n=parseInt(e[1],10)/(/%$/.test(e[1])?100:1)*(/%$/.test(e[1])?255:1),r=parseInt(e[2],10)/(/%$/.test(e[2])?100:1)*(/%$/.test(e[2])?255:1),o=parseInt(e[3],10)/(/%$/.test(e[3])?100:1)*(/%$/.test(e[3])?255:1);return[parseInt(n,10),parseInt(r,10),parseInt(o,10),e[4]?parseFloat(e[4]):1]}},e.Color.fromRgba=i.fromRgb,e.Color.fromHsl=function(t){return i.fromSource(i.sourceFromHsl(t))},e.Color.sourceFromHsl=function(t){var e=t.match(i.reHSLa);if(e){var r,o,s,a=(parseFloat(e[1])%360+360)%360/360,c=parseFloat(e[2])/(/%$/.test(e[2])?100:1),l=parseFloat(e[3])/(/%$/.test(e[3])?100:1);if(0===c)r=o=s=l;else{var h=l<=.5?l*(c+1):l+c-l*c,u=2*l-h;r=n(u,h,a+1/3),o=n(u,h,a),s=n(u,h,a-1/3)}return[Math.round(255*r),Math.round(255*o),Math.round(255*s),e[4]?parseFloat(e[4]):1]}},e.Color.fromHsla=i.fromHsl,e.Color.fromHex=function(t){return i.fromSource(i.sourceFromHex(t))},e.Color.sourceFromHex=function(t){if(t.match(i.reHex)){var e=t.slice(t.indexOf("#")+1),n=3===e.length||4===e.length,r=8===e.length||4===e.length,o=n?e.charAt(0)+e.charAt(0):e.substring(0,2),s=n?e.charAt(1)+e.charAt(1):e.substring(2,4),a=n?e.charAt(2)+e.charAt(2):e.substring(4,6),c=r?n?e.charAt(3)+e.charAt(3):e.substring(6,8):"FF";return[parseInt(o,16),parseInt(s,16),parseInt(a,16),parseFloat((parseInt(c,16)/255).toFixed(2))]}},e.Color.fromSource=function(t){var e=new i;return e.setSource(t),e})}(exports),function(){function t(t){var e,i,n,r=t.getAttribute("style"),o=t.getAttribute("offset")||0;if(o=(o=parseFloat(o)/(/%$/.test(o)?100:1))<0?0:o>1?1:o,r){var s=r.split(/\s*;\s*/);""===s[s.length-1]&&s.pop();for(var a=s.length;a--;){var c=s[a].split(/\s*:\s*/),l=c[0].trim(),h=c[1].trim();"stop-color"===l?e=h:"stop-opacity"===l&&(n=h)}}return e||(e=t.getAttribute("stop-color")||"rgb(0,0,0)"),n||(n=t.getAttribute("stop-opacity")),i=(e=new fabric.Color(e)).getAlpha(),n=isNaN(parseFloat(n))?1:parseFloat(n),n*=i,{offset:o,color:e.toRgb(),opacity:n}}function e(t,e,i){var n,r=0,o=1,s="";for(var a in e)"Infinity"===e[a]?e[a]=1:"-Infinity"===e[a]&&(e[a]=0),n=parseFloat(e[a],10),o="string"==typeof e[a]&&/^\d+%$/.test(e[a])?.01:1,"x1"===a||"x2"===a||"r2"===a?(o*="objectBoundingBox"===i?t.width:1,r="objectBoundingBox"===i&&t.left||0):"y1"!==a&&"y2"!==a||(o*="objectBoundingBox"===i?t.height:1,r="objectBoundingBox"===i&&t.top||0),e[a]=n*o+r;if("ellipse"===t.type&&null!==e.r2&&"objectBoundingBox"===i&&t.rx!==t.ry){var c=t.ry/t.rx;s=" scale(1, "+c+")",e.y1&&(e.y1/=c),e.y2&&(e.y2/=c)}return s}fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,initialize:function(t){t||(t={});var e={};this.id=fabric.Object.__uid++,this.type=t.type||"linear",e={x1:t.coords.x1||0,y1:t.coords.y1||0,x2:t.coords.x2||0,y2:t.coords.y2||0},"radial"===this.type&&(e.r1=t.coords.r1||0,e.r2=t.coords.r2||0),this.coords=e,this.colorStops=t.colorStops.slice(),t.gradientTransform&&(this.gradientTransform=t.gradientTransform),this.offsetX=t.offsetX||this.offsetX,this.offsetY=t.offsetY||this.offsetY},addColorStop:function(t){for(var e in t){var i=new fabric.Color(t[e]);this.colorStops.push({offset:e,color:i.toRgb(),opacity:i.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform}},toSVG:function(t){var e,i,n=fabric.util.object.clone(this.coords);if(this.colorStops.sort(function(t,e){return t.offset-e.offset}),!t.group||"path-group"!==t.group.type)for(var r in n)"x1"===r||"x2"===r||"r2"===r?n[r]+=this.offsetX-t.width/2:"y1"!==r&&"y2"!==r||(n[r]+=this.offsetY-t.height/2);i='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"',this.gradientTransform&&(i+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" '),"linear"===this.type?e=["<linearGradient ",i,' x1="',n.x1,'" y1="',n.y1,'" x2="',n.x2,'" y2="',n.y2,'">\n']:"radial"===this.type&&(e=["<radialGradient ",i,' cx="',n.x2,'" cy="',n.y2,'" r="',n.r2,'" fx="',n.x1,'" fy="',n.y1,'">\n']);for(var o=0;o<this.colorStops.length;o++)e.push("<stop ",'offset="',100*this.colorStops[o].offset+"%",'" style="stop-color:',this.colorStops[o].color,null!==this.colorStops[o].opacity?";stop-opacity: "+this.colorStops[o].opacity:";",'"/>\n');return e.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),e.join("")},toLive:function(t,e){var i,n,r=fabric.util.object.clone(this.coords);if(this.type){if(e.group&&"path-group"===e.group.type)for(n in r)"x1"===n||"x2"===n?r[n]+=-this.offsetX+e.width/2:"y1"!==n&&"y2"!==n||(r[n]+=-this.offsetY+e.height/2);"linear"===this.type?i=t.createLinearGradient(r.x1,r.y1,r.x2,r.y2):"radial"===this.type&&(i=t.createRadialGradient(r.x1,r.y1,r.r1,r.x2,r.y2,r.r2));for(var o=0,s=this.colorStops.length;o<s;o++){var a=this.colorStops[o].color,c=this.colorStops[o].opacity,l=this.colorStops[o].offset;void 0!==c&&(a=new fabric.Color(a).setAlpha(c).toRgba()),i.addColorStop(parseFloat(l),a)}return i}}}),fabric.util.object.extend(fabric.Gradient,{fromElement:function(i,n){var r,o,s,a=i.getElementsByTagName("stop"),c=i.getAttribute("gradientUnits")||"objectBoundingBox",l=i.getAttribute("gradientTransform"),h=[];"linear"===(r="linearGradient"===i.nodeName||"LINEARGRADIENT"===i.nodeName?"linear":"radial")?o=function(t){return{x1:t.getAttribute("x1")||0,y1:t.getAttribute("y1")||0,x2:t.getAttribute("x2")||"100%",y2:t.getAttribute("y2")||0}}(i):"radial"===r&&(o=function(t){return{x1:t.getAttribute("fx")||t.getAttribute("cx")||"50%",y1:t.getAttribute("fy")||t.getAttribute("cy")||"50%",r1:0,x2:t.getAttribute("cx")||"50%",y2:t.getAttribute("cy")||"50%",r2:t.getAttribute("r")||"50%"}}(i));for(var u=a.length;u--;)h.push(t(a[u]));s=e(n,o,c);var f=new fabric.Gradient({type:r,coords:o,colorStops:h,offsetX:-n.left,offsetY:-n.top});return(l||""!==s)&&(f.gradientTransform=fabric.parseTransformAttribute((l||"")+s)),f},forObject:function(t,i){return i||(i={}),e(t,i.coords,"userSpaceOnUse"),new fabric.Gradient(i)}})}(),fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(t){if(t||(t={}),this.id=fabric.Object.__uid++,t.source)if("string"==typeof t.source)if(void 0!==fabric.util.getFunctionBody(t.source))this.source=new Function(fabric.util.getFunctionBody(t.source));else{var e=this;this.source=fabric.util.createImage(),fabric.util.loadImage(t.source,function(t){e.source=t})}else this.source=t.source;t.repeat&&(this.repeat=t.repeat),t.offsetX&&(this.offsetX=t.offsetX),t.offsetY&&(this.offsetY=t.offsetY)},toObject:function(){var t;return"function"==typeof this.source?t=String(this.source):"string"==typeof this.source.src?t=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(t=this.source.toDataURL()),{source:t,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(t){var e="function"==typeof this.source?this.source():this.source,i=e.width/t.getWidth(),n=e.height/t.getHeight(),r=this.offsetX/t.getWidth(),o=this.offsetY/t.getHeight(),s="";return"repeat-x"!==this.repeat&&"no-repeat"!==this.repeat||(n=1),"repeat-y"!==this.repeat&&"no-repeat"!==this.repeat||(i=1),e.src?s=e.src:e.toDataURL&&(s=e.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+r+'" y="'+o+'" width="'+i+'" height="'+n+'">\n<image x="0" y="0" width="'+e.width+'" height="'+e.height+'" xlink:href="'+s+'"></image>\n</pattern>\n'},toLive:function(t){var e="function"==typeof this.source?this.source():this.source;if(!e)return"";if(void 0!==e.src){if(!e.complete)return"";if(0===e.naturalWidth||0===e.naturalHeight)return""}return t.createPattern(e,this.repeat)}}),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.toFixed;e.Shadow?e.warn("fabric.Shadow is already defined."):(e.Shadow=e.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(t){for(var i in"string"==typeof t&&(t=this._parseShadow(t)),t)this[i]=t[i];this.id=e.Object.__uid++},_parseShadow:function(t){var i=t.trim(),n=e.Shadow.reOffsetsAndBlur.exec(i)||[];return{color:(i.replace(e.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseInt(n[1],10)||0,offsetY:parseInt(n[2],10)||0,blur:parseInt(n[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(t){var n=40,r=40,o=e.Object.NUM_FRACTION_DIGITS,s=e.util.rotateVector({x:this.offsetX,y:this.offsetY},e.util.degreesToRadians(-t.angle));return t.width&&t.height&&(n=100*i((Math.abs(s.x)+this.blur)/t.width,o)+20,r=100*i((Math.abs(s.y)+this.blur)/t.height,o)+20),t.flipX&&(s.x*=-1),t.flipY&&(s.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+r+'%" height="'+(100+2*r)+'%" x="-'+n+'%" width="'+(100+2*n)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+i(this.blur?this.blur/2:0,o)+'"></feGaussianBlur>\n\t<feOffset dx="'+i(s.x,o)+'" dy="'+i(s.y,o)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+this.color+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke};var t={},i=e.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke"].forEach(function(e){this[e]!==i[e]&&(t[e]=this[e])},this),t}}),e.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/)}(exports),function(){"use strict";if(fabric.StaticCanvas)fabric.warn("fabric.StaticCanvas is already defined.");else{var t=fabric.util.object.extend,e=fabric.util.getElementOffset,i=fabric.util.removeFromArray,n=fabric.util.toFixed,r=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(t,e){e||(e={}),this._initStatic(t,e)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:[1,0,0,1,0,0],backgroundVpt:!0,overlayVpt:!0,onBeforeScaleRotate:function(){},enableRetinaScaling:!0,_initStatic:function(t,e){var i=fabric.StaticCanvas.prototype.renderAll.bind(this);this._objects=[],this._createLowerCanvas(t),this._initOptions(e),this._setImageSmoothing(),this.interactive||this._initRetinaScaling(),e.overlayImage&&this.setOverlayImage(e.overlayImage,i),e.backgroundImage&&this.setBackgroundImage(e.backgroundImage,i),e.backgroundColor&&this.setBackgroundColor(e.backgroundColor,i),e.overlayColor&&this.setOverlayColor(e.overlayColor,i),this.calcOffset()},_isRetinaScaling:function(){return 1!==fabric.devicePixelRatio&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?fabric.devicePixelRatio:1},_initRetinaScaling:function(){this._isRetinaScaling()&&(this.lowerCanvasEl.setAttribute("width",this.width*fabric.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio),this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio))},calcOffset:function(){return this._offset=e(this.lowerCanvasEl),this},setOverlayImage:function(t,e,i){return this.__setBgOverlayImage("overlayImage",t,e,i)},setBackgroundImage:function(t,e,i){return this.__setBgOverlayImage("backgroundImage",t,e,i)},setOverlayColor:function(t,e){return this.__setBgOverlayColor("overlayColor",t,e)},setBackgroundColor:function(t,e){return this.__setBgOverlayColor("backgroundColor",t,e)},_setImageSmoothing:function(){var t=this.getContext();t.imageSmoothingEnabled=t.imageSmoothingEnabled||t.webkitImageSmoothingEnabled||t.mozImageSmoothingEnabled||t.msImageSmoothingEnabled||t.oImageSmoothingEnabled,t.imageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(t,e,i,n){return"string"==typeof e?fabric.util.loadImage(e,function(e){e&&(this[t]=new fabric.Image(e,n)),i&&i(e)},this,n&&n.crossOrigin):(n&&e.setOptions(n),this[t]=e,i&&i(e)),this},__setBgOverlayColor:function(t,e,i){if(e&&e.source){var n=this;fabric.util.loadImage(e.source,function(r){n[t]=new fabric.Pattern({source:r,repeat:e.repeat,offsetX:e.offsetX,offsetY:e.offsetY}),i&&i()})}else this[t]=e,i&&i();return this},_createCanvasElement:function(t){var e=fabric.util.createCanvasElement(t);if(e.style||(e.style={}),!e)throw r;if(void 0===e.getContext)throw r;return e},_initOptions:function(t){for(var e in t)this[e]=t[e];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0,this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0,this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(t){this.lowerCanvasEl=fabric.util.getById(t)||this._createCanvasElement(t),fabric.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(t,e){return this.setDimensions({width:t},e)},setHeight:function(t,e){return this.setDimensions({height:t},e)},setDimensions:function(t,e){var i;for(var n in e=e||{},t)i=t[n],e.cssOnly||(this._setBackstoreDimension(n,t[n]),i+="px"),e.backstoreOnly||this._setCssDimension(n,i);return this._initRetinaScaling(),this._setImageSmoothing(),this.calcOffset(),e.cssOnly||this.renderAll(),this},_setBackstoreDimension:function(t,e){return this.lowerCanvasEl[t]=e,this.upperCanvasEl&&(this.upperCanvasEl[t]=e),this.cacheCanvasEl&&(this.cacheCanvasEl[t]=e),this[t]=e,this},_setCssDimension:function(t,e){return this.lowerCanvasEl.style[t]=e,this.upperCanvasEl&&(this.upperCanvasEl.style[t]=e),this.wrapperEl&&(this.wrapperEl.style[t]=e),this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(t){var e,i=this._activeGroup;this.viewportTransform=t;for(var n=0,r=this._objects.length;n<r;n++)(e=this._objects[n]).group||e.setCoords();return i&&i.setCoords(),this.renderAll(),this},zoomToPoint:function(t,e){var i=t,n=this.viewportTransform.slice(0);t=fabric.util.transformPoint(t,fabric.util.invertTransform(this.viewportTransform)),n[0]=e,n[3]=e;var r=fabric.util.transformPoint(t,n);return n[4]+=i.x-r.x,n[5]+=i.y-r.y,this.setViewportTransform(n)},setZoom:function(t){return this.zoomToPoint(new fabric.Point(0,0),t),this},absolutePan:function(t){var e=this.viewportTransform.slice(0);return e[4]=-t.x,e[5]=-t.y,this.setViewportTransform(e)},relativePan:function(t){return this.absolutePan(new fabric.Point(-t.x-this.viewportTransform[4],-t.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(t){this.stateful&&t.setupState(),t._set("canvas",this),t.setCoords(),this.fire("object:added",{target:t}),t.fire("added")},_onObjectRemoved:function(t){this.fire("object:removed",{target:t}),t.fire("removed"),delete t.canvas},clearContext:function(t){return t.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("selection:cleared",this._canvasITextSelectionClearedHanlder),this.off("object:selected",this._canvasITextSelectionClearedHanlder),this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderAll(),this},renderAll:function(){var t=this.contextContainer;return this.renderCanvas(t,this._objects),this},renderCanvas:function(t,e){this.clearContext(t),this.fire("before:render"),this.clipTo&&fabric.util.clipContext(this,t),this._renderBackground(t),t.save(),t.transform.apply(t,this.viewportTransform),this._renderObjects(t,e),t.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),this.clipTo&&t.restore(),this._renderOverlay(t),this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),this.fire("after:render")},_renderObjects:function(t,e){for(var i=0,n=e.length;i<n;++i)e[i]&&e[i].render(t)},_renderBackgroundOrOverlay:function(t,e){var i=this[e+"Color"];i&&(t.fillStyle=i.toLive?i.toLive(t):i,t.fillRect(i.offsetX||0,i.offsetY||0,this.width,this.height)),(i=this[e+"Image"])&&(this[e+"Vpt"]&&(t.save(),t.transform.apply(t,this.viewportTransform)),i.render(t),this[e+"Vpt"]&&t.restore())},_renderBackground:function(t){this._renderBackgroundOrOverlay(t,"background")},_renderOverlay:function(t){this._renderBackgroundOrOverlay(t,"overlay")},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(t){return this._centerObject(t,new fabric.Point(this.getCenter().left,t.getCenterPoint().y))},centerObjectV:function(t){return this._centerObject(t,new fabric.Point(t.getCenterPoint().x,this.getCenter().top))},centerObject:function(t){var e=this.getCenter();return this._centerObject(t,new fabric.Point(e.left,e.top))},viewportCenterObject:function(t){var e=this.getVpCenter();return this._centerObject(t,e)},viewportCenterObjectH:function(t){var e=this.getVpCenter();return this._centerObject(t,new fabric.Point(e.x,t.getCenterPoint().y)),this},viewportCenterObjectV:function(t){var e=this.getVpCenter();return this._centerObject(t,new fabric.Point(t.getCenterPoint().x,e.y))},getVpCenter:function(){var t=this.getCenter(),e=fabric.util.invertTransform(this.viewportTransform);return fabric.util.transformPoint({x:t.left,y:t.top},e)},_centerObject:function(t,e){return t.setPositionByOrigin(e,"center","center"),this.renderAll(),this},toDatalessJSON:function(t){return this.toDatalessObject(t)},toObject:function(t){return this._toObjectMethod("toObject",t)},toDatalessObject:function(t){return this._toObjectMethod("toDatalessObject",t)},_toObjectMethod:function(e,i){var n={objects:this._toObjects(e,i)};return t(n,this.__serializeBgOverlay(e,i)),fabric.util.populateWithProperties(this,n,i),n},_toObjects:function(t,e){return this.getObjects().filter(function(t){return!t.excludeFromExport}).map(function(i){return this._toObject(i,t,e)},this)},_toObject:function(t,e,i){var n;this.includeDefaultValues||(n=t.includeDefaultValues,t.includeDefaultValues=!1);var r=t[e](i);return this.includeDefaultValues||(t.includeDefaultValues=n),r},__serializeBgOverlay:function(t,e){var i={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject(e):this.backgroundColor};return this.overlayColor&&(i.overlay=this.overlayColor.toObject?this.overlayColor.toObject(e):this.overlayColor),this.backgroundImage&&(i.backgroundImage=this._toObject(this.backgroundImage,t,e)),this.overlayImage&&(i.overlayImage=this._toObject(this.overlayImage,t,e)),i},svgViewportTransformation:!0,toSVG:function(t,e){t||(t={});var i=[];return this._setSVGPreamble(i,t),this._setSVGHeader(i,t),this._setSVGBgOverlayColor(i,"backgroundColor"),this._setSVGBgOverlayImage(i,"backgroundImage",e),this._setSVGObjects(i,e),this._setSVGBgOverlayColor(i,"overlayColor"),this._setSVGBgOverlayImage(i,"overlayImage",e),i.push("</svg>"),i.join("")},_setSVGPreamble:function(t,e){e.suppressPreamble||t.push('<?xml version="1.0" encoding="',e.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(t,e){var i,r=e.width||this.width,o=e.height||this.height,s='viewBox="0 0 '+this.width+" "+this.height+'" ',a=fabric.Object.NUM_FRACTION_DIGITS;e.viewBox?s='viewBox="'+e.viewBox.x+" "+e.viewBox.y+" "+e.viewBox.width+" "+e.viewBox.height+'" ':this.svgViewportTransformation&&(i=this.viewportTransform,s='viewBox="'+n(-i[4]/i[0],a)+" "+n(-i[5]/i[3],a)+" "+n(this.width/i[0],a)+" "+n(this.height/i[3],a)+'" '),t.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',r,'" ','height="',o,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,s,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",fabric.version,"</desc>\n","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>\n")},_setSVGObjects:function(t,e){for(var i,n=0,r=this.getObjects(),o=r.length;n<o;n++)(i=r[n]).excludeFromExport||this._setSVGObject(t,i,e)},_setSVGObject:function(t,e,i){t.push(e.toSVG(i))},_setSVGBgOverlayImage:function(t,e,i){this[e]&&this[e].toSVG&&t.push(this[e].toSVG(i))},_setSVGBgOverlayColor:function(t,e){this[e]&&this[e].source?t.push('<rect x="',this[e].offsetX,'" y="',this[e].offsetY,'" ','width="',"repeat-y"===this[e].repeat||"no-repeat"===this[e].repeat?this[e].source.width:this.width,'" height="',"repeat-x"===this[e].repeat||"no-repeat"===this[e].repeat?this[e].source.height:this.height,'" fill="url(#'+e+'Pattern)"',"></rect>\n"):this[e]&&"overlayColor"===e&&t.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[e],'"',"></rect>\n")},sendToBack:function(t){if(!t)return this;var e,n,r,o=this._activeGroup;if(t===o)for(e=(r=o._objects).length;e--;)n=r[e],i(this._objects,n),this._objects.unshift(n);else i(this._objects,t),this._objects.unshift(t);return this.renderAll&&this.renderAll()},bringToFront:function(t){if(!t)return this;var e,n,r,o=this._activeGroup;if(t===o)for(r=o._objects,e=0;e<r.length;e++)n=r[e],i(this._objects,n),this._objects.push(n);else i(this._objects,t),this._objects.push(t);return this.renderAll&&this.renderAll()},sendBackwards:function(t,e){if(!t)return this;var n,r,o,s,a,c=this._activeGroup;if(t===c)for(a=c._objects,n=0;n<a.length;n++)r=a[n],0!==(o=this._objects.indexOf(r))&&(s=o-1,i(this._objects,r),this._objects.splice(s,0,r));else 0!==(o=this._objects.indexOf(t))&&(s=this._findNewLowerIndex(t,o,e),i(this._objects,t),this._objects.splice(s,0,t));return this.renderAll&&this.renderAll(),this},_findNewLowerIndex:function(t,e,i){var n;if(i){n=e;for(var r=e-1;r>=0;--r){if(t.intersectsWithObject(this._objects[r])||t.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(t)){n=r;break}}}else n=e-1;return n},bringForward:function(t,e){if(!t)return this;var n,r,o,s,a,c=this._activeGroup;if(t===c)for(n=(a=c._objects).length;n--;)r=a[n],(o=this._objects.indexOf(r))!==this._objects.length-1&&(s=o+1,i(this._objects,r),this._objects.splice(s,0,r));else(o=this._objects.indexOf(t))!==this._objects.length-1&&(s=this._findNewUpperIndex(t,o,e),i(this._objects,t),this._objects.splice(s,0,t));return this.renderAll&&this.renderAll(),this},_findNewUpperIndex:function(t,e,i){var n;if(i){n=e;for(var r=e+1;r<this._objects.length;++r){if(t.intersectsWithObject(this._objects[r])||t.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(t)){n=r;break}}}else n=e+1;return n},moveTo:function(t,e){return i(this._objects,t),this._objects.splice(e,0,t),this.renderAll&&this.renderAll()},dispose:function(){return this.clear(),this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}}),t(fabric.StaticCanvas.prototype,fabric.Observable),t(fabric.StaticCanvas.prototype,fabric.Collection),t(fabric.StaticCanvas.prototype,fabric.DataURLExporter),t(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(t){var e=fabric.util.createCanvasElement();if(!e||!e.getContext)return null;var i=e.getContext("2d");if(!i)return null;switch(t){case"getImageData":return void 0!==i.getImageData;case"setLineDash":return void 0!==i.setLineDash;case"toDataURL":return void 0!==e.toDataURL;case"toDataURLWithQuality":try{return e.toDataURL("image/jpeg",0),!0}catch(t){}return!1;default:return null}}}),fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}}(),fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeDashArray:null,setShadow:function(t){return this.shadow=new fabric.Shadow(t),this},_setBrushStyles:function(){var t=this.canvas.contextTop;t.strokeStyle=this.color,t.lineWidth=this.width,t.lineCap=this.strokeLineCap,t.lineJoin=this.strokeLineJoin,this.strokeDashArray&&fabric.StaticCanvas.supports("setLineDash")&&t.setLineDash(this.strokeDashArray)},_setShadow:function(){if(this.shadow){var t=this.canvas.contextTop;t.shadowColor=this.shadow.color,t.shadowBlur=this.shadow.blur,t.shadowOffsetX=this.shadow.offsetX,t.shadowOffsetY=this.shadow.offsetY}},_resetShadow:function(){var t=this.canvas.contextTop;t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0}}),fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(t){this.canvas=t,this._points=[]},onMouseDown:function(t){this._prepareForDrawing(t),this._captureDrawingPath(t),this._render()},onMouseMove:function(t){this._captureDrawingPath(t),this.canvas.clearContext(this.canvas.contextTop),this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(t){var e=new fabric.Point(t.x,t.y);this._reset(),this._addPoint(e),this.canvas.contextTop.moveTo(e.x,e.y)},_addPoint:function(t){this._points.push(t)},_reset:function(){this._points.length=0,this._setBrushStyles(),this._setShadow()},_captureDrawingPath:function(t){var e=new fabric.Point(t.x,t.y);this._addPoint(e)},_render:function(){var t=this.canvas.contextTop,e=this.canvas.viewportTransform,i=this._points[0],n=this._points[1];t.save(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5]),t.beginPath(),2===this._points.length&&i.x===n.x&&i.y===n.y&&(i.x-=.5,n.x+=.5),t.moveTo(i.x,i.y);for(var r=1,o=this._points.length;r<o;r++){var s=i.midPointFrom(n);t.quadraticCurveTo(i.x,i.y,s.x,s.y),i=this._points[r],n=this._points[r+1]}t.lineTo(i.x,i.y),t.stroke(),t.restore()},convertPointsToSVGPath:function(t){var e=[],i=new fabric.Point(t[0].x,t[0].y),n=new fabric.Point(t[1].x,t[1].y);e.push("M ",t[0].x," ",t[0].y," ");for(var r=1,o=t.length;r<o;r++){var s=i.midPointFrom(n);e.push("Q ",i.x," ",i.y," ",s.x," ",s.y," "),i=new fabric.Point(t[r].x,t[r].y),r+1<t.length&&(n=new fabric.Point(t[r+1].x,t[r+1].y))}return e.push("L ",i.x," ",i.y," "),e},createPath:function(t){var e=new fabric.Path(t,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,originX:"center",originY:"center"});return this.shadow&&(this.shadow.affectStroke=!0,e.setShadow(this.shadow)),e},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath();var t=this.convertPointsToSVGPath(this._points).join("");if("M 0 0 Q 0 0 0 0 L 0 0"!==t){var e=this.createPath(t);this.canvas.add(e),e.setCoords(),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderAll(),this.canvas.fire("path:created",{path:e})}else this.canvas.renderAll()}}),fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(t){this.canvas=t,this.points=[]},drawDot:function(t){var e=this.addPoint(t),i=this.canvas.contextTop,n=this.canvas.viewportTransform;i.save(),i.transform(n[0],n[1],n[2],n[3],n[4],n[5]),i.fillStyle=e.fill,i.beginPath(),i.arc(e.x,e.y,e.radius,0,2*Math.PI,!1),i.closePath(),i.fill(),i.restore()},onMouseDown:function(t){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(t)},onMouseMove:function(t){this.drawDot(t)},onMouseUp:function(){var t=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var e=[],i=0,n=this.points.length;i<n;i++){var r=this.points[i],o=new fabric.Circle({radius:r.radius,left:r.x,top:r.y,originX:"center",originY:"center",fill:r.fill});this.shadow&&o.setShadow(this.shadow),e.push(o)}var s=new fabric.Group(e,{originX:"center",originY:"center"});s.canvas=this.canvas,this.canvas.add(s),this.canvas.fire("path:created",{path:s}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=t,this.canvas.renderAll()},addPoint:function(t){var e=new fabric.Point(t.x,t.y),i=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,n=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return e.radius=i,e.fill=n,this.points.push(e),e}}),fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(t){this.canvas=t,this.sprayChunks=[]},onMouseDown:function(t){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(t),this.render()},onMouseMove:function(t){this.addSprayChunk(t),this.render()},onMouseUp:function(){var t=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var e=[],i=0,n=this.sprayChunks.length;i<n;i++)for(var r=this.sprayChunks[i],o=0,s=r.length;o<s;o++){var a=new fabric.Rect({width:r[o].width,height:r[o].width,left:r[o].x+1,top:r[o].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&a.setShadow(this.shadow),e.push(a)}this.optimizeOverlapping&&(e=this._getOptimizedRects(e));var c=new fabric.Group(e,{originX:"center",originY:"center"});c.canvas=this.canvas,this.canvas.add(c),this.canvas.fire("path:created",{path:c}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=t,this.canvas.renderAll()},_getOptimizedRects:function(t){for(var e,i={},n=0,r=t.length;n<r;n++)i[e=t[n].left+""+t[n].top]||(i[e]=t[n]);var o=[];for(e in i)o.push(i[e]);return o},render:function(){var t=this.canvas.contextTop;t.fillStyle=this.color;var e=this.canvas.viewportTransform;t.save(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5]);for(var i=0,n=this.sprayChunkPoints.length;i<n;i++){var r=this.sprayChunkPoints[i];void 0!==r.opacity&&(t.globalAlpha=r.opacity),t.fillRect(r.x,r.y,r.width,r.width)}t.restore()},addSprayChunk:function(t){this.sprayChunkPoints=[];for(var e,i,n,r=this.width/2,o=0;o<this.density;o++){e=fabric.util.getRandomInt(t.x-r,t.x+r),i=fabric.util.getRandomInt(t.y-r,t.y+r),n=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var s=new fabric.Point(e,i);s.width=n,this.randomOpacity&&(s.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(s)}this.sprayChunks.push(this.sprayChunkPoints)}}),fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var t=fabric.document.createElement("canvas"),e=t.getContext("2d");return t.width=t.height=25,e.fillStyle=this.color,e.beginPath(),e.arc(10,10,10,0,2*Math.PI,!1),e.closePath(),e.fill(),t},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(t){var e=this.callSuper("createPath",t),i=e._getLeftTopCoords().scalarAdd(e.strokeWidth/2);return e.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-i.x,offsetY:-i.y}),e}}),function(){var t=fabric.util.getPointer,e=fabric.util.degreesToRadians,i=fabric.util.radiansToDegrees,n=Math.atan2,r=Math.abs,o=fabric.StaticCanvas.supports("setLineDash");for(var s in fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(t,e){e||(e={}),this._initStatic(t,e),this._initInteractive(),this._createCacheCanvas()},uniScaleTransform:!1,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var t,e=this.getActiveGroup(),i=this.getActiveObject(),n=[],r=[];if(!e&&!i||this.preserveObjectStacking)n=this._objects;else{for(var o=0,s=this._objects.length;o<s;o++)t=this._objects[o],e&&e.contains(t)||t===i?r.push(t):n.push(t);e&&(e._set("_objects",r),n.push(e)),i&&n.push(i)}return n},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1);var t=this.contextContainer;return this.renderCanvas(t,this._chooseObjectsToRender()),this},renderTop:function(){var t=this.contextTop;return this.clearContext(t),this.selection&&this._groupSelector&&this._drawSelection(t),this.fire("after:render"),this.contextTopDirty=!0,this},_resetCurrentTransform:function(){var t=this._currentTransform;t.target.set({scaleX:t.original.scaleX,scaleY:t.original.scaleY,skewX:t.original.skewX,skewY:t.original.skewY,left:t.original.left,top:t.original.top}),this._shouldCenterTransform(t.target)?"rotate"===t.action?this._setOriginToCenter(t.target):("center"!==t.originX&&("right"===t.originX?t.mouseXSign=-1:t.mouseXSign=1),"center"!==t.originY&&("bottom"===t.originY?t.mouseYSign=-1:t.mouseYSign=1),t.originX="center",t.originY="center"):(t.originX=t.original.originX,t.originY=t.original.originY)},containsPoint:function(t,e,i){var n,r=i||this.getPointer(t,!0);return n=e.group&&e.group===this.getActiveGroup()?this._normalizePointer(e.group,r):{x:r.x,y:r.y},e.containsPoint(n)||e._findTargetCorner(r)},_normalizePointer:function(t,e){var i=t.calcTransformMatrix(),n=fabric.util.invertTransform(i),r=this.viewportTransform,o=this.restorePointerVpt(e),s=fabric.util.transformPoint(o,n);return fabric.util.transformPoint(s,r)},isTargetTransparent:function(t,e,i){var n=t.hasBorders,r=t.transparentCorners,o=this.contextCache,s=t.selectionBackgroundColor;t.hasBorders=t.transparentCorners=!1,t.selectionBackgroundColor="",o.save(),o.transform.apply(o,this.viewportTransform),t.render(o),o.restore(),t.active&&t._renderControls(o),t.hasBorders=n,t.transparentCorners=r,t.selectionBackgroundColor=s;var a=fabric.util.isTransparent(o,e,i,this.targetFindTolerance);return this.clearContext(o),a},_shouldClearSelection:function(t,e){var i=this.getActiveGroup(),n=this.getActiveObject();return!e||e&&i&&!i.contains(e)&&i!==e&&!t[this.selectionKey]||e&&!e.evented||e&&!e.selectable&&n&&n!==e},_shouldCenterTransform:function(t){if(t){var e,i=this._currentTransform;return"scale"===i.action||"scaleX"===i.action||"scaleY"===i.action?e=this.centeredScaling||t.centeredScaling:"rotate"===i.action&&(e=this.centeredRotation||t.centeredRotation),e?!i.altKey:i.altKey}},_getOriginFromCorner:function(t,e){var i={x:t.originX,y:t.originY};return"ml"===e||"tl"===e||"bl"===e?i.x="right":"mr"!==e&&"tr"!==e&&"br"!==e||(i.x="left"),"tl"===e||"mt"===e||"tr"===e?i.y="bottom":"bl"!==e&&"mb"!==e&&"br"!==e||(i.y="top"),i},_getActionFromCorner:function(t,e,i){if(!e)return"drag";switch(e){case"mtr":return"rotate";case"ml":case"mr":return i[this.altActionKey]?"skewY":"scaleX";case"mt":case"mb":return i[this.altActionKey]?"skewX":"scaleY";default:return"scale"}},_setupCurrentTransform:function(t,i){if(i){var n=this.getPointer(t),r=i._findTargetCorner(this.getPointer(t,!0)),o=this._getActionFromCorner(i,r,t),s=this._getOriginFromCorner(i,r);this._currentTransform={target:i,action:o,corner:r,scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY,offsetX:n.x-i.left,offsetY:n.y-i.top,originX:s.x,originY:s.y,ex:n.x,ey:n.y,lastX:n.x,lastY:n.y,left:i.left,top:i.top,theta:e(i.angle),width:i.width*i.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:t.shiftKey,altKey:t[this.centeredKey]},this._currentTransform.original={left:i.left,top:i.top,scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY,originX:s.x,originY:s.y},this._resetCurrentTransform()}},_translateObject:function(t,e){var i=this._currentTransform,n=i.target,r=t-i.offsetX,o=e-i.offsetY,s=!n.get("lockMovementX")&&n.left!==r,a=!n.get("lockMovementY")&&n.top!==o;return s&&n.set("left",r),a&&n.set("top",o),s||a},_changeSkewTransformOrigin:function(t,e,i){var n="originX",r={0:"center"},o=e.target.skewX,s="left",a="right",c="mt"===e.corner||"ml"===e.corner?1:-1,l=1;t=t>0?1:-1,"y"===i&&(o=e.target.skewY,s="top",a="bottom",n="originY"),r[-1]=s,r[1]=a,e.target.flipX&&(l*=-1),e.target.flipY&&(l*=-1),0===o?(e.skewSign=-c*t*l,e[n]=r[-t]):(o=o>0?1:-1,e.skewSign=o,e[n]=r[o*c*l])},_skewObject:function(t,e,i){var n,r=this._currentTransform,o=r.target,s=o.get("lockSkewingX"),a=o.get("lockSkewingY");if(s&&"x"===i||a&&"y"===i)return!1;var c,l,h=o.getCenterPoint(),u=o.toLocalPoint(new fabric.Point(t,e),"center","center")[i],f=o.toLocalPoint(new fabric.Point(r.lastX,r.lastY),"center","center")[i],d=o._getTransformedDimensions();return this._changeSkewTransformOrigin(u-f,r,i),c=o.toLocalPoint(new fabric.Point(t,e),r.originX,r.originY)[i],l=o.translateToOriginPoint(h,r.originX,r.originY),n=this._setObjectSkew(c,r,i,d),r.lastX=t,r.lastY=e,o.setPositionByOrigin(l,r.originX,r.originY),n},_setObjectSkew:function(t,e,i,n){var r,o,s,a,c,l,h,u,f,d,p=e.target,g=e.skewSign;return"x"===i?(c="y",l="Y",h="X",f=0,d=p.skewY):(c="x",l="X",h="Y",f=p.skewX,d=0),a=p._getTransformedDimensions(f,d),(u=2*Math.abs(t)-a[i])<=2?r=0:(r=g*Math.atan(u/p["scale"+h]/(a[c]/p["scale"+l])),r=fabric.util.radiansToDegrees(r)),o=p["skew"+h]!==r,p.set("skew"+h,r),0!==p["skew"+l]&&(s=p._getTransformedDimensions(),r=n[c]/s[c]*p["scale"+l],p.set("scale"+l,r)),o},_scaleObject:function(t,e,i){var n=this._currentTransform,r=n.target,o=r.get("lockScalingX"),s=r.get("lockScalingY"),a=r.get("lockScalingFlip");if(o&&s)return!1;var c,l=r.translateToOriginPoint(r.getCenterPoint(),n.originX,n.originY),h=r.toLocalPoint(new fabric.Point(t,e),n.originX,n.originY),u=r._getTransformedDimensions();return this._setLocalMouse(h,n),c=this._setObjectScale(h,n,o,s,i,a,u),r.setPositionByOrigin(l,n.originX,n.originY),c},_setObjectScale:function(t,e,i,n,r,o,s){var a,c,l,h,u=e.target,f=!1,d=!1,p=!1;return l=t.x*u.scaleX/s.x,h=t.y*u.scaleY/s.y,a=u.scaleX!==l,c=u.scaleY!==h,o&&l<=0&&l<u.scaleX&&(f=!0),o&&h<=0&&h<u.scaleY&&(d=!0),"equally"!==r||i||n?r?"x"!==r||u.get("lockUniScaling")?"y"!==r||u.get("lockUniScaling")||d||n||u.set("scaleY",h)&&(p=p||c):f||i||u.set("scaleX",l)&&(p=p||a):(f||i||u.set("scaleX",l)&&(p=p||a),d||n||u.set("scaleY",h)&&(p=p||c)):f||d||(p=this._scaleObjectEqually(t,u,e,s)),e.newScaleX=l,e.newScaleY=h,f||d||this._flipObject(e,r),p},_scaleObjectEqually:function(t,e,i,n){var r,o=t.y+t.x,s=n.y*i.original.scaleY/e.scaleY+n.x*i.original.scaleX/e.scaleX;return i.newScaleX=i.original.scaleX*o/s,i.newScaleY=i.original.scaleY*o/s,r=i.newScaleX!==e.scaleX||i.newScaleY!==e.scaleY,e.set("scaleX",i.newScaleX),e.set("scaleY",i.newScaleY),r},_flipObject:function(t,e){t.newScaleX<0&&"y"!==e&&("left"===t.originX?t.originX="right":"right"===t.originX&&(t.originX="left")),t.newScaleY<0&&"x"!==e&&("top"===t.originY?t.originY="bottom":"bottom"===t.originY&&(t.originY="top"))},_setLocalMouse:function(t,e){var i=e.target;"right"===e.originX?t.x*=-1:"center"===e.originX&&(t.x*=2*e.mouseXSign,t.x<0&&(e.mouseXSign=-e.mouseXSign)),"bottom"===e.originY?t.y*=-1:"center"===e.originY&&(t.y*=2*e.mouseYSign,t.y<0&&(e.mouseYSign=-e.mouseYSign)),r(t.x)>i.padding?t.x<0?t.x+=i.padding:t.x-=i.padding:t.x=0,r(t.y)>i.padding?t.y<0?t.y+=i.padding:t.y-=i.padding:t.y=0},_rotateObject:function(t,e){var r=this._currentTransform;if(r.target.get("lockRotation"))return!1;var o=n(r.ey-r.top,r.ex-r.left),s=n(e-r.top,t-r.left),a=i(s-o+r.theta),c=!0;if(a<0&&(a=360+a),a%=360,r.target.snapAngle>0){var l=r.target.snapAngle,h=r.target.snapThreshold||l,u=Math.ceil(a/l)*l,f=Math.floor(a/l)*l;Math.abs(a-f)<h?a=f:Math.abs(a-u)<h&&(a=u),r.target.angle===a&&(c=!1)}return r.target.angle=a,c},setCursor:function(t){this.upperCanvasEl.style.cursor=t},_resetObjectTransform:function(t){t.scaleX=1,t.scaleY=1,t.skewX=0,t.skewY=0,t.setAngle(0)},_drawSelection:function(t){var e=this._groupSelector,i=e.left,n=e.top,s=r(i),a=r(n);if(this.selectionColor&&(t.fillStyle=this.selectionColor,t.fillRect(e.ex-(i>0?0:-i),e.ey-(n>0?0:-n),s,a)),this.selectionLineWidth&&this.selectionBorderColor)if(t.lineWidth=this.selectionLineWidth,t.strokeStyle=this.selectionBorderColor,this.selectionDashArray.length>1&&!o){var c=e.ex+.5-(i>0?0:s),l=e.ey+.5-(n>0?0:a);t.beginPath(),fabric.util.drawDashedLine(t,c,l,c+s,l,this.selectionDashArray),fabric.util.drawDashedLine(t,c,l+a-1,c+s,l+a-1,this.selectionDashArray),fabric.util.drawDashedLine(t,c,l,c,l+a,this.selectionDashArray),fabric.util.drawDashedLine(t,c+s-1,l,c+s-1,l+a,this.selectionDashArray),t.closePath(),t.stroke()}else fabric.Object.prototype._setLineDash.call(this,t,this.selectionDashArray),t.strokeRect(e.ex+.5-(i>0?0:s),e.ey+.5-(n>0?0:a),s,a)},findTarget:function(t,e){if(!this.skipTargetFind){var i,n=this.getPointer(t,!0),r=this.getActiveGroup(),o=this.getActiveObject();if(r&&!e&&this._checkTarget(n,r))return this._fireOverOutEvents(r,t),r;if(o&&o._findTargetCorner(n))return this._fireOverOutEvents(o,t),o;if(o&&this._checkTarget(n,o)){if(!this.preserveObjectStacking)return this._fireOverOutEvents(o,t),o;i=o}this.targets=[];var s=this._searchPossibleTargets(this._objects,n);return t[this.altSelectionKey]&&s&&i&&s!==i&&(s=i),this._fireOverOutEvents(s,t),s}},_fireOverOutEvents:function(t,e){t?this._hoveredTarget!==t&&(this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget,e:e}),this._hoveredTarget.fire("mouseout")),this.fire("mouse:over",{target:t,e:e}),t.fire("mouseover"),this._hoveredTarget=t):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget,e:e}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},_checkTarget:function(t,e){if(e&&e.visible&&e.evented&&this.containsPoint(null,e,t)){if(!this.perPixelTargetFind&&!e.perPixelTargetFind||e.isEditing)return!0;if(!this.isTargetTransparent(e,t.x,t.y))return!0}},_searchPossibleTargets:function(t,e){for(var i,n,r,o=t.length;o--;)if(this._checkTarget(e,t[o])){"group"===(i=t[o]).type&&i.subTargetCheck&&(n=this._normalizePointer(i,e),(r=this._searchPossibleTargets(i._objects,n))&&this.targets.push(r));break}return i},restorePointerVpt:function(t){return fabric.util.transformPoint(t,fabric.util.invertTransform(this.viewportTransform))},getPointer:function(e,i,n){n||(n=this.upperCanvasEl);var r,o=t(e),s=n.getBoundingClientRect(),a=s.width||0,c=s.height||0;return a&&c||("top"in s&&"bottom"in s&&(c=Math.abs(s.top-s.bottom)),"right"in s&&"left"in s&&(a=Math.abs(s.right-s.left))),this.calcOffset(),o.x=o.x-this._offset.left,o.y=o.y-this._offset.top,i||(o=this.restorePointerVpt(o)),r=0===a||0===c?{width:1,height:1}:{width:n.width/a,height:n.height/c},{x:o.x*r.width,y:o.y*r.height}},_createUpperCanvas:function(){var t=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement(),fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+t),this.wrapperEl.appendChild(this.upperCanvasEl),this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl),this._applyCanvasStyle(this.upperCanvasEl),this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"}),fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(t){var e=this.getWidth()||t.width,i=this.getHeight()||t.height;fabric.util.setStyle(t,{position:"absolute",width:e+"px",height:i+"px",left:0,top:0}),t.width=e,t.height=i,fabric.util.makeElementUnselectable(t)},_copyCanvasStyle:function(t,e){e.style.cssText=t.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(t){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=t,t.set("active",!0)},setActiveObject:function(t,e){return this._setActiveObject(t),this.renderAll(),this.fire("object:selected",{target:t,e:e}),t.fire("selected",{e:e}),this},getActiveObject:function(){return this._activeObject},_onObjectRemoved:function(t){this.getActiveObject()===t&&(this.fire("before:selection:cleared",{target:t}),this._discardActiveObject(),this.fire("selection:cleared",{target:t}),t.fire("deselected")),this.callSuper("_onObjectRemoved",t)},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=null},discardActiveObject:function(t){var e=this._activeObject;return this.fire("before:selection:cleared",{target:e,e:t}),this._discardActiveObject(),this.fire("selection:cleared",{e:t}),e&&e.fire("deselected",{e:t}),this},_setActiveGroup:function(t){this._activeGroup=t,t&&t.set("active",!0)},setActiveGroup:function(t,e){return this._setActiveGroup(t),t&&(this.fire("object:selected",{target:t,e:e}),t.fire("selected",{e:e})),this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var t=this.getActiveGroup();t&&t.destroy(),this.setActiveGroup(null)},discardActiveGroup:function(t){var e=this.getActiveGroup();return this.fire("before:selection:cleared",{e:t,target:e}),this._discardActiveGroup(),this.fire("selection:cleared",{e:t}),this},deactivateAll:function(){for(var t=this.getObjects(),e=0,i=t.length;e<i;e++)t[e].set("active",!1);return this._discardActiveGroup(),this._discardActiveObject(),this},deactivateAllWithDispatch:function(t){var e=this.getActiveGroup(),i=this.getActiveObject();return(i||e)&&this.fire("before:selection:cleared",{target:i||e,e:t}),this.deactivateAll(),(i||e)&&(this.fire("selection:cleared",{e:t,target:i}),i&&i.fire("deselected")),this},dispose:function(){this.callSuper("dispose");var t=this.wrapperEl;return this.removeListeners(),t.removeChild(this.upperCanvasEl),t.removeChild(this.lowerCanvasEl),delete this.upperCanvasEl,t.parentNode&&t.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,this},clear:function(){return this.discardActiveGroup(),this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(t){var e=this.getActiveGroup();e?e._renderControls(t):this._drawObjectsControls(t)},_drawObjectsControls:function(t){for(var e=0,i=this._objects.length;e<i;++e)this._objects[e]&&this._objects[e].active&&this._objects[e]._renderControls(t)},_toObject:function(t,e,i){var n=this._realizeGroupTransformOnObject(t),r=this.callSuper("_toObject",t,e,i);return this._unwindGroupTransformOnObject(t,n),r},_realizeGroupTransformOnObject:function(t){if(t.group&&t.group===this.getActiveGroup()){var e={};return["angle","flipX","flipY","height","left","scaleX","scaleY","top","width"].forEach(function(i){e[i]=t[i]}),this.getActiveGroup().realizeTransform(t),e}return null},_unwindGroupTransformOnObject:function(t,e){e&&t.set(e)},_setSVGObject:function(t,e,i){var n;n=this._realizeGroupTransformOnObject(e),this.callSuper("_setSVGObject",t,e,i),this._unwindGroupTransformOnObject(e,n)}}),fabric.StaticCanvas)"prototype"!==s&&(fabric.Canvas[s]=fabric.StaticCanvas[s]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){}),fabric.Element=fabric.Canvas}(),function(){var t={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},e=fabric.util.addListener,i=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this._bindEvents(),e(fabric.window,"resize",this._onResize),e(this.upperCanvasEl,"mousedown",this._onMouseDown),e(this.upperCanvasEl,"mousemove",this._onMouseMove),e(this.upperCanvasEl,"mouseout",this._onMouseOut),e(this.upperCanvasEl,"mouseenter",this._onMouseEnter),e(this.upperCanvasEl,"wheel",this._onMouseWheel),e(this.upperCanvasEl,"contextmenu",this._onContextMenu),e(this.upperCanvasEl,"touchstart",this._onMouseDown),e(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof eventjs&&"add"in eventjs&&(eventjs.add(this.upperCanvasEl,"gesture",this._onGesture),eventjs.add(this.upperCanvasEl,"drag",this._onDrag),eventjs.add(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.add(this.upperCanvasEl,"shake",this._onShake),eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this)},removeListeners:function(){i(fabric.window,"resize",this._onResize),i(this.upperCanvasEl,"mousedown",this._onMouseDown),i(this.upperCanvasEl,"mousemove",this._onMouseMove),i(this.upperCanvasEl,"mouseout",this._onMouseOut),i(this.upperCanvasEl,"mouseenter",this._onMouseEnter),i(this.upperCanvasEl,"wheel",this._onMouseWheel),i(this.upperCanvasEl,"contextmenu",this._onContextMenu),i(this.upperCanvasEl,"touchstart",this._onMouseDown),i(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof eventjs&&"remove"in eventjs&&(eventjs.remove(this.upperCanvasEl,"gesture",this._onGesture),eventjs.remove(this.upperCanvasEl,"drag",this._onDrag),eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.remove(this.upperCanvasEl,"shake",this._onShake),eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(t,e){this.__onTransformGesture&&this.__onTransformGesture(t,e)},_onDrag:function(t,e){this.__onDrag&&this.__onDrag(t,e)},_onMouseWheel:function(t){this.__onMouseWheel(t)},_onMouseOut:function(t){var e=this._hoveredTarget;this.fire("mouse:out",{target:e,e:t}),this._hoveredTarget=null,e&&e.fire("mouseout",{e:t})},_onMouseEnter:function(t){this.findTarget(t)||(this.fire("mouse:over",{target:null,e:t}),this._hoveredTarget=null)},_onOrientationChange:function(t,e){this.__onOrientationChange&&this.__onOrientationChange(t,e)},_onShake:function(t,e){this.__onShake&&this.__onShake(t,e)},_onLongPress:function(t,e){this.__onLongPress&&this.__onLongPress(t,e)},_onContextMenu:function(t){return this.stopContextMenu&&(t.stopPropagation(),t.preventDefault()),!1},_onMouseDown:function(t){this.__onMouseDown(t),e(fabric.document,"touchend",this._onMouseUp),e(fabric.document,"touchmove",this._onMouseMove),i(this.upperCanvasEl,"mousemove",this._onMouseMove),i(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchstart"===t.type?i(this.upperCanvasEl,"mousedown",this._onMouseDown):(e(fabric.document,"mouseup",this._onMouseUp),e(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(t){if(this.__onMouseUp(t),i(fabric.document,"mouseup",this._onMouseUp),i(fabric.document,"touchend",this._onMouseUp),i(fabric.document,"mousemove",this._onMouseMove),i(fabric.document,"touchmove",this._onMouseMove),e(this.upperCanvasEl,"mousemove",this._onMouseMove),e(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchend"===t.type){var n=this;setTimeout(function(){e(n.upperCanvasEl,"mousedown",n._onMouseDown)},400)}},_onMouseMove:function(t){!this.allowTouchScrolling&&t.preventDefault&&t.preventDefault(),this.__onMouseMove(t)},_onResize:function(){this.calcOffset()},_shouldRender:function(t,e){var i=this.getActiveGroup()||this.getActiveObject();return!!(t&&(t.isMoving||t!==i)||!t&&i||!t&&!i&&!this._groupSelector||e&&this._previousPointer&&this.selection&&(e.x!==this._previousPointer.x||e.y!==this._previousPointer.y))},__onMouseUp:function(t){var e,i=!0,n=this._currentTransform,r=this._groupSelector,o=!r||0===r.left&&0===r.top;if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(t);else{n&&(this._finalizeCurrentTransform(),i=!n.actionPerformed),e=i?this.findTarget(t,!0):n.target;var s=this._shouldRender(e,this.getPointer(t));e||!o?this._maybeGroupObjects(t):(this._groupSelector=null,this._currentTransform=null),e&&(e.isMoving=!1),this._handleCursorAndEvent(t,e,"up"),e&&(e.__corner=0),s&&this.renderAll()}},_handleCursorAndEvent:function(t,e,i){this._setCursorFromEvent(t,e),this._handleEvent(t,i,e||null)},_handleEvent:function(t,e,i){var n=void 0===typeof i?this.findTarget(t):i,r=this.targets||[],o={e:t,target:n,subTargets:r};this.fire("mouse:"+e,o),n&&n.fire("mouse"+e,o);for(var s=0;s<r.length;s++)r[s].fire("mouse"+e,o)},_finalizeCurrentTransform:function(){var t=this._currentTransform,e=t.target;e._scaling&&(e._scaling=!1),e.setCoords(),this._restoreOriginXY(e),(t.actionPerformed||this.stateful&&e.hasStateChanged())&&(this.fire("object:modified",{target:e}),e.fire("modified"))},_restoreOriginXY:function(t){if(this._previousOriginX&&this._previousOriginY){var e=t.translateToOriginPoint(t.getCenterPoint(),this._previousOriginX,this._previousOriginY);t.originX=this._previousOriginX,t.originY=this._previousOriginY,t.left=e.x,t.top=e.y,this._previousOriginX=null,this._previousOriginY=null}},_onMouseDownInDrawingMode:function(t){this._isCurrentlyDrawing=!0,this.discardActiveObject(t).renderAll(),this.clipTo&&fabric.util.clipContext(this,this.contextTop);var e=this.getPointer(t);this.freeDrawingBrush.onMouseDown(e),this._handleEvent(t,"down")},_onMouseMoveInDrawingMode:function(t){if(this._isCurrentlyDrawing){var e=this.getPointer(t);this.freeDrawingBrush.onMouseMove(e)}this.setCursor(this.freeDrawingCursor),this._handleEvent(t,"move")},_onMouseUpInDrawingMode:function(t){this._isCurrentlyDrawing=!1,this.clipTo&&this.contextTop.restore(),this.freeDrawingBrush.onMouseUp(),this._handleEvent(t,"up")},__onMouseDown:function(t){var e=this.findTarget(t),i=this.getPointer(t,!0);if("which"in t?3===t.which:2===t.button)this.fireRightClick&&this._handleEvent(t,"down",e||null);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(t);else if(!this._currentTransform){this._previousPointer=i;var n=this._shouldRender(e,i),r=this._shouldGroup(t,e);this._shouldClearSelection(t,e)?this._clearSelection(t,e,i):r&&(this._handleGrouping(t,e),e=this.getActiveGroup()),e&&(!e.selectable||!e.__corner&&r||(this._beforeTransform(t,e),this._setupCurrentTransform(t,e)),e!==this.getActiveGroup()&&e!==this.getActiveObject()&&(this.deactivateAll(),e.selectable&&this.setActiveObject(e,t))),this._handleEvent(t,"down",e||null),n&&this.renderAll()}},_beforeTransform:function(t,e){this.stateful&&e.saveState(),e._findTargetCorner(this.getPointer(t))&&this.onBeforeScaleRotate(e)},_clearSelection:function(t,e,i){this.deactivateAllWithDispatch(t),e&&e.selectable?this.setActiveObject(e,t):this.selection&&(this._groupSelector={ex:i.x,ey:i.y,top:0,left:0})},_setOriginToCenter:function(t){this._previousOriginX=this._currentTransform.target.originX,this._previousOriginY=this._currentTransform.target.originY;var e=t.getCenterPoint();t.originX="center",t.originY="center",t.left=e.x,t.top=e.y,this._currentTransform.left=t.left,this._currentTransform.top=t.top},_setCenterToOrigin:function(t){var e=t.translateToOriginPoint(t.getCenterPoint(),this._previousOriginX,this._previousOriginY);t.originX=this._previousOriginX,t.originY=this._previousOriginY,t.left=e.x,t.top=e.y,this._previousOriginX=null,this._previousOriginY=null},__onMouseMove:function(t){var e,i;if(this.isDrawingMode)this._onMouseMoveInDrawingMode(t);else if(!(void 0!==t.touches&&t.touches.length>1)){var n=this._groupSelector;n?(i=this.getPointer(t,!0),n.left=i.x-n.ex,n.top=i.y-n.ey,this.renderTop()):this._currentTransform?this._transformObject(t):(e=this.findTarget(t),this._setCursorFromEvent(t,e)),this._handleEvent(t,"move",e||null)}},__onMouseWheel:function(t){this.fire("mouse:wheel",{e:t})},_transformObject:function(t){var e=this.getPointer(t),i=this._currentTransform;i.reset=!1,i.target.isMoving=!0,this._beforeScaleTransform(t,i),this._performTransformAction(t,i,e),i.actionPerformed&&this.renderAll()},_performTransformAction:function(t,e,i){var n=i.x,r=i.y,o=e.target,s=e.action,a=!1;"rotate"===s?(a=this._rotateObject(n,r))&&this._fire("rotating",o,t):"scale"===s?(a=this._onScale(t,e,n,r))&&this._fire("scaling",o,t):"scaleX"===s?(a=this._scaleObject(n,r,"x"))&&this._fire("scaling",o,t):"scaleY"===s?(a=this._scaleObject(n,r,"y"))&&this._fire("scaling",o,t):"skewX"===s?(a=this._skewObject(n,r,"x"))&&this._fire("skewing",o,t):"skewY"===s?(a=this._skewObject(n,r,"y"))&&this._fire("skewing",o,t):(a=this._translateObject(n,r))&&(this._fire("moving",o,t),this.setCursor(o.moveCursor||this.moveCursor)),e.actionPerformed=a},_fire:function(t,e,i){this.fire("object:"+t,{target:e,e:i}),e.fire(t,{e:i})},_beforeScaleTransform:function(t,e){if("scale"===e.action||"scaleX"===e.action||"scaleY"===e.action){var i=this._shouldCenterTransform(e.target);(i&&("center"!==e.originX||"center"!==e.originY)||!i&&"center"===e.originX&&"center"===e.originY)&&(this._resetCurrentTransform(),e.reset=!0)}},_onScale:function(t,e,i,n){return!t[this.uniScaleKey]&&!this.uniScaleTransform||e.target.get("lockUniScaling")?(e.reset||"scale"!==e.currentAction||this._resetCurrentTransform(),e.currentAction="scaleEqually",this._scaleObject(i,n,"equally")):(e.currentAction="scale",this._scaleObject(i,n))},_setCursorFromEvent:function(t,e){if(!e)return this.setCursor(this.defaultCursor),!1;var i=e.hoverCursor||this.hoverCursor;if(e.selectable){var n=this.getActiveGroup(),r=e._findTargetCorner&&(!n||!n.contains(e))&&e._findTargetCorner(this.getPointer(t,!0));r?this._setCornerCursor(r,e,t):this.setCursor(i)}else this.setCursor(i);return!0},_setCornerCursor:function(e,i,n){if(e in t)this.setCursor(this._getRotatedCornerCursor(e,i,n));else{if("mtr"!==e||!i.hasRotatingPoint)return this.setCursor(this.defaultCursor),!1;this.setCursor(this.rotationCursor)}},_getRotatedCornerCursor:function(e,i,n){var r=Math.round(i.getAngle()%360/45);return r<0&&(r+=8),r+=t[e],n[this.altActionKey]&&t[e]%2==0&&(r+=2),r%=8,this.cursorMap[r]}})}(),function(){var t=Math.min,e=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(t,e){var i=this.getActiveObject();return t[this.selectionKey]&&e&&e.selectable&&(this.getActiveGroup()||i&&i!==e)&&this.selection},_handleGrouping:function(t,e){var i=this.getActiveGroup();(e!==i||(e=this.findTarget(t,!0)))&&(i?this._updateActiveGroup(e,t):this._createActiveGroup(e,t),this._activeGroup&&this._activeGroup.saveCoords())},_updateActiveGroup:function(t,e){var i=this.getActiveGroup();if(i.contains(t)){if(i.removeWithUpdate(t),t.set("active",!1),1===i.size())return this.discardActiveGroup(e),void this.setActiveObject(i.item(0))}else i.addWithUpdate(t);this.fire("selection:created",{target:i,e:e}),i.set("active",!0)},_createActiveGroup:function(t,e){if(this._activeObject&&t!==this._activeObject){var i=this._createGroup(t);i.addWithUpdate(),this.setActiveGroup(i),this._activeObject=null,this.fire("selection:created",{target:i,e:e})}t.set("active",!0)},_createGroup:function(t){var e=this.getObjects(),i=e.indexOf(this._activeObject)<e.indexOf(t)?[this._activeObject,t]:[t,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new fabric.Group(i,{canvas:this})},_groupSelectedObjects:function(t){var e=this._collectObjects();1===e.length?this.setActiveObject(e[0],t):e.length>1&&((e=new fabric.Group(e.reverse(),{canvas:this})).addWithUpdate(),this.setActiveGroup(e,t),e.saveCoords(),this.fire("selection:created",{target:e}),this.renderAll())},_collectObjects:function(){for(var i,n=[],r=this._groupSelector.ex,o=this._groupSelector.ey,s=r+this._groupSelector.left,a=o+this._groupSelector.top,c=new fabric.Point(t(r,s),t(o,a)),l=new fabric.Point(e(r,s),e(o,a)),h=r===s&&o===a,u=this._objects.length;u--&&!((i=this._objects[u])&&i.selectable&&i.visible&&(i.intersectsWithRect(c,l)||i.isContainedWithinRect(c,l)||i.containsPoint(c)||i.containsPoint(l))&&(i.set("active",!0),n.push(i),h)););return n},_maybeGroupObjects:function(t){this.selection&&this._groupSelector&&this._groupSelectedObjects(t);var e=this.getActiveGroup();e&&(e.setObjectsCoords().setCoords(),e.isMoving=!1,this.setCursor(this.defaultCursor)),this._groupSelector=null,this._currentTransform=null}})}(),function(){var t=fabric.StaticCanvas.supports("toDataURLWithQuality");fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(t){t||(t={});var e=t.format||"png",i=t.quality||1,n=t.multiplier||1,r={left:t.left||0,top:t.top||0,width:t.width||0,height:t.height||0};return this.__toDataURLWithMultiplier(e,i,r,n)},__toDataURLWithMultiplier:function(t,e,i,n){var r=this.getWidth(),o=this.getHeight(),s=(i.width||this.getWidth())*n,a=(i.height||this.getHeight())*n,c=this.getZoom()*n,l=this.viewportTransform,h=[c,0,0,c,(l[4]-i.left)*n,(l[5]-i.top)*n],u=this.interactive;this.viewportTransform=h,this.interactive&&(this.interactive=!1),r!==s||o!==a?this.setDimensions({width:s,height:a}):this.renderAll();var f=this.__toDataURL(t,e,i);return u&&(this.interactive=u),this.viewportTransform=l,this.setDimensions({width:r,height:o}),f},__toDataURL:function(e,i){var n=this.contextContainer.canvas;return"jpg"===e&&(e="jpeg"),t?n.toDataURL("image/"+e,i):n.toDataURL("image/"+e)},toDataURLWithMultiplier:function(t,e,i){return this.toDataURL({format:t,multiplier:e,quality:i})}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(t,e,i){return this.loadFromJSON(t,e,i)},loadFromJSON:function(t,e,i){if(t){var n="string"==typeof t?JSON.parse(t):fabric.util.object.clone(t);this.clear();var r=this;return this._enlivenObjects(n.objects,function(){r._setBgOverlay(n,function(){for(var t in delete n.objects,delete n.backgroundImage,delete n.overlayImage,delete n.background,delete n.overlay,n)r[t]=n[t];e&&e()})},i),this}},_setBgOverlay:function(t,e){var i=this,n={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(t.backgroundImage||t.overlayImage||t.background||t.overlay){var r=function(){n.backgroundImage&&n.overlayImage&&n.backgroundColor&&n.overlayColor&&(i.renderAll(),e&&e())};this.__setBgOverlay("backgroundImage",t.backgroundImage,n,r),this.__setBgOverlay("overlayImage",t.overlayImage,n,r),this.__setBgOverlay("backgroundColor",t.background,n,r),this.__setBgOverlay("overlayColor",t.overlay,n,r),r()}else e&&e()},__setBgOverlay:function(t,e,i,n){var r=this;e?"backgroundImage"===t||"overlayImage"===t?fabric.Image.fromObject(e,function(e){r[t]=e,i[t]=!0,n&&n()}):this["set"+fabric.util.string.capitalize(t,!0)](e,function(){i[t]=!0,n&&n()}):i[t]=!0},_enlivenObjects:function(t,e,i){var n=this;if(t&&0!==t.length){var r=this.renderOnAddRemove;this.renderOnAddRemove=!1,fabric.util.enlivenObjects(t,function(t){t.forEach(function(t,e){n.insertAt(t,e)}),n.renderOnAddRemove=r,e&&e()},null,i)}else e&&e()},_toDataURL:function(t,e){this.clone(function(i){e(i.toDataURL(t))})},_toDataURLWithMultiplier:function(t,e,i){this.clone(function(n){i(n.toDataURLWithMultiplier(t,e))})},clone:function(t,e){var i=JSON.stringify(this.toJSON(e));this.cloneWithoutData(function(e){e.loadFromJSON(i,function(){t&&t(e)})})},cloneWithoutData:function(t){var e=fabric.document.createElement("canvas");e.width=this.getWidth(),e.height=this.getHeight();var i=new fabric.Canvas(e);i.clipTo=this.clipTo,this.backgroundImage?(i.setBackgroundImage(this.backgroundImage.src,function(){i.renderAll(),t&&t(i)}),i.backgroundImageOpacity=this.backgroundImageOpacity,i.backgroundImageStretch=this.backgroundImageStretch):t&&t(i)}}),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.toFixed,r=e.util.string.capitalize,o=e.util.degreesToRadians,s=e.StaticCanvas.supports("setLineDash");e.Object||(e.Object=e.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",borderDashArray:null,cornerColor:"rgba(102,153,255,0.5)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor skewX skewY".split(" "),initialize:function(t){t&&this.setOptions(t)},_initGradient:function(t){!t.fill||!t.fill.colorStops||t.fill instanceof e.Gradient||this.set("fill",new e.Gradient(t.fill)),!t.stroke||!t.stroke.colorStops||t.stroke instanceof e.Gradient||this.set("stroke",new e.Gradient(t.stroke))},_initPattern:function(t){!t.fill||!t.fill.source||t.fill instanceof e.Pattern||this.set("fill",new e.Pattern(t.fill)),!t.stroke||!t.stroke.source||t.stroke instanceof e.Pattern||this.set("stroke",new e.Pattern(t.stroke))},_initClipping:function(t){if(t.clipTo&&"string"==typeof t.clipTo){var i=e.util.getFunctionBody(t.clipTo);void 0!==i&&(this.clipTo=new Function("ctx",i))}},setOptions:function(t){for(var e in t)this.set(e,t[e]);this._initGradient(t),this._initPattern(t),this._initClipping(t)},transform:function(t,e){this.group&&!this.group._transformDone&&this.group===this.canvas._activeGroup&&this.group.transform(t);var i=e?this._getLeftTopCoords():this.getCenterPoint();t.translate(i.x,i.y),t.rotate(o(this.angle)),t.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1)),t.transform(1,0,Math.tan(o(this.skewX)),1,0,0),t.transform(1,Math.tan(o(this.skewY)),0,1,0,0)},toObject:function(t){var i=e.Object.NUM_FRACTION_DIGITS,r={type:this.type,originX:this.originX,originY:this.originY,left:n(this.left,i),top:n(this.top,i),width:n(this.width,i),height:n(this.height,i),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:n(this.strokeWidth,i),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:n(this.strokeMiterLimit,i),scaleX:n(this.scaleX,i),scaleY:n(this.scaleY,i),angle:n(this.getAngle(),i),flipX:this.flipX,flipY:this.flipY,opacity:n(this.opacity,i),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():this.transformMatrix,skewX:n(this.skewX,i),skewY:n(this.skewY,i)};return e.util.populateWithProperties(this,r,t),this.includeDefaultValues||(r=this._removeDefaultValues(r)),r},toDatalessObject:function(t){return this.toObject(t)},_removeDefaultValues:function(t){var i=e.util.getKlass(t.type).prototype;return i.stateProperties.forEach(function(e){t[e]===i[e]&&delete t[e],"[object Array]"===Object.prototype.toString.call(t[e])&&"[object Array]"===Object.prototype.toString.call(i[e])&&0===t[e].length&&0===i[e].length&&delete t[e]}),t},toString:function(){return"#<fabric."+r(this.type)+">"},get:function(t){return this[t]},getObjectScaling:function(){var t=this.scaleX,e=this.scaleY;if(this.group){var i=this.group.getObjectScaling();t*=i.scaleX,e*=i.scaleY}return{scaleX:t,scaleY:e}},_setObject:function(t){for(var e in t)this._set(e,t[e])},set:function(t,e){return"object"==typeof t?this._setObject(t):"function"==typeof e&&"clipTo"!==t?this._set(t,e(this.get(t))):this._set(t,e),this},_set:function(t,i){return("scaleX"===t||"scaleY"===t)&&(i=this._constrainScale(i)),"scaleX"===t&&i<0?(this.flipX=!this.flipX,i*=-1):"scaleY"===t&&i<0?(this.flipY=!this.flipY,i*=-1):"shadow"!==t||!i||i instanceof e.Shadow||(i=new e.Shadow(i)),this[t]=i,"width"!==t&&"height"!==t||(this.minScaleLimit=Math.min(.1,1/Math.max(this.width,this.height))),this},setOnGroup:function(){},toggle:function(t){var e=this.get(t);return"boolean"==typeof e&&this.set(t,!e),this},setSourcePath:function(t){return this.sourcePath=t,this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(t,i){0===this.width&&0===this.height||!this.visible||(t.save(),this._setupCompositeOperation(t),this.drawSelectionBackground(t),i||this.transform(t),this._setOpacity(t),this._setShadow(t),this._renderBackground(t),this._setStrokeStyles(t),this._setFillStyles(t),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this.clipTo&&e.util.clipContext(this,t),this._render(t,i),this.clipTo&&t.restore(),t.restore())},_renderBackground:function(t){this.backgroundColor&&(t.fillStyle=this.backgroundColor,t.fillRect(-this.width/2,-this.height/2,this.width,this.height),this._removeShadow(t))},_setOpacity:function(t){this.group&&this.group._setOpacity(t),t.globalAlpha*=this.opacity},_setStrokeStyles:function(t){this.stroke&&(t.lineWidth=this.strokeWidth,t.lineCap=this.strokeLineCap,t.lineJoin=this.strokeLineJoin,t.miterLimit=this.strokeMiterLimit,t.strokeStyle=this.stroke.toLive?this.stroke.toLive(t,this):this.stroke)},_setFillStyles:function(t){this.fill&&(t.fillStyle=this.fill.toLive?this.fill.toLive(t,this):this.fill)},_setLineDash:function(t,e,i){e&&(1&e.length&&e.push.apply(e,e),s?t.setLineDash(e):i&&i(t))},_renderControls:function(t,i){if(!(!this.active||i||this.group&&this.group!==this.canvas.getActiveGroup())){var n,r=this.getViewportTransform(),s=this.calcTransformMatrix();s=e.util.multiplyTransformMatrices(r,s),n=e.util.qrDecompose(s),t.save(),t.translate(n.translateX,n.translateY),t.lineWidth=1*this.borderScaleFactor,t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.group&&this.group===this.canvas.getActiveGroup()?(t.rotate(o(n.angle)),this.drawBordersInGroup(t,n)):(t.rotate(o(this.angle)),this.drawBorders(t)),this.drawControls(t),t.restore()}},_setShadow:function(t){if(this.shadow){var i=this.canvas&&this.canvas.viewportTransform[0]||1,n=this.canvas&&this.canvas.viewportTransform[3]||1,r=this.getObjectScaling();this.canvas&&this.canvas._isRetinaScaling()&&(i*=e.devicePixelRatio,n*=e.devicePixelRatio),t.shadowColor=this.shadow.color,t.shadowBlur=this.shadow.blur*(i+n)*(r.scaleX+r.scaleY)/4,t.shadowOffsetX=this.shadow.offsetX*i*r.scaleX,t.shadowOffsetY=this.shadow.offsetY*n*r.scaleY}},_removeShadow:function(t){this.shadow&&(t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0)},_renderFill:function(t){if(this.fill){if(t.save(),this.fill.gradientTransform){var e=this.fill.gradientTransform;t.transform.apply(t,e)}this.fill.toLive&&t.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0),"evenodd"===this.fillRule?t.fill("evenodd"):t.fill(),t.restore()}},_renderStroke:function(t){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokeDashArray,this._renderDashedStroke),this.stroke.gradientTransform){var e=this.stroke.gradientTransform;t.transform.apply(t,e)}this.stroke.toLive&&t.translate(-this.width/2+this.stroke.offsetX||0,-this.height/2+this.stroke.offsetY||0),t.stroke(),t.restore()}},clone:function(t,i){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(i),t):new e.Object(this.toObject(i))},cloneAsImage:function(t,i){var n=this.toDataURL(i);return e.util.loadImage(n,function(i){t&&t(new e.Image(i))}),this},toDataURL:function(t){t||(t={});var i=e.util.createCanvasElement(),n=this.getBoundingRect();i.width=n.width,i.height=n.height,e.util.wrapElement(i,"div");var r=new e.StaticCanvas(i,{enableRetinaScaling:t.enableRetinaScaling});"jpg"===t.format&&(t.format="jpeg"),"jpeg"===t.format&&(r.backgroundColor="#fff");var o={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",!1),this.setPositionByOrigin(new e.Point(r.getWidth()/2,r.getHeight()/2),"center","center");var s=this.canvas;r.add(this);var a=r.toDataURL(t);return this.set(o).setCoords(),this.canvas=s,r.dispose(),r=null,a},isType:function(t){return this.type===t},complexity:function(){return 0},toJSON:function(t){return this.toObject(t)},setGradient:function(t,i){i||(i={});var n={colorStops:[]};for(var r in n.type=i.type||(i.r1||i.r2?"radial":"linear"),n.coords={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2},(i.r1||i.r2)&&(n.coords.r1=i.r1,n.coords.r2=i.r2),i.gradientTransform&&(n.gradientTransform=i.gradientTransform),i.colorStops){var o=new e.Color(i.colorStops[r]);n.colorStops.push({offset:r,color:o.toRgb(),opacity:o.getAlpha()})}return this.set(t,e.Gradient.forObject(this,n))},setPatternFill:function(t){return this.set("fill",new e.Pattern(t))},setShadow:function(t){return this.set("shadow",t?new e.Shadow(t):null)},setColor:function(t){return this.set("fill",t),this},setAngle:function(t){var e=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return e&&this._setOriginToCenter(),this.set("angle",t),e&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},remove:function(){return this.canvas&&this.canvas.remove(this),this},getLocalPointer:function(t,i){i=i||this.canvas.getPointer(t);var n=new e.Point(i.x,i.y),r=this._getLeftTopCoords();return this.angle&&(n=e.util.rotatePoint(n,r,e.util.degreesToRadians(-this.angle))),{x:n.x-r.x,y:n.y-r.y}},_setupCompositeOperation:function(t){this.globalCompositeOperation&&(t.globalCompositeOperation=this.globalCompositeOperation)}}),e.util.createAccessors(e.Object),e.Object.prototype.rotate=e.Object.prototype.setAngle,i(e.Object.prototype,e.Observable),e.Object.NUM_FRACTION_DIGITS=2,e.Object.__uid=0)}(exports),function(){var t=fabric.util.degreesToRadians,e={left:-.5,center:0,right:.5},i={top:-.5,center:0,bottom:.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(t,n,r,o,s){var a,c,l,h=t.x,u=t.y;return"string"==typeof n?n=e[n]:n-=.5,"string"==typeof o?o=e[o]:o-=.5,a=o-n,"string"==typeof r?r=i[r]:r-=.5,"string"==typeof s?s=i[s]:s-=.5,c=s-r,(a||c)&&(l=this._getTransformedDimensions(),h=t.x+a*l.x,u=t.y+c*l.y),new fabric.Point(h,u)},translateToCenterPoint:function(e,i,n){var r=this.translateToGivenOrigin(e,i,n,"center","center");return this.angle?fabric.util.rotatePoint(r,e,t(this.angle)):r},translateToOriginPoint:function(e,i,n){var r=this.translateToGivenOrigin(e,"center","center",i,n);return this.angle?fabric.util.rotatePoint(r,e,t(this.angle)):r},getCenterPoint:function(){var t=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(t,this.originX,this.originY)},getPointByOrigin:function(t,e){var i=this.getCenterPoint();return this.translateToOriginPoint(i,t,e)},toLocalPoint:function(e,i,n){var r,o,s=this.getCenterPoint();return r=void 0!==i&&void 0!==n?this.translateToGivenOrigin(s,"center","center",i,n):new fabric.Point(this.left,this.top),o=new fabric.Point(e.x,e.y),this.angle&&(o=fabric.util.rotatePoint(o,s,-t(this.angle))),o.subtractEquals(r)},setPositionByOrigin:function(t,e,i){var n=this.translateToCenterPoint(t,e,i),r=this.translateToOriginPoint(n,this.originX,this.originY);this.set("left",r.x),this.set("top",r.y)},adjustPosition:function(i){var n,r,o=t(this.angle),s=this.getWidth(),a=Math.cos(o)*s,c=Math.sin(o)*s;n="string"==typeof this.originX?e[this.originX]:this.originX-.5,r="string"==typeof i?e[i]:i-.5,this.left+=a*(r-n),this.top+=c*(r-n),this.setCoords(),this.originX=i},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var t=this.getCenterPoint();this.originX="center",this.originY="center",this.left=t.x,this.top=t.y},_resetOrigin:function(){var t=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=t.x,this.top=t.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function t(t){return[new fabric.Point(t.tl.x,t.tl.y),new fabric.Point(t.tr.x,t.tr.y),new fabric.Point(t.br.x,t.br.y),new fabric.Point(t.bl.x,t.bl.y)]}var e=fabric.util.degreesToRadians,i=fabric.util.multiplyTransformMatrices;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(e,i){var n=t(this.oCoords);return"Intersection"===fabric.Intersection.intersectPolygonRectangle(n,e,i).status},intersectsWithObject:function(e){return"Intersection"===fabric.Intersection.intersectPolygonPolygon(t(this.oCoords),t(e.oCoords)).status||e.isContainedWithinObject(this)||this.isContainedWithinObject(e)},isContainedWithinObject:function(e){for(var i=t(this.oCoords),n=0;n<4;n++)if(!e.containsPoint(i[n]))return!1;return!0},isContainedWithinRect:function(t,e){var i=this.getBoundingRect();return i.left>=t.x&&i.left+i.width<=e.x&&i.top>=t.y&&i.top+i.height<=e.y},containsPoint:function(t){this.oCoords||this.setCoords();var e=this._getImageLines(this.oCoords),i=this._findCrossPoints(t,e);return 0!==i&&i%2==1},_getImageLines:function(t){return{topline:{o:t.tl,d:t.tr},rightline:{o:t.tr,d:t.br},bottomline:{o:t.br,d:t.bl},leftline:{o:t.bl,d:t.tl}}},_findCrossPoints:function(t,e){var i,n,r,o,s=0;for(var a in e)if(!((o=e[a]).o.y<t.y&&o.d.y<t.y||o.o.y>=t.y&&o.d.y>=t.y||(o.o.x===o.d.x&&o.o.x>=t.x?r=o.o.x:(i=0,n=(o.d.y-o.o.y)/(o.d.x-o.o.x),r=-(t.y-i*t.x-(o.o.y-n*o.o.x))/(i-n)),r>=t.x&&(s+=1),2!==s)))break;return s},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){return this.oCoords||this.setCoords(),fabric.util.makeBoundingBoxFromPoints([this.oCoords.tl,this.oCoords.tr,this.oCoords.br,this.oCoords.bl])},getWidth:function(){return this._getTransformedDimensions().x},getHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(t){return Math.abs(t)<this.minScaleLimit?t<0?-this.minScaleLimit:this.minScaleLimit:t},scale:function(t){return(t=this._constrainScale(t))<0&&(this.flipX=!this.flipX,this.flipY=!this.flipY,t*=-1),this.scaleX=t,this.scaleY=t,this.setCoords(),this},scaleToWidth:function(t){var e=this.getBoundingRect().width/this.getWidth();return this.scale(t/this.width/e)},scaleToHeight:function(t){var e=this.getBoundingRect().height/this.getHeight();return this.scale(t/this.height/e)},setCoords:function(){var t=e(this.angle),i=this.getViewportTransform(),n=this._calculateCurrentDimensions(),r=n.x,o=n.y;r<0&&(r=Math.abs(r));var s=Math.sin(t),a=Math.cos(t),c=r>0?Math.atan(o/r):0,l=r/Math.cos(c)/2,h=Math.cos(c+t)*l,u=Math.sin(c+t)*l,f=fabric.util.transformPoint(this.getCenterPoint(),i),d=new fabric.Point(f.x-h,f.y-u),p=new fabric.Point(d.x+r*a,d.y+r*s),g=new fabric.Point(d.x-o*s,d.y+o*a),v=new fabric.Point(f.x+h,f.y+u),m=new fabric.Point((d.x+g.x)/2,(d.y+g.y)/2),b=new fabric.Point((p.x+d.x)/2,(p.y+d.y)/2),y=new fabric.Point((v.x+p.x)/2,(v.y+p.y)/2),_=new fabric.Point((v.x+g.x)/2,(v.y+g.y)/2),x=new fabric.Point(b.x+s*this.rotatingPointOffset,b.y-a*this.rotatingPointOffset);return this.oCoords={tl:d,tr:p,br:v,bl:g,ml:m,mt:b,mr:y,mb:_,mtr:x},this._setCornerCoords&&this._setCornerCoords(),this},_calcRotateMatrix:function(){if(this.angle){var t=e(this.angle),i=Math.cos(t),n=Math.sin(t);return[i,n,-n,i,0,0]}return[1,0,0,1,0,0]},calcTransformMatrix:function(){var t=this.getCenterPoint(),e=[1,0,0,1,t.x,t.y],n=this._calcRotateMatrix(),r=this._calcDimensionsTransformMatrix(this.skewX,this.skewY,!0),o=this.group?this.group.calcTransformMatrix():[1,0,0,1,0,0];return o=i(o,e),o=i(o,n),o=i(o,r)},_calcDimensionsTransformMatrix:function(t,n,r){var o=[1,0,Math.tan(e(t)),1],s=[1,Math.tan(e(n)),0,1],a=this.scaleX*(r&&this.flipX?-1:1),c=this.scaleY*(r&&this.flipY?-1:1),l=i([a,0,0,c],o,!0);return i(l,s,!0)}})}(),fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(t){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,t):this.canvas.sendBackwards(this,t),this},bringForward:function(t){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,t):this.canvas.bringForward(this,t),this},moveTo:function(t){return this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,t):this.canvas.moveTo(this,t),this}}),function(){function t(t,e){if(e){if(e.toLive)return t+": url(#SVGID_"+e.id+"); ";var i=new fabric.Color(e),n=t+": "+i.toRgb()+"; ",r=i.getAlpha();return 1!==r&&(n+=t+"-opacity: "+r.toString()+"; "),n}return t+": none; "}fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(e){var i=this.fillRule,n=this.strokeWidth?this.strokeWidth:"0",r=this.strokeDashArray?this.strokeDashArray.join(" "):"none",o=this.strokeLineCap?this.strokeLineCap:"butt",s=this.strokeLineJoin?this.strokeLineJoin:"miter",a=this.strokeMiterLimit?this.strokeMiterLimit:"4",c=void 0!==this.opacity?this.opacity:"1",l=this.visible?"":" visibility: hidden;",h=e?"":this.getSvgFilter(),u=t("fill",this.fill);return[t("stroke",this.stroke),"stroke-width: ",n,"; ","stroke-dasharray: ",r,"; ","stroke-linecap: ",o,"; ","stroke-linejoin: ",s,"; ","stroke-miterlimit: ",a,"; ",u,"fill-rule: ",i,"; ","opacity: ",c,";",h,l].join("")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgId:function(){return this.id?'id="'+this.id+'" ':""},getSvgTransform:function(){if(this.group&&"path-group"===this.group.type)return"";var t=fabric.util.toFixed,e=this.getAngle(),i=this.getSkewX()%360,n=this.getSkewY()%360,r=this.getCenterPoint(),o=fabric.Object.NUM_FRACTION_DIGITS,s="path-group"===this.type?"":"translate("+t(r.x,o)+" "+t(r.y,o)+")",a=0!==e?" rotate("+t(e,o)+")":"",c=1===this.scaleX&&1===this.scaleY?"":" scale("+t(this.scaleX,o)+" "+t(this.scaleY,o)+")",l=0!==i?" skewX("+t(i,o)+")":"",h=0!==n?" skewY("+t(n,o)+")":"",u="path-group"===this.type?this.width:0,f=this.flipX?" matrix(-1 0 0 1 "+u+" 0) ":"",d="path-group"===this.type?this.height:0;return[s,a,c,f,this.flipY?" matrix(1 0 0 -1 0 "+d+")":"",l,h].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+") ":""},_createBaseSVGMarkup:function(){var t=[];return this.fill&&this.fill.toLive&&t.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&t.push(this.stroke.toSVG(this,!1)),this.shadow&&t.push(this.shadow.toSVG(this)),t}})}(),function(){var t=fabric.util.object.extend;function e(e,i,n){var r={};n.forEach(function(t){r[t]=e[t]}),t(e[i],r,!0)}fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return!function t(e,i){if(!fabric.isLikelyNode&&e instanceof Element)return e===i;if(e instanceof Array){if(e.length!==i.length)return!1;var n=i.concat().sort();return!e.concat().sort().some(function(e,i){return!t(n[i],e)})}if(e instanceof Object){for(var r in e)if(!t(e[r],i[r]))return!1;return!0}return e===i}(this.originalState,this)},saveState:function(t){return e(this,"originalState",this.stateProperties),t&&t.stateProperties&&e(this,"originalState",t.stateProperties),this},setupState:function(t){return this.originalState={},this.saveState(t),this}})}(),function(){var t=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(t){if(!this.hasControls||!this.active)return!1;var e,i,n=t.x,r=t.y;for(var o in this.__corner=0,this.oCoords)if(this.isControlVisible(o)&&("mtr"!==o||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==o&&"mr"!==o&&"mb"!==o&&"ml"!==o)&&(i=this._getImageLines(this.oCoords[o].corner),0!==(e=this._findCrossPoints({x:n,y:r},i))&&e%2==1))return this.__corner=o,o;return!1},_setCornerCoords:function(){var e,i,n=this.oCoords,r=t(45-this.angle),o=.707106*this.cornerSize,s=o*Math.cos(r),a=o*Math.sin(r);for(var c in n)e=n[c].x,i=n[c].y,n[c].corner={tl:{x:e-a,y:i-s},tr:{x:e+s,y:i-a},bl:{x:e-s,y:i+a},br:{x:e+a,y:i+s}}},_getNonTransformedDimensions:function(){var t=this.strokeWidth,e=this.width,i=this.height,n=!0,r=!0;return"line"===this.type&&"butt"===this.strokeLineCap&&(r=e,n=i),r&&(i+=i<0?-t:t),n&&(e+=e<0?-t:t),{x:e,y:i}},_getTransformedDimensions:function(t,e){void 0===t&&(t=this.skewX),void 0===e&&(e=this.skewY);var i,n,r=this._getNonTransformedDimensions(),o=r.x/2,s=r.y/2,a=[{x:-o,y:-s},{x:o,y:-s},{x:-o,y:s},{x:o,y:s}],c=this._calcDimensionsTransformMatrix(t,e,!1);for(i=0;i<a.length;i++)a[i]=fabric.util.transformPoint(a[i],c);return{x:(n=fabric.util.makeBoundingBoxFromPoints(a)).width,y:n.height}},_calculateCurrentDimensions:function(){var t=this.getViewportTransform(),e=this._getTransformedDimensions(),i=e.x,n=e.y;return fabric.util.transformPoint(new fabric.Point(i,n),t,!0).scalarAdd(2*this.padding)},drawSelectionBackground:function(e){if(!this.selectionBackgroundColor||this.group||!this.active)return this;e.save();var i=this.getCenterPoint(),n=this._calculateCurrentDimensions(),r=this.canvas.viewportTransform;return e.translate(i.x,i.y),e.scale(1/r[0],1/r[3]),e.rotate(t(this.angle)),e.fillStyle=this.selectionBackgroundColor,e.fillRect(-n.x/2,-n.y/2,n.x,n.y),e.restore(),this},drawBorders:function(t){if(!this.hasBorders)return this;var e=this._calculateCurrentDimensions(),i=1/this.borderScaleFactor,n=e.x+i,r=e.y+i;if(t.save(),t.strokeStyle=this.borderColor,this._setLineDash(t,this.borderDashArray,null),t.strokeRect(-n/2,-r/2,n,r),this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls){var o=-r/2;t.beginPath(),t.moveTo(0,o),t.lineTo(0,o-this.rotatingPointOffset),t.closePath(),t.stroke()}return t.restore(),this},drawBordersInGroup:function(t,e){if(!this.hasBorders)return this;var i=this._getNonTransformedDimensions(),n=fabric.util.customTransformMatrix(e.scaleX,e.scaleY,e.skewX),r=fabric.util.transformPoint(i,n),o=1/this.borderScaleFactor,s=r.x+o+2*this.padding,a=r.y+o+2*this.padding;return t.save(),this._setLineDash(t,this.borderDashArray,null),t.strokeStyle=this.borderColor,t.strokeRect(-s/2,-a/2,s,a),t.restore(),this},drawControls:function(t){if(!this.hasControls)return this;var e=this._calculateCurrentDimensions(),i=e.x,n=e.y,r=this.cornerSize,o=-(i+r)/2,s=-(n+r)/2,a=this.transparentCorners?"stroke":"fill";return t.save(),t.strokeStyle=t.fillStyle=this.cornerColor,this.transparentCorners||(t.strokeStyle=this.cornerStrokeColor),this._setLineDash(t,this.cornerDashArray,null),this._drawControl("tl",t,a,o,s),this._drawControl("tr",t,a,o+i,s),this._drawControl("bl",t,a,o,s+n),this._drawControl("br",t,a,o+i,s+n),this.get("lockUniScaling")||(this._drawControl("mt",t,a,o+i/2,s),this._drawControl("mb",t,a,o+i/2,s+n),this._drawControl("mr",t,a,o+i,s+n/2),this._drawControl("ml",t,a,o,s+n/2)),this.hasRotatingPoint&&this._drawControl("mtr",t,a,o+i/2,s-this.rotatingPointOffset),t.restore(),this},_drawControl:function(t,e,i,n,r){if(this.isControlVisible(t)){var o=this.cornerSize,s=!this.transparentCorners&&this.cornerStrokeColor;switch(this.cornerStyle){case"circle":e.beginPath(),e.arc(n+o/2,r+o/2,o/2,0,2*Math.PI,!1),e[i](),s&&e.stroke();break;default:"undefined"!=typeof G_vmlCanvasManager||this.transparentCorners||e.clearRect(n,r,o,o),e[i+"Rect"](n,r,o,o),s&&e.strokeRect(n,r,o,o)}}},isControlVisible:function(t){return this._getControlsVisibility()[t]},setControlVisible:function(t,e){return this._getControlsVisibility()[t]=e,this},setControlsVisibility:function(t){for(var e in t||(t={}),t)this.setControlVisible(e,t[e]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(t,e){var i=function(){},n=(e=e||{}).onComplete||i,r=e.onChange||i,o=this;return fabric.util.animate({startValue:t.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(e){t.set("left",e),o.renderAll(),r()},onComplete:function(){t.setCoords(),n()}}),this},fxCenterObjectV:function(t,e){var i=function(){},n=(e=e||{}).onComplete||i,r=e.onChange||i,o=this;return fabric.util.animate({startValue:t.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(e){t.set("top",e),o.renderAll(),r()},onComplete:function(){t.setCoords(),n()}}),this},fxRemove:function(t,e){var i=function(){},n=(e=e||{}).onComplete||i,r=e.onChange||i,o=this;return fabric.util.animate({startValue:t.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){t.set("active",!1)},onChange:function(e){t.set("opacity",e),o.renderAll(),r()},onComplete:function(){o.remove(t),n()}}),this}}),fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var t,e,i=[];for(t in arguments[0])i.push(t);for(var n=0,r=i.length;n<r;n++)t=i[n],e=n!==r-1,this._animate(t,arguments[0][t],arguments[1],e)}else this._animate.apply(this,arguments);return this},_animate:function(t,e,i,n){var r,o=this;e=e.toString(),i=i?fabric.util.object.clone(i):{},~t.indexOf(".")&&(r=t.split("."));var s=r?this.get(r[0])[r[1]]:this.get(t);"from"in i||(i.from=s),e=~e.indexOf("=")?s+parseFloat(e.replace("=","")):parseFloat(e),fabric.util.animate({startValue:i.from,endValue:e,byValue:i.by,easing:i.easing,duration:i.duration,abort:i.abort&&function(){return i.abort.call(o)},onChange:function(e){r?o[r[0]][r[1]]=e:o.set(t,e),n||i.onChange&&i.onChange()},onComplete:function(){n||(o.setCoords(),i.onComplete&&i.onComplete())}})}}),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n={x1:1,x2:1,y1:1,y2:1},r=e.StaticCanvas.supports("setLineDash");function o(t,e){var i=t.origin,n=t.axis1,r=t.axis2,o=t.dimension,s=e.nearest,a=e.center,c=e.farthest;return function(){switch(this.get(i)){case s:return Math.min(this.get(n),this.get(r));case a:return Math.min(this.get(n),this.get(r))+.5*this.get(o);case c:return Math.max(this.get(n),this.get(r))}}}e.Line?e.warn("fabric.Line is already defined"):(e.Line=e.util.createClass(e.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(t,e){e=e||{},t||(t=[0,0,0,0]),this.callSuper("initialize",e),this.set("x1",t[0]),this.set("y1",t[1]),this.set("x2",t[2]),this.set("y2",t[3]),this._setWidthHeight(e)},_setWidthHeight:function(t){t||(t={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in t?t.left:this._getLeftToOriginX(),this.top="top"in t?t.top:this._getTopToOriginY()},_set:function(t,e){return this.callSuper("_set",t,e),void 0!==n[t]&&this._setWidthHeight(),this},_getLeftToOriginX:o({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:o({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(t,e){if(t.beginPath(),e){var i=this.getCenterPoint();t.translate(i.x-this.strokeWidth/2,i.y-this.strokeWidth/2)}if(!this.strokeDashArray||this.strokeDashArray&&r){var n=this.calcLinePoints();t.moveTo(n.x1,n.y1),t.lineTo(n.x2,n.y2)}t.lineWidth=this.strokeWidth;var o=t.strokeStyle;t.strokeStyle=this.stroke||t.fillStyle,this.stroke&&this._renderStroke(t),t.strokeStyle=o},_renderDashedStroke:function(t){var i=this.calcLinePoints();t.beginPath(),e.util.drawDashedLine(t,i.x1,i.y1,i.x2,i.y2,this.strokeDashArray),t.closePath()},toObject:function(t){return i(this.callSuper("toObject",t),this.calcLinePoints())},calcLinePoints:function(){var t=this.x1<=this.x2?-1:1,e=this.y1<=this.y2?-1:1,i=t*this.width*.5,n=e*this.height*.5;return{x1:i,x2:t*this.width*-.5,y1:n,y2:e*this.height*-.5}},toSVG:function(t){var e=this._createBaseSVGMarkup(),i={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};return this.group&&"path-group"===this.group.type||(i=this.calcLinePoints()),e.push("<line ",this.getSvgId(),'x1="',i.x1,'" y1="',i.y1,'" x2="',i.x2,'" y2="',i.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),t?t(e.join("")):e.join("")},complexity:function(){return 1}}),e.Line.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),e.Line.fromElement=function(t,n){var r=e.parseAttributes(t,e.Line.ATTRIBUTE_NAMES),o=[r.x1||0,r.y1||0,r.x2||0,r.y2||0];return new e.Line(o,i(r,n))},e.Line.fromObject=function(t,i){var n=[t.x1,t.y1,t.x2,t.y2],r=new e.Line(n,t);return i&&i(r),r})}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=Math.PI,n=e.util.object.extend;e.Circle?e.warn("fabric.Circle is already defined."):(e.Circle=e.util.createClass(e.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*i,initialize:function(t){t=t||{},this.callSuper("initialize",t),this.set("radius",t.radius||0),this.startAngle=t.startAngle||this.startAngle,this.endAngle=t.endAngle||this.endAngle},_set:function(t,e){return this.callSuper("_set",t,e),"radius"===t&&this.setRadius(e),this},toObject:function(t){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(t))},toSVG:function(t){var e=this._createBaseSVGMarkup(),n=0,r=0,o=(this.endAngle-this.startAngle)%(2*i);if(0===o)this.group&&"path-group"===this.group.type&&(n=this.left+this.radius,r=this.top+this.radius),e.push("<circle ",this.getSvgId(),'cx="'+n+'" cy="'+r+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');else{var s=Math.cos(this.startAngle)*this.radius,a=Math.sin(this.startAngle)*this.radius,c=Math.cos(this.endAngle)*this.radius,l=Math.sin(this.endAngle)*this.radius,h=o>i?"1":"0";e.push('<path d="M '+s+" "+a," A "+this.radius+" "+this.radius," 0 ",+h+" 1"," "+c+" "+l,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')}return t?t(e.join("")):e.join("")},_render:function(t,e){t.beginPath(),t.arc(e?this.left+this.radius:0,e?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,!1),this._renderFill(t),this._renderStroke(t)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(t){return this.radius=t,this.set("width",2*t).set("height",2*t)},complexity:function(){return 1}}),e.Circle.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),e.Circle.fromElement=function(t,i){i||(i={});var r=e.parseAttributes(t,e.Circle.ATTRIBUTE_NAMES);if(!function(t){return"radius"in t&&t.radius>=0}(r))throw new Error("value of `r` attribute is required and can not be negative");r.left=r.left||0,r.top=r.top||0;var o=new e.Circle(n(r,i));return o.left-=o.radius,o.top-=o.radius,o},e.Circle.fromObject=function(t,i){var n=new e.Circle(t);return i&&i(n),n})}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={});e.Triangle?e.warn("fabric.Triangle is already defined"):(e.Triangle=e.util.createClass(e.Object,{type:"triangle",initialize:function(t){t=t||{},this.callSuper("initialize",t),this.set("width",t.width||100).set("height",t.height||100)},_render:function(t){var e=this.width/2,i=this.height/2;t.beginPath(),t.moveTo(-e,i),t.lineTo(0,-i),t.lineTo(e,i),t.closePath(),this._renderFill(t),this._renderStroke(t)},_renderDashedStroke:function(t){var i=this.width/2,n=this.height/2;t.beginPath(),e.util.drawDashedLine(t,-i,n,0,-n,this.strokeDashArray),e.util.drawDashedLine(t,0,-n,i,n,this.strokeDashArray),e.util.drawDashedLine(t,i,n,-i,n,this.strokeDashArray),t.closePath()},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=this.width/2,n=this.height/2,r=[-i+" "+n,"0 "+-n,i+" "+n].join(",");return e.push("<polygon ",this.getSvgId(),'points="',r,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),t?t(e.join("")):e.join("")},complexity:function(){return 1}}),e.Triangle.fromObject=function(t,i){var n=new e.Triangle(t);return i&&i(n),n})}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=2*Math.PI,n=e.util.object.extend;e.Ellipse?e.warn("fabric.Ellipse is already defined."):(e.Ellipse=e.util.createClass(e.Object,{type:"ellipse",rx:0,ry:0,initialize:function(t){t=t||{},this.callSuper("initialize",t),this.set("rx",t.rx||0),this.set("ry",t.ry||0)},_set:function(t,e){switch(this.callSuper("_set",t,e),t){case"rx":this.rx=e,this.set("width",2*e);break;case"ry":this.ry=e,this.set("height",2*e)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(t){return this.callSuper("toObject",["rx","ry"].concat(t))},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=0,n=0;return this.group&&"path-group"===this.group.type&&(i=this.left+this.rx,n=this.top+this.ry),e.push("<ellipse ",this.getSvgId(),'cx="',i,'" cy="',n,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),t?t(e.join("")):e.join("")},_render:function(t,e){t.beginPath(),t.save(),t.transform(1,0,0,this.ry/this.rx,0,0),t.arc(e?this.left+this.rx:0,e?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,i,!1),t.restore(),this._renderFill(t),this._renderStroke(t)},complexity:function(){return 1}}),e.Ellipse.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),e.Ellipse.fromElement=function(t,i){i||(i={});var r=e.parseAttributes(t,e.Ellipse.ATTRIBUTE_NAMES);r.left=r.left||0,r.top=r.top||0;var o=new e.Ellipse(n(r,i));return o.top-=o.ry,o.left-=o.rx,o},e.Ellipse.fromObject=function(t,i){var n=new e.Ellipse(t);return i&&i(n),n})}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend;if(e.Rect)e.warn("fabric.Rect is already defined");else{var n=e.Object.prototype.stateProperties.concat();n.push("rx","ry","x","y"),e.Rect=e.util.createClass(e.Object,{stateProperties:n,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(t){t=t||{},this.callSuper("initialize",t),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(t,e){if(1!==this.width||1!==this.height){var i=this.rx?Math.min(this.rx,this.width/2):0,n=this.ry?Math.min(this.ry,this.height/2):0,r=this.width,o=this.height,s=e?this.left:-this.width/2,a=e?this.top:-this.height/2,c=0!==i||0!==n,l=.4477152502;t.beginPath(),t.moveTo(s+i,a),t.lineTo(s+r-i,a),c&&t.bezierCurveTo(s+r-l*i,a,s+r,a+l*n,s+r,a+n),t.lineTo(s+r,a+o-n),c&&t.bezierCurveTo(s+r,a+o-l*n,s+r-l*i,a+o,s+r-i,a+o),t.lineTo(s+i,a+o),c&&t.bezierCurveTo(s+l*i,a+o,s,a+o-l*n,s,a+o-n),t.lineTo(s,a+n),c&&t.bezierCurveTo(s,a+l*n,s+l*i,a,s+i,a),t.closePath(),this._renderFill(t),this._renderStroke(t)}else t.fillRect(-.5,-.5,1,1)},_renderDashedStroke:function(t){var i=-this.width/2,n=-this.height/2,r=this.width,o=this.height;t.beginPath(),e.util.drawDashedLine(t,i,n,i+r,n,this.strokeDashArray),e.util.drawDashedLine(t,i+r,n,i+r,n+o,this.strokeDashArray),e.util.drawDashedLine(t,i+r,n+o,i,n+o,this.strokeDashArray),e.util.drawDashedLine(t,i,n+o,i,n,this.strokeDashArray),t.closePath()},toObject:function(t){return this.callSuper("toObject",["rx","ry"].concat(t))},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=this.left,n=this.top;return this.group&&"path-group"===this.group.type||(i=-this.width/2,n=-this.height/2),e.push("<rect ",this.getSvgId(),'x="',i,'" y="',n,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),t?t(e.join("")):e.join("")},complexity:function(){return 1}}),e.Rect.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),e.Rect.fromElement=function(t,n){if(!t)return null;n=n||{};var r=e.parseAttributes(t,e.Rect.ATTRIBUTE_NAMES);r.left=r.left||0,r.top=r.top||0;var o=new e.Rect(i(n?e.util.object.clone(n):{},r));return o.visible=o.visible&&o.width>0&&o.height>0,o},e.Rect.fromObject=function(t,i){var n=new e.Rect(t);return i&&i(n),n}}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={});e.Polyline?e.warn("fabric.Polyline is already defined"):(e.Polyline=e.util.createClass(e.Object,{type:"polyline",points:null,minX:0,minY:0,initialize:function(t,i){return e.Polygon.prototype.initialize.call(this,t,i)},_calcDimensions:function(){return e.Polygon.prototype._calcDimensions.call(this)},toObject:function(t){return e.Polygon.prototype.toObject.call(this,t)},toSVG:function(t){return e.Polygon.prototype.toSVG.call(this,t)},_render:function(t,i){e.Polygon.prototype.commonRender.call(this,t,i)&&(this._renderFill(t),this._renderStroke(t))},_renderDashedStroke:function(t){var i,n;t.beginPath();for(var r=0,o=this.points.length;r<o;r++)i=this.points[r],n=this.points[r+1]||i,e.util.drawDashedLine(t,i.x,i.y,n.x,n.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),e.Polyline.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polyline.fromElement=function(t,i){if(!t)return null;i||(i={});var n=e.parsePointsAttribute(t.getAttribute("points")),r=e.parseAttributes(t,e.Polyline.ATTRIBUTE_NAMES);return new e.Polyline(n,e.util.object.extend(r,i))},e.Polyline.fromObject=function(t,i){var n=new e.Polyline(t.points,t);return i&&i(n),n})}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.array.min,r=e.util.array.max,o=e.util.toFixed;e.Polygon?e.warn("fabric.Polygon is already defined"):(e.Polygon=e.util.createClass(e.Object,{type:"polygon",points:null,minX:0,minY:0,initialize:function(t,e){e=e||{},this.points=t||[],this.callSuper("initialize",e),this._calcDimensions(),"top"in e||(this.top=this.minY),"left"in e||(this.left=this.minX),this.pathOffset={x:this.minX+this.width/2,y:this.minY+this.height/2}},_calcDimensions:function(){var t=this.points,e=n(t,"x"),i=n(t,"y"),o=r(t,"x"),s=r(t,"y");this.width=o-e||0,this.height=s-i||0,this.minX=e||0,this.minY=i||0},toObject:function(t){return i(this.callSuper("toObject",t),{points:this.points.concat()})},toSVG:function(t){for(var e,i=[],n=this._createBaseSVGMarkup(),r=0,s=this.points.length;r<s;r++)i.push(o(this.points[r].x,2),",",o(this.points[r].y,2)," ");return this.group&&"path-group"===this.group.type||(e=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") "),n.push("<",this.type," ",this.getSvgId(),'points="',i.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),e," ",this.getSvgTransformMatrix(),'"/>\n'),t?t(n.join("")):n.join("")},_render:function(t,e){this.commonRender(t,e)&&(this._renderFill(t),(this.stroke||this.strokeDashArray)&&(t.closePath(),this._renderStroke(t)))},commonRender:function(t,e){var i,n=this.points.length;if(!n||isNaN(this.points[n-1].y))return!1;e||t.translate(-this.pathOffset.x,-this.pathOffset.y),t.beginPath(),t.moveTo(this.points[0].x,this.points[0].y);for(var r=0;r<n;r++)i=this.points[r],t.lineTo(i.x,i.y);return!0},_renderDashedStroke:function(t){e.Polyline.prototype._renderDashedStroke.call(this,t),t.closePath()},complexity:function(){return this.points.length}}),e.Polygon.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polygon.fromElement=function(t,n){if(!t)return null;n||(n={});var r=e.parsePointsAttribute(t.getAttribute("points")),o=e.parseAttributes(t,e.Polygon.ATTRIBUTE_NAMES);return new e.Polygon(r,i(o,n))},e.Polygon.fromObject=function(t,i){var n=new e.Polygon(t.points,t);return i&&i(n),n})}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.array.min,n=e.util.array.max,r=e.util.object.extend,o=Object.prototype.toString,s=e.util.drawArc,a={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},c={m:"l",M:"L"};e.Path?e.warn("fabric.Path is already defined"):(e.Path=e.util.createClass(e.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(t,e){e=e||{},this.setOptions(e),t||(t=[]);var i="[object Array]"===o.call(t);this.path=i?t:t.match&&t.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path&&(i||(this.path=this._parsePath()),this._setPositionDimensions(e),e.sourcePath&&this.setSourcePath(e.sourcePath))},_setPositionDimensions:function(t){var e=this._parseDimensions();this.minX=e.left,this.minY=e.top,this.width=e.width,this.height=e.height,void 0===t.left&&(this.left=e.left+("center"===this.originX?this.width/2:"right"===this.originX?this.width:0)),void 0===t.top&&(this.top=e.top+("center"===this.originY?this.height/2:"bottom"===this.originY?this.height:0)),this.pathOffset=this.pathOffset||{x:this.minX+this.width/2,y:this.minY+this.height/2}},_renderPathCommands:function(t){var e,i,n,r=null,o=0,a=0,c=0,l=0,h=0,u=0,f=-this.pathOffset.x,d=-this.pathOffset.y;this.group&&"path-group"===this.group.type&&(f=0,d=0),t.beginPath();for(var p=0,g=this.path.length;p<g;++p){switch((e=this.path[p])[0]){case"l":c+=e[1],l+=e[2],t.lineTo(c+f,l+d);break;case"L":c=e[1],l=e[2],t.lineTo(c+f,l+d);break;case"h":c+=e[1],t.lineTo(c+f,l+d);break;case"H":c=e[1],t.lineTo(c+f,l+d);break;case"v":l+=e[1],t.lineTo(c+f,l+d);break;case"V":l=e[1],t.lineTo(c+f,l+d);break;case"m":o=c+=e[1],a=l+=e[2],t.moveTo(c+f,l+d);break;case"M":o=c=e[1],a=l=e[2],t.moveTo(c+f,l+d);break;case"c":i=c+e[5],n=l+e[6],h=c+e[3],u=l+e[4],t.bezierCurveTo(c+e[1]+f,l+e[2]+d,h+f,u+d,i+f,n+d),c=i,l=n;break;case"C":c=e[5],l=e[6],h=e[3],u=e[4],t.bezierCurveTo(e[1]+f,e[2]+d,h+f,u+d,c+f,l+d);break;case"s":i=c+e[3],n=l+e[4],null===r[0].match(/[CcSs]/)?(h=c,u=l):(h=2*c-h,u=2*l-u),t.bezierCurveTo(h+f,u+d,c+e[1]+f,l+e[2]+d,i+f,n+d),h=c+e[1],u=l+e[2],c=i,l=n;break;case"S":i=e[3],n=e[4],null===r[0].match(/[CcSs]/)?(h=c,u=l):(h=2*c-h,u=2*l-u),t.bezierCurveTo(h+f,u+d,e[1]+f,e[2]+d,i+f,n+d),c=i,l=n,h=e[1],u=e[2];break;case"q":i=c+e[3],n=l+e[4],h=c+e[1],u=l+e[2],t.quadraticCurveTo(h+f,u+d,i+f,n+d),c=i,l=n;break;case"Q":i=e[3],n=e[4],t.quadraticCurveTo(e[1]+f,e[2]+d,i+f,n+d),c=i,l=n,h=e[1],u=e[2];break;case"t":i=c+e[1],n=l+e[2],null===r[0].match(/[QqTt]/)?(h=c,u=l):(h=2*c-h,u=2*l-u),t.quadraticCurveTo(h+f,u+d,i+f,n+d),c=i,l=n;break;case"T":i=e[1],n=e[2],null===r[0].match(/[QqTt]/)?(h=c,u=l):(h=2*c-h,u=2*l-u),t.quadraticCurveTo(h+f,u+d,i+f,n+d),c=i,l=n;break;case"a":s(t,c+f,l+d,[e[1],e[2],e[3],e[4],e[5],e[6]+c+f,e[7]+l+d]),c+=e[6],l+=e[7];break;case"A":s(t,c+f,l+d,[e[1],e[2],e[3],e[4],e[5],e[6]+f,e[7]+d]),c=e[6],l=e[7];break;case"z":case"Z":c=o,l=a,t.closePath()}r=e}},_render:function(t){this._renderPathCommands(t),this._renderFill(t),this._renderStroke(t)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(t){return r(this.callSuper("toObject",["sourcePath","pathOffset"].concat(t)),{path:this.path.map(function(t){return t.slice()})})},toDatalessObject:function(t){var e=this.toObject(t);return this.sourcePath&&(e.path=this.sourcePath),delete e.sourcePath,e},toSVG:function(t){for(var e=[],i=this._createBaseSVGMarkup(),n="",r=0,o=this.path.length;r<o;r++)e.push(this.path[r].join(" "));var s=e.join(" ");return this.group&&"path-group"===this.group.type||(n=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") "),i.push("<path ",this.getSvgId(),'d="',s,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),n,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n"),t?t(i.join("")):i.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var t,e,i,n,r,o=[],s=[],l=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,h=0,u=this.path.length;h<u;h++){for(n=(t=this.path[h]).slice(1).trim(),s.length=0;i=l.exec(n);)s.push(i[0]);r=[t.charAt(0)];for(var f=0,d=s.length;f<d;f++)e=parseFloat(s[f]),isNaN(e)||r.push(e);var p=r[0],g=a[p.toLowerCase()],v=c[p]||p;if(r.length-1>g)for(var m=1,b=r.length;m<b;m+=g)o.push([p].concat(r.slice(m,m+g))),p=v;else o.push(r)}return o},_parseDimensions:function(){for(var t,r,o,s,a=[],c=[],l=null,h=0,u=0,f=0,d=0,p=0,g=0,v=0,m=this.path.length;v<m;++v){switch((t=this.path[v])[0]){case"l":f+=t[1],d+=t[2],s=[];break;case"L":f=t[1],d=t[2],s=[];break;case"h":f+=t[1],s=[];break;case"H":f=t[1],s=[];break;case"v":d+=t[1],s=[];break;case"V":d=t[1],s=[];break;case"m":h=f+=t[1],u=d+=t[2],s=[];break;case"M":h=f=t[1],u=d=t[2],s=[];break;case"c":r=f+t[5],o=d+t[6],p=f+t[3],g=d+t[4],s=e.util.getBoundsOfCurve(f,d,f+t[1],d+t[2],p,g,r,o),f=r,d=o;break;case"C":f=t[5],d=t[6],p=t[3],g=t[4],s=e.util.getBoundsOfCurve(f,d,t[1],t[2],p,g,f,d);break;case"s":r=f+t[3],o=d+t[4],null===l[0].match(/[CcSs]/)?(p=f,g=d):(p=2*f-p,g=2*d-g),s=e.util.getBoundsOfCurve(f,d,p,g,f+t[1],d+t[2],r,o),p=f+t[1],g=d+t[2],f=r,d=o;break;case"S":r=t[3],o=t[4],null===l[0].match(/[CcSs]/)?(p=f,g=d):(p=2*f-p,g=2*d-g),s=e.util.getBoundsOfCurve(f,d,p,g,t[1],t[2],r,o),f=r,d=o,p=t[1],g=t[2];break;case"q":r=f+t[3],o=d+t[4],p=f+t[1],g=d+t[2],s=e.util.getBoundsOfCurve(f,d,p,g,p,g,r,o),f=r,d=o;break;case"Q":p=t[1],g=t[2],s=e.util.getBoundsOfCurve(f,d,p,g,p,g,t[3],t[4]),f=t[3],d=t[4];break;case"t":r=f+t[1],o=d+t[2],null===l[0].match(/[QqTt]/)?(p=f,g=d):(p=2*f-p,g=2*d-g),s=e.util.getBoundsOfCurve(f,d,p,g,p,g,r,o),f=r,d=o;break;case"T":r=t[1],o=t[2],null===l[0].match(/[QqTt]/)?(p=f,g=d):(p=2*f-p,g=2*d-g),s=e.util.getBoundsOfCurve(f,d,p,g,p,g,r,o),f=r,d=o;break;case"a":s=e.util.getBoundsOfArc(f,d,t[1],t[2],t[3],t[4],t[5],t[6]+f,t[7]+d),f+=t[6],d+=t[7];break;case"A":s=e.util.getBoundsOfArc(f,d,t[1],t[2],t[3],t[4],t[5],t[6],t[7]),f=t[6],d=t[7];break;case"z":case"Z":f=h,d=u}l=t,s.forEach(function(t){a.push(t.x),c.push(t.y)}),a.push(f),c.push(d)}var b=i(a)||0,y=i(c)||0;return{left:b,top:y,width:(n(a)||0)-b,height:(n(c)||0)-y}}}),e.Path.fromObject=function(t,i){var n;if("string"!=typeof t.path)return n=new e.Path(t.path,t),i&&i(n),n;e.loadSVGFromURL(t.path,function(r){var o=t.path;n=r[0],delete t.path,e.util.object.extend(n,t),n.setSourcePath(o),i&&i(n)})},e.Path.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(["d"]),e.Path.fromElement=function(t,i,n){var o=e.parseAttributes(t,e.Path.ATTRIBUTE_NAMES);i&&i(new e.Path(o.d,r(o,n)))},e.Path.async=!0)}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.array.invoke,r=e.Object.prototype.toObject;e.PathGroup?e.warn("fabric.PathGroup is already defined"):(e.PathGroup=e.util.createClass(e.Path,{type:"path-group",fill:"",initialize:function(t,e){e=e||{},this.paths=t||[];for(var i=this.paths.length;i--;)this.paths[i].group=this;e.toBeParsed&&(this.parseDimensionsFromPaths(e),delete e.toBeParsed),this.setOptions(e),this.setCoords(),e.sourcePath&&this.setSourcePath(e.sourcePath)},parseDimensionsFromPaths:function(t){for(var i,n,r,o,s,a,c=[],l=[],h=this.paths.length;h--;){o=(r=this.paths[h]).height+r.strokeWidth,s=r.width+r.strokeWidth,i=[{x:r.left,y:r.top},{x:r.left+s,y:r.top},{x:r.left,y:r.top+o},{x:r.left+s,y:r.top+o}],a=this.paths[h].transformMatrix;for(var u=0;u<i.length;u++)n=i[u],a&&(n=e.util.transformPoint(n,a,!1)),c.push(n.x),l.push(n.y)}t.width=Math.max.apply(null,c),t.height=Math.max.apply(null,l)},render:function(t){if(this.visible){t.save(),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this.transform(t),this._setShadow(t),this.clipTo&&e.util.clipContext(this,t),t.translate(-this.width/2,-this.height/2);for(var i=0,n=this.paths.length;i<n;++i)this.paths[i].render(t,!0);this.clipTo&&t.restore(),t.restore()}},_set:function(t,e){if("fill"===t&&e&&this.isSameColor())for(var i=this.paths.length;i--;)this.paths[i]._set(t,e);return this.callSuper("_set",t,e)},toObject:function(t){return i(r.call(this,["sourcePath"].concat(t)),{paths:n(this.getObjects(),"toObject",t)})},toDatalessObject:function(t){var e=this.toObject(t);return this.sourcePath&&(e.paths=this.sourcePath),e},toSVG:function(t){var e=this.getObjects(),i=this.getPointByOrigin("left","top"),n="translate("+i.x+" "+i.y+")",r=this._createBaseSVGMarkup();r.push("<g ",this.getSvgId(),'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransformMatrix(),n,this.getSvgTransform(),'" ',">\n");for(var o=0,s=e.length;o<s;o++)r.push("\t",e[o].toSVG(t));return r.push("</g>\n"),t?t(r.join("")):r.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var t=this.getObjects()[0].get("fill")||"";return"string"==typeof t&&(t=t.toLowerCase(),this.getObjects().every(function(e){var i=e.get("fill")||"";return"string"==typeof i&&i.toLowerCase()===t}))},complexity:function(){return this.paths.reduce(function(t,e){return t+(e&&e.complexity?e.complexity():0)},0)},getObjects:function(){return this.paths}}),e.PathGroup.fromObject=function(t,i){"string"==typeof t.paths?e.loadSVGFromURL(t.paths,function(n){var r=t.paths;delete t.paths;var o=e.util.groupSVGElements(n,t,r);i(o)}):e.util.enlivenObjects(t.paths,function(n){delete t.paths,i(new e.PathGroup(n,t))})},e.PathGroup.async=!0)}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.array.min,r=e.util.array.max,o=e.util.array.invoke;if(!e.Group){var s={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};e.Group=e.util.createClass(e.Object,e.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,initialize:function(t,e,i){e=e||{},this._objects=[],i&&this.callSuper("initialize",e),this._objects=t||[];for(var n=this._objects.length;n--;)this._objects[n].group=this;this.originalState={},e.originX&&(this.originX=e.originX),e.originY&&(this.originY=e.originY),i?this._updateObjectsCoords(!0):(this._calcBounds(),this._updateObjectsCoords(),this.callSuper("initialize",e)),this.setCoords(),this.saveCoords()},_updateObjectsCoords:function(t){for(var e=this._objects.length;e--;)this._updateObjectCoords(this._objects[e],t)},_updateObjectCoords:function(t,e){if(t.__origHasControls=t.hasControls,t.hasControls=!1,!e){var i=t.getLeft(),n=t.getTop(),r=this.getCenterPoint();t.set({originalLeft:i,originalTop:n,left:i-r.x,top:n-r.y}),t.setCoords()}},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(t){return this._restoreObjectsState(),e.util.resetObjectTransform(this),t&&(this._objects.push(t),t.group=this,t._set("canvas",this.canvas)),this.forEachObject(this._setObjectActive,this),this._calcBounds(),this._updateObjectsCoords(),this},_setObjectActive:function(t){t.set("active",!0),t.group=this},removeWithUpdate:function(t){return this._restoreObjectsState(),e.util.resetObjectTransform(this),this.forEachObject(this._setObjectActive,this),this.remove(t),this._calcBounds(),this._updateObjectsCoords(),this},_onObjectAdded:function(t){t.group=this,t._set("canvas",this.canvas)},_onObjectRemoved:function(t){delete t.group,t.set("active",!1)},delegatedProperties:{fill:!0,stroke:!0,strokeWidth:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(t,e){var i=this._objects.length;if(this.delegatedProperties[t]||"canvas"===t)for(;i--;)this._objects[i].set(t,e);else for(;i--;)this._objects[i].setOnGroup(t,e);this.callSuper("_set",t,e)},toObject:function(t){return i(this.callSuper("toObject",t),{objects:o(this._objects,"toObject",t)})},render:function(t){if(this.visible){t.save(),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this.transform(t),this._setShadow(t),this.clipTo&&e.util.clipContext(this,t),this._transformDone=!0;for(var i=0,n=this._objects.length;i<n;i++)this._renderObject(this._objects[i],t);this.clipTo&&t.restore(),t.restore(),this._transformDone=!1}},_renderControls:function(t,e){this.callSuper("_renderControls",t,e);for(var i=0,n=this._objects.length;i<n;i++)this._objects[i]._renderControls(t)},_renderObject:function(t,e){if(t.visible){var i=t.hasRotatingPoint;t.hasRotatingPoint=!1,t.render(e),t.hasRotatingPoint=i}},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(t){var i=t.calcTransformMatrix(),n=e.util.qrDecompose(i),r=new e.Point(n.translateX,n.translateY);return t.scaleX=n.scaleX,t.scaleY=n.scaleY,t.skewX=n.skewX,t.skewY=n.skewY,t.angle=n.angle,t.flipX=!1,t.flipY=!1,t.setPositionByOrigin(r,"center","center"),t},_restoreObjectState:function(t){return this.realizeTransform(t),t.setCoords(),t.hasControls=t.__origHasControls,delete t.__origHasControls,t.set("active",!1),delete t.group,this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){return this._originalLeft=this.get("left"),this._originalTop=this.get("top"),this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){return this.forEachObject(function(t){t.setCoords()}),this},_calcBounds:function(t){for(var e,i,n,r=[],o=[],s=["tr","br","bl","tl"],a=0,c=this._objects.length,l=s.length;a<c;++a)for((e=this._objects[a]).setCoords(),n=0;n<l;n++)i=s[n],r.push(e.oCoords[i].x),o.push(e.oCoords[i].y);this.set(this._getBounds(r,o,t))},_getBounds:function(t,i,o){var s=e.util.invertTransform(this.getViewportTransform()),a=e.util.transformPoint(new e.Point(n(t),n(i)),s),c=e.util.transformPoint(new e.Point(r(t),r(i)),s),l={width:c.x-a.x||0,height:c.y-a.y||0};return o||(l.left=a.x||0,l.top=a.y||0,"center"===this.originX&&(l.left+=l.width/2),"right"===this.originX&&(l.left+=l.width),"center"===this.originY&&(l.top+=l.height/2),"bottom"===this.originY&&(l.top+=l.height)),l},toSVG:function(t){var e=this._createBaseSVGMarkup();e.push("<g ",this.getSvgId(),'transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'" style="',this.getSvgFilter(),'">\n');for(var i=0,n=this._objects.length;i<n;i++)e.push("\t",this._objects[i].toSVG(t));return e.push("</g>\n"),t?t(e.join("")):e.join("")},get:function(t){if(t in s){if(this[t])return this[t];for(var e=0,i=this._objects.length;e<i;e++)if(this._objects[e][t])return!0;return!1}return t in this.delegatedProperties?this._objects[0]&&this._objects[0].get(t):this[t]}}),e.Group.fromObject=function(t,i){e.util.enlivenObjects(t.objects,function(n){delete t.objects,i&&i(new e.Group(n,t,!0))})},e.Group.async=!0}}(exports),function(t){"use strict";var e=fabric.util.object.extend;if(t.fabric||(t.fabric={}),t.fabric.Image)fabric.warn("fabric.Image is already defined.");else{var i=fabric.Object.prototype.stateProperties.concat();i.push("alignX","alignY","meetOrSlice"),fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",strokeWidth:0,_lastScaleX:1,_lastScaleY:1,minimumScaleTrigger:.5,stateProperties:i,initialize:function(t,e,i){e||(e={}),this.filters=[],this.resizeFilters=[],this.callSuper("initialize",e),this._initElement(t,e,i)},getElement:function(){return this._element},setElement:function(t,e,i){var n,r;return this._element=t,this._originalElement=t,this._initConfig(i),0===this.resizeFilters.length?n=e:(r=this,n=function(){r.applyFilters(e,r.resizeFilters,r._filteredEl||r._originalElement,!0)}),0!==this.filters.length?this.applyFilters(n):n&&n(this),this},setCrossOrigin:function(t){return this.crossOrigin=t,this._element.crossOrigin=t,this},getOriginalSize:function(){var t=this.getElement();return{width:t.width,height:t.height}},_stroke:function(t){if(this.stroke&&0!==this.strokeWidth){var e=this.width/2,i=this.height/2;t.beginPath(),t.moveTo(-e,-i),t.lineTo(e,-i),t.lineTo(e,i),t.lineTo(-e,i),t.lineTo(-e,-i),t.closePath()}},_renderDashedStroke:function(t){var e=-this.width/2,i=-this.height/2,n=this.width,r=this.height;t.save(),this._setStrokeStyles(t),t.beginPath(),fabric.util.drawDashedLine(t,e,i,e+n,i,this.strokeDashArray),fabric.util.drawDashedLine(t,e+n,i,e+n,i+r,this.strokeDashArray),fabric.util.drawDashedLine(t,e+n,i+r,e,i+r,this.strokeDashArray),fabric.util.drawDashedLine(t,e,i+r,e,i,this.strokeDashArray),t.closePath(),t.restore()},toObject:function(t){var i=[],n=[],r=1,o=1;this.filters.forEach(function(t){t&&("Resize"===t.type&&(r*=t.scaleX,o*=t.scaleY),i.push(t.toObject()))}),this.resizeFilters.forEach(function(t){t&&n.push(t.toObject())});var s=e(this.callSuper("toObject",["crossOrigin","alignX","alignY","meetOrSlice"].concat(t)),{src:this.getSrc(),filters:i,resizeFilters:n});return s.width/=r,s.height/=o,s},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=-this.width/2,n=-this.height/2,r="none";if(this.group&&"path-group"===this.group.type&&(i=this.left,n=this.top),"none"!==this.alignX&&"none"!==this.alignY&&(r="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice),e.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n',"<image ",this.getSvgId(),'xlink:href="',this.getSvgSrc(!0),'" x="',i,'" y="',n,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',r,'"',"></image>\n"),this.stroke||this.strokeDashArray){var o=this.fill;this.fill=null,e.push("<rect ",'x="',i,'" y="',n,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=o}return e.push("</g>\n"),t?t(e.join("")):e.join("")},getSrc:function(t){var e=t?this._element:this._originalElement;return e?fabric.isLikelyNode?e._src:e.src:this.src||""},setSrc:function(t,e,i){fabric.util.loadImage(t,function(t){return this.setElement(t,e,i)},this,i&&i.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyFilters:function(t,e,i,n){if(e=e||this.filters,i=i||this._originalElement){var r,o,s=fabric.util.createImage(),a=this.canvas?this.canvas.getRetinaScaling():fabric.devicePixelRatio,c=this.minimumScaleTrigger/a,l=this;if(0===e.length)return this._element=i,t&&t(this),i;var h=fabric.util.createCanvasElement();return h.width=i.width,h.height=i.height,h.getContext("2d").drawImage(i,0,0,i.width,i.height),e.forEach(function(t){t&&(n?(r=l.scaleX<c?l.scaleX:1,o=l.scaleY<c?l.scaleY:1,r*a<1&&(r*=a),o*a<1&&(o*=a)):(r=t.scaleX,o=t.scaleY),t.applyTo(h,r,o),n||"Resize"!==t.type||(l.width*=t.scaleX,l.height*=t.scaleY))}),s.width=h.width,s.height=h.height,fabric.isLikelyNode?(s.src=h.toBuffer(void 0,fabric.Image.pngCompression),l._element=s,!n&&(l._filteredEl=s),t&&t(l)):(s.onload=function(){l._element=s,!n&&(l._filteredEl=s),t&&t(l),s.onload=h=null},s.src=h.toDataURL("image/png")),h}},_render:function(t,e){var i,n,r,o=this._findMargins();i=e?this.left:-this.width/2,n=e?this.top:-this.height/2,"slice"===this.meetOrSlice&&(t.beginPath(),t.rect(i,n,this.width,this.height),t.clip()),!1===this.isMoving&&this.resizeFilters.length&&this._needsResize()?(this._lastScaleX=this.scaleX,this._lastScaleY=this.scaleY,r=this.applyFilters(null,this.resizeFilters,this._filteredEl||this._originalElement,!0)):r=this._element,r&&t.drawImage(r,i+o.marginX,n+o.marginY,o.width,o.height),this._stroke(t),this._renderStroke(t)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var t,e,i=this.width,n=this.height,r=0,o=0;return"none"===this.alignX&&"none"===this.alignY||(t=[this.width/this._element.width,this.height/this._element.height],e="meet"===this.meetOrSlice?Math.min.apply(null,t):Math.max.apply(null,t),i=this._element.width*e,n=this._element.height*e,"Mid"===this.alignX&&(r=(this.width-i)/2),"Max"===this.alignX&&(r=this.width-i),"Mid"===this.alignY&&(o=(this.height-n)/2),"Max"===this.alignY&&(o=this.height-n)),{width:i,height:n,marginX:r,marginY:o}},_resetWidthHeight:function(){var t=this.getElement();this.set("width",t.width),this.set("height",t.height)},_initElement:function(t,e,i){this.setElement(fabric.util.getById(t),i,e),fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(t){t||(t={}),this.setOptions(t),this._setWidthHeight(t),this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(t,e){t&&t.length?fabric.util.enlivenObjects(t,function(t){e&&e(t)},"fabric.Image.filters"):e&&e()},_setWidthHeight:function(t){this.width="width"in t?t.width:this.getElement()&&this.getElement().width||0,this.height="height"in t?t.height:this.getElement()&&this.getElement().height||0},complexity:function(){return 1}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(t,e){fabric.util.loadImage(t.src,function(i){fabric.Image.prototype._initFilters.call(t,t.filters,function(n){t.filters=n||[],fabric.Image.prototype._initFilters.call(t,t.resizeFilters,function(n){return t.resizeFilters=n||[],new fabric.Image(i,t,e)})})},null,t.crossOrigin)},fabric.Image.fromURL=function(t,e,i){fabric.util.loadImage(t,function(t){e&&e(new fabric.Image(t,i))},null,i&&i.crossOrigin)},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href".split(" ")),fabric.Image.fromElement=function(t,i,n){var r,o=fabric.parseAttributes(t,fabric.Image.ATTRIBUTE_NAMES);o.preserveAspectRatio&&(r=fabric.util.parsePreserveAspectRatioAttribute(o.preserveAspectRatio),e(o,r)),fabric.Image.fromURL(o["xlink:href"],i,e(n?fabric.util.object.clone(n):{},o))},fabric.Image.async=!0,fabric.Image.pngCompression=1}}(exports),fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var t=this.getAngle()%360;return t>0?90*Math.round((t-1)/90):90*Math.round(t/90)},straighten:function(){return this.setAngle(this._getAngleValueForStraighten()),this},fxStraighten:function(t){var e=function(){},i=(t=t||{}).onComplete||e,n=t.onChange||e,r=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(t){r.setAngle(t),n()},onComplete:function(){r.setCoords(),i()},onStart:function(){r.set("active",!1)}}),this}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(t){return t.straighten(),this.renderAll(),this},fxStraightenObject:function(t){return t.fxStraighten({onChange:this.renderAll.bind(this)}),this}}),fabric.Image.filters=fabric.Image.filters||{},fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",initialize:function(t){t&&this.setOptions(t)},setOptions:function(t){for(var e in t)this[e]=t[e]},toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}}),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.Brightness=r(n.BaseFilter,{type:"Brightness",initialize:function(t){t=t||{},this.brightness=t.brightness||0},applyTo:function(t){for(var e=t.getContext("2d"),i=e.getImageData(0,0,t.width,t.height),n=i.data,r=this.brightness,o=0,s=n.length;o<s;o+=4)n[o]+=r,n[o+1]+=r,n[o+2]+=r;e.putImageData(i,0,0)},toObject:function(){return i(this.callSuper("toObject"),{brightness:this.brightness})}}),e.Image.filters.Brightness.fromObject=function(t){return new e.Image.filters.Brightness(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.Convolute=r(n.BaseFilter,{type:"Convolute",initialize:function(t){t=t||{},this.opaque=t.opaque,this.matrix=t.matrix||[0,0,0,0,1,0,0,0,0]},applyTo:function(t){for(var e,i,n,r,o,s,a,c,l,h=this.matrix,u=t.getContext("2d"),f=u.getImageData(0,0,t.width,t.height),d=Math.round(Math.sqrt(h.length)),p=Math.floor(d/2),g=f.data,v=f.width,m=f.height,b=u.createImageData(v,m),y=b.data,_=this.opaque?1:0,x=0;x<m;x++)for(var w=0;w<v;w++){o=4*(x*v+w),e=0,i=0,n=0,r=0;for(var S=0;S<d;S++)for(var C=0;C<d;C++)s=w+C-p,(a=x+S-p)<0||a>m||s<0||s>v||(c=4*(a*v+s),l=h[S*d+C],e+=g[c]*l,i+=g[c+1]*l,n+=g[c+2]*l,r+=g[c+3]*l);y[o]=e,y[o+1]=i,y[o+2]=n,y[o+3]=r+_*(255-r)}u.putImageData(b,0,0)},toObject:function(){return i(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),e.Image.filters.Convolute.fromObject=function(t){return new e.Image.filters.Convolute(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.GradientTransparency=r(n.BaseFilter,{type:"GradientTransparency",initialize:function(t){t=t||{},this.threshold=t.threshold||100},applyTo:function(t){for(var e=t.getContext("2d"),i=e.getImageData(0,0,t.width,t.height),n=i.data,r=this.threshold,o=n.length,s=0,a=n.length;s<a;s+=4)n[s+3]=r+255*(o-s)/o;e.putImageData(i,0,0)},toObject:function(){return i(this.callSuper("toObject"),{threshold:this.threshold})}}),e.Image.filters.GradientTransparency.fromObject=function(t){return new e.Image.filters.GradientTransparency(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Grayscale=n(i.BaseFilter,{type:"Grayscale",applyTo:function(t){for(var e,i=t.getContext("2d"),n=i.getImageData(0,0,t.width,t.height),r=n.data,o=n.width*n.height*4,s=0;s<o;)e=(r[s]+r[s+1]+r[s+2])/3,r[s]=e,r[s+1]=e,r[s+2]=e,s+=4;i.putImageData(n,0,0)}}),e.Image.filters.Grayscale.fromObject=function(){return new e.Image.filters.Grayscale}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Invert=n(i.BaseFilter,{type:"Invert",applyTo:function(t){var e,i=t.getContext("2d"),n=i.getImageData(0,0,t.width,t.height),r=n.data,o=r.length;for(e=0;e<o;e+=4)r[e]=255-r[e],r[e+1]=255-r[e+1],r[e+2]=255-r[e+2];i.putImageData(n,0,0)}}),e.Image.filters.Invert.fromObject=function(){return new e.Image.filters.Invert}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.Mask=r(n.BaseFilter,{type:"Mask",initialize:function(t){t=t||{},this.mask=t.mask,this.channel=[0,1,2,3].indexOf(t.channel)>-1?t.channel:0},applyTo:function(t){if(this.mask){var i,n=t.getContext("2d"),r=n.getImageData(0,0,t.width,t.height),o=r.data,s=this.mask.getElement(),a=e.util.createCanvasElement(),c=this.channel,l=r.width*r.height*4;a.width=t.width,a.height=t.height,a.getContext("2d").drawImage(s,0,0,t.width,t.height);var h=a.getContext("2d").getImageData(0,0,t.width,t.height).data;for(i=0;i<l;i+=4)o[i+3]=h[i+c];n.putImageData(r,0,0)}},toObject:function(){return i(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}}),e.Image.filters.Mask.fromObject=function(t,i){e.util.loadImage(t.mask.src,function(n){t.mask=new e.Image(n,t.mask),i&&i(new e.Image.filters.Mask(t))})},e.Image.filters.Mask.async=!0}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.Noise=r(n.BaseFilter,{type:"Noise",initialize:function(t){t=t||{},this.noise=t.noise||0},applyTo:function(t){for(var e,i=t.getContext("2d"),n=i.getImageData(0,0,t.width,t.height),r=n.data,o=this.noise,s=0,a=r.length;s<a;s+=4)e=(.5-Math.random())*o,r[s]+=e,r[s+1]+=e,r[s+2]+=e;i.putImageData(n,0,0)},toObject:function(){return i(this.callSuper("toObject"),{noise:this.noise})}}),e.Image.filters.Noise.fromObject=function(t){return new e.Image.filters.Noise(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.Pixelate=r(n.BaseFilter,{type:"Pixelate",initialize:function(t){t=t||{},this.blocksize=t.blocksize||4},applyTo:function(t){var e,i,n,r,o,s,a,c=t.getContext("2d"),l=c.getImageData(0,0,t.width,t.height),h=l.data,u=l.height,f=l.width;for(i=0;i<u;i+=this.blocksize)for(n=0;n<f;n+=this.blocksize){r=h[e=4*i*f+4*n],o=h[e+1],s=h[e+2],a=h[e+3];for(var d=i,p=i+this.blocksize;d<p;d++)for(var g=n,v=n+this.blocksize;g<v;g++)h[e=4*d*f+4*g]=r,h[e+1]=o,h[e+2]=s,h[e+3]=a}c.putImageData(l,0,0)},toObject:function(){return i(this.callSuper("toObject"),{blocksize:this.blocksize})}}),e.Image.filters.Pixelate.fromObject=function(t){return new e.Image.filters.Pixelate(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.RemoveWhite=r(n.BaseFilter,{type:"RemoveWhite",initialize:function(t){t=t||{},this.threshold=t.threshold||30,this.distance=t.distance||20},applyTo:function(t){for(var e,i,n,r=t.getContext("2d"),o=r.getImageData(0,0,t.width,t.height),s=o.data,a=this.threshold,c=this.distance,l=255-a,h=Math.abs,u=0,f=s.length;u<f;u+=4)e=s[u],i=s[u+1],n=s[u+2],e>l&&i>l&&n>l&&h(e-i)<c&&h(e-n)<c&&h(i-n)<c&&(s[u+3]=0);r.putImageData(o,0,0)},toObject:function(){return i(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}}),e.Image.filters.RemoveWhite.fromObject=function(t){return new e.Image.filters.RemoveWhite(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Sepia=n(i.BaseFilter,{type:"Sepia",applyTo:function(t){var e,i,n=t.getContext("2d"),r=n.getImageData(0,0,t.width,t.height),o=r.data,s=o.length;for(e=0;e<s;e+=4)i=.3*o[e]+.59*o[e+1]+.11*o[e+2],o[e]=i+100,o[e+1]=i+50,o[e+2]=i+255;n.putImageData(r,0,0)}}),e.Image.filters.Sepia.fromObject=function(){return new e.Image.filters.Sepia}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Sepia2=n(i.BaseFilter,{type:"Sepia2",applyTo:function(t){var e,i,n,r,o=t.getContext("2d"),s=o.getImageData(0,0,t.width,t.height),a=s.data,c=a.length;for(e=0;e<c;e+=4)i=a[e],n=a[e+1],r=a[e+2],a[e]=(.393*i+.769*n+.189*r)/1.351,a[e+1]=(.349*i+.686*n+.168*r)/1.203,a[e+2]=(.272*i+.534*n+.131*r)/2.14;o.putImageData(s,0,0)}}),e.Image.filters.Sepia2.fromObject=function(){return new e.Image.filters.Sepia2}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.Tint=r(n.BaseFilter,{type:"Tint",initialize:function(t){t=t||{},this.color=t.color||"#000000",this.opacity=void 0!==t.opacity?t.opacity:new e.Color(this.color).getAlpha()},applyTo:function(t){var i,n,r,o,s,a,c,l,h,u=t.getContext("2d"),f=u.getImageData(0,0,t.width,t.height),d=f.data,p=d.length;for(n=(h=new e.Color(this.color).getSource())[0]*this.opacity,r=h[1]*this.opacity,o=h[2]*this.opacity,l=1-this.opacity,i=0;i<p;i+=4)s=d[i],a=d[i+1],c=d[i+2],d[i]=n+s*l,d[i+1]=r+a*l,d[i+2]=o+c*l;u.putImageData(f,0,0)},toObject:function(){return i(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}}),e.Image.filters.Tint.fromObject=function(t){return new e.Image.filters.Tint(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.Multiply=r(n.BaseFilter,{type:"Multiply",initialize:function(t){t=t||{},this.color=t.color||"#000000"},applyTo:function(t){var i,n,r=t.getContext("2d"),o=r.getImageData(0,0,t.width,t.height),s=o.data,a=s.length;for(n=new e.Color(this.color).getSource(),i=0;i<a;i+=4)s[i]*=n[0]/255,s[i+1]*=n[1]/255,s[i+2]*=n[2]/255;r.putImageData(o,0,0)},toObject:function(){return i(this.callSuper("toObject"),{color:this.color})}}),e.Image.filters.Multiply.fromObject=function(t){return new e.Image.filters.Multiply(t)}}(exports),function(t){"use strict";var e=t.fabric,i=e.Image.filters,n=e.util.createClass;i.Blend=n(i.BaseFilter,{type:"Blend",initialize:function(t){t=t||{},this.color=t.color||"#000",this.image=t.image||!1,this.mode=t.mode||"multiply",this.alpha=t.alpha||1},applyTo:function(t){var i,n,r,o,s,a,c,l,h,u,f=t.getContext("2d"),d=f.getImageData(0,0,t.width,t.height),p=d.data,g=!1;if(this.image){g=!0;var v=e.util.createCanvasElement();v.width=this.image.width,v.height=this.image.height;var m=new e.StaticCanvas(v);m.add(this.image),u=m.getContext("2d").getImageData(0,0,m.width,m.height).data}else i=(u=new e.Color(this.color).getSource())[0]*this.alpha,n=u[1]*this.alpha,r=u[2]*this.alpha;for(var b=0,y=p.length;b<y;b+=4)switch(o=p[b],s=p[b+1],a=p[b+2],g&&(i=u[b]*this.alpha,n=u[b+1]*this.alpha,r=u[b+2]*this.alpha),this.mode){case"multiply":p[b]=o*i/255,p[b+1]=s*n/255,p[b+2]=a*r/255;break;case"screen":p[b]=1-(1-o)*(1-i),p[b+1]=1-(1-s)*(1-n),p[b+2]=1-(1-a)*(1-r);break;case"add":p[b]=Math.min(255,o+i),p[b+1]=Math.min(255,s+n),p[b+2]=Math.min(255,a+r);break;case"diff":case"difference":p[b]=Math.abs(o-i),p[b+1]=Math.abs(s-n),p[b+2]=Math.abs(a-r);break;case"subtract":c=o-i,l=s-n,h=a-r,p[b]=c<0?0:c,p[b+1]=l<0?0:l,p[b+2]=h<0?0:h;break;case"darken":p[b]=Math.min(o,i),p[b+1]=Math.min(s,n),p[b+2]=Math.min(a,r);break;case"lighten":p[b]=Math.max(o,i),p[b+1]=Math.max(s,n),p[b+2]=Math.max(a,r)}f.putImageData(d,0,0)},toObject:function(){return{color:this.color,image:this.image,mode:this.mode,alpha:this.alpha}}}),e.Image.filters.Blend.fromObject=function(t){return new e.Image.filters.Blend(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=Math.pow,n=Math.floor,r=Math.sqrt,o=Math.abs,s=Math.max,a=Math.round,c=Math.sin,l=Math.ceil,h=e.Image.filters,u=e.util.createClass;h.Resize=u(h.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,applyTo:function(t,e,i){if(1!==e||1!==i){this.rcpScaleX=1/e,this.rcpScaleY=1/i;var n,r=t.width,o=t.height,s=a(r*e),c=a(o*i);"sliceHack"===this.resizeType&&(n=this.sliceByTwo(t,r,o,s,c)),"hermite"===this.resizeType&&(n=this.hermiteFastResize(t,r,o,s,c)),"bilinear"===this.resizeType&&(n=this.bilinearFiltering(t,r,o,s,c)),"lanczos"===this.resizeType&&(n=this.lanczosResize(t,r,o,s,c)),t.width=s,t.height=c,t.getContext("2d").putImageData(n,0,0)}},sliceByTwo:function(t,i,r,o,a){var c,l=t.getContext("2d"),h=.5,u=.5,f=1,d=1,p=!1,g=!1,v=i,m=r,b=e.util.createCanvasElement(),y=b.getContext("2d");for(o=n(o),a=n(a),b.width=s(o,i),b.height=s(a,r),o>i&&(h=2,f=-1),a>r&&(u=2,d=-1),c=l.getImageData(0,0,i,r),t.width=s(o,i),t.height=s(a,r),l.putImageData(c,0,0);!p||!g;)i=v,r=m,o*f<n(v*h*f)?v=n(v*h):(v=o,p=!0),a*d<n(m*u*d)?m=n(m*u):(m=a,g=!0),c=l.getImageData(0,0,i,r),y.putImageData(c,0,0),l.clearRect(0,0,v,m),l.drawImage(b,0,0,i,r,0,0,v,m);return l.getImageData(0,0,o,a)},lanczosResize:function(t,e,s,a,h){var u=t.getContext("2d"),f=u.getImageData(0,0,e,s),d=u.getImageData(0,0,a,h),p=f.data,g=d.data,v=function(t){return function(e){if(e>t)return 0;if(e*=Math.PI,o(e)<1e-16)return 1;var i=e/t;return c(e)*c(i)/e/i}}(this.lanczosLobes),m=this.rcpScaleX,b=this.rcpScaleY,y=2/this.rcpScaleX,_=2/this.rcpScaleY,x=l(m*this.lanczosLobes/2),w=l(b*this.lanczosLobes/2),S={},C={},O={};return function t(c){var l,u,f,k,T,E,j,M,P,A,I;for(C.x=(c+.5)*m,O.x=n(C.x),l=0;l<h;l++){for(C.y=(l+.5)*b,O.y=n(C.y),T=0,E=0,j=0,M=0,P=0,u=O.x-x;u<=O.x+x;u++)if(!(u<0||u>=e)){A=n(1e3*o(u-C.x)),S[A]||(S[A]={});for(var D=O.y-w;D<=O.y+w;D++)D<0||D>=s||(I=n(1e3*o(D-C.y)),S[A][I]||(S[A][I]=v(r(i(A*y,2)+i(I*_,2))/1e3)),(f=S[A][I])>0&&(T+=f,E+=f*p[k=4*(D*e+u)],j+=f*p[k+1],M+=f*p[k+2],P+=f*p[k+3]))}g[k=4*(l*a+c)]=E/T,g[k+1]=j/T,g[k+2]=M/T,g[k+3]=P/T}return++c<a?t(c):d}(0)},bilinearFiltering:function(t,e,i,r,o){var s,a,c,l,h,u,f,d,p,g=0,v=this.rcpScaleX,m=this.rcpScaleY,b=t.getContext("2d"),y=4*(e-1),_=b.getImageData(0,0,e,i).data,x=b.getImageData(0,0,r,o),w=x.data;for(c=0;c<o;c++)for(l=0;l<r;l++)for(h=v*l-(s=n(v*l)),u=m*c-(a=n(m*c)),p=4*(a*e+s),f=0;f<4;f++)d=_[p+f]*(1-h)*(1-u)+_[p+4+f]*h*(1-u)+_[p+y+f]*u*(1-h)+_[p+y+4+f]*h*u,w[g++]=d;return x},hermiteFastResize:function(t,e,i,s,a){for(var c=this.rcpScaleX,h=this.rcpScaleY,u=l(c/2),f=l(h/2),d=t.getContext("2d"),p=d.getImageData(0,0,e,i).data,g=d.getImageData(0,0,s,a),v=g.data,m=0;m<a;m++)for(var b=0;b<s;b++){for(var y=4*(b+m*s),_=0,x=0,w=0,S=0,C=0,O=0,k=0,T=(m+.5)*h,E=n(m*h);E<(m+1)*h;E++)for(var j=o(T-(E+.5))/f,M=(b+.5)*c,P=j*j,A=n(b*c);A<(b+1)*c;A++){var I=o(M-(A+.5))/u,D=r(P+I*I);D>1&&D<-1||(_=2*D*D*D-3*D*D+1)>0&&(k+=_*p[(I=4*(A+E*e))+3],w+=_,p[I+3]<255&&(_=_*p[I+3]/250),S+=_*p[I],C+=_*p[I+1],O+=_*p[I+2],x+=_)}v[y]=S/x,v[y+1]=C/x,v[y+2]=O/x,v[y+3]=k/w}return g},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),e.Image.filters.Resize.fromObject=function(t){return new e.Image.filters.Resize(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.ColorMatrix=r(n.BaseFilter,{type:"ColorMatrix",initialize:function(t){t||(t={}),this.matrix=t.matrix||[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]},applyTo:function(t){var e,i,n,r,o,s=t.getContext("2d"),a=s.getImageData(0,0,t.width,t.height),c=a.data,l=c.length,h=this.matrix;for(e=0;e<l;e+=4)i=c[e],n=c[e+1],r=c[e+2],o=c[e+3],c[e]=i*h[0]+n*h[1]+r*h[2]+o*h[3]+h[4],c[e+1]=i*h[5]+n*h[6]+r*h[7]+o*h[8]+h[9],c[e+2]=i*h[10]+n*h[11]+r*h[12]+o*h[13]+h[14],c[e+3]=i*h[15]+n*h[16]+r*h[17]+o*h[18]+h[19];s.putImageData(a,0,0)},toObject:function(){return i(this.callSuper("toObject"),{type:this.type,matrix:this.matrix})}}),e.Image.filters.ColorMatrix.fromObject=function(t){return new e.Image.filters.ColorMatrix(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.Contrast=r(n.BaseFilter,{type:"Contrast",initialize:function(t){t=t||{},this.contrast=t.contrast||0},applyTo:function(t){for(var e=t.getContext("2d"),i=e.getImageData(0,0,t.width,t.height),n=i.data,r=259*(this.contrast+255)/(255*(259-this.contrast)),o=0,s=n.length;o<s;o+=4)n[o]=r*(n[o]-128)+128,n[o+1]=r*(n[o+1]-128)+128,n[o+2]=r*(n[o+2]-128)+128;e.putImageData(i,0,0)},toObject:function(){return i(this.callSuper("toObject"),{contrast:this.contrast})}}),e.Image.filters.Contrast.fromObject=function(t){return new e.Image.filters.Contrast(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.Saturate=r(n.BaseFilter,{type:"Saturate",initialize:function(t){t=t||{},this.saturate=t.saturate||0},applyTo:function(t){for(var e,i=t.getContext("2d"),n=i.getImageData(0,0,t.width,t.height),r=n.data,o=.01*-this.saturate,s=0,a=r.length;s<a;s+=4)e=Math.max(r[s],r[s+1],r[s+2]),r[s]+=e!==r[s]?(e-r[s])*o:0,r[s+1]+=e!==r[s+1]?(e-r[s+1])*o:0,r[s+2]+=e!==r[s+2]?(e-r[s+2])*o:0;i.putImageData(n,0,0)},toObject:function(){return i(this.callSuper("toObject"),{saturate:this.saturate})}}),e.Image.filters.Saturate.fromObject=function(t){return new e.Image.filters.Saturate(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.clone,n=e.util.toFixed,r=e.Object.NUM_FRACTION_DIGITS;if(e.Text)e.warn("fabric.Text is already defined");else{var o=e.Object.prototype.stateProperties.concat();o.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor"),e.Text=e.util.createClass(e.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,fontStyle:!0,lineHeight:!0,text:!0,charSpacing:!0,textAlign:!0,strokeWidth:!1},_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.16,textBackgroundColor:"",stateProperties:o,stroke:null,shadow:null,_fontSizeFraction:.25,_fontSizeMult:1.13,charSpacing:0,initialize:function(t,e){e=e||{},this.text=t,this.__skipDimension=!0,this.setOptions(e),this.__skipDimension=!1,this._initDimensions()},_initDimensions:function(t){this.__skipDimension||(t||(t=e.util.createCanvasElement().getContext("2d"),this._setTextStyles(t)),this._textLines=this._splitTextIntoLines(),this._clearCache(),this.width=this._getTextWidth(t)||this.cursorWidth||2,this.height=this._getTextHeight(t))},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(t){this.clipTo&&e.util.clipContext(this,t),this._setOpacity(t),this._setShadow(t),this._setupCompositeOperation(t),this._renderTextBackground(t),this._setStrokeStyles(t),this._setFillStyles(t),this._renderText(t),this._renderTextDecoration(t),this.clipTo&&t.restore()},_renderText:function(t){this._renderTextFill(t),this._renderTextStroke(t)},_setTextStyles:function(t){t.textBaseline="alphabetic",t.font=this._getFontDeclaration()},_getTextHeight:function(){return this._getHeightOfSingleLine()+(this._textLines.length-1)*this._getHeightOfLine()},_getTextWidth:function(t){for(var e=this._getLineWidth(t,0),i=1,n=this._textLines.length;i<n;i++){var r=this._getLineWidth(t,i);r>e&&(e=r)}return e},_getNonTransformedDimensions:function(){return{x:this.width,y:this.height}},_renderChars:function(t,e,i,n,r){var o,s,a=t.slice(0,-4);if(this[a].toLive){var c=-this.width/2+this[a].offsetX||0,l=-this.height/2+this[a].offsetY||0;e.save(),e.translate(c,l),n-=c,r-=l}if(0!==this.charSpacing)for(var h=this._getWidthOfCharSpacing(),u=0,f=(i=i.split("")).length;u<f;u++)o=i[u],s=e.measureText(o).width+h,e[t](o,n,r),n+=s>0?s:0;else e[t](i,n,r);this[a].toLive&&e.restore()},_renderTextLine:function(t,e,i,n,r,o){r-=this.fontSize*this._fontSizeFraction;var s=this._getLineWidth(e,o);if("justify"!==this.textAlign||this.width<s)this._renderChars(t,e,i,n,r,o);else for(var a,c=i.split(/\s+/),l=0,h=this._getWidthOfWords(e,c.join(" "),o,0),u=this.width-h,f=c.length-1,d=f>0?u/f:0,p=0,g=0,v=c.length;g<v;g++){for(;" "===i[l]&&l<i.length;)l++;a=c[g],this._renderChars(t,e,a,n+p,r,o,l),p+=this._getWidthOfWords(e,a,o,l)+d,l+=a.length}},_getWidthOfWords:function(t,e){var i=t.measureText(e).width;return 0!==this.charSpacing&&(i+=e.split("").length*this._getWidthOfCharSpacing()),i>0?i:0},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},isEmptyStyles:function(){return!0},_renderTextCommon:function(t,e){for(var i=0,n=this._getLeftOffset(),r=this._getTopOffset(),o=0,s=this._textLines.length;o<s;o++){var a=this._getHeightOfLine(t,o),c=a/this.lineHeight,l=this._getLineWidth(t,o),h=this._getLineLeftOffset(l);this._renderTextLine(e,t,this._textLines[o],n+h,r+i+c,o),i+=a}},_renderTextFill:function(t){!this.fill&&this.isEmptyStyles()||this._renderTextCommon(t,"fillText")},_renderTextStroke:function(t){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokedashArray),t.beginPath(),this._renderTextCommon(t,"strokeText"),t.closePath(),t.restore())},_getHeightOfLine:function(){return this._getHeightOfSingleLine()*this.lineHeight},_getHeightOfSingleLine:function(){return this.fontSize*this._fontSizeMult},_renderTextBackground:function(t){this._renderBackground(t),this._renderTextLinesBackground(t)},_renderTextLinesBackground:function(t){if(this.textBackgroundColor){var e,i,n,r=0;t.fillStyle=this.textBackgroundColor;for(var o=0,s=this._textLines.length;o<s;o++)e=this._getHeightOfLine(t,o),(i=this._getLineWidth(t,o))>0&&(n=this._getLineLeftOffset(i),t.fillRect(this._getLeftOffset()+n,this._getTopOffset()+r,i,e/this.lineHeight)),r+=e;this._removeShadow(t)}},_getLineLeftOffset:function(t){return"center"===this.textAlign?(this.width-t)/2:"right"===this.textAlign?this.width-t:0},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[]},_shouldClearCache:function(){var t=!1;if(this._forceClearCache)return this._forceClearCache=!1,!0;for(var e in this._dimensionAffectingProps)this["__"+e]!==this[e]&&(this["__"+e]=this[e],t=!0);return t},_getLineWidth:function(t,e){if(this.__lineWidths[e])return-1===this.__lineWidths[e]?this.width:this.__lineWidths[e];var i,n=this._textLines[e];return i=""===n?0:this._measureLine(t,e),this.__lineWidths[e]=i,i&&"justify"===this.textAlign&&n.split(/\s+/).length>1&&(this.__lineWidths[e]=-1),i},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0},_measureLine:function(t,e){var i,n=this._textLines[e],r=t.measureText(n).width,o=0;return 0!==this.charSpacing&&(o=(n.split("").length-1)*this._getWidthOfCharSpacing()),(i=r+o)>0?i:0},_renderTextDecoration:function(t){if(this.textDecoration){var e=this.height/2,i=this,n=[];this.textDecoration.indexOf("underline")>-1&&n.push(.85),this.textDecoration.indexOf("line-through")>-1&&n.push(.43),this.textDecoration.indexOf("overline")>-1&&n.push(-.12),n.length>0&&function(n){var r,o,s,a,c,l,h,u=0;for(r=0,o=i._textLines.length;r<o;r++){for(c=i._getLineWidth(t,r),l=i._getLineLeftOffset(c),h=i._getHeightOfLine(t,r),s=0,a=n.length;s<a;s++)t.fillRect(i._getLeftOffset()+l,u+(i._fontSizeMult-1+n[s])*i.fontSize-e,c,i.fontSize/15);u+=h}}(n)}},_getFontDeclaration:function(){return[e.isLikelyNode?this.fontWeight:this.fontStyle,e.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",e.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(t,e){this.visible&&(t.save(),this._setTextStyles(t),this._shouldClearCache()&&this._initDimensions(t),this.drawSelectionBackground(t),e||this.transform(t),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this.group&&"path-group"===this.group.type&&t.translate(this.left,this.top),this._render(t),t.restore())},_splitTextIntoLines:function(){return this.text.split(this._reNewline)},toObject:function(t){var e=["text","fontSize","fontWeight","fontFamily","fontStyle","lineHeight","textDecoration","textAlign","textBackgroundColor","charSpacing"].concat(t);return this.callSuper("toObject",e)},toSVG:function(t){this.ctx||(this.ctx=e.util.createCanvasElement().getContext("2d"));var i=this._createBaseSVGMarkup(),n=this._getSVGLeftTopOffsets(this.ctx),r=this._getSVGTextAndBg(n.textTop,n.textLeft);return this._wrapSVGTextAndBg(i,r),t?t(i.join("")):i.join("")},_getSVGLeftTopOffsets:function(t){var e=this._getHeightOfLine(t,0);return{textLeft:-this.width/2+(this.group&&"path-group"===this.group.type?this.left:0),textTop:0+(this.group&&"path-group"===this.group.type?-this.top:0),lineTop:e}},_wrapSVGTextAndBg:function(t,e){var i=this.getSvgFilter(),n=""===i?"":' style="'+i+'"';t.push("\t<g ",this.getSvgId(),'transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"',n,">\n",e.textBgRects.join(""),"\t\t<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(!0),'" >\n',e.textSpans.join(""),"\t\t</text>\n","\t</g>\n")},_getSVGTextAndBg:function(t,e){var i=[],n=[],r=0;this._setSVGBg(n);for(var o=0,s=this._textLines.length;o<s;o++)this.textBackgroundColor&&this._setSVGTextLineBg(n,o,e,t,r),this._setSVGTextLineText(o,i,r,e,t,n),r+=this._getHeightOfLine(this.ctx,o);return{textSpans:i,textBgRects:n}},_setSVGTextLineText:function(t,i,o,s,a){var c=this.fontSize*(this._fontSizeMult-this._fontSizeFraction)-a+o-this.height/2;"justify"!==this.textAlign?i.push('\t\t\t<tspan x="',n(s+this._getLineLeftOffset(this._getLineWidth(this.ctx,t)),r),'" ','y="',n(c,r),'" ',this._getFillAttributes(this.fill),">",e.util.string.escapeXml(this._textLines[t]),"</tspan>\n"):this._setSVGTextLineJustifed(t,i,c,s)},_setSVGTextLineJustifed:function(t,i,o,s){var a=e.util.createCanvasElement().getContext("2d");this._setTextStyles(a);var c,l,h=this._textLines[t].split(/\s+/),u=this._getWidthOfWords(a,h.join("")),f=this.width-u,d=h.length-1,p=d>0?f/d:0,g=this._getFillAttributes(this.fill);for(s+=this._getLineLeftOffset(this._getLineWidth(a,t)),t=0,l=h.length;t<l;t++)c=h[t],i.push('\t\t\t<tspan x="',n(s,r),'" ','y="',n(o,r),'" ',g,">",e.util.string.escapeXml(c),"</tspan>\n"),s+=this._getWidthOfWords(a,c)+p},_setSVGTextLineBg:function(t,e,i,o,s){t.push("\t\t<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',n(i+this._getLineLeftOffset(this._getLineWidth(this.ctx,e)),r),'" y="',n(s-this.height/2,r),'" width="',n(this._getLineWidth(this.ctx,e),r),'" height="',n(this._getHeightOfLine(this.ctx,e)/this.lineHeight,r),'"></rect>\n')},_setSVGBg:function(t){this.backgroundColor&&t.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',n(-this.width/2,r),'" y="',n(-this.height/2,r),'" width="',n(this.width,r),'" height="',n(this.height,r),'"></rect>\n')},_getFillAttributes:function(t){var i=t&&"string"==typeof t?new e.Color(t):"";return i&&i.getSource()&&1!==i.getAlpha()?'opacity="'+i.getAlpha()+'" fill="'+i.setAlpha(1).toRgb()+'"':'fill="'+t+'"'},_set:function(t,e){this.callSuper("_set",t,e),t in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),e.Text.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" ")),e.Text.DEFAULT_SVG_FONT_SIZE=16,e.Text.fromElement=function(t,i){if(!t)return null;var n=e.parseAttributes(t,e.Text.ATTRIBUTE_NAMES);(i=e.util.object.extend(i?e.util.object.clone(i):{},n)).top=i.top||0,i.left=i.left||0,"dx"in n&&(i.left+=n.dx),"dy"in n&&(i.top+=n.dy),"fontSize"in i||(i.fontSize=e.Text.DEFAULT_SVG_FONT_SIZE),i.originX||(i.originX="left");var r="";"textContent"in t?r=t.textContent:"firstChild"in t&&null!==t.firstChild&&"data"in t.firstChild&&null!==t.firstChild.data&&(r=t.firstChild.data),r=r.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var o=new e.Text(r,i),s=o.getHeight()/o.height,a=((o.height+o.strokeWidth)*o.lineHeight-o.height)*s,c=o.getHeight()+a,l=0;return"left"===o.originX&&(l=o.getWidth()/2),"right"===o.originX&&(l=-o.getWidth()/2),o.set({left:o.getLeft()+l,top:o.getTop()-c/2+o.fontSize*(.18+o._fontSizeFraction)/o.lineHeight}),o},e.Text.fromObject=function(t,n){var r=new e.Text(t.text,i(t));return n&&n(r),r},e.util.createAccessors(e.Text)}}(exports),function(){var t=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,styles:null,caching:!0,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],initialize:function(t,e){this.styles=e&&e.styles||{},this.callSuper("initialize",t,e),this.initBehavior()},_clearCache:function(){this.callSuper("_clearCache"),this.__widthOfSpace=[]},isEmptyStyles:function(){if(!this.styles)return!0;var t=this.styles;for(var e in t)for(var i in t[e])for(var n in t[e][i])return!1;return!0},setSelectionStart:function(t){t=Math.max(t,0),this._updateAndFire("selectionStart",t)},setSelectionEnd:function(t){t=Math.min(t,this.text.length),this._updateAndFire("selectionEnd",t)},_updateAndFire:function(t,e){this[t]!==e&&(this._fireSelectionChanged(),this[t]=e),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},getSelectionStyles:function(t,e){if(2===arguments.length){for(var i=[],n=t;n<e;n++)i.push(this.getSelectionStyles(n));return i}var r=this.get2DCursorLocation(t);return this._getStyleDeclaration(r.lineIndex,r.charIndex)||{}},setSelectionStyles:function(t){if(this.selectionStart===this.selectionEnd)this._extendStyles(this.selectionStart,t);else for(var e=this.selectionStart;e<this.selectionEnd;e++)this._extendStyles(e,t);return this._forceClearCache=!0,this},_extendStyles:function(t,e){var i=this.get2DCursorLocation(t);this._getLineStyle(i.lineIndex)||this._setLineStyle(i.lineIndex,{}),this._getStyleDeclaration(i.lineIndex,i.charIndex)||this._setStyleDeclaration(i.lineIndex,i.charIndex,{}),fabric.util.object.extend(this._getStyleDeclaration(i.lineIndex,i.charIndex),e)},render:function(t,e){this.clearContextTop(),this.callSuper("render",t,e)},_render:function(t){this.callSuper("_render",t),this.ctx=t,this.cursorOffsetCache={},this.renderCursorOrSelection()},clearContextTop:function(){if(this.active&&this.isEditing&&this.canvas&&this.canvas.contextTop){var t=this.canvas.contextTop;t.save(),t.transform.apply(t,this.canvas.viewportTransform),this.transform(t),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this._clearTextArea(t),t.restore()}},renderCursorOrSelection:function(){if(this.active&&this.isEditing){var t,e,i=this.text.split("");this.canvas&&this.canvas.contextTop?((e=this.canvas.contextTop).save(),e.transform.apply(e,this.canvas.viewportTransform),this.transform(e),this.transformMatrix&&e.transform.apply(e,this.transformMatrix),this._clearTextArea(e)):(e=this.ctx).save(),this.selectionStart===this.selectionEnd?(t=this._getCursorBoundaries(i,"cursor"),this.renderCursor(t,e)):(t=this._getCursorBoundaries(i,"selection"),this.renderSelection(i,t,e)),e.restore()}},_clearTextArea:function(t){var e=this.width+4,i=this.height+4;t.clearRect(-e/2,-i/2,e,i)},get2DCursorLocation:function(t){void 0===t&&(t=this.selectionStart);for(var e=this._textLines.length,i=0;i<e;i++){if(t<=this._textLines[i].length)return{lineIndex:i,charIndex:t};t-=this._textLines[i].length+1}return{lineIndex:i-1,charIndex:this._textLines[i-1].length<t?this._textLines[i-1].length:t}},getCurrentCharStyle:function(t,e){var i=this._getStyleDeclaration(t,0===e?0:e-1);return{fontSize:i&&i.fontSize||this.fontSize,fill:i&&i.fill||this.fill,textBackgroundColor:i&&i.textBackgroundColor||this.textBackgroundColor,textDecoration:i&&i.textDecoration||this.textDecoration,fontFamily:i&&i.fontFamily||this.fontFamily,fontWeight:i&&i.fontWeight||this.fontWeight,fontStyle:i&&i.fontStyle||this.fontStyle,stroke:i&&i.stroke||this.stroke,strokeWidth:i&&i.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(t,e){var i=this._getStyleDeclaration(t,0===e?0:e-1);return i&&i.fontSize?i.fontSize:this.fontSize},getCurrentCharColor:function(t,e){var i=this._getStyleDeclaration(t,0===e?0:e-1);return i&&i.fill?i.fill:this.cursorColor},_getCursorBoundaries:function(t,e){var i=Math.round(this._getLeftOffset()),n=this._getTopOffset(),r=this._getCursorBoundariesOffsets(t,e);return{left:i,top:n,leftOffset:r.left+r.lineLeft,topOffset:r.top}},_getCursorBoundariesOffsets:function(t,e){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;for(var i,n=0,r=0,o=0,s=0,a=0,c=0;c<this.selectionStart;c++)"\n"===t[c]?(a=0,s+=this._getHeightOfLine(this.ctx,r),r++,o=0):(a+=this._getWidthOfChar(this.ctx,t[c],r,o),o++),n=this._getLineLeftOffset(this._getLineWidth(this.ctx,r));return"cursor"===e&&(s+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,r)/this.lineHeight-this.getCurrentCharFontSize(r,o)*(1-this._fontSizeFraction)),0!==this.charSpacing&&o===this._textLines[r].length&&(a-=this._getWidthOfCharSpacing()),i={top:s,left:a>0?a:0,lineLeft:n},this.cursorOffsetCache=i,this.cursorOffsetCache},renderCursor:function(t,e){var i=this.get2DCursorLocation(),n=i.lineIndex,r=i.charIndex,o=this.getCurrentCharFontSize(n,r),s=0===n&&0===r?this._getLineLeftOffset(this._getLineWidth(e,n)):t.leftOffset,a=this.scaleX*this.canvas.getZoom(),c=this.cursorWidth/a;e.fillStyle=this.getCurrentCharColor(n,r),e.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,e.fillRect(t.left+s-c/2,t.top+t.topOffset,c,o)},renderSelection:function(t,e,i){i.fillStyle=this.selectionColor;for(var n=this.get2DCursorLocation(this.selectionStart),r=this.get2DCursorLocation(this.selectionEnd),o=n.lineIndex,s=r.lineIndex,a=o;a<=s;a++){var c,l=this._getLineLeftOffset(this._getLineWidth(i,a))||0,h=this._getHeightOfLine(this.ctx,a),u=0,f=this._textLines[a];if(a===o){for(var d=0,p=f.length;d<p;d++)d>=n.charIndex&&(a!==s||d<r.charIndex)&&(u+=this._getWidthOfChar(i,f[d],a,d)),d<n.charIndex&&(l+=this._getWidthOfChar(i,f[d],a,d));d===f.length&&(u-=this._getWidthOfCharSpacing())}else if(a>o&&a<s)u+=this._getLineWidth(i,a)||5;else if(a===s){for(var g=0,v=r.charIndex;g<v;g++)u+=this._getWidthOfChar(i,f[g],a,g);r.charIndex===f.length&&(u-=this._getWidthOfCharSpacing())}c=h,(this.lineHeight<1||a===s&&this.lineHeight>1)&&(h/=this.lineHeight),i.fillRect(e.left+l,e.top+e.topOffset,u>0?u:0,h),e.topOffset+=c}},_renderChars:function(t,e,i,n,r,o,s){if(this.isEmptyStyles())return this._renderCharsFast(t,e,i,n,r);s=s||0;var a,c,l=this._getHeightOfLine(e,o),h="";e.save(),r-=l/this.lineHeight*this._fontSizeFraction;for(var u=s,f=i.length+s;u<=f;u++)a=a||this.getCurrentCharStyle(o,u),c=this.getCurrentCharStyle(o,u+1),(this._hasStyleChanged(a,c)||u===f)&&(this._renderChar(t,e,o,u-1,h,n,r,l),h="",a=c),h+=i[u-s];e.restore()},_renderCharsFast:function(t,e,i,n,r){"fillText"===t&&this.fill&&this.callSuper("_renderChars",t,e,i,n,r),"strokeText"===t&&(this.stroke&&this.strokeWidth>0||this.skipFillStrokeCheck)&&this.callSuper("_renderChars",t,e,i,n,r)},_renderChar:function(t,e,i,n,r,o,s,a){var c,l,h,u,f,d,p,g,v,m=this._getStyleDeclaration(i,n);if(m?(l=this._getHeightOfChar(e,r,i,n),u=m.stroke,h=m.fill,d=m.textDecoration):l=this.fontSize,u=(u||this.stroke)&&"strokeText"===t,h=(h||this.fill)&&"fillText"===t,m&&e.save(),c=this._applyCharStylesGetWidth(e,r,i,n,m||null),d=d||this.textDecoration,m&&m.textBackgroundColor&&this._removeShadow(e),0!==this.charSpacing){g=this._getWidthOfCharSpacing(),c=0;for(var b,y=0,_=(p=r.split("")).length;y<_;y++)b=p[y],h&&e.fillText(b,o+c,s),u&&e.strokeText(b,o+c,s),c+=(v=e.measureText(b).width+g)>0?v:0}else h&&e.fillText(r,o,s),u&&e.strokeText(r,o,s);(d||""!==d)&&(f=this._fontSizeFraction*a/this.lineHeight,this._renderCharDecoration(e,d,o,s,f,c,l)),m&&e.restore(),e.translate(c,0)},_hasStyleChanged:function(t,e){return t.fill!==e.fill||t.fontSize!==e.fontSize||t.textBackgroundColor!==e.textBackgroundColor||t.textDecoration!==e.textDecoration||t.fontFamily!==e.fontFamily||t.fontWeight!==e.fontWeight||t.fontStyle!==e.fontStyle||t.stroke!==e.stroke||t.strokeWidth!==e.strokeWidth},_renderCharDecoration:function(t,e,i,n,r,o,s){if(e){var a,c,l=s/15,h={underline:n+s/10,"line-through":n-s*(this._fontSizeFraction+this._fontSizeMult-1)+l,overline:n-(this._fontSizeMult-this._fontSizeFraction)*s},u=["underline","line-through","overline"];for(a=0;a<u.length;a++)c=u[a],e.indexOf(c)>-1&&t.fillRect(i,h[c],o,l)}},_renderTextLine:function(t,e,i,n,r,o){this.isEmptyStyles()||(r+=this.fontSize*(this._fontSizeFraction+.03)),this.callSuper("_renderTextLine",t,e,i,n,r,o)},_renderTextDecoration:function(t){if(this.isEmptyStyles())return this.callSuper("_renderTextDecoration",t)},_renderTextLinesBackground:function(t){this.callSuper("_renderTextLinesBackground",t);for(var e,i,n,r,o,s,a=0,c=this._getLeftOffset(),l=this._getTopOffset(),h=0,u=this._textLines.length;h<u;h++)if(e=this._getHeightOfLine(t,h),""!==(r=this._textLines[h])&&this.styles&&this._getLineStyle(h)){i=this._getLineWidth(t,h),n=this._getLineLeftOffset(i);for(var f=0,d=r.length;f<d;f++)(s=this._getStyleDeclaration(h,f))&&s.textBackgroundColor&&(o=r[f],t.fillStyle=s.textBackgroundColor,t.fillRect(c+n+this._getWidthOfCharsAt(t,h,f),l+a,this._getWidthOfChar(t,o,h,f),e/this.lineHeight));a+=e}else a+=e},_getCacheProp:function(t,e){return t+e.fontSize+e.fontWeight+e.fontStyle},_getFontCache:function(t){return fabric.charWidthsCache[t]||(fabric.charWidthsCache[t]={}),fabric.charWidthsCache[t]},_applyCharStylesGetWidth:function(e,i,n,r,o){var s,a,c,l=o||this._getStyleDeclaration(n,r),h=t(l);if(this._applyFontStyles(h),c=this._getFontCache(h.fontFamily),a=this._getCacheProp(i,h),!l&&c[a]&&this.caching)return c[a];"string"==typeof h.shadow&&(h.shadow=new fabric.Shadow(h.shadow));var u=h.fill||this.fill;return e.fillStyle=u.toLive?u.toLive(e,this):u,h.stroke&&(e.strokeStyle=h.stroke&&h.stroke.toLive?h.stroke.toLive(e,this):h.stroke),e.lineWidth=h.strokeWidth||this.strokeWidth,e.font=this._getFontDeclaration.call(h),h.shadow&&(h.scaleX=this.scaleX,h.scaleY=this.scaleY,h.canvas=this.canvas,h.getObjectScaling=this.getObjectScaling,this._setShadow.call(h,e)),this.caching&&c[a]?c[a]:(s=e.measureText(i).width,this.caching&&(c[a]=s),s)},_applyFontStyles:function(t){t.fontFamily||(t.fontFamily=this.fontFamily),t.fontSize||(t.fontSize=this.fontSize),t.fontWeight||(t.fontWeight=this.fontWeight),t.fontStyle||(t.fontStyle=this.fontStyle)},_getStyleDeclaration:function(e,i,n){return n?this.styles[e]&&this.styles[e][i]?t(this.styles[e][i]):{}:this.styles[e]&&this.styles[e][i]?this.styles[e][i]:null},_setStyleDeclaration:function(t,e,i){this.styles[t][e]=i},_deleteStyleDeclaration:function(t,e){delete this.styles[t][e]},_getLineStyle:function(t){return this.styles[t]},_setLineStyle:function(t,e){this.styles[t]=e},_deleteLineStyle:function(t){delete this.styles[t]},_getWidthOfChar:function(t,e,i,n){if(!this._isMeasuring&&"justify"===this.textAlign&&this._reSpacesAndTabs.test(e))return this._getWidthOfSpace(t,i);t.save();var r=this._applyCharStylesGetWidth(t,e,i,n);return 0!==this.charSpacing&&(r+=this._getWidthOfCharSpacing()),t.restore(),r>0?r:0},_getHeightOfChar:function(t,e,i){var n=this._getStyleDeclaration(e,i);return n&&n.fontSize?n.fontSize:this.fontSize},_getWidthOfCharsAt:function(t,e,i){var n,r,o=0;for(n=0;n<i;n++)r=this._textLines[e][n],o+=this._getWidthOfChar(t,r,e,n);return o},_measureLine:function(t,e){this._isMeasuring=!0;var i=this._getWidthOfCharsAt(t,e,this._textLines[e].length);return 0!==this.charSpacing&&(i-=this._getWidthOfCharSpacing()),this._isMeasuring=!1,i>0?i:0},_getWidthOfSpace:function(t,e){if(this.__widthOfSpace[e])return this.__widthOfSpace[e];var i=this._textLines[e],n=this._getWidthOfWords(t,i,e,0),r=this.width-n,o=i.length-i.replace(this._reSpacesAndTabs,"").length,s=Math.max(r/o,t.measureText(" ").width);return this.__widthOfSpace[e]=s,s},_getWidthOfWords:function(t,e,i,n){for(var r=0,o=0;o<e.length;o++){var s=e[o];s.match(/\s/)||(r+=this._getWidthOfChar(t,s,i,o+n))}return r},_getHeightOfLine:function(t,e){if(this.__lineHeights[e])return this.__lineHeights[e];for(var i=this._textLines[e],n=this._getHeightOfChar(t,e,0),r=1,o=i.length;r<o;r++){var s=this._getHeightOfChar(t,e,r);s>n&&(n=s)}return this.__lineHeights[e]=n*this.lineHeight*this._fontSizeMult,this.__lineHeights[e]},_getTextHeight:function(t){for(var e,i=0,n=0,r=this._textLines.length;n<r;n++)e=this._getHeightOfLine(t,n),i+=n===r-1?e/this.lineHeight:e;return i},toObject:function(e){return fabric.util.object.extend(this.callSuper("toObject",e),{styles:t(this.styles,!0)})}}),fabric.IText.fromObject=function(e,i){var n=new fabric.IText(e.text,t(e));return i&&i(n),n}}(),function(){var t=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},initSelectedHandler:function(){this.on("selected",function(){var t=this;setTimeout(function(){t.selected=!0},100)})},initAddedHandler:function(){var t=this;this.on("added",function(){var e=t.canvas;e&&(e._hasITextHandlers||(e._hasITextHandlers=!0,t._initCanvasHandlers(e)),e._iTextInstances=e._iTextInstances||[],e._iTextInstances.push(t))})},initRemovedHandler:function(){var t=this;this.on("removed",function(){var e=t.canvas;e&&(e._iTextInstances=e._iTextInstances||[],fabric.util.removeFromArray(e._iTextInstances,t),0===e._iTextInstances.length&&(e._hasITextHandlers=!1,t._removeCanvasHandlers(e)))})},_initCanvasHandlers:function(t){t._canvasITextSelectionClearedHanlder=function(){fabric.IText.prototype.exitEditingOnOthers(t)}.bind(this),t._mouseUpITextHandler=function(){t._iTextInstances&&t._iTextInstances.forEach(function(t){t.__isMousedown=!1})}.bind(this),t.on("selection:cleared",t._canvasITextSelectionClearedHanlder),t.on("object:selected",t._canvasITextSelectionClearedHanlder),t.on("mouse:up",t._mouseUpITextHandler)},_removeCanvasHandlers:function(t){t.off("selection:cleared",t._canvasITextSelectionClearedHanlder),t.off("object:selected",t._canvasITextSelectionClearedHanlder),t.off("mouse:up",t._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(t,e,i,n){var r;return r={isAborted:!1,abort:function(){this.isAborted=!0}},t.animate("_currentCursorOpacity",e,{duration:i,onComplete:function(){r.isAborted||t[n]()},onChange:function(){t.canvas&&t.selectionStart===t.selectionEnd&&t.renderCursorOrSelection()},abort:function(){return r.isAborted}}),r},_onTickComplete:function(){var t=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){t._currentTickCompleteState=t._animateCursor(t,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(t){var e=this,i=t?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){e._tick()},i)},abortCursorAnimation:function(){var t=this._currentTickState||this._currentTickCompleteState;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,t&&this.canvas&&this.canvas.clearContext(this.canvas.contextTop||this.ctx)},selectAll:function(){this.selectionStart=0,this.selectionEnd=this.text.length,this._fireSelectionChanged(),this._updateTextarea()},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(t){var e=0,i=t-1;if(this._reSpace.test(this.text.charAt(i)))for(;this._reSpace.test(this.text.charAt(i));)e++,i--;for(;/\S/.test(this.text.charAt(i))&&i>-1;)e++,i--;return t-e},findWordBoundaryRight:function(t){var e=0,i=t;if(this._reSpace.test(this.text.charAt(i)))for(;this._reSpace.test(this.text.charAt(i));)e++,i++;for(;/\S/.test(this.text.charAt(i))&&i<this.text.length;)e++,i++;return t+e},findLineBoundaryLeft:function(t){for(var e=0,i=t-1;!/\n/.test(this.text.charAt(i))&&i>-1;)e++,i--;return t-e},findLineBoundaryRight:function(t){for(var e=0,i=t;!/\n/.test(this.text.charAt(i))&&i<this.text.length;)e++,i++;return t+e},getNumNewLinesInSelectedText:function(){for(var t=this.getSelectedText(),e=0,i=0,n=t.length;i<n;i++)"\n"===t[i]&&e++;return e},searchWordBoundary:function(t,e){for(var i=this._reSpace.test(this.text.charAt(t))?t-1:t,n=this.text.charAt(i),r=/[ \n\.,;!\?\-]/;!r.test(n)&&i>0&&i<this.text.length;)i+=e,n=this.text.charAt(i);return r.test(n)&&"\n"!==n&&(i+=1===e?0:1),i},selectWord:function(t){t=t||this.selectionStart;var e=this.searchWordBoundary(t,-1),i=this.searchWordBoundary(t,1);this.selectionStart=e,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(t){t=t||this.selectionStart;var e=this.findLineBoundaryLeft(t),i=this.findLineBoundaryRight(t);this.selectionStart=e,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea()},enterEditing:function(t){if(!this.isEditing&&this.editable)return this.canvas&&this.exitEditingOnOthers(this.canvas),this.isEditing=!0,this.initHiddenTextarea(t),this.hiddenTextarea.focus(),this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.renderAll(),this):this},exitEditingOnOthers:function(t){t._iTextInstances&&t._iTextInstances.forEach(function(t){t.selected=!1,t.isEditing&&t.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(t){if(this.__isMousedown&&this.isEditing){var e=this.getSelectionStartFromPointer(t.e),i=this.selectionStart,n=this.selectionEnd;e!==this.__selectionStartOnMouseDown&&(e>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=e):(this.selectionStart=e,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===i&&this.selectionEnd===n||(this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){if(this.hiddenTextarea&&!this.inCompositionMode&&(this.cursorOffsetCache={},this.hiddenTextarea.value=this.text,this.hiddenTextarea.selectionStart=this.selectionStart,this.hiddenTextarea.selectionEnd=this.selectionEnd,this.selectionStart===this.selectionEnd)){var t=this._calcTextareaPosition();this.hiddenTextarea.style.left=t.left,this.hiddenTextarea.style.top=t.top,this.hiddenTextarea.style.fontSize=t.fontSize}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var t=this.text.split(""),e=this._getCursorBoundaries(t,"cursor"),i=this.get2DCursorLocation(),n=i.lineIndex,r=i.charIndex,o=this.getCurrentCharFontSize(n,r),s=0===n&&0===r?this._getLineLeftOffset(this._getLineWidth(this.ctx,n)):e.leftOffset,a=this.calcTransformMatrix(),c={x:e.left+s,y:e.top+e.topOffset+o},l=this.canvas.upperCanvasEl,h=l.width-o,u=l.height-o;return c=fabric.util.transformPoint(c,a),(c=fabric.util.transformPoint(c,this.canvas.viewportTransform)).x<0&&(c.x=0),c.x>h&&(c.x=h),c.y<0&&(c.y=0),c.y>u&&(c.y=u),c.x+=this.canvas._offset.left,c.y+=this.canvas._offset.top,{left:c.x+"px",top:c.y+"px",fontSize:o}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var t=this._textBeforeEdit!==this.text;return this.selected=!1,this.isEditing=!1,this.selectable=!0,this.selectionEnd=this.selectionStart,this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this.fire("editing:exited"),t&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),t&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var t in this.styles)this._textLines[t]||delete this.styles[t]},_removeCharsFromTo:function(t,e){for(;e!==t;)this._removeSingleCharAndStyle(t+1),e--;this.selectionStart=t,this.selectionEnd=t},_removeSingleCharAndStyle:function(t){var e="\n"===this.text[t-1],i=e?t:t-1;this.removeStyleObject(e,i),this.text=this.text.slice(0,t-1)+this.text.slice(t),this._textLines=this._splitTextIntoLines()},insertChars:function(t,e){var i;if(this.selectionEnd-this.selectionStart>1&&this._removeCharsFromTo(this.selectionStart,this.selectionEnd),e||!this.isEmptyStyles())for(var n=0,r=t.length;n<r;n++)e&&(i=fabric.copiedTextStyle[n]),this.insertChar(t[n],n<r-1,i);else this.insertChar(t,!1)},insertChar:function(t,e,i){var n="\n"===this.text[this.selectionStart];this.text=this.text.slice(0,this.selectionStart)+t+this.text.slice(this.selectionEnd),this._textLines=this._splitTextIntoLines(),this.insertStyleObjects(t,n,i),this.selectionStart+=t.length,this.selectionEnd=this.selectionStart,e||(this._updateTextarea(),this.setCoords(),this._fireSelectionChanged(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this}),this.canvas&&this.canvas.renderAll())},insertNewlineStyleObject:function(e,i,n){this.shiftLineStyles(e,1),this.styles[e+1]||(this.styles[e+1]={});var r={},o={};if(this.styles[e]&&this.styles[e][i-1]&&(r=this.styles[e][i-1]),n)o[0]=t(r),this.styles[e+1]=o;else{for(var s in this.styles[e])parseInt(s,10)>=i&&(o[parseInt(s,10)-i]=this.styles[e][s],delete this.styles[e][s]);this.styles[e+1]=o}this._forceClearCache=!0},insertCharStyleObject:function(e,i,n){var r=this.styles[e],o=t(r);for(var s in 0!==i||n||(i=1),o){var a=parseInt(s,10);a>=i&&(r[a+1]=o[a],o[a-1]||delete r[a])}this.styles[e][i]=n||t(r[i-1]),this._forceClearCache=!0},insertStyleObjects:function(t,e,i){var n=this.get2DCursorLocation(),r=n.lineIndex,o=n.charIndex;this._getLineStyle(r)||this._setLineStyle(r,{}),"\n"===t?this.insertNewlineStyleObject(r,o,e):this.insertCharStyleObject(r,o,i)},shiftLineStyles:function(e,i){var n=t(this.styles);for(var r in this.styles){var o=parseInt(r,10);o>e&&(this.styles[o+i]=n[o],n[o-i]||delete this.styles[o])}},removeStyleObject:function(t,e){var i=this.get2DCursorLocation(e),n=i.lineIndex,r=i.charIndex;this._removeStyleObject(t,i,n,r)},_getTextOnPreviousLine:function(t){return this._textLines[t-1]},_removeStyleObject:function(e,i,n,r){if(e){var o=this._getTextOnPreviousLine(i.lineIndex),s=o?o.length:0;for(r in this.styles[n-1]||(this.styles[n-1]={}),this.styles[n])this.styles[n-1][parseInt(r,10)+s]=this.styles[n][r];this.shiftLineStyles(i.lineIndex,-1)}else{var a=this.styles[n];a&&delete a[r];var c=t(a);for(var l in c){var h=parseInt(l,10);h>=r&&0!==h&&(a[h-1]=c[h],delete a[h])}}},insertNewline:function(){this.insertChars("\n")},setSelectionStartEndWithShift:function(t,e,i){i<=t?(e===t?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=t),this.selectionStart=i):i>t&&i<e?"right"===this._selectionDirection?this.selectionEnd=i:this.selectionStart=i:(e===t?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=e),this.selectionEnd=i)},setSelectionInBoundaries:function(){var t=this.text.length;this.selectionStart>t?this.selectionStart=t:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>t?this.selectionEnd=t:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(t){this.__newClickTime=+new Date;var e=this.canvas.getPointer(t.e);this.isTripleClick(e)?(this.fire("tripleclick",t),this._stopEvent(t.e)):this.isDoubleClick(e)&&(this.fire("dblclick",t),this._stopEvent(t.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=e,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected},isDoubleClick:function(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y&&this.__lastIsEditing},isTripleClick:function(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y},_stopEvent:function(t){t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler(),this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},initClicks:function(){this.on("dblclick",function(t){this.selectWord(this.getSelectionStartFromPointer(t.e))}),this.on("tripleclick",function(t){this.selectLine(this.getSelectionStartFromPointer(t.e))})},initMousedownHandler:function(){this.on("mousedown",function(t){if(this.editable){var e=this.canvas.getPointer(t.e);this.__mousedownX=e.x,this.__mousedownY=e.y,this.__isMousedown=!0,this.selected&&this.setCursorByClick(t.e),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection())}})},_isObjectMoved:function(t){var e=this.canvas.getPointer(t);return this.__mousedownX!==e.x||this.__mousedownY!==e.y},initMouseupHandler:function(){this.on("mouseup",function(t){this.__isMousedown=!1,this.editable&&!this._isObjectMoved(t.e)&&(this.__lastSelected&&!this.__corner&&(this.enterEditing(t.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()),this.selected=!0)})},setCursorByClick:function(t){var e=this.getSelectionStartFromPointer(t),i=this.selectionStart,n=this.selectionEnd;t.shiftKey?this.setSelectionStartEndWithShift(i,n,e):(this.selectionStart=e,this.selectionEnd=e),this._fireSelectionChanged(),this._updateTextarea()},getSelectionStartFromPointer:function(t){for(var e,i=this.getLocalPointer(t),n=0,r=0,o=0,s=0,a=0,c=this._textLines.length;a<c;a++){e=this._textLines[a],o+=this._getHeightOfLine(this.ctx,a)*this.scaleY;var l=this._getLineWidth(this.ctx,a);r=this._getLineLeftOffset(l)*this.scaleX;for(var h=0,u=e.length;h<u;h++){if(n=r,r+=this._getWidthOfChar(this.ctx,e[h],a,this.flipX?u-h:h)*this.scaleX,!(o<=i.y||r<=i.x))return this._getNewSelectionStartFromOffset(i,n,r,s+a,u);s++}if(i.y<o)return this._getNewSelectionStartFromOffset(i,n,r,s+a-1,u)}return this.text.length},_getNewSelectionStartFromOffset:function(t,e,i,n,r){var o=t.x-e,s=n+(i-t.x>o?0:1);return this.flipX&&(s=r-s),s>this.text.length&&(s=this.text.length),s}}),fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off");var t=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+t.top+"; left: "+t.left+"; opacity: 0; width: 0px; height: 0px; z-index: -999;",fabric.document.body.appendChild(this.hiddenTextarea),fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),fabric.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),fabric.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),fabric.util.addListener(this.hiddenTextarea,"cut",this.cut.bind(this)),fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},_keysMap:{8:"removeChars",9:"exitEditing",27:"exitEditing",13:"insertNewline",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMapUp:{67:"copy",88:"cut"},_ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(t){if(this.isEditing){if(t.keyCode in this._keysMap)this[this._keysMap[t.keyCode]](t);else{if(!(t.keyCode in this._ctrlKeysMapDown&&(t.ctrlKey||t.metaKey)))return;this[this._ctrlKeysMapDown[t.keyCode]](t)}t.stopImmediatePropagation(),t.preventDefault(),this.canvas&&this.canvas.renderAll()}},onKeyUp:function(t){this.isEditing&&!this._copyDone?t.keyCode in this._ctrlKeysMapUp&&(t.ctrlKey||t.metaKey)&&(this[this._ctrlKeysMapUp[t.keyCode]](t),t.stopImmediatePropagation(),t.preventDefault(),this.canvas&&this.canvas.renderAll()):this._copyDone=!1},onInput:function(t){if(this.isEditing&&!this.inCompositionMode){var e,i,n,r=this.selectionStart||0,o=this.selectionEnd||0,s=this.text.length,a=this.hiddenTextarea.value.length;a>s?(n="left"===this._selectionDirection?o:r,e=a-s,i=this.hiddenTextarea.value.slice(n,n+e)):(e=a-s+o-r,i=this.hiddenTextarea.value.slice(r,r+e)),this.insertChars(i),t.stopPropagation()}},onCompositionStart:function(){this.inCompositionMode=!0,this.prevCompositionLength=0,this.compositionStart=this.selectionStart},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(t){var e=t.data;this.selectionStart=this.compositionStart,this.selectionEnd=this.selectionEnd===this.selectionStart?this.compositionStart+this.prevCompositionLength:this.selectionEnd,this.insertChars(e,!1),this.prevCompositionLength=e.length},forwardDelete:function(t){if(this.selectionStart===this.selectionEnd){if(this.selectionStart===this.text.length)return;this.moveCursorRight(t)}this.removeChars(t)},copy:function(t){if(this.selectionStart!==this.selectionEnd){var e=this.getSelectedText(),i=this._getClipboardData(t);i&&i.setData("text",e),fabric.copiedText=e,fabric.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd),t.stopImmediatePropagation(),t.preventDefault(),this._copyDone=!0}},paste:function(t){var e=null,i=this._getClipboardData(t),n=!0;i?(e=i.getData("text").replace(/\r/g,""),fabric.copiedTextStyle&&fabric.copiedText===e||(n=!1)):e=fabric.copiedText,e&&this.insertChars(e,n),t.stopImmediatePropagation(),t.preventDefault()},cut:function(t){this.selectionStart!==this.selectionEnd&&(this.copy(t),this.removeChars(t))},_getClipboardData:function(t){return t&&t.clipboardData||fabric.window.clipboardData},_getWidthBeforeCursor:function(t,e){for(var i,n=this._textLines[t].slice(0,e),r=this._getLineWidth(this.ctx,t),o=this._getLineLeftOffset(r),s=0,a=n.length;s<a;s++)i=n[s],o+=this._getWidthOfChar(this.ctx,i,t,s);return o},getDownCursorOffset:function(t,e){var i=this._getSelectionForOffset(t,e),n=this.get2DCursorLocation(i),r=n.lineIndex;if(r===this._textLines.length-1||t.metaKey||34===t.keyCode)return this.text.length-i;var o=n.charIndex,s=this._getWidthBeforeCursor(r,o),a=this._getIndexOnLine(r+1,s);return this._textLines[r].slice(o).length+a+2},_getSelectionForOffset:function(t,e){return t.shiftKey&&this.selectionStart!==this.selectionEnd&&e?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(t,e){var i=this._getSelectionForOffset(t,e),n=this.get2DCursorLocation(i),r=n.lineIndex;if(0===r||t.metaKey||33===t.keyCode)return-i;var o=n.charIndex,s=this._getWidthBeforeCursor(r,o),a=this._getIndexOnLine(r-1,s),c=this._textLines[r].slice(0,o);return-this._textLines[r-1].length+a-c.length},_getIndexOnLine:function(t,e){for(var i,n=this._getLineWidth(this.ctx,t),r=this._textLines[t],o=this._getLineLeftOffset(n),s=0,a=0,c=r.length;a<c;a++){var l=r[a],h=this._getWidthOfChar(this.ctx,l,t,a);if((o+=h)>e){i=!0;var u=o-h,f=o,d=Math.abs(u-e);s=Math.abs(f-e)<d?a:a-1;break}}return i||(s=r.length-1),s},moveCursorDown:function(t){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||this._moveCursorUpOrDown("Down",t)},moveCursorUp:function(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",t)},_moveCursorUpOrDown:function(t,e){var i=this["get"+t+"CursorOffset"](e,"right"===this._selectionDirection);e.shiftKey?this.moveCursorWithShift(i):this.moveCursorWithoutShift(i),0!==i&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(t){var e="left"===this._selectionDirection?this.selectionStart+t:this.selectionEnd+t;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,e),0!==t},moveCursorWithoutShift:function(t){return t<0?(this.selectionStart+=t,this.selectionEnd=this.selectionStart):(this.selectionEnd+=t,this.selectionStart=this.selectionEnd),0!==t},moveCursorLeft:function(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",t)},_move:function(t,e,i){var n;if(t.altKey)n=this["findWordBoundary"+i](this[e]);else{if(!t.metaKey&&35!==t.keyCode&&36!==t.keyCode)return this[e]+="Left"===i?-1:1,!0;n=this["findLineBoundary"+i](this[e])}if(void 0!==typeof n&&this[e]!==n)return this[e]=n,!0},_moveLeft:function(t,e){return this._move(t,e,"Left")},_moveRight:function(t,e){return this._move(t,e,"Right")},moveCursorLeftWithoutShift:function(t){var e=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(e=this._moveLeft(t,"selectionStart")),this.selectionEnd=this.selectionStart,e},moveCursorLeftWithShift:function(t){return"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(t,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection="left",this._moveLeft(t,"selectionStart")):void 0},moveCursorRight:function(t){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||this._moveCursorLeftOrRight("Right",t)},_moveCursorLeftOrRight:function(t,e){var i="moveCursor"+t+"With";this._currentCursorOpacity=1,e.shiftKey?i+="Shift":i+="outShift",this[i](e)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(t){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(t,"selectionStart"):this.selectionEnd!==this.text.length?(this._selectionDirection="right",this._moveRight(t,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(t){var e=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(e=this._moveRight(t,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,e},removeChars:function(t){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(t):this._removeCharsFromTo(this.selectionStart,this.selectionEnd),this.setSelectionEnd(this.selectionStart),this._removeExtraneousStyles(),this.canvas&&this.canvas.renderAll(),this.setCoords(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(t){if(0!==this.selectionStart)if(t.metaKey){var e=this.findLineBoundaryLeft(this.selectionStart);this._removeCharsFromTo(e,this.selectionStart),this.setSelectionStart(e)}else if(t.altKey){var i=this.findWordBoundaryLeft(this.selectionStart);this._removeCharsFromTo(i,this.selectionStart),this.setSelectionStart(i)}else this._removeSingleCharAndStyle(this.selectionStart),this.setSelectionStart(this.selectionStart-1)}}),function(){var t=fabric.util.toFixed,e=fabric.Object.NUM_FRACTION_DIGITS;fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(t,e,i,n,r,o){this._getLineStyle(t)?this._setSVGTextLineChars(t,e,i,n,o):fabric.Text.prototype._setSVGTextLineText.call(this,t,e,i,n,r)},_setSVGTextLineChars:function(t,e,i,n,r){for(var o=this._textLines[t],s=0,a=this._getLineLeftOffset(this._getLineWidth(this.ctx,t))-this.width/2,c=this._getSVGLineTopOffset(t),l=this._getHeightOfLine(this.ctx,t),h=0,u=o.length;h<u;h++){var f=this._getStyleDeclaration(t,h)||{};e.push(this._createTextCharSpan(o[h],f,a,c.lineTop+c.offset,s));var d=this._getWidthOfChar(this.ctx,o[h],t,h);f.textBackgroundColor&&r.push(this._createTextCharBg(f,a,c.lineTop,l,d,s)),s+=d}},_getSVGLineTopOffset:function(t){for(var e,i=0,n=0;n<t;n++)i+=this._getHeightOfLine(this.ctx,n);return e=this._getHeightOfLine(this.ctx,n),{lineTop:i,offset:(this._fontSizeMult-this._fontSizeFraction)*e/(this.lineHeight*this._fontSizeMult)}},_createTextCharBg:function(i,n,r,o,s,a){return['\t\t<rect fill="',i.textBackgroundColor,'" x="',t(n+a,e),'" y="',t(r-this.height/2,e),'" width="',t(s,e),'" height="',t(o/this.lineHeight,e),'"></rect>\n'].join("")},_createTextCharSpan:function(i,n,r,o,s){var a=this.getSvgStyles.call(fabric.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text",getSvgFilter:fabric.Object.prototype.getSvgFilter},n));return['\t\t\t<tspan x="',t(r+s,e),'" y="',t(o-this.height/2,e),'" ',n.fontFamily?'font-family="'+n.fontFamily.replace(/"/g,"'")+'" ':"",n.fontSize?'font-size="'+n.fontSize+'" ':"",n.fontStyle?'font-style="'+n.fontStyle+'" ':"",n.fontWeight?'font-weight="'+n.fontWeight+'" ':"",n.textDecoration?'text-decoration="'+n.textDecoration+'" ':"",'style="',a,'">',fabric.util.string.escapeXml(i),"</tspan>\n"].join("")}})}(),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.clone;e.Textbox=e.util.createClass(e.IText,e.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingY:!0,lockScalingFlip:!0,initialize:function(t,i){this.ctx=e.util.createCanvasElement().getContext("2d"),this.callSuper("initialize",t,i),this.setControlsVisibility(e.Textbox.getTextboxControlVisibility()),this._dimensionAffectingProps.width=!0},_initDimensions:function(t){this.__skipDimension||(t||(t=e.util.createCanvasElement().getContext("2d"),this._setTextStyles(t)),this.dynamicMinWidth=0,this._textLines=this._splitTextIntoLines(),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this._clearCache(),this.height=this._getTextHeight(t))},_generateStyleMap:function(){for(var t=0,e=0,i=0,n={},r=0;r<this._textLines.length;r++)"\n"===this.text[i]&&r>0?(e=0,i++,t++):" "===this.text[i]&&r>0&&(e++,i++),n[r]={line:t,offset:e},i+=this._textLines[r].length,e+=this._textLines[r].length;return n},_getStyleDeclaration:function(t,e,i){if(this._styleMap){var n=this._styleMap[t];if(!n)return i?{}:null;t=n.line,e=n.offset+e}return this.callSuper("_getStyleDeclaration",t,e,i)},_setStyleDeclaration:function(t,e,i){var n=this._styleMap[t];t=n.line,e=n.offset+e,this.styles[t][e]=i},_deleteStyleDeclaration:function(t,e){var i=this._styleMap[t];t=i.line,e=i.offset+e,delete this.styles[t][e]},_getLineStyle:function(t){var e=this._styleMap[t];return this.styles[e.line]},_setLineStyle:function(t,e){var i=this._styleMap[t];this.styles[i.line]=e},_deleteLineStyle:function(t){var e=this._styleMap[t];delete this.styles[e.line]},_wrapText:function(t,e){var i,n=e.split(this._reNewline),r=[];for(i=0;i<n.length;i++)r=r.concat(this._wrapLine(t,n[i],i));return r},_measureText:function(t,e,i,n){var r=0;n=n||0;for(var o=0,s=e.length;o<s;o++)r+=this._getWidthOfChar(t,e[o],i,o+n);return r},_wrapLine:function(t,e,i){for(var n=0,r=[],o="",s=e.split(" "),a="",c=0,l=0,h=0,u=0,f=!0,d=this._getWidthOfCharSpacing(),p=0;p<s.length;p++)a=s[p],l=this._measureText(t,a,i,c),c+=a.length,(n+=h+l-d)>=this.width&&!f?(r.push(o),o="",n=l,f=!0):n+=d,f||(o+=" "),o+=a,h=this._measureText(t," ",i,c),c++,f=!1,l>u&&(u=l);return p&&r.push(o),u>this.dynamicMinWidth&&(this.dynamicMinWidth=u-d),r},_splitTextIntoLines:function(){var t=this.textAlign;this.ctx.save(),this._setTextStyles(this.ctx),this.textAlign="left";var e=this._wrapText(this.ctx,this.text);return this.textAlign=t,this.ctx.restore(),this._textLines=e,this._styleMap=this._generateStyleMap(),e},setOnGroup:function(t,e){"scaleX"===t&&(this.set("scaleX",Math.abs(1/e)),this.set("width",this.get("width")*e/(void 0===this.__oldScaleX?1:this.__oldScaleX)),this.__oldScaleX=e)},get2DCursorLocation:function(t){void 0===t&&(t=this.selectionStart);for(var e=this._textLines.length,i=0,n=0;n<e;n++){var r=this._textLines[n].length;if(t<=i+r)return{lineIndex:n,charIndex:t-i};i+=r,"\n"!==this.text[i]&&" "!==this.text[i]||i++}return{lineIndex:e-1,charIndex:this._textLines[e-1].length}},_getCursorBoundariesOffsets:function(t,e){for(var i=0,n=0,r=this.get2DCursorLocation(),o=this._textLines[r.lineIndex].split(""),s=this._getLineLeftOffset(this._getLineWidth(this.ctx,r.lineIndex)),a=0;a<r.charIndex;a++)n+=this._getWidthOfChar(this.ctx,o[a],r.lineIndex,a);for(a=0;a<r.lineIndex;a++)i+=this._getHeightOfLine(this.ctx,a);return"cursor"===e&&(i+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,r.lineIndex)/this.lineHeight-this.getCurrentCharFontSize(r.lineIndex,r.charIndex)*(1-this._fontSizeFraction)),{top:i,left:n,lineLeft:s}},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},toObject:function(t){return this.callSuper("toObject",["minWidth"].concat(t))}}),e.Textbox.fromObject=function(t,n){var r=new e.Textbox(t.text,i(t));return n&&n(r),r},e.Textbox.getTextboxControlVisibility=function(){return{tl:!1,tr:!1,br:!1,bl:!1,ml:!0,mt:!1,mr:!0,mb:!1,mtr:!0}}}(exports),function(){var t=fabric.Canvas.prototype._setObjectScale;fabric.Canvas.prototype._setObjectScale=function(e,i,n,r,o,s,a){var c=i.target;if(!(c instanceof fabric.Textbox))return t.call(fabric.Canvas.prototype,e,i,n,r,o,s,a);var l=c.width*(e.x/i.scaleX/(c.width+c.strokeWidth));return l>=c.getMinWidth()?(c.set("width",l),!0):void 0},fabric.Group.prototype._refreshControlsVisibility=function(){if(void 0!==fabric.Textbox)for(var t=this._objects.length;t--;)if(this._objects[t]instanceof fabric.Textbox)return void this.setControlsVisibility(fabric.Textbox.getTextboxControlVisibility())};var e=fabric.util.object.clone;fabric.util.object.extend(fabric.Textbox.prototype,{_removeExtraneousStyles:function(){for(var t in this._styleMap)this._textLines[t]||delete this.styles[this._styleMap[t].line]},insertCharStyleObject:function(t,e,i){var n=this._styleMap[t];t=n.line,e=n.offset+e,fabric.IText.prototype.insertCharStyleObject.apply(this,[t,e,i])},insertNewlineStyleObject:function(t,e,i){var n=this._styleMap[t];t=n.line,e=n.offset+e,fabric.IText.prototype.insertNewlineStyleObject.apply(this,[t,e,i])},shiftLineStyles:function(t,i){var n=e(this.styles),r=this._styleMap[t];for(var o in t=r.line,this.styles){var s=parseInt(o,10);s>t&&(this.styles[s+i]=n[s],n[s-i]||delete this.styles[s])}},_getTextOnPreviousLine:function(t){for(var e=this._textLines[t-1];this._styleMap[t-2]&&this._styleMap[t-2].line===this._styleMap[t-1].line;)e=this._textLines[t-2]+e,t--;return e},removeStyleObject:function(t,e){var i=this.get2DCursorLocation(e),n=this._styleMap[i.lineIndex],r=n.line,o=n.offset+i.charIndex;this._removeStyleObject(t,i,r,o)}})}(),function(){var t=fabric.IText.prototype._getNewSelectionStartFromOffset;fabric.IText.prototype._getNewSelectionStartFromOffset=function(e,i,n,r,o){r=t.call(this,e,i,n,r,o);for(var s=0,a=0,c=0;c<this._textLines.length&&!((s+=this._textLines[c].length)+a>=r);c++)"\n"!==this.text[s+a]&&" "!==this.text[s+a]||a++;return r-c+a}}(),function(){if("undefined"==typeof document||"undefined"==typeof window){var DOMParser=__webpack_require__(23).DOMParser,URL=__webpack_require__(9),HTTP=__webpack_require__(10),HTTPS=__webpack_require__(12),Canvas=__webpack_require__(5),Image=__webpack_require__(5).Image;fabric.util.loadImage=function(t,e,i){function n(n){n?(r.src=new Buffer(n,"binary"),r._src=t,e&&e.call(i,r)):(r=null,e&&e.call(i,null,!0))}var r=new Image;t&&(t instanceof Buffer||0===t.indexOf("data"))?(r.src=r._src=t,e&&e.call(i,r)):t&&0!==t.indexOf("http")?requestFs(t,n):t?request(t,"binary",n):e&&e.call(i,t)},fabric.loadSVGFromURL=function(t,e,i){0!==(t=t.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim()).indexOf("http")?requestFs(t,function(t){fabric.loadSVGFromString(t.toString(),e,i)}):request(t,"",function(t){fabric.loadSVGFromString(t,e,i)})},fabric.loadSVGFromString=function(t,e,i){var n=(new DOMParser).parseFromString(t);fabric.parseSVGDocument(n.documentElement,function(t,i){e&&e(t,i)},i)},fabric.util.getScript=function(url,callback){request(url,"",function(body){eval(body),callback&&callback()})},fabric.createCanvasForNode=function(t,e,i,n){n=n||i;var r=fabric.document.createElement("canvas"),o=new Canvas(t||600,e||600,n),s=new Canvas(t||600,e||600,n);r.style={},r.width=o.width,r.height=o.height,(i=i||{}).nodeCanvas=o,i.nodeCacheCanvas=s;var a=new(fabric.Canvas||fabric.StaticCanvas)(r,i);return a.nodeCanvas=o,a.nodeCacheCanvas=s,a.contextContainer=o.getContext("2d"),a.contextCache=s.getContext("2d"),a.Font=Canvas.Font,a};var originaInitStatic=fabric.StaticCanvas.prototype._initStatic;fabric.StaticCanvas.prototype._initStatic=function(t,e){t=t||fabric.document.createElement("canvas"),this.nodeCanvas=new Canvas(t.width,t.height),this.nodeCacheCanvas=new Canvas(t.width,t.height),originaInitStatic.call(this,t,e),this.contextContainer=this.nodeCanvas.getContext("2d"),this.contextCache=this.nodeCacheCanvas.getContext("2d"),this.Font=Canvas.Font},fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(t){return this.nodeCanvas.createJPEGStream(t)},fabric.StaticCanvas.prototype._initRetinaScaling=function(){if(this._isRetinaScaling())return this.lowerCanvasEl.setAttribute("width",this.width*fabric.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio),this.nodeCanvas.width=this.width*fabric.devicePixelRatio,this.nodeCanvas.height=this.height*fabric.devicePixelRatio,this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio),this},fabric.Canvas&&(fabric.Canvas.prototype._initRetinaScaling=fabric.StaticCanvas.prototype._initRetinaScaling);var origSetBackstoreDimension=fabric.StaticCanvas.prototype._setBackstoreDimension;fabric.StaticCanvas.prototype._setBackstoreDimension=function(t,e){return origSetBackstoreDimension.call(this,t,e),this.nodeCanvas[t]=e,this},fabric.Canvas&&(fabric.Canvas.prototype._setBackstoreDimension=fabric.StaticCanvas.prototype._setBackstoreDimension)}function request(t,e,i){var n=URL.parse(t);n.port||(n.port=0===n.protocol.indexOf("https:")?443:80);var r=(0===n.protocol.indexOf("https:")?HTTPS:HTTP).request({hostname:n.hostname,port:n.port,path:n.path,method:"GET"},function(t){var n="";e&&t.setEncoding(e),t.on("end",function(){i(n)}),t.on("data",function(e){200===t.statusCode&&(n+=e)})});r.on("error",function(t){t.errno===process.ECONNREFUSED?fabric.log("ECONNREFUSED: connection refused to "+n.hostname+":"+n.port):fabric.log(t.message),i(null)}),r.end()}function requestFs(t,e){__webpack_require__(11).readFile(t,function(t,i){if(t)throw fabric.log(t),t;e(i)})}}()}).call(this,__webpack_require__(3).Buffer,__webpack_require__(1))},function(t,e,i){
/*!
 * Toast UI Colorpicker
 * @version 2.2.0
 * @author NHNEnt FE Development Team <dl_javascript@nhnent.com>
 * @license MIT
 */
!function(e,n){t.exports=n(i(26))}(0,function(t){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={exports:{},id:n,loaded:!1};return t[n].call(r.exports,r,r.exports,i),r.loaded=!0,r.exports}return i.m=t,i.c=e,i.p="dist",i(0)}([function(t,e,i){i(1),t.exports=i(6)},function(t,e){},,,,,function(t,e,i){"use strict";var n={domutil:i(7),domevent:i(9),Collection:i(10),View:i(11),Drag:i(12),create:i(13),Palette:i(16),Slider:i(18),colorutil:i(14),svgvml:i(19)};t.exports=n},function(t,e,i){"use strict";var n,r,o=i(8),s=i(9),a=i(10),c=o,l="onselectstart"in document,h="",u=/^auto$|^$|%/;r=(n={appendHTMLElement:function(t,e,i){var n;return i=i||"",(n=document.createElement(t)).className=i,e?e.appendChild(n):document.body.appendChild(n),n},remove:function(t){t&&t.parentNode&&t.parentNode.removeChild(t)},get:function(t){return document.getElementById(t)},_matcher:function(t,e){return/^\./.test(e)?n.hasClass(t,e.replace(".","")):/^#/.test(e)?t.id===e.replace("#",""):t.nodeName.toLowerCase()===e.toLowerCase()},find:function(t,e,i){var r=[],o=!1,s=c.isUndefined(i)||!1===i,a=c.isFunction(i);return c.isString(e)&&(e=n.get(e)),function t(e,c){for(var l,h=e.childNodes,u=0,f=h.length;u<f;u+=1)if("#text"!==(l=h[u]).nodeName)if(n._matcher(l,c)){if((a&&i(l)||!a)&&r.push(l),s){o=!0;break}}else if(l.childNodes.length>0&&(t(l,c),o))break}(e=e||window.document.body,t),s?r[0]||null:r},closest:function(t,e){var i=t.parentNode;if(n._matcher(t,e))return t;for(;i&&i!==window.document.body;){if(n._matcher(i,e))return i;i=i.parentNode}},text:function(t){var e="",i=0,r=t.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)e+=n.text(t)}else if(3===r||4===r)return t.nodeValue}else for(;t[i];i+=1)e+=n.text(t[i]);return e},setData:function(t,e,i){"dataset"in t?t.dataset[e]=i:t.setAttribute("data-"+e,i)},getData:function(t,e){return"dataset"in t?t.dataset[e]:t.getAttribute("data-"+e)},hasClass:function(t,e){var i;return c.isUndefined(t.classList)?(i=n.getClass(t)).length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(i):t.classList.contains(e)},addClass:function(t,e){var i;c.isUndefined(t.classList)?n.hasClass(t,e)||(i=n.getClass(t),n.setClass(t,(i?i+" ":"")+e)):c.forEachArray(e.split(" "),function(e){t.classList.add(e)})},setClass:function(t,e){c.isUndefined(t.className.baseVal)?t.className=e:t.className.baseVal=e},removeClass:function(t,e){var i="";c.isUndefined(t.classList)?(i=(" "+n.getClass(t)+" ").replace(" "+e+" "," "),n.setClass(t,function(t){return t.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}(i))):t.classList.remove(e)},getClass:function(t){return t&&t.className?c.isUndefined(t.className.baseVal)?t.className:t.className.baseVal:""},getStyle:function(t,e){var i,n=t.style[e]||t.currentStyle&&t.currentStyle[e];return n&&"auto"!==n||!document.defaultView||(n=(i=document.defaultView.getComputedStyle(t,null))?i[e]:null),"auto"===n?null:n},getComputedStyle:function(t){var e=document.defaultView;return e&&e.getComputedStyle?document.defaultView.getComputedStyle(t):{getPropertyValue:function(e){var i=/(\-([a-z]){1})/g;return"float"===e&&(e="styleFloat"),i.test(e)&&(e=e.replace(i,function(){return arguments[2].toUpperCase()})),t.currentStyle[e]?t.currentStyle[e]:null}}},setPosition:function(t,e,i){e=c.isUndefined(e)?0:e,i=c.isUndefined(i)?0:i,t._pos=[e,i],t.style.left=e+"px",t.style.top=i+"px"},getPosition:function(t,e){var i,n,r;return e&&(t._pos=null),t._pos?t._pos:(i=0,n=0,(u.test(t.style.left)||u.test(t.style.top))&&"getBoundingClientRect"in t?(i=(r=t.getBoundingClientRect()).left,n=r.top):(i=parseFloat(t.style.left||0),n=parseFloat(t.style.top||0)),[i,n])},getSize:function(t){var e,i=n.getStyle(t,"width"),r=n.getStyle(t,"height");return(u.test(i)||u.test(r))&&"getBoundingClientRect"in t?(i=(e=t.getBoundingClientRect()).width,r=e.height):(i=parseFloat(i||0),r=parseFloat(r||0)),[i,r]},testProp:function(t){for(var e=document.documentElement.style,i=0,n=t.length;i<n;i+=1)if(t[i]in e)return t[i];return!1},getFormData:function(t){var e=new a(function(){return this.length}),i=function(t){return!t.disabled},r={};return e.add.apply(e,n.find("input",t,i).concat(n.find("select",t,i)).concat(n.find("textarea",t,i))),e=e.groupBy(function(t){return t&&t.getAttribute("name")||"_other"}),c.forEach(e,function(t,e){"_other"!==e&&t.each(function(i){var o=i.nodeName.toLowerCase(),s=i.type,a=[];"radio"===s?a=[t.find(function(t){return t.checked}).toArray().pop()]:"checkbox"===s?a=t.find(function(t){return t.checked}).toArray():"select"===o?t.find(function(t){return!!t.childNodes.length}).each(function(t){a=a.concat(n.find("option",t,function(t){return t.selected}))}):a=t.find(function(t){return""!==t.value}).toArray(),(a=c.map(a,function(t){return t.value})).length?1===a.length&&(a=a[0]):a="",r[e]=a})}),r}}).testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]),n.disableTextSelection=l?function(){s.on(window,"selectstart",s.preventDefault)}:function(){var t=document.documentElement.style;h=t[r],t[r]="none"},n.enableTextSelection=l?function(){s.off(window,"selectstart",s.preventDefault)}:function(){document.documentElement.style[r]=h},n.disableImageDrag=function(){s.on(window,"dragstart",s.preventDefault)},n.enableImageDrag=function(){s.off(window,"dragstart",s.preventDefault)},n.applyTemplate=function(t,e){return t.replace(/\{\{(\w*)\}\}/g,function(t,i){return e.hasOwnProperty(i)?e[i]:""})},t.exports=n},function(e,i){e.exports=t},function(t,e,i){"use strict";var n=i(8),r=n.browser,o={START:["touchstart","mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},s={on:function(t,e,i,r){n.isString(e)?n.forEach(e.split(" "),function(e){s._on(t,e,i,r)}):n.forEachOwnProperties(e,function(e,n){s._on(t,n,e,i)})},_on:function(t,e,i,r){var o,a,c;o=e+n.stamp(i)+(r?"_"+n.stamp(r):""),t._evt&&t._evt[o]||(c=a=function(e){i.call(r||t,e||window.event)},"addEventListener"in t?"mouseenter"===e||"mouseleave"===e?(a=function(e){e=e||window.event,s._checkMouse(t,e)&&c(e)},t.addEventListener("mouseenter"===e?"mouseover":"mouseout",a,!1)):("mousewheel"===e&&t.addEventListener("DOMMouseScroll",a,!1),t.addEventListener(e,a,!1)):"attachEvent"in t&&t.attachEvent("on"+e,a),t._evt=t._evt||{},t._evt[o]=a)},off:function(t,e,i,r){n.isString(e)?n.forEach(e.split(" "),function(e){s._off(t,e,i,r)}):n.forEachOwnProperties(e,function(e,n){s._off(t,n,e,i)})},_off:function(t,e,i,r){var o=e+n.stamp(i)+(r?"_"+n.stamp(r):""),s=t._evt&&t._evt[o];if(s){if("removeEventListener"in t)"mouseenter"===e||"mouseleave"===e?t.removeEventListener("mouseenter"===e?"mouseover":"mouseout",s,!1):("mousewheel"===e&&t.removeEventListener("DOMMouseScroll",s,!1),t.removeEventListener(e,s,!1));else if("detachEvent"in t)try{t.detachEvent("on"+e,s)}catch(t){}delete t._evt[o],n.keys(t._evt).length||(n.browser.msie&&n.browser.version<9?t._evt=null:delete t._evt)}},once:function(t,e,i,r){var o=this;n.isObject(e)?n.forEachOwnProperties(e,function(e,n){s.once(t,n,e,i)}):s.on(t,e,function n(){i.apply(r||t,arguments),o._off(t,e,n,r)},r)},stopPropagation:function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},preventDefault:function(t){t.preventDefault?t.preventDefault():t.returnValue=!1},stop:function(t){s.preventDefault(t),s.stopPropagation(t)},disableScrollPropagation:function(t){s.on(t,"mousewheel MozMousePixelScroll",s.stopPropagation)},disableClickPropagation:function(t){s.on(t,o.START.join(" ")+" click dblclick",s.stopPropagation)},getMousePosition:function(t,e){var i;return e?(i=e.getBoundingClientRect(),[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]):[t.clientX,t.clientY]},getWheelDelta:function(t){var e=0;return t.wheelDelta&&(e=t.wheelDelta/120),t.detail&&(e=-t.detail/3),e},_checkMouse:function(t,e){var i=e.relatedTarget;if(!i)return!0;try{for(;i&&i!==t;)i=i.parentNode}catch(t){return!1}return i!==t},trigger:function(t,e,i){n.isUndefined(i)&&/(mouse|click)/.exec(e)&&(i=s.mouseEvent(e)),t.dispatchEvent?t.dispatchEvent(i):t.fireEvent&&t.fireEvent("on"+e,i)},mouseEvent:function(t,e){var i,o;return o=n.extend({bubbles:!0,cancelable:"mousemove"!==t,view:window,wheelDelta:0,detail:0,screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:void 0},e),r.msie&&r.version<9&&delete o.wheelDelta,"function"==typeof document.createEvent?(i=document.createEvent("MouseEvents")).initMouseEvent(t,o.bubbles,o.cancelable,o.view,o.detail,o.screenX,o.screenY,o.clientX,o.clientY,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.button,document.body.parentNode):document.createEventObject&&(i=document.createEventObject(),n.forEach(o,function(t,e){i[e]=t},this),i.button={0:1,1:4,2:2}[i.button]||i.button),i},getMouseButton:function(t){var e;return document.implementation.hasFeature("MouseEvents","2.0")?t.button:(e=t.button+"",~"0,1,3,5,7".indexOf(e)?0:~"2,6".indexOf(e)?2:~"4".indexOf(e)?1:void 0)}};t.exports=s},function(t,e,i){"use strict";var n=i(8),r=n.forEachOwnProperties,o=n.forEachArray,s=n.isFunction,a=n.isObject,c=Array.prototype.slice;function l(t){this.items={},this.length=0,s(t)&&(this.getItemID=t)}l.and=function(t){var e;return t=c.call(arguments),e=t.length,function(i){for(var n=0;n<e;n+=1)if(!t[n].call(null,i))return!1;return!0}},l.or=function(t){var e;return t=c.call(arguments),e=t.length,function(i){for(var n=1,r=t[0].call(null,i);n<e;n+=1)r=r||t[n].call(null,i);return r}},l.merge=function(t){var e=c.call(arguments),i={},r=new l(e[0].getItemID),s=n.extend;return o(e,function(t){s(i,t.items)}),r.items=i,r.length=n.keys(r.items).length,r},l.prototype.getItemID=function(t){return t._id+""},l.prototype.add=function(t){var e,i;arguments.length>1?o(c.call(arguments),function(t){this.add(t)},this):(e=this.getItemID(t),(i=this.items)[e]||(this.length+=1),i[e]=t)},l.prototype.remove=function(t){var e,i,r=[];return this.length?arguments.length>1?r=n.map(c.call(arguments),function(t){return this.remove(t)},this):(e=this.items,a(t)&&(t=this.getItemID(t)),e[t]?(this.length-=1,i=e[t],delete e[t],i):r):r},l.prototype.clear=function(){this.items={},this.length=0},l.prototype.has=function(t){var e,i;return!!this.length&&(e=s(t),i=!1,e?this.each(function(e){return!0!==t(e)||(i=!0,!1)}):(t=a(t)?this.getItemID(t):t,i=n.isExisty(this.items[t])),i)},l.prototype.doWhenHas=function(t,e,i){var r=this.items[t];n.isExisty(r)&&e.call(i||this,r)},l.prototype.find=function(t){var e=new l;return this.hasOwnProperty("getItemID")&&(e.getItemID=this.getItemID),this.each(function(i){!0===t(i)&&e.add(i)}),e},l.prototype.groupBy=function(t,e){var i,r,o={},a=s(t),c=this.getItemID;if(n.isArray(t)){if(n.forEachArray(t,function(t){o[t+""]=new l(c)}),!e)return o;t=e,a=!0}return this.each(function(e){a?r=t(e):(r=e[t],s(r)&&(r=r.apply(e))),(i=o[r])||(i=o[r]=new l(c)),i.add(e)}),o},l.prototype.single=function(){var t;return this.each(function(e){return t=e,!1},this),t},l.prototype.sort=function(t){var e=[];return this.each(function(t){e.push(t)}),s(t)&&(e=e.sort(t)),e},l.prototype.each=function(t,e){r(this.items,t,e||this)},l.prototype.toArray=function(){return this.length?n.map(this.items,function(t){return t}):[]},t.exports=l},function(t,e,i){"use strict";var n=i(8),r=i(7),o=i(10);function s(t,e){var i=n.stamp(this);t=t||{},n.isUndefined(e)&&(e=r.appendHTMLElement("div")),r.addClass(e,"tui-view-"+i),this.id=i,this.container=e,this.childs=new o(function(t){return n.stamp(t)}),this.parent=null}s.prototype.addChild=function(t,e){e&&e.call(t,this),t.parent=this,this.childs.add(t)},s.prototype.removeChild=function(t,e){var i=n.isNumber(t)?this.childs.items[t]:t;t=n.stamp(i),e&&e.call(i,this),this.childs.remove(t)},s.prototype.render=function(){this.childs.each(function(t){t.render()})},s.prototype.recursive=function(t,e){n.isFunction(t)&&(e||t(this),this.childs.each(function(e){e.recursive(t)}))},s.prototype.resize=function(){for(var t=Array.prototype.slice.call(arguments),e=this.parent;e;)n.isFunction(e._onResize)&&e._onResize.apply(e,t),e=e.parent},s.prototype._beforeDestroy=function(){},s.prototype._destroy=function(){this._beforeDestroy(),this.childs.clear(),this.container.innerHTML="",this.id=this.parent=this.childs=this.container=null},s.prototype.destroy=function(t){this.childs.each(function(t){t.destroy(!0),t._destroy()}),t||this._destroy()},s.prototype.getViewBound=function(){var t=this.container,e=r.getPosition(t),i=r.getSize(t);return{x:e[0],y:e[1],width:i[0],height:i[1]}},t.exports=s},function(t,e,i){(function(e){"use strict";var n=i(8),r=i(7),o=i(9);function s(t,e){o.on(e,"mousedown",this._onMouseDown,this),this.options=n.extend({distance:10},t),this.container=e,this._isMoved=!1,this._distance=0,this._dragStartFired=!1,this._dragStartEventData=null}s.prototype.destroy=function(){o.off(this.container,"mousedown",this._onMouseDown,this),this.options=this.container=this._isMoved=this._distance=this._dragStartFired=this._dragStartEventData=null},s.prototype._toggleDragEvent=function(t){var i,n,s=this.container;t?(i="on",n="disable"):(i="off",n="enable"),r[n+"TextSelection"](s),r[n+"ImageDrag"](s),o[i](e.document,{mousemove:this._onMouseMove,mouseup:this._onMouseUp},this)},s.prototype._getEventData=function(t){return{target:t.target||t.srcElement,originEvent:t}},s.prototype._onMouseDown=function(t){0===o.getMouseButton(t)&&(this._distance=0,this._dragStartFired=!1,this._dragStartEventData=this._getEventData(t),this._toggleDragEvent(!0))},s.prototype._onMouseMove=function(t){var e=this.options.distance;o.preventDefault(t),this._isMoved=!0,this._distance<e?this._distance+=1:this._dragStartFired||(this._dragStartFired=!0,this.invoke("dragStart",this._dragStartEventData))?this.fire("drag",this._getEventData(t)):this._toggleDragEvent(!1)},s.prototype._onMouseUp=function(t){if(this._toggleDragEvent(!1),this._isMoved)return this._isMoved=!1,void this.fire("dragEnd",this._getEventData(t));this.fire("click",this._getEventData(t))},n.CustomEvents.mixin(s),t.exports=s}).call(e,function(){return this}())},function(t,e,i){"use strict";var n=i(8),r=i(14),o=i(15),s=i(16),a=i(18),c=!1;function l(t){var e;if(!(this instanceof l))return new l(t);if(!(t=this.options=n.extend({container:null,color:"#f8f8f8",preset:["#181818","#282828","#383838","#585858","#b8b8b8","#d8d8d8","#e8e8e8","#f8f8f8","#ab4642","#dc9656","#f7ca88","#a1b56c","#86c1b9","#7cafc2","#ba8baf","#a16946"],cssPrefix:"tui-colorpicker-",detailTxt:"Detail",usageStatistics:!0},t)).container)throw new Error("ColorPicker(): need container option.");e=this.layout=new o(t,t.container),this.palette=new s(t,e.container),this.palette.on({_selectColor:this._onSelectColorInPalette,_toggleSlider:this._onToggleSlider},this),this.slider=new a(t,e.container),this.slider.on("_selectColor",this._onSelectColorInSlider,this),e.addChild(this.palette),e.addChild(this.slider),this.render(t.color),t.usageStatistics&&function(){var t=location.hostname;c||(c=!0,n.imagePing("https://www.google-analytics.com/collect",{v:1,t:"event",tid:"UA-115377265-9",cid:t,dp:t,dh:"color-picker"}))}()}l.prototype._onSelectColorInPalette=function(t){var e=t.color,i=this.options;r.isValidRGB(e)||""===e?(this.fire("selectColor",{color:e,origin:"palette"}),i.color!==e&&(i.color=e,this.render(e))):this.render()},l.prototype._onToggleSlider=function(){this.slider.toggle(!this.slider.isVisible())},l.prototype._onSelectColorInSlider=function(t){var e=t.color,i=this.options;this.fire("selectColor",{color:e,origin:"slider"}),i.color!==e&&(i.color=e,this.palette.render(e))},l.prototype.setColor=function(t){if(!r.isValidRGB(t))throw new Error("ColorPicker#setColor(): need valid hex string color value");this.options.color=t,this.render(t)},l.prototype.getColor=function(){return this.options.color},l.prototype.toggle=function(t){this.layout.container.style.display=t?"block":"none"},l.prototype.render=function(t){this.layout.render(t||this.options.color)},l.prototype.destroy=function(){this.layout.destroy(),this.options.container.innerHTML="",this.layout=this.slider=this.palette=this.options=null},n.CustomEvents.mixin(l),t.exports=l},function(t,e){"use strict";var i=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i,n={leadingZero:function(t,e){var i="",n=0;if((t+"").length>e)return t+"";for(;n<e-1;n+=1)i+="0";return(i+t).slice(-1*e)},isValidRGB:function(t){return i.test(t)},
// @license RGB <-> HSV conversion utilities based off of http://www.cs.rit.edu/~ncs/color/t_convert.html
hexToRGB:function(t){return!!n.isValidRGB(t)&&(t=t.substring(1),[parseInt(t.substr(0,2),16),parseInt(t.substr(2,2),16),parseInt(t.substr(4,2),16)])},rgbToHEX:function(t,e,i){var r="#"+n.leadingZero(t.toString(16),2)+n.leadingZero(e.toString(16),2)+n.leadingZero(i.toString(16),2);return!!n.isValidRGB(r)&&r},rgbToHSV:function(t,e,i){var n,r,o,s,a,c;if(t/=255,e/=255,i/=255,a=n=Math.max(t,e,i),c=n-(r=Math.min(t,e,i)),s=0===n?0:c/n,n===r)o=0;else{switch(n){case t:o=(e-i)/c+(e<i?6:0);break;case e:o=(i-t)/c+2;break;case i:o=(t-e)/c+4}o/=6}return[Math.round(360*o),Math.round(100*s),Math.round(100*a)]},hsvToRGB:function(t,e,i){var n,r,o,s,a,c,l,h;if(t=Math.max(0,Math.min(360,t)),e=Math.max(0,Math.min(100,e)),i=Math.max(0,Math.min(100,i)),i/=100,0===(e/=100))return n=r=o=i,[Math.round(255*n),Math.round(255*r),Math.round(255*o)];switch(c=i*(1-e),l=i*(1-e*(a=(t/=60)-(s=Math.floor(t)))),h=i*(1-e*(1-a)),s){case 0:n=i,r=h,o=c;break;case 1:n=l,r=i,o=c;break;case 2:n=c,r=i,o=h;break;case 3:n=c,r=l,o=i;break;case 4:n=h,r=c,o=i;break;default:n=i,r=c,o=l}return[Math.round(255*n),Math.round(255*r),Math.round(255*o)]}};t.exports=n},function(t,e,i){"use strict";var n=i(8),r=i(7),o=i(11);function s(t,e){this.options=n.extend({cssPrefix:"tui-colorpicker-"},t),e=r.appendHTMLElement("div",e,this.options.cssPrefix+"container"),o.call(this,t,e),this.render()}n.inherit(s,o),s.prototype.render=function(t){this.recursive(function(e){e.render(t)},!0)},t.exports=s},function(t,e,i){"use strict";var n=i(8),r=i(7),o=i(14),s=i(9),a=i(11),c=i(17);function l(t,e){this.options=n.extend({cssPrefix:"tui-colorpicker-",preset:["#181818","#282828","#383838","#585858","#B8B8B8","#D8D8D8","#E8E8E8","#F8F8F8","#AB4642","#DC9656","#F7CA88","#A1B56C","#86C1B9","#7CAFC2","#BA8BAF","#A16946"],detailTxt:"Detail"},t),e=r.appendHTMLElement("div",e,this.options.cssPrefix+"palette-container"),a.call(this,t,e)}n.inherit(l,a),l.prototype._onClick=function(t){var e=this.options,i=t.srcElement||t.target,n={};if(r.hasClass(i,e.cssPrefix+"palette-button"))return n.color=i.value,void this.fire("_selectColor",n);r.hasClass(i,e.cssPrefix+"palette-toggle-slider")&&this.fire("_toggleSlider")},l.prototype._onChange=function(t){var e=this.options,i=t.srcElement||t.target,n={};r.hasClass(i,e.cssPrefix+"palette-hex")&&(n.color=i.value,this.fire("_selectColor",n))},l.prototype._beforeDestroy=function(){this._toggleEvent(!1)},l.prototype._toggleEvent=function(t){var e,i=this.options,n=this.container,o=s[t?"on":"off"];o(n,"click",this._onClick,this),(e=r.find("."+i.cssPrefix+"palette-hex",n))&&o(e,"change",this._onChange,this)},l.prototype.render=function(t){var e=this.options,i="";this._toggleEvent(!1),i=c.layout.replace("{{colorList}}",n.map(e.preset,function(i){var n="";return o.isValidRGB(i)&&(n=r.applyTemplate(c.itemStyle,{color:i})),r.applyTemplate(c.item,{itemStyle:n,itemClass:i?"":" "+e.cssPrefix+"color-transparent",color:i,cssPrefix:e.cssPrefix,selected:i===t?" "+e.cssPrefix+"selected":""})}).join("")),i=r.applyTemplate(i,{cssPrefix:e.cssPrefix,detailTxt:e.detailTxt,color:t}),this.container.innerHTML=i,this._toggleEvent(!0)},n.CustomEvents.mixin(l),t.exports=l},function(t,e){"use strict";var i=['<ul class="{{cssPrefix}}clearfix">{{colorList}}</ul>','<div class="{{cssPrefix}}clearfix" style="overflow:hidden">','<input type="button" class="{{cssPrefix}}palette-toggle-slider" value="{{detailTxt}}" />','<input type="text" class="{{cssPrefix}}palette-hex" value="{{color}}" maxlength="7" />','<span class="{{cssPrefix}}palette-preview" style="background-color:{{color}};color:{{color}}">{{color}}</span>',"</div>"].join("\n");t.exports={layout:i,item:'<li><input class="{{cssPrefix}}palette-button{{selected}}{{itemClass}}" type="button" style="{{itemStyle}}" title="{{color}}" value="{{color}}" /></li>',itemStyle:"background-color:{{color}};color:{{color}}"}},function(t,e,i){"use strict";var n=i(8),r=i(7),o=i(9),s=i(19),a=i(14),c=i(11),l=i(12),h=i(20),u=[-7,112],f=[-3,115];function d(t,e){(e=r.appendHTMLElement("div",e,t.cssPrefix+"slider-container")).style.display="none",c.call(this,t,e),this.options=n.extend({color:"#f8f8f8",cssPrefix:"tui-colorpicker-"},t),this._dragDataCache={},this.sliderHandleElement=null,this.huebarHandleElement=null,this.baseColorElement=null,this.drag=new l({distance:0},e),this.drag.on({dragStart:this._onDragStart,drag:this._onDrag,dragEnd:this._onDragEnd,click:this._onClick},this)}n.inherit(d,c),d.prototype._beforeDestroy=function(){this.drag.off(),this.drag=this.options=this._dragDataCache=this.sliderHandleElement=this.huebarHandleElement=this.baseColorElement=null},d.prototype.toggle=function(t){this.container.style.display=t?"block":"none"},d.prototype.isVisible=function(){return"block"===this.container.style.display},d.prototype.render=function(t){var e,i,n=this.container,o=this.options,s=h.layout;a.isValidRGB(t)&&(s=(s=(s=s.replace(/{{slider}}/,h.slider)).replace(/{{huebar}}/,h.huebar)).replace(/{{cssPrefix}}/g,o.cssPrefix),this.container.innerHTML=s,this.sliderHandleElement=r.find("."+o.cssPrefix+"slider-handle",n),this.huebarHandleElement=r.find("."+o.cssPrefix+"huebar-handle",n),this.baseColorElement=r.find("."+o.cssPrefix+"slider-basecolor",n),e=a.hexToRGB(t),i=a.rgbToHSV.apply(null,e),this.moveHue(i[0],!0),this.moveSaturationAndValue(i[1],i[2],!0))},d.prototype._moveColorSliderHandle=function(t,e,i){var n,r=this.sliderHandleElement;e=Math.max(u[0],e),e=Math.min(u[1],e),t=Math.max(u[0],t),t=Math.min(u[1],t),s.setTranslateXY(r,t,e),n=e>50?"white":"black",s.setStrokeColor(r,n),i||this.fire("_selectColor",{color:a.rgbToHEX.apply(null,this.getRGB())})},d.prototype.moveSaturationAndValue=function(t,e,i){var n,r,o,s;t=t||0,e=e||0,n=Math.abs(u[0]),o=t*(r=u[1])/100-n,s=r-e*r/100-n,this._moveColorSliderHandle(o,s,i)},d.prototype._moveColorSliderByPosition=function(t,e){var i=u[0];this._moveColorSliderHandle(t+i,e+i)},d.prototype.getSaturationAndValue=function(){var t=Math.abs(u[0]),e=t+u[1],i=s.getTranslateXY(this.sliderHandleElement);return[(i[1]+t)/e*100,100-(i[0]+t)/e*100]},d.prototype._moveHueHandle=function(t,e){var i,n,r=this.huebarHandleElement,o=this.baseColorElement;t=Math.max(f[0],t),t=Math.min(f[1],t),s.setTranslateY(r,t),i=a.hsvToRGB(this.getHue(),100,100),n=a.rgbToHEX.apply(null,i),s.setGradientColorStop(o,n),e||this.fire("_selectColor",{color:a.rgbToHEX.apply(null,this.getRGB())})},d.prototype.moveHue=function(t,e){var i,n;i=((n=Math.abs(f[0]))+f[1])*(t=t||0)/359.99-n,this._moveHueHandle(i,e)},d.prototype._moveHueByPosition=function(t){var e=f[0];this._moveHueHandle(t+e)},d.prototype.getHue=function(){var t,e,i=this.huebarHandleElement,n=s.getTranslateXY(i);return e=(t=Math.abs(f[0]))+f[1],359.99*(n[0]+t)/e},d.prototype.getHSV=function(){var t=this.getSaturationAndValue();return[this.getHue()].concat(t)},d.prototype.getRGB=function(){return a.hsvToRGB.apply(null,this.getHSV())},d.prototype._prepareColorSliderForMouseEvent=function(t){var e=this.options,i=r.closest(t.target,"."+e.cssPrefix+"slider-part");return this._dragDataCache={isColorSlider:r.hasClass(i,e.cssPrefix+"slider-left"),parentElement:i}},d.prototype._onClick=function(t){var e=this._prepareColorSliderForMouseEvent(t),i=o.getMousePosition(t.originEvent,e.parentElement);e.isColorSlider?this._moveColorSliderByPosition(i[0],i[1]):this._moveHueByPosition(i[1]),this._dragDataCache=null},d.prototype._onDragStart=function(t){this._prepareColorSliderForMouseEvent(t)},d.prototype._onDrag=function(t){var e=this._dragDataCache,i=o.getMousePosition(t.originEvent,e.parentElement);e.isColorSlider?this._moveColorSliderByPosition(i[0],i[1]):this._moveHueByPosition(i[1])},d.prototype._onDragEnd=function(){this._dragDataCache=null},n.CustomEvents.mixin(d),t.exports=d},function(t,e,i){"use strict";var n=i(8),r=/[\.\-0-9]+/g,o={isOldBrowser:function(){var t=o._isOldBrowser;return n.isExisty(t)||(o._isOldBrowser=t=n.browser.msie&&n.browser.version<9),t},getTranslateXY:function(t){var e;return o.isOldBrowser()?(e=t.style,[parseFloat(e.top),parseFloat(e.left)]):(e=t.getAttribute("transform"))?(e=e.match(r),[parseFloat(e[1]),parseFloat(e[0])]):[0,0]},setTranslateXY:function(t,e,i){o.isOldBrowser()?(t.style.left=e+"px",t.style.top=i+"px"):t.setAttribute("transform","translate("+e+","+i+")")},setTranslateY:function(t,e){o.isOldBrowser()?t.style.top=e+"px":t.setAttribute("transform","translate(-6,"+e+")")},setStrokeColor:function(t,e){o.isOldBrowser()?t.strokecolor=e:t.setAttribute("stroke",e)},setGradientColorStop:function(t,e){o.isOldBrowser()?t.color=e:t.setAttribute("stop-color",e)}};t.exports=o},function(t,e,i){(function(e){"use strict";var n=i(8),r=['<div class="{{cssPrefix}}slider-left {{cssPrefix}}slider-part">{{slider}}</div>','<div class="{{cssPrefix}}slider-right {{cssPrefix}}slider-part">{{huebar}}</div>'].join("\n"),o=['<svg class="{{cssPrefix}}svg {{cssPrefix}}svg-slider">',"<defs>",'<linearGradient id="{{cssPrefix}}svg-fill-color" x1="0%" y1="0%" x2="100%" y2="0%">','<stop offset="0%" stop-color="rgb(255,255,255)" />','<stop class="{{cssPrefix}}slider-basecolor" offset="100%" stop-color="rgb(255,0,0)" />',"</linearGradient>",'<linearGradient id="{{cssPrefix}}svn-fill-black" x1="0%" y1="0%" x2="0%" y2="100%">','<stop offset="0%" style="stop-color:rgb(0,0,0);stop-opacity:0" />','<stop offset="100%" style="stop-color:rgb(0,0,0);stop-opacity:1" />',"</linearGradient>","</defs>",'<rect width="100%" height="100%" fill="url(#{{cssPrefix}}svg-fill-color)"></rect>','<rect width="100%" height="100%" fill="url(#{{cssPrefix}}svn-fill-black)"></rect>','<path transform="translate(0,0)" class="{{cssPrefix}}slider-handle" d="M0 7.5 L15 7.5 M7.5 15 L7.5 0 M2 7 a5.5 5.5 0 1 1 0 1 Z" stroke="black" stroke-width="0.75" fill="none" />',"</svg>"].join("\n"),s=['<div class="{{cssPrefix}}vml-slider">','<v:rect strokecolor="none" class="{{cssPrefix}}vml {{cssPrefix}}vml-slider-bg">','<v:fill class="{{cssPrefix}}vml {{cssPrefix}}slider-basecolor" type="gradient" method="none" color="#ff0000" color2="#fff" angle="90" />',"</v:rect>",'<v:rect strokecolor="#ccc" class="{{cssPrefix}}vml {{cssPrefix}}vml-slider-bg">','<v:fill type="gradient" method="none" color="black" color2="white" o:opacity2="0%" class="{{cssPrefix}}vml" />',"</v:rect>",'<v:shape class="{{cssPrefix}}vml {{cssPrefix}}slider-handle" coordsize="1 1" style="width:1px;height:1px;"path="m 0,7 l 14,7 m 7,14 l 7,0 ar 12,12 2,2 z" filled="false" stroked="true" />',"</div>"].join("\n"),a=['<svg class="{{cssPrefix}}svg {{cssPrefix}}svg-huebar">',"<defs>",'<linearGradient id="g" x1="0%" y1="0%" x2="0%" y2="100%">','<stop offset="0%" stop-color="rgb(255,0,0)" />','<stop offset="16.666%" stop-color="rgb(255,255,0)" />','<stop offset="33.333%" stop-color="rgb(0,255,0)" />','<stop offset="50%" stop-color="rgb(0,255,255)" />','<stop offset="66.666%" stop-color="rgb(0,0,255)" />','<stop offset="83.333%" stop-color="rgb(255,0,255)" />','<stop offset="100%" stop-color="rgb(255,0,0)" />',"</linearGradient>","</defs>",'<rect width="18px" height="100%" fill="url(#g)"></rect>','<path transform="translate(-6,-3)" class="{{cssPrefix}}huebar-handle" d="M0 0 L4 4 L0 8 L0 0 Z" fill="black" stroke="none" />',"</svg>"].join("\n"),c=['<div class="{{cssPrefix}}vml-huebar">','<v:rect strokecolor="#ccc" class="{{cssPrefix}}vml {{cssPrefix}}vml-huebar-bg">','<v:fill type="gradient" method="none" colors="0% rgb(255,0,0), 16.666% rgb(255,255,0), 33.333% rgb(0,255,0), 50% rgb(0,255,255), 66.666% rgb(0,0,255), 83.333% rgb(255,0,255), 100% rgb(255,0,0)" angle="180" class="{{cssPrefix}}vml" />',"</v:rect>",'<v:shape class="{{cssPrefix}}vml {{cssPrefix}}huebar-handle" coordsize="1 1" style="width:1px;height:1px;position:absolute;z-index:1;right:22px;top:-3px;"path="m 0,0 l 4,4 l 0,8 l 0,0 z" filled="true" fillcolor="black" stroked="false" />',"</div>"].join("\n"),l=n.browser.msie&&n.browser.version<9;l&&e.document.namespaces.add("v","urn:schemas-microsoft-com:vml"),t.exports={layout:r,slider:l?s:o,huebar:l?c:a}}).call(e,function(){return this}())}])})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i(51),i(50);var n=i(30),r=i(29);function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var s=i(28),a=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.instance=null,this.selector=null,this.config=Object.assign({},i,{theme:i&&"white"===i.theme?r.whiteTheme:n.blackTheme,maxWidth:700,maxHeight:500,menuBarPosition:"bottom"}),console.log(this.config)}return function(t,e,i){e&&o(t.prototype,e),i&&o(t,i)}(t,[{key:"load",value:function(t,e){this.selector=document.querySelector(t),this.config.loadImage={path:e,name:"SampleImage"};var i={includeUI:this.config,cssMaxWidth:this.config.maxHeight,cssMaxHeight:this.config.maxWidth,selectionStyle:{cornerSize:20,rotatingPointOffset:70}};this.instance=new s(this.selector,i)}}]),t}();e.default=a,t.exports=e.default}])});
//# sourceMappingURL=photo-editor-cloud.min.js.map